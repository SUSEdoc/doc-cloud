<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Security Guide | SUSE OpenStack Cloud 8</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.17 (based on DocBook XSL Stylesheets 1.79.2)" /><meta name="product-name" content="SUSE OpenStack Cloud" /><meta name="product-number" content="8" /><meta name="book-title" content="Security Guide" /><meta name="description" content="This topic explains how to achieve more granular access control for your Neutron networks." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 8" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft single offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #FABEBE;"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs inactive"><a class="single-crumb" href="#book-security" accesskey="c"><span class="single-contents-icon"></span>Security Guide</a><div class="bubble-corner active-contents"></div></div><div class="clearme"></div></div></div><div id="_fixed-header-wrap" style="background-color: #FABEBE;" class="inactive"><div id="_fixed-header"><div class="crumbs inactive"><a class="single-crumb" href="#book-security" accesskey="c"><span class="single-contents-icon"></span>Show Contents: Security Guide</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="clearme"></div></div><div class="clearme"></div></div><div class="active-contents bubble"><div class="bubble-container"><div id="_bubble-toc"><ol><li class="inactive"><a href="#newsecurity"><span class="number">1 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Features Overview</span></a></li><li class="inactive"><a href="#barbican"><span class="number">2 </span><span class="name">Key Management with the Barbican Service</span></a></li><li class="inactive"><a href="#barbicanAdmin"><span class="number">3 </span><span class="name">Key Management Service Administration</span></a></li><li class="inactive"><a href="#roleSegregation"><span class="number">4 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Service Admin Role Segregation in the Identity Service</span></a></li><li class="inactive"><a href="#cha-security-rbac"><span class="number">5 </span><span class="name">Role-Based Access Control in Neutron</span></a></li><li class="inactive"><a href="#x509-certificate-auth"><span class="number">6 </span><span class="name">Configuring Keystone and Horizon to use X.509 Client Certificates</span></a></li><li class="inactive"><a href="#tls30overview"><span class="number">7 </span><span class="name">Transport Layer Security (TLS) Overview</span></a></li><li class="inactive"><a href="#header-poisoning"><span class="number">8 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Preventing Host Header Poisoning</span></a></li><li class="inactive"><a href="#password-encryption"><span class="number">9 </span><span class="name">Encryption of Passwords and Sensitive Data</span></a></li><li class="inactive"><a href="#encryption-ephemeral"><span class="number">10 </span><span class="name">Encryption of Ephemeral Volumes</span></a></li><li class="inactive"><a href="#topic-rmq-j1v-4t"><span class="number">11 </span><span class="name">Refining Access Control with AppArmor</span></a></li><li class="inactive"><a href="#dar"><span class="number">12 </span><span class="name">Data at Rest Encryption</span></a></li><li class="inactive"><a href="#glance-rate-limit"><span class="number">13 </span><span class="name">Glance-API Rate Limit (CVE-2016-8611)</span></a></li><li class="inactive"><a href="#idg-all-security-middleware-auditing-xml-1"><span class="number">14 </span><span class="name">Security Audit Logs</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_toc-bubble-wrap"></div><div id="_content" class="draft "><div class="documentation"><div class="book" id="book-security"><div class="titlepage"><div><h6 class="version-info"><span class="productname "><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber "><span class="phrase"><span class="phrase">8</span></span></span></h6><div><h1 class="title">Security Guide <a title="Permalink" class="permalink" href="#book-security">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/book.security.xml" title="Edit the source file for this section">Edit source</a></h1></div><div class="date"><span class="imprint-label">Publication Date: </span>03/04/2021</div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="#newsecurity"><span class="number">1 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Features Overview</span></a></span></dt><dd><dl><dt><span class="section"><a href="#idg-all-security-security-features-xml-6"><span class="number">1.1 </span><span class="name">Security features in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span></span></a></span></dt><dt><span class="section"><a href="#rbac"><span class="number">1.2 </span><span class="name">Role-Based Access Control (RBAC) Support for Neutron Networks</span></a></span></dt><dt><span class="section"><a href="#adminRoles"><span class="number">1.3 </span><span class="name">Separate Service Administrator Role</span></a></span></dt><dt><span class="section"><a href="#interservicePasswords"><span class="number">1.4 </span><span class="name">Inter-service Password Enhancements</span></a></span></dt><dt><span class="section"><a href="#selinux"><span class="number">1.5 </span><span class="name">SELinux for KVM</span></a></span></dt><dt><span class="section"><a href="#in-transit"><span class="number">1.6 </span><span class="name">Data In Transit Protection</span></a></span></dt><dt><span class="section"><a href="#dataSecurity"><span class="number">1.7 </span><span class="name">Data-at-Rest Protection Using Project-Based Encryption</span></a></span></dt><dt><span class="section"><a href="#cadf"><span class="number">1.8 </span><span class="name">CADF-Compliant Security Audit Logs</span></a></span></dt><dt><span class="section"><a href="#pciReady"><span class="number">1.9 </span><span class="name">PCI Readiness</span></a></span></dt><dt><span class="section"><a href="#id-1.5.3.11"><span class="number">1.10 </span><span class="name">Glance-API Rate Limit to Address CVE-2016-8611</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#barbican"><span class="number">2 </span><span class="name">Key Management with the Barbican Service</span></a></span></dt><dd><dl><dt><span class="section"><a href="#idg-all-security-barbican-xml-4"><span class="number">2.1 </span><span class="name">Barbican Service Overview</span></a></span></dt><dt><span class="section"><a href="#features"><span class="number">2.2 </span><span class="name">Key Features</span></a></span></dt><dt><span class="section"><a href="#idg-all-security-barbican-xml-6"><span class="number">2.3 </span><span class="name">Installation</span></a></span></dt><dt><span class="section"><a href="#sec-barbican-audit"><span class="number">2.4 </span><span class="name">Auditing Barbican Events</span></a></span></dt><dt><span class="section"><a href="#id-1.5.4.6"><span class="number">2.5 </span><span class="name">Barbican Key Management Service Bootstrap Data</span></a></span></dt><dt><span class="section"><a href="#idg-all-security-barbican-xml-11"><span class="number">2.6 </span><span class="name">Known issues and workarounds</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#barbicanAdmin"><span class="number">3 </span><span class="name">Key Management Service Administration</span></a></span></dt><dd><dl><dt><span class="section"><a href="#idg-all-security-barbican-admin-xml-6"><span class="number">3.1 </span><span class="name">Post-installation verification and administration</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.3"><span class="number">3.2 </span><span class="name">Updating the Barbican Key Management Service</span></a></span></dt><dt><span class="section"><a href="#idg-all-security-barbican-admin-xml-8"><span class="number">3.3 </span><span class="name">Barbican Settings</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.5"><span class="number">3.4 </span><span class="name">Enable or Disable Auditing of Barbican Events</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.6"><span class="number">3.5 </span><span class="name">Updating the Barbican API Service Configuration File</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.7"><span class="number">3.6 </span><span class="name">Starting and Stopping the Barbican Service</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.8"><span class="number">3.7 </span><span class="name">Changing or Resetting a Password</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.9"><span class="number">3.8 </span><span class="name">Checking Barbican Status</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.10"><span class="number">3.9 </span><span class="name">Updating Logging Configuration</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#roleSegregation"><span class="number">4 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Service Admin Role Segregation in the Identity Service</span></a></span></dt><dd><dl><dt><span class="section"><a href="#idg-all-security-admin-role-segregation-xml-6"><span class="number">4.1 </span><span class="name">Overview</span></a></span></dt><dt><span class="section"><a href="#id-1.5.6.3"><span class="number">4.2 </span><span class="name">Pre-Installed Service Admin Role Components</span></a></span></dt><dt><span class="section"><a href="#id-1.5.6.4"><span class="number">4.3 </span><span class="name">Features and Benefits</span></a></span></dt><dt><span class="section"><a href="#id-1.5.6.5"><span class="number">4.4 </span><span class="name">Roles</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha-security-rbac"><span class="number">5 </span><span class="name">Role-Based Access Control in Neutron</span></a></span></dt><dd><dl><dt><span class="section"><a href="#id-1.5.7.7"><span class="number">5.1 </span><span class="name">Creating a Network</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.8"><span class="number">5.2 </span><span class="name">Creating an RBAC Policy</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.9"><span class="number">5.3 </span><span class="name">Listing RBACs</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.10"><span class="number">5.4 </span><span class="name">Listing the Attributes of an RBAC</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.11"><span class="number">5.5 </span><span class="name">Deleting an RBAC Policy</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.12"><span class="number">5.6 </span><span class="name">Sharing a Network with All Tenants</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.13"><span class="number">5.7 </span><span class="name">Target Project (<code class="literal">demo2</code>) View of Networks and Subnets</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.14"><span class="number">5.8 </span><span class="name">Target Project: Creating a Port Using demo-net</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.15"><span class="number">5.9 </span><span class="name">Target Project Booting a VM Using Demo-Net</span></a></span></dt><dt><span class="section"><a href="#sec-security-rbac-limitation"><span class="number">5.10 </span><span class="name">Limitations</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#x509-certificate-auth"><span class="number">6 </span><span class="name">Configuring Keystone and Horizon to use X.509 Client Certificates</span></a></span></dt><dd><dl><dt><span class="section"><a href="#id-1.5.8.4"><span class="number">6.1 </span><span class="name">Keystone configuration</span></a></span></dt><dt><span class="section"><a href="#section-p5j-4lq-mx"><span class="number">6.2 </span><span class="name">HAProxy Configuration</span></a></span></dt><dt><span class="section"><a href="#section-mqr-m2p-hx"><span class="number">6.3 </span><span class="name">Create CA and client certificates</span></a></span></dt><dt><span class="section"><a href="#section-qjc-42p-hx"><span class="number">6.4 </span><span class="name">Horizon configuration</span></a></span></dt><dt><span class="section"><a href="#section-chx-42p-hx"><span class="number">6.5 </span><span class="name">Browser configuration</span></a></span></dt><dt><span class="section"><a href="#section-u54-p2p-hx"><span class="number">6.6 </span><span class="name">User accounts</span></a></span></dt><dt><span class="section"><a href="#section-hbf-q2p-hx"><span class="number">6.7 </span><span class="name">How it works</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#tls30overview"><span class="number">7 </span><span class="name">Transport Layer Security (TLS) Overview</span></a></span></dt><dd><dl><dt><span class="section"><a href="#id-1.5.9.6"><span class="number">7.1 </span><span class="name">Comparing Clean Installation and Upgrade of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span></a></span></dt><dt><span class="section"><a href="#idg-all-security-tls-config-xml-1"><span class="number">7.2 </span><span class="name">TLS Configuration</span></a></span></dt><dt><span class="section"><a href="#TLS-MySQL"><span class="number">7.3 </span><span class="name">Enabling TLS for MySQL Traffic</span></a></span></dt><dt><span class="section"><a href="#TLS-RabbitMQ"><span class="number">7.4 </span><span class="name">Enabling TLS for RabbitMQ Traffic</span></a></span></dt><dt><span class="section"><a href="#troubleshootng-tls"><span class="number">7.5 </span><span class="name">Troubleshooting TLS</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#header-poisoning"><span class="number">8 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Preventing Host Header Poisoning</span></a></span></dt><dt><span class="chapter"><a href="#password-encryption"><span class="number">9 </span><span class="name">Encryption of Passwords and Sensitive Data</span></a></span></dt><dd><dl><dt><span class="section"><a href="#id-1.5.11.4"><span class="number">9.1 </span><span class="name">SSH Introduction</span></a></span></dt><dt><span class="section"><a href="#protection"><span class="number">9.2 </span><span class="name">Protecting sensitive data on the Cloud Lifecycle Manager</span></a></span></dt><dt><span class="section"><a href="#id-1.5.11.6"><span class="number">9.3 </span><span class="name">Interacting with Encrypted Files</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#encryption-ephemeral"><span class="number">10 </span><span class="name">Encryption of Ephemeral Volumes</span></a></span></dt><dd><dl><dt><span class="section"><a href="#id-1.5.12.4"><span class="number">10.1 </span><span class="name">Enabling ephemeral volume encryption</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#topic-rmq-j1v-4t"><span class="number">11 </span><span class="name">Refining Access Control with AppArmor</span></a></span></dt><dd><dl><dt><span class="section"><a href="#apparmor-openstack"><span class="number">11.1 </span><span class="name">AppArmor in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span></span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#dar"><span class="number">12 </span><span class="name">Data at Rest Encryption</span></a></span></dt><dd><dl><dt><span class="section"><a href="#configure-KMIP-ESKM"><span class="number">12.1 </span><span class="name">Configuring KMIP and ESKM</span></a></span></dt><dt><span class="section"><a href="#id-1.5.14.9"><span class="number">12.2 </span><span class="name">Configuring Cinder volumes for encryption</span></a></span></dt><dt><span class="section"><a href="#id-1.5.14.10"><span class="number">12.3 </span><span class="name">For More Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#glance-rate-limit"><span class="number">13 </span><span class="name">Glance-API Rate Limit (CVE-2016-8611)</span></a></span></dt><dt><span class="chapter"><a href="#idg-all-security-middleware-auditing-xml-1"><span class="number">14 </span><span class="name">Security Audit Logs</span></a></span></dt><dd><dl><dt><span class="section"><a href="#id-1.5.16.2"><span class="number">14.1 </span><span class="name">The need for auditing</span></a></span></dt><dt><span class="section"><a href="#id-1.5.16.3"><span class="number">14.2 </span><span class="name">Audit middleware</span></a></span></dt><dt><span class="section"><a href="#id-1.5.16.4"><span class="number">14.3 </span><span class="name">Centralized auditing configuration</span></a></span></dt></dl></dd></dl></div><div class="list-of-examples"><div class="toc-title">List of Examples</div><dl><dt><span class="example"><a href="#privateMetadata"><span class="number">7.1 </span><span class="name">Certificate request file</span></a></span></dt></dl></div><div><div class="legalnotice" id="id-1.5.2.1"><p>
  Copyright © 2006–
2021

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Except where otherwise noted, this document is licensed under
  <span class="bold"><strong>Creative Commons Attribution 3.0 License
  </strong></span>:
  <a class="link" href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">


  </a>
 </p><p>
  For SUSE trademarks, see
  <a class="link" href="http://www.suse.com/company/legal/" target="_blank">http://www.suse.com/company/legal/</a>. All other
  third-party trademarks are the property of their respective owners. Trademark
  symbols (®, ™ etc.) denote trademarks of SUSE and its affiliates.
  Asterisks (*) denote third-party trademarks.
 </p><p>
  All information found in this book has been compiled with utmost attention
  to detail. However, this does not guarantee complete accuracy. Neither
  SUSE LLC, its affiliates, the authors nor the translators shall be held
  liable for possible errors or the consequences thereof.
 </p></div></div><div class="chapter " id="newsecurity"><div class="titlepage"><div><div><h1 class="title"><span class="number">1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Features Overview</span> <a title="Permalink" class="permalink" href="#newsecurity">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>newsecurity</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#idg-all-security-security-features-xml-6"><span class="number">1.1 </span><span class="name">Security features in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span></span></a></span></dt><dt><span class="section"><a href="#rbac"><span class="number">1.2 </span><span class="name">Role-Based Access Control (RBAC) Support for Neutron Networks</span></a></span></dt><dt><span class="section"><a href="#adminRoles"><span class="number">1.3 </span><span class="name">Separate Service Administrator Role</span></a></span></dt><dt><span class="section"><a href="#interservicePasswords"><span class="number">1.4 </span><span class="name">Inter-service Password Enhancements</span></a></span></dt><dt><span class="section"><a href="#selinux"><span class="number">1.5 </span><span class="name">SELinux for KVM</span></a></span></dt><dt><span class="section"><a href="#in-transit"><span class="number">1.6 </span><span class="name">Data In Transit Protection</span></a></span></dt><dt><span class="section"><a href="#dataSecurity"><span class="number">1.7 </span><span class="name">Data-at-Rest Protection Using Project-Based Encryption</span></a></span></dt><dt><span class="section"><a href="#cadf"><span class="number">1.8 </span><span class="name">CADF-Compliant Security Audit Logs</span></a></span></dt><dt><span class="section"><a href="#pciReady"><span class="number">1.9 </span><span class="name">PCI Readiness</span></a></span></dt><dt><span class="section"><a href="#id-1.5.3.11"><span class="number">1.10 </span><span class="name">Glance-API Rate Limit to Address CVE-2016-8611</span></a></span></dt></dl></div></div><div class="sect1" id="idg-all-security-security-features-xml-6"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Security features in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span></span> <a title="Permalink" class="permalink" href="#idg-all-security-security-features-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>idg-all-security-security-features-xml-6</li></ul></div></div></div></div><p>
   Enterprises need protection against security breaches, insider threats, and
   operational issues that increase the risk to sensitive data. By combining
   technologies from both <span class="productname">OpenStack</span> services and Micro Focus Security–Data
   Security products, <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span> provides capabilities that help you
   protect your data at rest and in transit, enable centralized key management,
   and comply with Payment Card Industry Data Security Standard (PCI-DSS).
  </p><p>
   In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, a number of security enhancements are available to
   strengthen and harden your cloud deployment. Below is an overview of some of
   the features and brief descriptions. Follow the links to the relevant topics
   for instructions on setup, configuration, and use of these security
   features.
  </p></div><div class="sect1" id="rbac"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Role-Based Access Control (RBAC) Support for Neutron Networks</span> <a title="Permalink" class="permalink" href="#rbac">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>rbac</li></ul></div></div></div></div><p>
   The RBAC feature in this release enables better security as administrators
   can now control who has access to specific networks. This is a significant
   improvement over the previous all-or-nothing approach to shared networks.
   This is beneficial from a security standpoint as some projects (or tenants)
   have stricter security policies. For example, a finance department must run
   PCI-compliant workloads in isolation from other departments, and thus cannot
   share their Neutron network resources. RBAC enables cloud admins to create
   granular security policies for sharing Neutron resources with one or more
   tenants or projects using the standard CRUD (Create, Read, Update, Delete)
   model. More information can be found in
   <a class="xref" href="#cha-security-rbac" title="Chapter 5. Role-Based Access Control in Neutron">Chapter 5, <em>Role-Based Access Control in Neutron</em></a>.
  </p></div><div class="sect1" id="adminRoles"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Separate Service Administrator Role</span> <a title="Permalink" class="permalink" href="#adminRoles">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>adminRoles</li></ul></div></div></div></div><p>
   Each <span class="productname">OpenStack</span> service account now has an optional role available to
   restrict the <span class="productname">OpenStack</span> functions each account can access. This feature
   enables cloud administrators to apply service-specific role-based,
   admin-level access to a specific UserID, with the ability to audit
   admin-level actions. This functionality provides better security by not only
   providing full visibility into admin-level activities via audit logs, but
   also by fulfilling compliance requirements such as PCI DSS v3.1 standards.
   More information in
   <a class="xref" href="#idg-all-security-admin-role-segregation-xml-6" title="4.1. Overview">Section 4.1, “Overview”</a>.
  </p></div><div class="sect1" id="interservicePasswords"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Inter-service Password Enhancements</span> <a title="Permalink" class="permalink" href="#interservicePasswords">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>interservicePasswords</li></ul></div></div></div></div><p>
   You can conveniently change the inter-service passwords used for
   authenticating communications between services in your <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> deployment,
   promoting better compliance with your organization’s security policies.
   The inter-service passwords that can be changed include (but are not limited
   to) Keystone, MariaDB, RabbitMQ, Cloud Lifecycle Manager, Monasca and Barbican. Admins can
   implement this feature by running the configuration processor to generate
   new passwords followed by Ansible playbook commands to change the
   credentials.
  </p></div><div class="sect1" id="selinux"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">SELinux for KVM</span> <a title="Permalink" class="permalink" href="#selinux">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>selinux</li></ul></div></div></div></div><p>
   SELinux (also known as Security-Enhanced Linux) provides enhanced security
   at the hypervisor layer on Compute Nodes by mitigating the risk of hypervisor
   attacks and strongly isolating the guest VMs. It enforces mandatory access
   control security policies for the Compute Nodes (svirt process) running KVM,
   thus reducing the risk of a hypervisor breakout. By providing a locked down
   profile for the KVM/QEMU processes that the guest VMs run in, it strongly
   isolates the guest VMs. With such strong security measures as SELinux,
   malicious attacks on VMs and the underlying host OS are much less
   possible. SELinux provides enhanced security for instances managed by
   <code class="literal">libvirt</code>. It does not, however, provide enhanced security
   for <span class="productname">OpenStack</span> processes.
  </p></div><div class="sect1" id="in-transit"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Data In Transit Protection</span> <a title="Permalink" class="permalink" href="#in-transit">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>in-transit</li></ul></div></div></div></div><p>
   With <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, data transmission between internal API endpoints is
   encrypted using TLS v 1.2 to protect sensitive data against unauthorized
   disclosure and modification (spoofing and tampering attacks). Additionally,
   you can configure TLS using your own certificates, from a Certificate
   Authority of your choice, providing deployment flexibility. More at
   <a class="xref" href="#idg-all-security-tls-config-xml-1" title="7.2. TLS Configuration">Section 7.2, “TLS Configuration”</a>.
  </p></div><div class="sect1" id="dataSecurity"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Data-at-Rest Protection Using Project-Based Encryption</span> <a title="Permalink" class="permalink" href="#dataSecurity">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>dataSecurity</li></ul></div></div></div></div><p>
   You can encrypt sensitive data-at-rest on per tenant or project basis, while
   storing and managing keys externally and centrally using Enterprise Secure
   Key Manager (ESKM). This capability requires the Barbican API and
   OASIS KMIP (Key Management Interoperability Protocol) plug-ins for
   integration, and supports encryption of Cinder block storage with
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>. More information at <a class="xref" href="#dar" title="Chapter 12. Data at Rest Encryption">Chapter 12, <em>Data at Rest Encryption</em></a>.
  </p></div><div class="sect1" id="cadf"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">CADF-Compliant Security Audit Logs</span> <a title="Permalink" class="permalink" href="#cadf">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>cadf</li></ul></div></div></div></div><p>
   Security audit logs for critical services such as Keystone, Nova, Cinder,
   Glance, Heat, Neutron, Barbican are available in a standard CADF (Cloud
   Audit Data Federation) format. These logs contain information on events such
   as unauthorized logins, admin level access, unsuccessful login attempts, and
   anomalous deletion of VMs that are critical from a security threat
   monitoring standpoint. Audit logs are useful as a tool for risk mitigation,
   identifying suspicious or anomalous activity, and for fulfilling compliance.
   For more information see
   <a class="xref" href="#idg-all-security-middleware-auditing-xml-1" title="Chapter 14. Security Audit Logs">Chapter 14, <em>Security Audit Logs</em></a>.
  </p></div><div class="sect1" id="pciReady"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">PCI Readiness</span> <a title="Permalink" class="permalink" href="#pciReady">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span>pciReady</li></ul></div></div></div></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span> is PCI (Payment Card Industry) ready, enabling retail and
   finance industries that are subject to PCI compliance, to become certified.
   The readiness is based on lab assessment and verification conducted by an
   external audit firm, against the more than 250 security requirements
   specified in the PCI DSS (Data Security Standard) v3.1 standards document.
   Since <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> satisfies the requirements that fall under vendor
   responsibility, customers can proceed with their certification efforts with
   full confidence and peace of mind that <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> will not be a blocker.
  </p></div><div class="sect1" id="id-1.5.3.11"><div class="titlepage"><div><div><h2 class="title"><span class="number">1.10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Glance-API Rate Limit to Address CVE-2016-8611</span> <a title="Permalink" class="permalink" href="#id-1.5.3.11">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-security_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-security_features.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   No limits are enforced within the Glance service for both v1 and v2/images
   API POST method for authenticated users, resulting in possible denial of
   service through database table saturation. Further explanation and
   instructions for adding a rate-limiter are in <a class="xref" href="#glance-rate-limit" title="Chapter 13. Glance-API Rate Limit (CVE-2016-8611)">Chapter 13, <em>Glance-API Rate Limit (CVE-2016-8611)</em></a>.
  </p></div></div><div class="chapter " id="barbican"><div class="titlepage"><div><div><h1 class="title"><span class="number">2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Key Management with the Barbican Service</span> <a title="Permalink" class="permalink" href="#barbican">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>barbican</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#idg-all-security-barbican-xml-4"><span class="number">2.1 </span><span class="name">Barbican Service Overview</span></a></span></dt><dt><span class="section"><a href="#features"><span class="number">2.2 </span><span class="name">Key Features</span></a></span></dt><dt><span class="section"><a href="#idg-all-security-barbican-xml-6"><span class="number">2.3 </span><span class="name">Installation</span></a></span></dt><dt><span class="section"><a href="#sec-barbican-audit"><span class="number">2.4 </span><span class="name">Auditing Barbican Events</span></a></span></dt><dt><span class="section"><a href="#id-1.5.4.6"><span class="number">2.5 </span><span class="name">Barbican Key Management Service Bootstrap Data</span></a></span></dt><dt><span class="section"><a href="#idg-all-security-barbican-xml-11"><span class="number">2.6 </span><span class="name">Known issues and workarounds</span></a></span></dt></dl></div></div><div class="sect1" id="idg-all-security-barbican-xml-4"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Barbican Service Overview</span> <a title="Permalink" class="permalink" href="#idg-all-security-barbican-xml-4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-xml-4</li></ul></div></div></div></div><p>
   Barbican is an <span class="productname">OpenStack</span> key management service offering secure storage,
   provisioning, and management of key data. The Barbican service provides
   management of secrets, keys and certificates via multiple storage back-ends.
   The support for various back ends is provided via a plug-in mechanism, a Key
   Management Interoperability Protocol (KMIP) plug-in for a KMIP-compliant HSM
   Hardware Secure Module (HSM) device. Barbican supports symmetric and
   asymmetric key generation using various algorithms. Cinder, neutron-lbaas v2
   and Nova will integrate with Barbican for their encryption key
   generation and storage.
  </p><p>
   Barbican has two types of core feature sets:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The <span class="emphasis"><em>Barbican component</em></span>, a Web Server Gateway
     Interface (WSGI) application that exposes a REST API for
     secrets/containers/orders.
    </p></li><li class="listitem "><p>
     <span class="emphasis"><em>Barbican workers</em></span> for asynchronous processing,
     which is used for various messaging-event-driven tasks related to
     certificate generation.
    </p></li></ul></div></div><div class="sect1" id="features"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Key Features</span> <a title="Permalink" class="permalink" href="#features">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>features</li></ul></div></div></div></div><p>
   The major features of the Barbican key management service are:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The ability to encrypt volumes/disks. In an <span class="productname">OpenStack</span> context, this
     means support for encrypting Cinder volumes (volume encryption). Cinder
     has its own key manager interface (KeyMgr) and can use BarbicanClient as
     one of its implementations. By default in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, Cinder uses
     Barbican as its key manager when Barbican is enabled. KeyMgr
     encrypts data
     in the virtualization host before writing data to the remote disk. There
     are three options available in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       Tenant-based encryption for block volume storage using Barbican
       for KMS,
      </p></li><li class="listitem "><p>
       Barbican with KMIP and PKCS11 and external KMS (certified with
       Micro Focus ESKM),
      </p></li><li class="listitem "><p>
       3PAR StoreServ Data-At-Rest Encryption,
      </p></li></ul></div></li><li class="listitem "><p>
     Storage and retrieval of secrets (passwords)
    </p></li><li class="listitem "><p>
     Certificate management for Load Balancer as a Service V2 (previously known
     as Neutron-LBaaS)
    </p></li><li class="listitem "><p>
     The ability to define and manage access policies for key material
    </p></li><li class="listitem "><p>
     Administrative functionality, and the ability to control the lifecycle of
     key material
    </p></li><li class="listitem "><p>
     A well-defined auditing ability in <span class="productname">OpenStack</span> services for key access
     and lifecycle events
    </p></li><li class="listitem "><p>
     Key management as a service for PaaS application(s) deployed on an
     <span class="productname">OpenStack</span> cloud
    </p></li><li class="listitem "><p>
     The ability to scale key management effectively and make it highly
     available (able to handle failover)
    </p></li></ul></div><div id="id-1.5.4.3.4" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning</h6><p>
    Do not delete the certificate container associated with your load balancer
    listeners before deleting the load balancers themselves. If you delete the
    certificate first, future operations on your load balancers and failover
    will stop working.
   </p></div></div><div class="sect1" id="idg-all-security-barbican-xml-6"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Installation</span> <a title="Permalink" class="permalink" href="#idg-all-security-barbican-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-xml-6</li></ul></div></div></div></div><p>
   New installations of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     For new installations, no changes are needed for Barbican to be
     enabled.
     When installing your cloud, you should use the input models which already
     define the necessary Barbican components. When using the pre-defined
     input model files that come with <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, nothing else needs to be
     done in those files.
    </p></li><li class="listitem "><p>
     Generate a master key.
    </p><div id="id-1.5.4.4.3.2.2" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning</h6><p>
      Do not change your master key after deploying it to Barbican.
     </p></div></li><li class="listitem "><p>
     If you decide to make configuration changes to your clean install of
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, you will need to redeploy the Barbican service. For
     details on available customization options, please see
     <a class="xref" href="#barbicanAdmin" title="Chapter 3. Key Management Service Administration">Chapter 3, <em>Key Management Service Administration</em></a>.
    </p></li></ul></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.4.4"><span class="name">Master Key Configuration</span><a title="Permalink" class="permalink" href="#id-1.5.4.4.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><p>
   Barbican currently supports databases and KMIP as its secret store
   back-ends.
   In <span class="productname">OpenStack</span> upstream additional back-ends are available, such as the
   PKCS11 and dogtag plug-ins, but they are not tested or supported by
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
  </p><p>
   In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, by default Barbican is configured to use a database as a
   secret (keys) storage back-end.
   This back-end encrypts Barbican-managed keys with a
   project level key (<span class="emphasis"><em>KEK</em></span>/Key Encryption Key) before
   storing it in the database. Project-level keys are encrypted using a master
   key. As part of the initial Barbican configuration, you must generate
   and configure this master key.
  </p><p>
   When Barbican is used with <code class="literal">simple_crypto_plugin</code> as
   its secret store back-end, its master key needs to be defined
   <span class="bold"><strong>before initial deployment</strong></span>. If no key is
   specified before deployment, the default master key is
   used—<span class="bold"><strong>this practice is discouraged</strong></span>.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Generate the master key using the provided python *generate_kek* script on
     the Cloud Lifecycle Manager node:
    </p><div class="verbatim-wrap"><pre class="screen">python ~/openstack/ardana/ansible/roles/KEYMGR-API/templates/generate_kek</pre></div><p>
     The master key is generated at stdout from this command.
    </p></li><li class="step "><p>
     Set the master key in
     <code class="filename">~/openstack/my_cloud/config/barbican/barbican_deploy_config.yml</code>.
    </p></li><li class="step "><p>
     If there is an existing <code class="literal">barbican_customer_master_key</code>
     value, replace it with the generated master key you just generated.
    </p></li><li class="step "><p>
     Commit the change to the Git repository:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "My config"</pre></div></li><li class="step "><p>
     Run ready-deployment:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     When the master key is set, continue with your cloud deployment.
    </p></li></ol></div></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.4.9"><span class="name">Upgrade Master Key Configuration</span><a title="Permalink" class="permalink" href="#id-1.5.4.4.9">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Check the master key.
    </p><p>
     If a master key is already defined, check
     <code class="filename">~/openstack/ardana/ansible/roles/barbican-common/vars/barbican_deploy_config.yml</code>
     for <code class="literal">barbican_customer_master_key</code> value. If the value
     does not have a prefix <code class="literal">@ardana@</code>, it is not encrypted.
     It is highly recommended to encrypt this value.
    </p></li><li class="step "><p>
     Encrypt the existing key during upgrade:
    </p><ol type="a" class="substeps "><li class="step "><p>
       Set up the environment variable.
      </p><div class="verbatim-wrap"><pre class="screen">ARDANA_USER_PASSWORD_ENCRYPT_KEY</pre></div><p>
       which contains the key used to encrypt Barbican master key.
      </p></li><li class="step "><p>
       Before you run any playbooks, you need to export the encryption key in
       the following environment variable:
      </p><ol type="i" class="substeps "><li class="step "><div class="verbatim-wrap"><pre class="screen">export ARDANA_USER_PASSWORD_ENCRYPT_KEY=&lt;USER_ENCRYPTION_KEY&gt;</pre></div></li><li class="step "><div class="verbatim-wrap"><pre class="screen">python
*roles/KEYMGR-API/templates/generate_kek &lt;barbican_customer_master_key&gt;</pre></div></li><li class="step "><p>
         Master key is generated at stdout.
        </p></li><li class="step "><p>
         Set this master key in file
        </p><div class="verbatim-wrap"><pre class="screen">~/openstack/ardana/ansible/roles/barbican-common/vars/barbican_deploy_config.yml</pre></div></li><li class="step "><p>
         Replace existing <code class="literal">barbican_customer_master_key</code> value
         with the master key you just generated.
        </p></li><li class="step "><p>
         Commit the change in git repository.
        </p></li><li class="step "><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
         When the master key is set, continue with cloud deployment.
        </p></li></ol></li></ol></li><li class="step "><p>
     Changing the master key during the upgrade process is discouraged.
     Changing the master key will result in a read error for existing secrets
     as they were encrypted using the previous master key.
    </p></li></ol></div></div><div id="id-1.5.4.4.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    For a Barbican deployment with a database back-end, the master key
    needs to be generated and configured before Barbican is deployed for
    the first time.
    Once the master key is set, it must not be modified.
   </p></div><div id="id-1.5.4.4.12" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Changing the master key can result in read errors for existing secrets as
    those secrets are stored in the database and are encrypted using the
    previous master key. Once a new master key is used, Barbican will not
    be able to read those secrets. Also it will not be able to create new
    secrets within that project as the project key is encrypted using previous
    master key.
   </p></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.4.13"><span class="name">KMIP Plug-in Support</span><a title="Permalink" class="permalink" href="#id-1.5.4.4.13">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><p>
   Barbican has a KMIP plug-in to store encryption keys (called secrets in
   Barbican service terminology) in an HSM device using the KMIP protocol.
   This plug-in has been tested against Micro Focus ESKM with KMIP server. To
   enable support for it, Barbican needs to be configured with the
   corresponding plug-in
   connection details, and client certificate information needs to be defined
   in its configuration. The ESKM KMIP server uses a client certificate to
   validate a KMIP client connection established by the Barbican server.
   As part of that KMIP configuration, playbooks provide a mechanism to upload
   your client certs to nodes hosting the Barbican API server.
  </p><p>
   KMIP deployment instructions can be found in
   <a class="xref" href="#configure-KMIP-ESKM" title="12.1. Configuring KMIP and ESKM">Section 12.1, “Configuring KMIP and ESKM”</a>.
  </p><div id="id-1.5.4.4.16" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Installation and deployment of the Micro Focus ESKM or any other HSM devices
    and dependent components is beyond the scope of this document. Please refer
    the relevant documentation for your choice of product. For example, you can
    get more information on Micro Focus ESKM and related Data Security and
    Encryption Products at
    <a class="link" href="https://software.microfocus.com/en-us/products/eskm-enterprise-secure-key-management/overview" target="_blank">https://software.microfocus.com/en-us/products/eskm-enterprise-secure-key-management/overview</a>.
   </p></div></div><div class="sect1" id="sec-barbican-audit"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Auditing Barbican Events</span> <a title="Permalink" class="permalink" href="#sec-barbican-audit">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>sec-barbican-audit</li></ul></div></div></div></div><p>
   The Barbican service supports auditing and uses
   <a class="xref" href="#idg-all-security-middleware-auditing-xml-1" title="Chapter 14. Security Audit Logs">Chapter 14, <em>Security Audit Logs</em></a> to generate
   auditing data in Cloud Auditing Data Federation (CADF) format. The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
   input model has a mechanism to enable and disable auditing on a per-service
   basis. When Barbican auditing is enabled, it writes audit messages to
   an audit log file that is separate from the Barbican internal logging.
   The base location of audit log file is driven by common auditing
   configuration.
  </p><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.5.3"><span class="name">Enabling and Disabling Auditing</span><a title="Permalink" class="permalink" href="#id-1.5.4.5.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><p>
   The auditing of Barbican events can be enabled and disabled through the
   Barbican reconfigure playbook. As part of the configuration of
   Barbican, its audit messages can be directed to a log or to a
   messaging queue. By default, messages are written to the Barbican log
   file. Once an architecture-level decision is made with regards to the
   default consumer of audit events (either logging or messaging), the
   Barbican service can be configured to use
   it as the default option when auditing is enabled.
  </p><p>
   Auditing can be disabled or enabled by following these steps on the Cloud Lifecycle Manager
   node.
  </p><div class="procedure " id="id-1.5.4.5.6"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 2.1: </span><span class="name">Enabling or Disabling Auditing </span><a title="Permalink" class="permalink" href="#id-1.5.4.5.6">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the file
     <code class="literal">~/openstack/my_cloud/definition/cloudConfig.yml</code>. All
     audit-related configuration is defined in the audit-settings section. You
     must use valid YAML syntax when specifying values.
    </p></li><li class="step "><p>
     Any service (including Barbican) that is listed under
     enabled-services or disabled-services will override the default setting.
     To enable auditing, make sure that the Barbican service name is in
     the enabled-services list
     of the <code class="literal">audit-settings</code> section or is not present in
     disabled-services list when default: is set to enabled.
    </p><p>
     The relevant section of <code class="literal">cloudConfig.yml</code> is shown below.
     Enabled-services are commented out.
    </p><p>
     The <code class="literal">default: enabled</code> setting applies to all services.
     If you want to disable (or enable) a few, whichever is the opposite of the
     default global setting you used, you can do so in a disabled-services (or
     enabled-services) section below it. Here the enabled-services entry is
     commented out. You should only have either a default of enabled (or
     disabled) or a section of disabled (or enabled). There is no need to
     duplicate the setting.
    </p><div class="verbatim-wrap"><pre class="screen">audit-settings:
     default: enabled
     #enabled-services:
     #  - keystone
     #  - barbican
     disabled-services:
        - nova
        - barbican
        - keystone
        - cinder
        - ceilometer
        - neutron</pre></div></li><li class="step "><p>
     When you are satisfied with your settings, copy the files to
     <code class="literal">~/openstack/my_cloud/definition/</code>, and commit the
     changes in the git repository. For example, if you are using the Entry
     Scale KVM model, you would copy from
     <code class="filename">~/openstack/examples/entry-scale-kvm</code> and commit.
    </p><div class="verbatim-wrap"><pre class="screen"> cp -r ~/openstack/examples/entry-scale-kvm/* ~/openstack/my_cloud/definition/
 cd ~/openstack
 git add -A
 git commit -m "My config"</pre></div></li><li class="step "><p>
     Run the configuration processor and ready-deployment:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
 ansible-playbook -i hosts/localhost config-processor-run.yml
 ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     Run barbican-reconfigure:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
 ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect1" id="id-1.5.4.6"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Barbican Key Management Service Bootstrap Data</span> <a title="Permalink" class="permalink" href="#id-1.5.4.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   When the key management service is installed, some of the Keystone-related
   initial data is bootstrapped as part of its initial deployment. The data
   added is primarily related to Barbican user, roles, service and
   endpoint definitions, and Barbican role assignments.
  </p><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.6.3"><span class="name">User, Roles, Service and Endpoint Definitions</span><a title="Permalink" class="permalink" href="#id-1.5.4.6.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><thead><tr><th>Type</th><th>Name or key-value pair</th><th>Purpose</th><th>Comments</th></tr></thead><tbody><tr><td>
       <p>
        Keystone User Account
       </p>
      </td><td>
       <p>
        barbican
       </p>
      </td><td>
       <p>
        Barbican user account associated with administrative privileges.
       </p>
      </td><td>
       <p>
        Password is randomly generated and made available in the Barbican
        client environment setup script, <code class="literal">barbican.osrc,</code>, on
        the Cloud Lifecycle Manager node.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone User Account
       </p>
      </td><td>
       <p>
        barbican_service
       </p>
      </td><td>
       <p>
        Service account used for Keystone token validation by
        <code class="literal">barbican</code> service.
       </p>
      </td><td>
       <p>
        Password is randomly generated and stored in barbican paste
        configuration, <code class="filename">barbican-api-paste.ini</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:creator
       </p>
      </td><td>
       <p>
        Barbican specific role with privilege to create, modify, list, and
        delete keys and certificates.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined for
        <code class="literal">creator</code> role in upstream Barbican. Referenced in the
        service policy config file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:admin
       </p>
      </td><td>
       <p>
        Barbican-specific role that has administrative privileges. Privileges
        include modifications (update and delete) in container's consumer,
        transport keys, certificate authorities (CA), assignment, and
        management of per-project CA.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined for<code class="literal">admin</code>
        role in upstream Barbican. Referenced in the service policy config
        file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:observer
       </p>
      </td><td>
       <p>
        Barbican specific role which has privileges limited to read/list of
        keys, certificates.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined
        for<code class="literal">observer</code> role in upstream Barbican. Referenced in
        the service policy config file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:auditor
       </p>
      </td><td>
       <p>
        Barbican specific role which has privileges limited to reading
        metadata
        of keys, certificates. This role does not allow reading and listing of
        actual keys and certificates.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined for<code class="literal">auditor</code>
        role in upstream Barbican. Referenced in the service policy config
        file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:service-admin
       </p>
      </td><td>
       <p>
        Barbican specific role which has privilege to modify global
        preferred CA and modify default project quotas.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined
        for <code class="literal">key-manager:service-admin</code> role in upstream
        Barbican. Referenced in the service policy config file,
        <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Service
       </p>
      </td><td>
       <p>
        name: barbican type: key-manager
       </p>
      </td><td>
       <p>
        Barbican service definition. Service type is
        <span class="emphasis"><em>key-manager</em></span>.
       </p>
      </td><td> </td></tr><tr><td>
       <p>
        Keystone Endpoint
       </p>
      </td><td>
       <p>
        interface: internal region: region1
       </p>
      </td><td>
       <p>
        Barbican internal endpoint. This is the load-balanced endpoint exposed
        for internal service usage.
       </p>
      </td><td> </td></tr><tr><td>
       <p>
        Keystone Endpoint
       </p>
      </td><td>
       <p>
        interface: public region: region1
       </p>
      </td><td>
       <p>
        Barbican public endpoint. This is the load-balanced endpoint exposed
        for external/public service usage.
       </p>
      </td><td> </td></tr></tbody></table></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.6.5"><span class="name">Role Assignments</span><a title="Permalink" class="permalink" href="#id-1.5.4.6.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><thead><tr><th>User name</th><th>Project name</th><th>Role name</th><th>Purpose</th></tr></thead><tbody><tr><td>barbican</td><td>admin</td><td>key-manager:admin</td><td>
       <p>
        User is assigned Barbican administration privileges on Keystone-defined
        <code class="literal">admin</code> project. This allows the user to manage
        Barbican resources associated with that project using the Barbican CLI
        setup.
       </p>
      </td></tr><tr><td>barbican</td><td>admin</td><td>key-manager:service-admin </td><td>
       <p>
        User is assigned Barbican service administration privileges on
        Keystone-defined <code class="literal">admin</code> project. This role and the
        one above allows full Barbican-related administration capabilities.
       </p>
      </td></tr><tr><td>barbican</td><td>admin</td><td>admin</td><td>
       <p>
        User assigned Keystone defined administrative role on its
        <code class="literal">admin</code> project. This way customer can continue to use
         Barbican CLI and <span class="productname">OpenStack</span> CLI without need to switch when testing
        or verifying data.
       </p>
      </td></tr><tr><td>admin</td><td>admin</td><td>key-manager:admin</td><td>
       <p>
        Keystone-defined <code class="literal">admin</code> user is given Barbican
        related administrative privileges on Keystone-defined
        <code class="literal">admin</code> project.
       </p>
      </td></tr><tr><td>admin</td><td>admin</td><td>key-manager:service-admin</td><td>
       <p>
        In lines of above role assignment, Barbican specific service
        administrator role
        is assigned to allow global preferred CA and quotas modifications.
       </p>
      </td></tr><tr><td>barbican_service</td><td>services</td><td>service</td><td>
       <p>
        Barbican service account is given <code class="literal">service</code> role
        on <code class="literal">services</code> project for token validation. API server
        uses this for creating scoped service token and then includes it as
        <code class="literal">X-Service-Token</code> when requesting customer/client
        token validation from Keystone.
       </p>
      </td></tr></tbody></table></div></div><div class="sect1" id="idg-all-security-barbican-xml-11"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Known issues and workarounds</span> <a title="Permalink" class="permalink" href="#idg-all-security-barbican-xml-11">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-xml-11</li></ul></div></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Make sure that in your Certificate Signing Request (CSR) <code class="literal">Common
     Name</code> matches the <code class="literal">barbican_kmip_username</code> value
     defined in
     <code class="filename">roles/barbican-common/vars/barbican_deploy_config.yml</code>.
     Otherwise you may see an internal server error message in Barbican for
     secret create request.
    </p></li><li class="listitem "><p>
     Barbican does not return a clear error message with regards to client
     certificate setup and its connectivity with KMIP server. During secret
     create request, a general "Internal Server Error" is returned when the
     certificate is invalid or missing any of necessary client certificate data
     (client certificate, key and CA root certificate).
    </p></li></ol></div></div></div><div class="chapter " id="barbicanAdmin"><div class="titlepage"><div><div><h1 class="title"><span class="number">3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Key Management Service Administration</span> <a title="Permalink" class="permalink" href="#barbicanAdmin">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span>barbicanAdmin</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#idg-all-security-barbican-admin-xml-6"><span class="number">3.1 </span><span class="name">Post-installation verification and administration</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.3"><span class="number">3.2 </span><span class="name">Updating the Barbican Key Management Service</span></a></span></dt><dt><span class="section"><a href="#idg-all-security-barbican-admin-xml-8"><span class="number">3.3 </span><span class="name">Barbican Settings</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.5"><span class="number">3.4 </span><span class="name">Enable or Disable Auditing of Barbican Events</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.6"><span class="number">3.5 </span><span class="name">Updating the Barbican API Service Configuration File</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.7"><span class="number">3.6 </span><span class="name">Starting and Stopping the Barbican Service</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.8"><span class="number">3.7 </span><span class="name">Changing or Resetting a Password</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.9"><span class="number">3.8 </span><span class="name">Checking Barbican Status</span></a></span></dt><dt><span class="section"><a href="#id-1.5.5.10"><span class="number">3.9 </span><span class="name">Updating Logging Configuration</span></a></span></dt></dl></div></div><div class="sect1" id="idg-all-security-barbican-admin-xml-6"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Post-installation verification and administration</span> <a title="Permalink" class="permalink" href="#idg-all-security-barbican-admin-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-admin-xml-6</li></ul></div></div></div></div><p>
   In a production environment, you can verify your installation of the
   Barbican key management service by running the
   <code class="filename">barbican-status.yml</code> Ansible playbook on the Cloud Lifecycle Manager node.
  </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts barbican-status.yml</pre></div><p>
   In any non-production environment, along with the playbook, you can also
   verify the service by storing and retrieving the secret from Barbican.
  </p></div><div class="sect1" id="id-1.5.5.3"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Updating the Barbican Key Management Service</span> <a title="Permalink" class="permalink" href="#id-1.5.5.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Some Barbican features and service configurations can be changed. This
   is done using the Cloud Lifecycle Manager Reconfigure Ansible playbook. For example, the log
   level can be changed from INFO to DEBUG and vice-versa. If needed, this
   change can be restricted to a set of nodes via the playbook's host limit
   option. Barbican administration tasks should be performed by an admin
   user with a token scoped to the default domain via the Keystone identity
   API. These settings are preconfigured in the
   <code class="filename">barbican.osrc</code> file. By default,
   <code class="filename">barbican.osrc</code> is configured with the admin endpoint. If
   the admin endpoint is not accessible from your network, change
   <code class="literal">OS_AUTH_URL</code> to point to the public endpoint.
  </p></div><div class="sect1" id="idg-all-security-barbican-admin-xml-8"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Barbican Settings</span> <a title="Permalink" class="permalink" href="#idg-all-security-barbican-admin-xml-8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-admin-xml-8</li></ul></div></div></div></div><p>
   The following Barbican configuration settings can be changed:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Anything in the main Barbican configuration file:
     <code class="filename">/etc/barbican/barbican.conf</code>
    </p></li><li class="listitem "><p>
     Anything in the main Barbican worker configuration file:
     <code class="filename">/etc/barbican/barbican-worker.conf</code>
    </p></li></ul></div><p>
   You can also update the following configuration options and enable the
   following features. For example, you can:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Change the verbosity of logs written to Barbican log files
     (<code class="filename">var/log/barbican/</code>).
    </p></li><li class="listitem "><p>
     Enable and disable auditing of the Barbican key management service
    </p></li><li class="listitem "><p>
     Edit <code class="literal">barbican_secret_store</code> plug-ins. The two options
     are:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       <code class="literal">store_crypto</code> used to store the secrets in the
       database
      </p></li><li class="listitem "><p>
       <code class="literal">kmip_plugin</code> used to store the secrets into
       KMIP-enabled external devices
      </p></li></ul></div></li></ul></div></div><div class="sect1" id="id-1.5.5.5"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enable or Disable Auditing of Barbican Events</span> <a title="Permalink" class="permalink" href="#id-1.5.5.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Auditing of Barbican key manager events can be disabled or enabled by
   following steps on the Cloud Lifecycle Manager node.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the file
     <code class="filename">~/openstack/my_cloud/definition/cloudConfig.yml</code>.
    </p><p>
     All audit-related configuration is defined under
     <code class="literal">audit-settings</code> section. Valid YAML syntax is required
     when specifying values.
    </p><p>
     Service name defined under <code class="literal">enabled-services</code> or
     <code class="literal">disabled-services</code> override the default setting (that is,
     <code class="literal">default: enabled</code> or <code class="literal">default:
     disabled</code>)
    </p></li><li class="step "><p>
     To enable auditing, make sure that the barbican service
     name is listed in the <code class="literal">enabled-services</code> list
     of <code class="literal">audit-settings</code> section or is not listed in the
     <code class="literal">disabled-services</code> list when default: is set to
     <code class="literal">enabled</code>.
    </p></li><li class="step "><p>
     To disable auditing for the Barbican service specifically, make sure
     that <code class="literal">barbican service name</code> is in
     <code class="literal">disabled-services</code> list of the
     <code class="literal">audit-settings</code> section or is not present in the
     <code class="literal">enabled-services</code> list when default: is set to
     <code class="literal">disabled</code>. You should not specify the service name in
     both lists. If it is specified in both, the enabled-services list takes
     precedence.
    </p></li><li class="step "><p>
     Commit the change in git repository.
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
git add -A
git commit -m "My config"</pre></div></li><li class="step "><p>
     Run the <code class="literal">configuration-processor-run</code> and
     <code class="literal">ready-deployment</code> playbooks, followed by the
     <code class="literal">barbican-reconfigure</code> playbook:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect1" id="id-1.5.5.6"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Updating the Barbican API Service Configuration File</span> <a title="Permalink" class="permalink" href="#id-1.5.5.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     The Barbican API service configuration file
     (<code class="literal">/etc/barbican/barbican.conf</code>), located on each control
     plane server (controller node) is generated from the following template
     file located on the Cloud Lifecycle Manager node:
     <code class="filename">/var/lib/ardana/openstack/my_cloud/config/barbican/barbican.conf.j2</code>.
     Modify this template file as appropriate. This is a Jinja2 template, which
     expects certain template variables to be set. Do not change values inside
     double curly braces: <code class="literal">{{ }}</code>.
    </p></li><li class="step "><p>
     Once the template is modified, copy the files to
     <code class="literal">~/openstack/my_cloud/definition/</code>, and commit the change to
     the local git repository:
    </p><div class="verbatim-wrap"><pre class="screen">cp -r ~/hp-ci/padawan/* ~/openstack/my_cloud/definition/
cd ~/openstack/ardana/ansible
git add -A
git commit -m "My config"</pre></div></li><li class="step "><p>
     Then rerun the configuration processor and ready-deployment playbooks:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     Finally, run the <code class="literal">barbican-reconfigure</code> playbook in the
     deployment area:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect1" id="id-1.5.5.7"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Starting and Stopping the Barbican Service</span> <a title="Permalink" class="permalink" href="#id-1.5.5.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   You can start or stop the Barbican service from the Cloud Lifecycle Manager nodes by
   running the appropriate Ansible playbooks:
  </p><p>
   To stop the Barbican service:
  </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-stop.yml</pre></div><p>
   To start the Barbican service:
  </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-start.yml</pre></div></div><div class="sect1" id="id-1.5.5.8"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Changing or Resetting a Password</span> <a title="Permalink" class="permalink" href="#id-1.5.5.8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To change the password for the Barbican administrator:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Copy the file as shown below:
    </p><div class="verbatim-wrap"><pre class="screen">cp ~/openstack/my_cloud/info/private_data_metadata_ccp.yml \
  ~/openstack/change_credentials/</pre></div></li><li class="step "><p>
     Then edit <code class="filename">private_data_metadata_ccp.yml</code> found here:
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/change_credentials/private_data_metadata_ccp.yml</pre></div></li><li class="step "><p>
     Change credentials for the Barbican admin user and/or Barbican
     service user. Remove everything else. The file will look similar to this:
    </p><div class="verbatim-wrap"><pre class="screen">barbican_admin_password:
    value: <span class="bold"><strong>'testing_123'</strong></span>
    metadata:
    - clusters:
        - cluster1
        component: barbican-api
        cp: ccp
    version: '2.0'
barbican_service_password:
    value:<span class="bold"><strong> 'testing_123'</strong></span>
    metadata:
    - clusters:
        - cluster1
        component: barbican-api
        cp: ccp
    version: '2.0'</pre></div><p>
     The value (shown in bold) is optional; it is used to set a user-chosen
     password. If left blank, the playbook will generate a random password.
    </p></li><li class="step "><p>
     Execute the following playbooks from
     <code class="filename">~/openstack/ardana/ansible/</code>:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="" -e rekey=""
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure-credentials-change.yml</pre></div></li><li class="step "><p>
     SSH to the controller and make sure the password has been properly
     updated.
    </p><div class="verbatim-wrap"><pre class="screen">/etc/barbican# vi barbican-api-paste.ini</pre></div></li></ol></div></div></div><div class="sect1" id="id-1.5.5.9"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Checking Barbican Status</span> <a title="Permalink" class="permalink" href="#id-1.5.5.9">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   You can check the status of Barbican by running the
   <code class="literal">barbican-status.yml</code> Ansible playbook on the Cloud Lifecycle Manager node.
  </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts barbican-status.yml</pre></div><div id="id-1.5.5.9.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
   Make sure you remove/delete
   <code class="filename">~/openstack/change_credentials/private_data_metadata.yml</code>
   after successfully
   changing the password.
  </p></div></div><div class="sect1" id="id-1.5.5.10"><div class="titlepage"><div><div><h2 class="title"><span class="number">3.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Updating Logging Configuration</span> <a title="Permalink" class="permalink" href="#id-1.5.5.10">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-barbican_admin.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican_admin.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   All Barbican logging is set to INFO by default. To change the
   level from the Cloud Lifecycle Manager, there are two options available
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Edit the Barbican configuration file,
     <code class="filename">/barbican_deploy_config.yml</code>, in the following
     directory.
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/config/barbican/</pre></div><p>
     To change log level entry (<code class="literal">barbican_loglevel</code>) to DEBUG,
     edit the entry:
    </p><div class="verbatim-wrap"><pre class="screen">barbican_loglevel = {{ openstack_loglevel | default('DEBUG') }}</pre></div><p>
     To change the log level to INFO, edit the entry:
    </p><div class="verbatim-wrap"><pre class="screen">barbican_loglevel = {{ openstack_loglevel | default('INFO') }}</pre></div></li><li class="listitem "><p>
     Edit file
     <code class="literal">~/openstack/ardana/ansible/roles/KEYMGR-API/templates/api-logging.conf.j2</code>
     and update the log level accordingly.
    </p></li></ol></div><p>
   Commit the change to the local git repository:
  </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
git add -A
git commit -m "My config"</pre></div><p>
   Run the configuration-processor-run and ready-deployment playbooks, followed
   by the <code class="literal">barbican-reconfigure</code> playbook:
  </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</pre></div></div></div><div class="chapter " id="roleSegregation"><div class="titlepage"><div><div><h1 class="title"><span class="number">4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Service Admin Role Segregation in the Identity Service</span> <a title="Permalink" class="permalink" href="#roleSegregation">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-admin_role_segregation.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-admin_role_segregation.xml</li><li><span class="ds-label">ID: </span>roleSegregation</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#idg-all-security-admin-role-segregation-xml-6"><span class="number">4.1 </span><span class="name">Overview</span></a></span></dt><dt><span class="section"><a href="#id-1.5.6.3"><span class="number">4.2 </span><span class="name">Pre-Installed Service Admin Role Components</span></a></span></dt><dt><span class="section"><a href="#id-1.5.6.4"><span class="number">4.3 </span><span class="name">Features and Benefits</span></a></span></dt><dt><span class="section"><a href="#id-1.5.6.5"><span class="number">4.4 </span><span class="name">Roles</span></a></span></dt></dl></div></div><div class="sect1" id="idg-all-security-admin-role-segregation-xml-6"><div class="titlepage"><div><div><h2 class="title"><span class="number">4.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Overview</span> <a title="Permalink" class="permalink" href="#idg-all-security-admin-role-segregation-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-admin_role_segregation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-admin_role_segregation.xml</li><li><span class="ds-label">ID: </span>idg-all-security-admin-role-segregation-xml-6</li></ul></div></div></div></div><p>
   Under the default <span class="productname">OpenStack</span> user policies, a user can have either member
   privilege or admin privilege. Admin privilege is assigned by creating a user
   account with the role of admin. However, the default admin role is too broad
   and often grants users more privilege than they need, giving them access to
   additional tasks and resources that they should not have.
  </p><p>
   Ideally, each user account should only be assigned privileges necessary to
   perform tasks they are required to perform. According to the widely accepted
   principle of least privilege, a user who needs to perform administrative
   tasks should have a user account with the privileges required to perform
   only those administrative tasks and no others. This prevents the granting of
   too much privilege while retaining the individual accountability of the
   user.
  </p><p>
   Service Administrator Roles is an alternative to the current
   one-size-fits-all admin role model and can help you institute different
   privileges for different administrators.
  </p></div><div class="sect1" id="id-1.5.6.3"><div class="titlepage"><div><div><h2 class="title"><span class="number">4.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Pre-Installed Service Admin Role Components</span> <a title="Permalink" class="permalink" href="#id-1.5.6.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-admin_role_segregation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-admin_role_segregation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The main components of Service Administrator Roles are:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <code class="literal">nova_admin</code> role in the identity service (Keystone) and
     support in <code class="filename">nova_policy.json</code>
    </p></li><li class="listitem "><p>
     <code class="literal">neutron_admin</code> role in the identity service and support
     in <code class="filename">neutron_policy.json</code>
    </p></li><li class="listitem "><p>
     <code class="literal">cinder_admin</code> role in the identity service and support
     in <code class="filename">cinder_policy.json</code>
    </p></li><li class="listitem "><p>
     <code class="literal">swiftoperator</code> role in the identity service, defined in
     the <code class="literal">keystoneauth</code> section of the
     <code class="filename">proxy-server.conf</code> file.
    </p></li><li class="listitem "><p>
     <code class="literal">glance_admin</code> role in the identity service and support
     in <code class="filename">glance_policy.json</code>
    </p><div id="id-1.5.6.3.3.5.2" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: 
      Changing <code class="filename">glance_policy.json</code> may Introduce a
      Security Issue
     </h6><p>
      A security issue is described in the OpenStack Security Note OSSN-0075
      <a class="link" href="https://wiki.openstack.org/wiki/OSSN/OSSN-0075" target="_blank">https://wiki.openstack.org/wiki/OSSN/OSSN-0075</a>. It
      refers to a scenario where a malicious tenant is able to reuse deleted
      Glance image IDs to share malicious images with other tenants in a
      manner that is undetectable to the victim tenant.
     </p><p>
      The default policy <code class="filename">glance_policy.json</code> that is
      shipped with <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> prevents this by ensuring only admins can
      deactivate/reactivate images:
     </p><div class="verbatim-wrap"><pre class="screen">"deactivate": "role:admin"
"reactivate": "role:admin"</pre></div><p>
      It is suggested to <span class="emphasis"><em>not</em></span> change these settings. If you
      do change them, please refer to the OSSN-0075 <a class="link" href="https://wiki.openstack.org/wiki/OSSN/OSSN-0075" target="_blank">https://wiki.openstack.org/wiki/OSSN/OSSN-0075</a>. This
      reference has details about on the exact scope of the security issue.
     </p></div><p>
     The <span class="productname">OpenStack</span> <code class="literal">admin</code> user has broad capabilities to
     administer the cloud, including Nova, Neutron, Cinder,
     Swift, and Glance. This is maintained to ensure backwards
     compatilibity, but if separation of duties is desired among administrative
     staff then the <span class="productname">OpenStack</span> roles may be partitioned across different
     administrators. For example, it is possible to have a set of network
     administrators with the <code class="literal">neutron_admin</code> role, a set of
     storage administrators with the <code class="literal">cinder_admin</code> and/or
     <code class="literal">swiftoperator</code> roles, and a set of compute
     administrators with the <code class="literal">nova_admin</code> and
     <code class="literal">glance_admin</code> roles.
    </p></li></ul></div></div><div class="sect1" id="id-1.5.6.4"><div class="titlepage"><div><div><h2 class="title"><span class="number">4.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Features and Benefits</span> <a title="Permalink" class="permalink" href="#id-1.5.6.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-admin_role_segregation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-admin_role_segregation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Service Administrator Roles offer the following features and benefits:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Support separation of duties through more granular roles
    </p></li><li class="listitem "><p>
     Are enabled by default
    </p></li><li class="listitem "><p>
     Are backwards compatible
    </p></li><li class="listitem "><p>
     Have predefined service administrator roles in the identity service
    </p></li><li class="listitem "><p>
     Have predefined <code class="filename">policy.json</code> files with corresponding
     service admin roles to facilitate quick and easy deployment
    </p></li></ul></div></div><div class="sect1" id="id-1.5.6.5"><div class="titlepage"><div><div><h2 class="title"><span class="number">4.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Roles</span> <a title="Permalink" class="permalink" href="#id-1.5.6.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-admin_role_segregation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-admin_role_segregation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The following are the roles defined in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>. These roles serve as
   a way to group common administrative needs at the <span class="productname">OpenStack</span> service level.
   Each role represents administrative privilege into each service. Multiple
   roles can be assigned to a user. You can assign a Service Admin Role to a
   user once you have determined that the user is authorized to perform
   administrative actions and access resources in that service.
  </p><p>
   <span class="bold"><strong>Pre-Installed Service Admin Roles</strong></span>
  </p><p>
   The following service admin roles exist by default:
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.5.6.5.5.1"><span class="term ">nova_admin role</span></dt><dd><p>
      Assign this role to users whose job function it is to perform Nova
      compute-related administrative tasks.
     </p></dd><dt id="id-1.5.6.5.5.2"><span class="term ">neutron_admin role</span></dt><dd><p>
      Assign this role to users whose job function it is to perform Neutron
      networking-related administrative tasks.
     </p></dd><dt id="id-1.5.6.5.5.3"><span class="term ">cinder_admin role</span></dt><dd><p>
      Assign this role to users whose job function it is to perform Cinder
      storage-related administrative tasks.
     </p></dd><dt id="id-1.5.6.5.5.4"><span class="term ">glance_admin role</span></dt><dd><p>
      Assign this role to users whose job function it is to perform Glance
      image service-related administrative tasks.
     </p></dd></dl></div><p>
   For configuration steps, see
   <span class="intraxref">Book “User Guide”, Chapter 4 “Cloud Admin Actions with the Command Line”</span>.
  </p></div></div><div class="chapter " id="cha-security-rbac"><div class="titlepage"><div><div><h1 class="title"><span class="number">5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Role-Based Access Control in Neutron</span> <a title="Permalink" class="permalink" href="#cha-security-rbac">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span>cha-security-rbac</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#id-1.5.7.7"><span class="number">5.1 </span><span class="name">Creating a Network</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.8"><span class="number">5.2 </span><span class="name">Creating an RBAC Policy</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.9"><span class="number">5.3 </span><span class="name">Listing RBACs</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.10"><span class="number">5.4 </span><span class="name">Listing the Attributes of an RBAC</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.11"><span class="number">5.5 </span><span class="name">Deleting an RBAC Policy</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.12"><span class="number">5.6 </span><span class="name">Sharing a Network with All Tenants</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.13"><span class="number">5.7 </span><span class="name">Target Project (<code class="literal">demo2</code>) View of Networks and Subnets</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.14"><span class="number">5.8 </span><span class="name">Target Project: Creating a Port Using demo-net</span></a></span></dt><dt><span class="section"><a href="#id-1.5.7.15"><span class="number">5.9 </span><span class="name">Target Project Booting a VM Using Demo-Net</span></a></span></dt><dt><span class="section"><a href="#sec-security-rbac-limitation"><span class="number">5.10 </span><span class="name">Limitations</span></a></span></dt></dl></div></div><p>
   This topic explains how to achieve more granular access control for your
   Neutron networks.
  </p><p>
   Previously in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, a network object was either private to a project or
   could be used by all projects. If the network's shared attribute was True,
   then the network could be used by every project in the cloud. If false, only
   the members of the owning project could use it. There was no way for the
   network to be shared by only a subset of the projects.
  </p><p>
  <span class="phrase">Neutron Role Based Access Control (RBAC) solves this problem for
   networks. Now the network owner can create RBAC policies that give network
   access to target projects. Members of a targeted project can use the
   network named in the RBAC policy the same way as if the network was owned
   by the project. Constraints are described in the
   section</span>
  <a class="xref" href="#sec-security-rbac-limitation" title="5.10. Limitations">Section 5.10, “Limitations”</a>.
 </p><p>
   With RBAC you are able to let another tenant use a network that you created,
   but as the owner of the network, you need to create the subnet and the
   router for the network.
  </p><p>
   To use RBAC, Neutron configuration files do not need to be changed.
  </p><div class="sect1" id="id-1.5.7.7"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating a Network</span> <a title="Permalink" class="permalink" href="#id-1.5.7.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network create demo-net
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   |                                      |
| availability_zones        |                                      |
| created_at                | 2018-07-25T17:43:59Z                 |
| description               |                                      |
| dns_domain                |                                      |
| id                        | 9c801954-ec7f-4a65-82f8-e313120aabc4 |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| is_default                | False                                |
| is_vlan_transparent       | None                                 |
| mtu                       | 1450                                 |
| name                      | demo-net                             |
| port_security_enabled     | False                                |
| project_id                | cb67c79e25a84e328326d186bf703e1b     |
| provider:network_type     | vxlan                                |
| provider:physical_network | None                                 |
| provider:segmentation_id  | 1009                                 |
| qos_policy_id             | None                                 |
| revision_number           | 2                                    |
| router:external           | Internal                             |
| segments                  | None                                 |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tags                      |                                      |
| updated_at                | 2018-07-25T17:43:59Z                 |
+---------------------------+--------------------------------------+</pre></div></div><div class="sect1" id="id-1.5.7.8"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating an RBAC Policy</span> <a title="Permalink" class="permalink" href="#id-1.5.7.8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Here we will create an RBAC policy where a member of the project called
   'demo' will share the network with members of project 'demo2'
  </p><p>
   To create the RBAC policy, run:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac create  --target-project <em class="replaceable ">DEMO2-PROJECT-ID</em> --type network --action access_as_shared demo-net</pre></div><p>
   Here is an example where the <em class="replaceable ">DEMO2-PROJECT-ID</em> is
   5a582af8b44b422fafcd4545bd2b7eb5
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac create --target-tenant 5a582af8b44b422fafcd4545bd2b7eb5 \
  --type network --action access_as_shared demo-net</pre></div></div><div class="sect1" id="id-1.5.7.9"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Listing RBACs</span> <a title="Permalink" class="permalink" href="#id-1.5.7.9">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To list all the RBAC rules/policies, execute:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac list
+--------------------------------------+-------------+--------------------------------------+
| ID                                   | Object Type | Object ID                            |
+--------------------------------------+-------------+--------------------------------------+
| 0fdec7f0-9b94-42b4-a4cd-b291d04282c1 | network     | 7cd94877-4276-488d-b682-7328fc85d721 |
+--------------------------------------+-------------+--------------------------------------+</pre></div></div><div class="sect1" id="id-1.5.7.10"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Listing the Attributes of an RBAC</span> <a title="Permalink" class="permalink" href="#id-1.5.7.10">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To see the attributes of a specific RBAC policy, run
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac show <em class="replaceable ">POLICY-ID</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac show 0fd89dcb-9809-4a5e-adc1-39dd676cb386</pre></div><p>
   Here is the output:
  </p><div class="verbatim-wrap"><pre class="screen">+---------------+--------------------------------------+
| Field         | Value                                |
+---------------+--------------------------------------+
| action        | access_as_shared                     |
| id            | 0fd89dcb-9809-4a5e-adc1-39dd676cb386 |
| object_id     | c3d55c21-d8c9-4ee5-944b-560b7e0ea33b |
| object_type   | network                              |
| target_tenant | 5a582af8b44b422fafcd4545bd2b7eb5     |
| tenant_id     | 75eb5efae5764682bca2fede6f4d8c6f     |
+---------------+--------------------------------------+</pre></div></div><div class="sect1" id="id-1.5.7.11"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Deleting an RBAC Policy</span> <a title="Permalink" class="permalink" href="#id-1.5.7.11">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To delete an RBAC policy, run <code class="literal">openstack network rbac delete</code> passing the policy id:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac delete <em class="replaceable ">POLICY-ID</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac delete 0fd89dcb-9809-4a5e-adc1-39dd676cb386</pre></div><p>
   Here is the output:
  </p><div class="verbatim-wrap"><pre class="screen">Deleted rbac_policy: 0fd89dcb-9809-4a5e-adc1-39dd676cb386</pre></div></div><div class="sect1" id="id-1.5.7.12"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Sharing a Network with All Tenants</span> <a title="Permalink" class="permalink" href="#id-1.5.7.12">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Either the administrator or the network owner can make a network shareable
   by all tenants.
  </p><p>
   The administrator can make a tenant's network shareable by all tenants.
   To make the network <code class="literal">demo-shareall-net</code> accessible by all
   tenants in the cloud:
  </p><p>
   To share a network with all tenants:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Get a list of all projects
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>~/service.osrc
<code class="prompt user">ardana &gt; </code>openstack project list</pre></div><p>
      which produces the list:
    </p><div class="verbatim-wrap"><pre class="screen">+----------------------------------+------------------+
| ID                               | Name             |
+----------------------------------+------------------+
| 1be57778b61645a7a1c07ca0ac488f9e | demo             |
| 5346676226274cd2b3e3862c2d5ceadd | admin            |
| 749a557b2b9c482ca047e8f4abf348cd | swift-monitor    |
| 8284a83df4df429fb04996c59f9a314b | swift-dispersion |
| c7a74026ed8d4345a48a3860048dcb39 | demo-sharee      |
| e771266d937440828372090c4f99a995 | glance-swift     |
| f43fb69f107b4b109d22431766b85f20 | services         |
+----------------------------------+------------------+</pre></div></li><li class="step "><p>
     Get a list of networks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network list</pre></div><p>
     This produces the following list:
    </p><div class="verbatim-wrap"><pre class="screen">+--------------------------------------+-------------------+----------------------------------------------------+
| id                                   | name              | subnets                                            |
+--------------------------------------+-------------------+----------------------------------------------------+
| f50f9a63-c048-444d-939d-370cb0af1387 | ext-net           | ef3873db-fc7a-4085-8454-5566fb5578ea 172.31.0.0/16 |
| 9fb676f5-137e-4646-ac6e-db675a885fd3 | demo-net          | 18fb0b77-fc8b-4f8d-9172-ee47869f92cc 10.0.1.0/24   |
| 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e | demo-shareall-net | 2bbc85a9-3ffe-464c-944b-2476c7804877 10.0.250.0/24 |
| 73f946ee-bd2b-42e9-87e4-87f19edd0682 | demo-share-subset | c088b0ef-f541-42a7-b4b9-6ef3c9921e44 10.0.2.0/24   |
+--------------------------------------+-------------------+----------------------------------------------------+</pre></div></li><li class="step "><p>
     Set the network you want to share to a shared value of True:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network set --share 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e</pre></div><p>
     You should see the following output:
    </p><div class="verbatim-wrap"><pre class="screen">Updated network: 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e</pre></div></li><li class="step "><p>
     Check the attributes of that network by running the following command
     using the ID of the network in question:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network show 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e</pre></div><p>
     The output will look like this:
    </p><div class="verbatim-wrap"><pre class="screen">+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   |                                      |
| availability_zones        |                                      |
| created_at                | 2018-07-25T17:43:59Z                 |
| description               |                                      |
| dns_domain                |                                      |
| id                        | 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| is_default                | None                                 |
| is_vlan_transparent       | None                                 |
| mtu                       | 1450                                 |
| name                      | demo-net                             |
| port_security_enabled     | False                                |
| project_id                | cb67c79e25a84e328326d186bf703e1b     |
| provider:network_type     | vxlan                                |
| provider:physical_network | None                                 |
| provider:segmentation_id  | 1009                                 |
| qos_policy_id             | None                                 |
| revision_number           | 2                                    |
| router:external           | Internal                             |
| segments                  | None                                 |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tags                      |                                      |
| updated_at                | 2018-07-25T17:43:59Z                 |
+---------------------------+--------------------------------------+</pre></div></li><li class="step "><p>
     As the owner of the <code class="literal">demo-shareall-net</code> network, view
     the RBAC attributes for
     <code class="literal">demo-shareall-net</code>
     (<code class="literal">id=8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e</code>) by first
     getting an RBAC list:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>echo $OS_USERNAME ; echo $OS_PROJECT_NAME
demo
demo
<code class="prompt user">ardana &gt; </code>openstack network rbac list</pre></div><p>
     This produces the list:
    </p><div class="verbatim-wrap"><pre class="screen">+--------------------------------------+--------------------------------------+
| id                                   | object_id                            |
+--------------------------------------+--------------------------------------+
| ...                                                                         |
| 3e078293-f55d-461c-9a0b-67b5dae321e8 | 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e |
+--------------------------------------+--------------------------------------+</pre></div></li><li class="step "><p>
     View the RBAC information:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac show 3e078293-f55d-461c-9a0b-67b5dae321e8

+---------------+--------------------------------------+
| Field         | Value                                |
+---------------+--------------------------------------+
| action        | access_as_shared                     |
| id            | 3e078293-f55d-461c-9a0b-67b5dae321e8 |
| object_id     | 8eada4f7-83cf-40ba-aa8c-5bf7d87cca8e |
| object_type   | network                              |
| target_tenant | *                                    |
| tenant_id     | 1be57778b61645a7a1c07ca0ac488f9e     |
+---------------+--------------------------------------+</pre></div></li><li class="step "><p>
     With network RBAC, the owner of the network can also make the network
     shareable by all tenants. First create the network:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>echo $OS_PROJECT_NAME ; echo $OS_USERNAME
demo
demo
<code class="prompt user">ardana &gt; </code>openstack network create test-net</pre></div><p>
     The network is created:
    </p><div class="verbatim-wrap"><pre class="screen">+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   |                                      |
| availability_zones        |                                      |
| created_at                | 2018-07-25T18:04:25Z                 |
| description               |                                      |
| dns_domain                |                                      |
| id                        | a4bd7c3a-818f-4431-8cdb-fedf7ff40f73 |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| is_default                | False                                |
| is_vlan_transparent       | None                                 |
| mtu                       | 1450                                 |
| name                      | test-net                             |
| port_security_enabled     | False                                |
| project_id                | cb67c79e25a84e328326d186bf703e1b     |
| provider:network_type     | vxlan                                |
| provider:physical_network | None                                 |
| provider:segmentation_id  | 1073                                 |
| qos_policy_id             | None                                 |
| revision_number           | 2                                    |
| router:external           | Internal                             |
| segments                  | None                                 |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   |                                      |
| tags                      |                                      |
| updated_at                | 2018-07-25T18:04:25Z                 |
+---------------------------+--------------------------------------+</pre></div></li><li class="step "><p>
     Create the RBAC. It is important that the asterisk is surrounded by
     single-quotes to prevent the shell from expanding it to all files in the
     current directory.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network rbac create --type network \
  --action access_as_shared --target-project '*' test-net</pre></div><p>
     Here are the resulting RBAC attributes:
    </p><div class="verbatim-wrap"><pre class="screen">+---------------+--------------------------------------+
| Field         | Value                                |
+---------------+--------------------------------------+
| action        | access_as_shared                     |
| id            | 0b797cc6-debc-48a1-bf9d-d294b077d0d9 |
| object_id     | a4bd7c3a-818f-4431-8cdb-fedf7ff40f73 |
| object_type   | network                              |
| target_tenant | *                                    |
| tenant_id     | 1be57778b61645a7a1c07ca0ac488f9e     |
+---------------+--------------------------------------+</pre></div></li></ol></div></div></div><div class="sect1" id="id-1.5.7.13"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Target Project (<code class="literal">demo2</code>) View of Networks and Subnets</span> <a title="Permalink" class="permalink" href="#id-1.5.7.13">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Note that the owner of the network and subnet is not the tenant named
   <code class="literal">demo2</code>. Both the network and subnet are owned by tenant <code class="literal">demo</code>.
   <code class="literal">Demo2</code>members cannot create subnets of the network. They also cannot
   modify or delete subnets owned by <code class="literal">demo</code>.
  </p><p>
   As the tenant <code class="literal">demo2</code>, you can get a list of neutron networks:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack network list</pre></div><div class="verbatim-wrap"><pre class="screen">+--------------------------------------+-----------+--------------------------------------------------+
| id                                   | name      | subnets                                          |
+--------------------------------------+-----------+--------------------------------------------------+
| f60f3896-2854-4f20-b03f-584a0dcce7a6 | ext-net   | 50e39973-b2e3-466b-81c9-31f4d83d990b             |
| c3d55c21-d8c9-4ee5-944b-560b7e0ea33b | demo-net  | d9b765da-45eb-4543-be96-1b69a00a2556 10.0.1.0/24 |
   ...
+--------------------------------------+-----------+--------------------------------------------------+</pre></div><p>
   And get a list of subnets:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack subnet list --network c3d55c21-d8c9-4ee5-944b-560b7e0ea33b</pre></div><div class="verbatim-wrap"><pre class="screen">+--------------------------------------+---------+--------------------------------------+---------------+
| ID                                   | Name    | Network                              | Subnet        |
+--------------------------------------+---------+--------------------------------------+---------------+
| a806f28b-ad66-47f1-b280-a1caa9beb832 | ext-net | c3d55c21-d8c9-4ee5-944b-560b7e0ea33b | 10.0.1.0/24   |
+--------------------------------------+---------+--------------------------------------+---------------+</pre></div><p>
To show details of the subnet:
</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack subnet show d9b765da-45eb-4543-be96-1b69a00a2556</pre></div><div class="verbatim-wrap"><pre class="screen">+-------------------+--------------------------------------------+
| Field             | Value                                      |
+-------------------+--------------------------------------------+
| allocation_pools  | {"start": "10.0.1.2", "end": "10.0.1.254"} |
| cidr              | 10.0.1.0/24                                |
| dns_nameservers   |                                            |
| enable_dhcp       | True                                       |
| gateway_ip        | 10.0.1.1                                   |
| host_routes       |                                            |
| id                | d9b765da-45eb-4543-be96-1b69a00a2556       |
| ip_version        | 4                                          |
| ipv6_address_mode |                                            |
| ipv6_ra_mode      |                                            |
| name              | sb-demo-net                                |
| network_id        | c3d55c21-d8c9-4ee5-944b-560b7e0ea33b       |
| subnetpool_id     |                                            |
| tenant_id         | 75eb5efae5764682bca2fede6f4d8c6f           |
+-------------------+--------------------------------------------+</pre></div></div><div class="sect1" id="id-1.5.7.14"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Target Project: Creating a Port Using demo-net</span> <a title="Permalink" class="permalink" href="#id-1.5.7.14">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The owner of the port is <code class="literal">demo2</code>. Members of the network owner project
   (<code class="literal">demo</code>) will not see this port.
  </p><p>
   Running the following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack port create c3d55c21-d8c9-4ee5-944b-560b7e0ea33b</pre></div><p>
   Creates a new port:
  </p><div class="verbatim-wrap"><pre class="screen">+-----------------------+-----------------------------------------------------------------------------------------------------+
| Field                 | Value                                                                                               |
+-----------------------+-----------------------------------------------------------------------------------------------------+
| admin_state_up        | True                                                                                                |
| allowed_address_pairs |                                                                                                     |
| binding:vnic_type     | normal                                                                                              |
| device_id             |                                                                                                     |
| device_owner          |                                                                                                     |
| dns_assignment        | {"hostname": "host-10-0-1-10", "ip_address": "10.0.1.10", "fqdn": "host-10-0-1-10.openstacklocal."} |
| dns_name              |                                                                                                     |
| fixed_ips             | {"subnet_id": "d9b765da-45eb-4543-be96-1b69a00a2556", "ip_address": "10.0.1.10"}                    |
| id                    | 03ef2dce-20dc-47e5-9160-942320b4e503                                                                |
| mac_address           | fa:16:3e:27:8d:ca                                                                                   |
| name                  |                                                                                                     |
| network_id            | c3d55c21-d8c9-4ee5-944b-560b7e0ea33b                                                                |
| security_groups       | 275802d0-33cb-4796-9e57-03d8ddd29b94                                                                |
| status                | DOWN                                                                                                |
| tenant_id             | 5a582af8b44b422fafcd4545bd2b7eb5                                                                    |
+-----------------------+-----------------------------------------------------------------------------------------------------+</pre></div></div><div class="sect1" id="id-1.5.7.15"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Target Project Booting a VM Using Demo-Net</span> <a title="Permalink" class="permalink" href="#id-1.5.7.15">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Here the tenant <code class="literal">demo2</code> boots a VM that uses the <code class="literal">demo-net</code> shared network:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack server create --flavor 1 --image $OS_IMAGE --nic net-id=c3d55c21-d8c9-4ee5-944b-560b7e0ea33b demo2-vm-using-demo-net-nic</pre></div><div class="verbatim-wrap"><pre class="screen">+--------------------------------------+------------------------------------------------+
| Property                             | Value                                          |
+--------------------------------------+------------------------------------------------+
| OS-EXT-AZ:availability_zone          |                                                |
| OS-EXT-STS:power_state               | 0                                              |
| OS-EXT-STS:task_state                | scheduling                                     |
| OS-EXT-STS:vm_state                  | building                                       |
| OS-SRV-USG:launched_at               | -                                              |
| OS-SRV-USG:terminated_at             | -                                              |
| accessIPv4                           |                                                |
| accessIPv6                           |                                                |
| adminPass                            | sS9uSv9PT79F                                   |
| config_drive                         |                                                |
| created                              | 2016-01-04T19:23:24Z                           |
| flavor                               | m1.tiny (1)                                    |
| hostId                               |                                                |
| id                                   | 3a4dc44a-027b-45e9-acf8-054a7c2dca2a           |
| image                                | cirros-0.3.3-x86_64 (6ae23432-8636-4e...1efc5) |
| key_name                             | -                                              |
| metadata                             | {}                                             |
| name                                 | demo2-vm-using-demo-net-nic                    |
| os-extended-volumes:volumes_attached | []                                             |
| progress                             | 0                                              |
| security_groups                      | default                                        |
| status                               | BUILD                                          |
| tenant_id                            | 5a582af8b44b422fafcd4545bd2b7eb5               |
| updated                              | 2016-01-04T19:23:24Z                           |
| user_id                              | a0e6427b036344fdb47162987cb0cee5               |
+--------------------------------------+------------------------------------------------+</pre></div><p>
   Run openstack server list:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack server list</pre></div><p>
   See the VM running:
  </p><div class="verbatim-wrap"><pre class="screen">+-------------------+-----------------------------+--------+------------+-------------+--------------------+
| ID                | Name                        | Status | Task State | Power State | Networks           |
+-------------------+-----------------------------+--------+------------+-------------+--------------------+
| 3a4dc...a7c2dca2a | demo2-vm-using-demo-net-nic | ACTIVE | -          | Running     | demo-net=10.0.1.11 |
+-------------------+-----------------------------+--------+------------+-------------+--------------------+</pre></div><p>
   Run openstack port list:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>neutron port-list --device-id 3a4dc44a-027b-45e9-acf8-054a7c2dca2a</pre></div><p>
   View the subnet:
  </p><div class="verbatim-wrap"><pre class="screen">+---------------------+------+-------------------+-------------------------------------------------------------------+
| id                  | name | mac_address       | fixed_ips                                                         |
+---------------------+------+-------------------+-------------------------------------------------------------------+
| 7d14ef8b-9...80348f |      | fa:16:3e:75:32:8e | {"subnet_id": "d9b765da-45...00a2556", "ip_address": "10.0.1.11"} |
+---------------------+------+-------------------+-------------------------------------------------------------------+</pre></div><p>
   Run neutron port-show:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack port show 7d14ef8b-9d48-4310-8c02-00c74d80348f</pre></div><div class="verbatim-wrap"><pre class="screen">+-----------------------+-----------------------------------------------------------------------------------------------------+
| Field                 | Value                                                                                               |
+-----------------------+-----------------------------------------------------------------------------------------------------+
| admin_state_up        | True                                                                                                |
| allowed_address_pairs |                                                                                                     |
| binding:vnic_type     | normal                                                                                              |
| device_id             | 3a4dc44a-027b-45e9-acf8-054a7c2dca2a                                                                |
| device_owner          | compute:None                                                                                        |
| dns_assignment        | {"hostname": "host-10-0-1-11", "ip_address": "10.0.1.11", "fqdn": "host-10-0-1-11.openstacklocal."} |
| dns_name              |                                                                                                     |
| extra_dhcp_opts       |                                                                                                     |
| fixed_ips             | {"subnet_id": "d9b765da-45eb-4543-be96-1b69a00a2556", "ip_address": "10.0.1.11"}                    |
| id                    | 7d14ef8b-9d48-4310-8c02-00c74d80348f                                                                |
| mac_address           | fa:16:3e:75:32:8e                                                                                   |
| name                  |                                                                                                     |
| network_id            | c3d55c21-d8c9-4ee5-944b-560b7e0ea33b                                                                |
| security_groups       | 275802d0-33cb-4796-9e57-03d8ddd29b94                                                                |
| status                | ACTIVE                                                                                              |
| tenant_id             | 5a582af8b44b422fafcd4545bd2b7eb5                                                                    |
+-----------------------+-----------------------------------------------------------------------------------------------------+</pre></div></div><div class="sect1" id="sec-security-rbac-limitation"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Limitations</span> <a title="Permalink" class="permalink" href="#sec-security-rbac-limitation">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-rbac.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-rbac.xml</li><li><span class="ds-label">ID: </span>sec-security-rbac-limitation</li></ul></div></div></div></div><p>
   Note the following limitations of RBAC in Neutron.
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Neutron network is the only supported RBAC Neutron object type.
    </p></li><li class="listitem "><p>
     The "access_as_external" action is not supported – even though it is
     listed as a valid action by python-neutronclient.
    </p></li><li class="listitem "><p>
     The neutron-api server will not accept action value of
     'access_as_external'. The <code class="literal">access_as_external</code> definition
     is not found in the specs.
    </p></li><li class="listitem "><p>
     The target project users cannot create, modify, or delete subnets on
     networks that have RBAC policies.
    </p></li><li class="listitem "><p>
     The subnet of a network that has an RBAC policy cannot be added as an
     interface of a target tenant's router. For example, the command
     <code class="literal">neutron router-interface-add tgt-tenant-router &lt;sb-demo-net
     uuid&gt;</code> will error out.
    </p></li><li class="listitem "><p>
     The security group rules on the network owner do not apply to other
     projects that can use the network.
    </p></li><li class="listitem "><p>
     A user in target project can boot up VMs using a VNIC using the shared
     network. The user of the target project can assign a floating IP (FIP) to
     the VM. The target project must have SG rules that allows SSH and/or ICMP
     for VM connectivity.
    </p></li><li class="listitem "><p>
     Neutron RBAC creation and management are currently not supported in
     Horizon. For now, the Neutron CLI has to be used to manage RBAC rules.
    </p></li><li class="listitem "><p>
     A RBAC rule tells Neutron whether a tenant can access a network (Allow).
     Currently there is no DENY action.
    </p></li><li class="listitem "><p>
     Port creation on a shared network fails if <code class="literal">--fixed-ip</code>
     is specified in the <code class="literal">neutron port-create</code> command.
     
     
    </p></li></ul></div></div></div><div class="chapter " id="x509-certificate-auth"><div class="titlepage"><div><div><h1 class="title"><span class="number">6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring Keystone and Horizon to use X.509 Client Certificates</span> <a title="Permalink" class="permalink" href="#x509-certificate-auth">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>x509-certificate-auth</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#id-1.5.8.4"><span class="number">6.1 </span><span class="name">Keystone configuration</span></a></span></dt><dt><span class="section"><a href="#section-p5j-4lq-mx"><span class="number">6.2 </span><span class="name">HAProxy Configuration</span></a></span></dt><dt><span class="section"><a href="#section-mqr-m2p-hx"><span class="number">6.3 </span><span class="name">Create CA and client certificates</span></a></span></dt><dt><span class="section"><a href="#section-qjc-42p-hx"><span class="number">6.4 </span><span class="name">Horizon configuration</span></a></span></dt><dt><span class="section"><a href="#section-chx-42p-hx"><span class="number">6.5 </span><span class="name">Browser configuration</span></a></span></dt><dt><span class="section"><a href="#section-u54-p2p-hx"><span class="number">6.6 </span><span class="name">User accounts</span></a></span></dt><dt><span class="section"><a href="#section-hbf-q2p-hx"><span class="number">6.7 </span><span class="name">How it works</span></a></span></dt></dl></div></div><p>
  The Keystone service supports X.509 SSL cerificate authentication and
  authorization for accessing the Horizon dashboard in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>. This
  feature is disabled by default, and must be manually configured and enabled
  by running a number of Ansible playbooks.
 </p><div id="id-1.5.8.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
   Enabling client SSL certificate authentication and authorization for the
   Horizon dashboard is a non-core feature in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
   
   
  </p></div><div class="sect1" id="id-1.5.8.4"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Keystone configuration</span> <a title="Permalink" class="permalink" href="#id-1.5.8.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To configure and enable X.509 SSL authentication and authorization support
   for the Keystone service, perform the following steps.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Create a new configuration file named <code class="filename">x509auth.yml</code> and
     place it in any directory in your deployer node. For example, perform the
     following command to create the file in the <code class="filename">/tmp</code>
     directory:
    </p><div class="verbatim-wrap"><pre class="screen">touch /tmp/x509auth.yml</pre></div></li><li class="step " id="st-horizon-authenticate-configure-yaml"><p>
     Edit the new file to include the following text. Note that YAML files are
     whitespace-sensitive. Preserve the indentation format of the
     following text.
    </p><div class="verbatim-wrap"><pre class="screen">keystone_x509auth_conf:
    identity_provider:
        id: intermediateca
        description: This is the trusted issuer HEX Id.
    mapping:
        id: x509_mapping1
        rules_file: /tmp/x509auth_mapping.json
    protocol:
        id: x509
    remote_id: intermediateca
    ca_file: /tmp/cacert.pem</pre></div><p>
     The preceding example sets a number of configuration parameters for the
     X.509/Keystone configuration. The following are detailed descriptions of
     each parameter.
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       <span class="bold"><strong>identity_provider</strong></span> This section
       identifies and describes an outside identity provider.
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
         <span class="bold"><strong>id</strong></span>: Any unique, readable string that
         identifies the identitiy provider.
        </p></li><li class="listitem "><p>
         <span class="bold"><strong>description</strong></span>: A description of the
         identity provider.
        </p></li></ul></div></li><li class="listitem "><p>
       <span class="bold"><strong>mapping</strong></span>: This section describes a
       JSON-format file that maps X.509 client certificate attributes to a
       local Keystone user.
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
         <span class="bold"><strong>id</strong></span>: Any unique, readable string that
         identifies the user-certificate mapping.
        </p></li><li class="listitem "><p>
         <span class="bold"><strong>rules_file</strong></span>: The filepath to a JSON
         file that contains the client certificate attributes mapping.
        </p></li></ul></div></li><li class="listitem "><p>
       <span class="bold"><strong>protocol</strong></span>: This section sets the
       cryptographic protocol to be used.
      </p><div class="itemizedlist " id="ul-cbr-shp-hx"><ul class="itemizedlist"><li class="listitem "><p>
         <span class="bold"><strong>id</strong></span>: The cryptographic protocol used
         for the certificate-based authentication/authorization.
        </p></li></ul></div></li><li class="listitem "><p>
       <span class="bold"><strong>remote_id</strong></span>: By default, this field
       expects the client certificate's issuer's common name (CN) as a value.
       The expected value is set in the <code class="literal">keystone.conf</code> file,
       where the default setting is:
      </p><div class="verbatim-wrap"><pre class="screen">remote_id_attribute = SSL_CLIENT_I_DN_CN</pre></div></li><li class="listitem "><p>
       <span class="bold"><strong>ca_file</strong></span>: The file that contains the
       client certificate's related intermediary and root CA certificates.
      </p></li></ul></div><p>
     Note: In the <code class="filename">/tmp/x509auth.yml</code> file, the
     <code class="literal">ca_file</code> value should be a file that contains both the
     root and signing CA certificates (often found in
     <code class="filename">/home/pki/cacert.pem</code>).
    </p></li><li class="step " id="st-horizon-authenticate-configure-json"><p>
     Create a JSON-formatted mapping file. To do so, edit the
     <code class="filename">x509auth.yml</code> file you created in
     <a class="xref" href="#st-horizon-authenticate-configure-yaml" title="Step 2">Step 2</a>
     to reference this file in the
     <span class="bold"><strong>mapping</strong></span>→
     <span class="bold"><strong>rules_file</strong></span> parameter. You can create the
     file with the following example command:
    </p><div class="verbatim-wrap"><pre class="screen">touch /tmp/x509auth_mapping.json</pre></div></li><li class="step "><p>
     Edit the JSON file you created in
     <a class="xref" href="#st-horizon-authenticate-configure-json" title="Step 3">Step 3</a>
     to include the following content:
    </p><div class="verbatim-wrap"><pre class="screen">[
                 {
                     "local": [
                         {
                            "user": {
                                "name": "{0}",
                                "domain": {
                                    "name": "{1}"
                                },
                                "type": "local"
                            }
                         }
                    ],
                    "remote": [
                        {
                            "type": "SSL_CLIENT_S_DN_CN"
                        },
                        {
                            "type": "SSL_CLIENT_S_DN_O"
                        },
                        {
                            "type": "SSL_CLIENT_I_DN",
                            "any_one_of": [
                            ]
                        }
                    ]
                }
]</pre></div></li><li class="step "><p>
     Enter the distinguished name(s) (DN) of the certificate issuer(s) that
     issued your client certificates into the
     <span class="bold"><strong>any_one_of</strong></span> field in the
     <span class="bold"><strong>remote</strong></span> block. The
     <span class="bold"><strong>any_one_of</strong></span> field is a comma-separated
     list of all certificate issuers that you want the Keystone service to
     trust.
    </p><p>
     All DNs in the <span class="bold"><strong>any_one_of</strong></span> field must
     adhere to the following format: 
     A descending list of DN elements, with each element separated by a
     forward slash (<code class="literal">/</code>).
    </p><p>
     The following is an example of a properly formatted DN for a certificate
     issuer named <code class="literal">intermedia</code>.
    </p><div class="verbatim-wrap"><pre class="screen">/C=US/ST=California/O=EXAMPLE/OU=Engineering/CN=intermediateca/emailAddress=user@example.com</pre></div><p>
     The following example file illustrates an
     <code class="filename">x509auth_mapping.json</code> file with the
     <code class="literal">intermedia</code> certificate issuer added to the
     <span class="bold"><strong>any_one_of</strong></span> field. Note that the DN string
     is in quotes.
    </p><div class="verbatim-wrap"><pre class="screen">[
                 {
                     "local": [
                         {
                            "user": {
                                "name": "{0}",
                                "domain": {
                                    "name": "{1}"
                                },
                                "type": "local"
                            }
                         }
                    ],
                    "remote": [
                        {
                            "type": "SSL_CLIENT_S_DN_CN"
                        },
                        {
                            "type": "SSL_CLIENT_S_DN_O"
                        },
                        {
                            "type": "SSL_CLIENT_I_DN",
                            "any_one_of": [
                                "/C=US/ST=California/O=EXAMPLE/OU=Engineering/CN=intermediateca/emailAddress=user@example.com"
                            ]
                        }
                    ]
                }
]</pre></div><p>
     The Keystone service will trust all client certificates issued by any of
     the certificate issuers listed in the
     <span class="bold"><strong>any_one_of</strong></span> field.
    </p></li><li class="step "><p>
     Run the following commands to enable the new X.509/Keystone settings.
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@/tmp/x509auth.yml</pre></div></li></ol></div></div></div><div class="sect1" id="section-p5j-4lq-mx"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">HAProxy Configuration</span> <a title="Permalink" class="permalink" href="#section-p5j-4lq-mx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>section-p5j-4lq-mx</li></ul></div></div></div></div><p>
   Because of the experimental nature of the HAProxy feature, it is important
   to minimize the risk of impacting other services. If you have implemented,
   or wish to implement the HAProxy feature alongside client SSL certificate
   login to the Horizon dashboard in your cloud, please complete the following
   steps to make the necessary manual configuration changes.
  </p><div id="id-1.5.8.5.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    You must perform the Keystone configuration steps in the previous section
    before performing the following HAProxy configuration changes.
   </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Locate and open the
     <code class="literal">~/openstack/ardana/ansible/roles/haproxy/templates/haproxy.cfg</code>
     file.
    </p></li><li class="step "><p>
     Locate the following line in the <code class="literal">haproxy.cfg</code> file.
    </p><div class="verbatim-wrap"><pre class="screen">listen {{ network.vip }}-{{ port }}</pre></div><p>
     Enter the following codeblock in the open space immediately preceding the
     <code class="literal">listen {{ network.vip }}-{{ port }}</code> line.
    </p><div class="verbatim-wrap"><pre class="screen">{%- if service == 'KEY_API' and port == '5000' %}
    {% set bind_defaults = 'ca-file /etc/ssl/private/cacert.pem verify optional' %}
{%- endif %}</pre></div><p>
     After entering the preceding code, your <code class="literal">haproxy.cfg</code>
     file should look like the following example.
    </p><div class="verbatim-wrap"><pre class="screen">{%- if network.terminate_tls is defined and network.terminate_tls and port == '80' %}
    {% set port = '443' %}
{%- endif %}

{%- if service == 'KEY_API' and port == '5000' %}
    {% set bind_defaults = 'ca-file /etc/ssl/private/cacert.pem verify optional' %}
{%- endif %}

listen {{ network.vip }}-{{ port }}
    {%- set options = network.vip_options | default(vip_options_defaults) %}
      {%- if options &gt; 0 %}
        {%- for option in options %}
    {{ option }}
        {%- endfor %}
      {%- endif %}
    bind {{ network.vip }}:{{ port }} {% if network.terminate_tls is defined and network.terminate_tls %} ssl crt {{ frontend_server_cert_directory }}/{{ network.cert_file }} {{ bind_defaults }} {% endif %}</pre></div></li><li class="step "><p>
     Commit the changes to your local git repository.
    </p><div class="verbatim-wrap"><pre class="screen">git add -A
git commit -m "Added HAProxy configuration changes"</pre></div></li><li class="step "><p>
     Run the configuration processor and ready-deployment Ansible playbooks.
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     Implement the HAProxy configuration changes.
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts FND-CLU-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect1" id="section-mqr-m2p-hx"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Create CA and client certificates</span> <a title="Permalink" class="permalink" href="#section-mqr-m2p-hx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>section-mqr-m2p-hx</li></ul></div></div></div></div><p>
   An X.509 client certificate can be issued from any certificate authority
   (CA). You can use the openssl command-line tool to generate certificate
   signing requests (CSRs). Once a CA has signed your CSR, the CA will return a
   signed certificate that you can use to authenticate to Horizon.
  </p><p>
   Read more about openssl here: <a class="link" href="https://www.openssl.org/" target="_blank">https://www.openssl.org/</a>
  </p><div id="id-1.5.8.6.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Your cloud's load balancer will reject any self-signed client SSL
    certificates. Ensure that all client certificates are signed by a
    certificate authority that your cloud recognizes.
   </p></div></div><div class="sect1" id="section-qjc-42p-hx"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Horizon configuration</span> <a title="Permalink" class="permalink" href="#section-qjc-42p-hx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>section-qjc-42p-hx</li></ul></div></div></div></div><p>
   Complete the following steps to configure Horizon to support SSL certificate
   authorization and authentication.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the
     <code class="literal">~/openstack/ardana/ansible/roles/HZN-WEB/defaults/main.yml</code>
     file and set the following parameter to <code class="literal">True</code>.
    </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_enabled: True</pre></div></li><li class="step "><p>
     Locate the last line in the
     <code class="literal">~/openstack/ardana/ansible/roles/HZN-WEB/defaults/main.yml</code>
     file. The default configuration for this line should look like the
     following.
    </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_choices:
  - {protocol: saml2, description: "ADFS Credentials"}</pre></div><div class="itemizedlist " id="ul-jg3-g2r-mx"><ul class="itemizedlist"><li class="listitem "><p>
       If your cloud <span class="bold"><strong>does not</strong></span> have AD FS
       enabled, then replace the preceding
       <code class="literal">horizon_websso_choices:</code> parameter with the following.
      </p><div class="verbatim-wrap"><pre class="screen">- {protocol: x509, description: "X.509 SSL Certificate"}</pre></div><p>
       The resulting block should look like the following.
      </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_choices:
    - {protocol: x509, description: "X.509 SSL Certificate"}</pre></div></li><li class="listitem "><p>
       If your cloud <span class="bold"><strong>does</strong></span> have AD FS enabled,
       then simply add the following parameter to the
       <code class="literal">horizon_websso_choices:</code> section. Do not replace the
       default parameter, add the following line to the existing block.
      </p><div class="verbatim-wrap"><pre class="screen">- {protocol: saml2, description: "ADFS Credentials"}</pre></div><p>
       If your cloud has AD FS enabled, the final block of your
       <code class="literal">~/openstack/ardana/ansible/roles/HZN-WEB/defaults/main.yml</code>
       should have the following entries.
      </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_choices:
    - {protocol: x509, description: "X.509 SSL Certificate"}
    - {protocol: saml2, description: "ADFS Credentials"}</pre></div></li></ul></div></li><li class="step "><p>
     Run the following commands to add your changes to the local git
     repository, and reconfigure the Horizon service, enabling the changes made
     in <span class="bold"><strong>Step 1</strong></span>:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "my commit message"
cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts horizon-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect1" id="section-chx-42p-hx"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Browser configuration</span> <a title="Permalink" class="permalink" href="#section-chx-42p-hx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>section-chx-42p-hx</li></ul></div></div></div></div><p>
   To enable your web browser to present a certificate to the Horizon dashboard
   upon login, you first need to import the certificate. The steps to complete
   this action will vary from browser to browser. Please refer to your
   browser's documentation for specific instructions.
  </p><div class="procedure " id="ol-oyb-rxp-hx"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Import the desired certificate into your web browser's certificate store.
    </p></li><li class="step "><p>
     After importing the certificate, verify that it appears in your browser's
     certificate manager.
    </p></li></ol></div></div></div><div class="sect1" id="section-u54-p2p-hx"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">User accounts</span> <a title="Permalink" class="permalink" href="#section-u54-p2p-hx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>section-u54-p2p-hx</li></ul></div></div></div></div><p>
   For the Keystone service to use X.509 certificates to grant users access to
   Horizon, there must be a Keystone user account associated with each
   certificate. Keystone associates user accounts with certificates by matching
   the common name (CN) and organization (O) of a presented certificate with
   the username and domain of an existing Keystone user.
  </p><p>
   When an X.509 certificate is presented to Horizon for
   authentication/authorization, Horizon passes the certificate information
   along to the Keystone service. Keystone attempts to match the CN and O of
   the certificate with the username and domain of an existing local user
   account. For this operation to be successful, there must be a Keystone user
   account and domain that match the CN and O of the certificate.
  </p><p>
   For example, if a user named Sam presents a certificate to Horizon with the
   following information,
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     CN=sam
    </p></li><li class="listitem "><p>
     O=EXAMPLE
    </p></li></ul></div><p>
   Then there must be an existing Keystone user account with the following
   values,
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Username=sam
    </p></li><li class="listitem "><p>
     Domain=EXAMPLE
    </p></li></ul></div><p>
   Further, Sam's client certificate must have been issued by one of the
   certificate issuers listed in the
   <span class="bold"><strong>any_one_of</strong></span> field in the
   <code class="literal">x509auth_mapping.json</code> file.
  </p><p>
   Also, when creating a local Keystone user, you must assign the user account
   a project scope. Without a project scope, the authorization portion of the
   sign-on process will fail.
  </p><p>
   The following steps illustrate how to use the CLI to create a domain, create
   and manage a user, and assign a permissions role to the new user.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Create a new domain, named <code class="literal">EXAMPLE</code>.
    </p><div class="verbatim-wrap"><pre class="screen">openstack domain create EXAMPLE</pre></div></li><li class="step " id="st-horizon-auth-create-project"><p>
     Create a new project named <code class="literal">xyz</code>, under the
     <code class="literal">EXAMPLE</code> domain.
    </p><div class="verbatim-wrap"><pre class="screen">openstack project create --domain EXAMPLE xyz</pre></div></li><li class="step "><p>
     Create a new user named <code class="literal">Sam</code> in the
     <code class="literal">EXAMPLE</code> domain. Set the password and
     email for the new account.
    </p><div class="verbatim-wrap"><pre class="screen">openstack user create --domain EXAMPLE --password pass \
  --email sam@example.com --enable sam</pre></div></li><li class="step "><p>
     Create a new role named <code class="literal">role1</code>.
    </p><div class="verbatim-wrap"><pre class="screen">openstack role create role1</pre></div></li><li class="step "><p>
     Grant the new role, <code class="literal">role1</code> to the new user
     <code class="literal">Sam</code> from the <code class="literal">EXAMPLE</code> domain.
     Note that both the user account and domain must be referenced by their
     unique ID numbers rather than their friendly names.
    </p><div class="verbatim-wrap"><pre class="screen">openstack role add --user 04f3db9e7f3f45dc82e1d5f20b4acfcc \
  --domain 6b64021839774991b5e0df16077f11eb role1</pre></div></li><li class="step "><p>
     Add the user <code class="literal">Sam</code> to the newly-created project from
     <a class="xref" href="#st-horizon-auth-create-project" title="Step 2">Step 2</a>. Note that the
     project and user account must be referenced by their respective unique ID
     numbers rather than their friendly names.
    </p><div class="verbatim-wrap"><pre class="screen">openstack role add --project 4e2ad14406b247c7a9fc0a48c0b1713e \
  --user 04f3db9e7f3f45dc82e1d5f20b4acfcc role1</pre></div></li></ol></div></div></div><div class="sect1" id="section-hbf-q2p-hx"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">How it works</span> <a title="Permalink" class="permalink" href="#section-hbf-q2p-hx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-horizon_ssl_auth.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-horizon_ssl_auth.xml</li><li><span class="ds-label">ID: </span>section-hbf-q2p-hx</li></ul></div></div></div></div><p>
   The SSL authentication and authorization process is detailed in the
   following steps.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     User directs a web browser to the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Horizon login landing page.
    </p></li><li class="listitem "><p>
     The user selects the "X.509 Certificate" login option from the dropdown
     menu.
    </p></li><li class="listitem "><p>
     Horizon responds with an HTTP 302 redirect, redirecting the browser to the
     SSL-protected Keystone (federated) authentication endpoint.
    </p></li><li class="listitem "><p>
     The browser then prompts user to select the certificate to use for the
     login (if there is more than one certificate for the given trusted
     Certificate Authority (CA)).
    </p></li><li class="listitem "><p>
     The web browser establishes a 2-way SSL handshake with the Keystone
     service.
    </p></li><li class="listitem "><p>
     Keystone, utilizing federation mapping, maps the user to a federated
     persona and issues an (federated) unscoped token.
    </p></li><li class="listitem "><p>
     The token is then passed to the browser, along with JavaScript code that
     redirects the browser back to the Horizon dashboard.
    </p></li><li class="listitem "><p>
     The browser then logs into the Horizon dashboard using the newly issued
     unscoped token to authenticate the user.
    </p></li><li class="listitem "><p>
     Horizon queries the Keystone service for the list of federated projects
     the authenticated user has access to.
    </p></li><li class="listitem "><p>
     Horizon then rescopes the token to the first project, granting the user
     authorization.
    </p></li><li class="listitem "><p>
     The login process is completed.
    </p></li></ol></div><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/media-security-Horizon-SSL-Keystone.png" target="_blank"><img src="images/media-security-Horizon-SSL-Keystone.png" width="" /></a></div></div></div></div><div class="chapter " id="tls30overview"><div class="titlepage"><div><div><h1 class="title"><span class="number">7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Transport Layer Security (TLS) Overview</span> <a title="Permalink" class="permalink" href="#tls30overview">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_overview.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_overview.xml</li><li><span class="ds-label">ID: </span>tls30overview</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#id-1.5.9.6"><span class="number">7.1 </span><span class="name">Comparing Clean Installation and Upgrade of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span></a></span></dt><dt><span class="section"><a href="#idg-all-security-tls-config-xml-1"><span class="number">7.2 </span><span class="name">TLS Configuration</span></a></span></dt><dt><span class="section"><a href="#TLS-MySQL"><span class="number">7.3 </span><span class="name">Enabling TLS for MySQL Traffic</span></a></span></dt><dt><span class="section"><a href="#TLS-RabbitMQ"><span class="number">7.4 </span><span class="name">Enabling TLS for RabbitMQ Traffic</span></a></span></dt><dt><span class="section"><a href="#troubleshootng-tls"><span class="number">7.5 </span><span class="name">Troubleshooting TLS</span></a></span></dt></dl></div></div><p>
  The Transport Layer Security (TLS) protocol, successor to SSL, provides the
  mechanisms to ensure authentication, non-repudiation, confidentiality, and
  integrity of user communications to and between the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> services from
  internal and public endpoints.
 </p><p>
  OpenStack endpoints are HTTP (REST) services providing APIs to other
  OpenStack services on the management network. All traffic to OpenStack
  services coming in on the public endpoints and some traffic between services
  can be secured using TLS connections.
 </p><p>
  In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, the following are enabled for TLS
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    API endpoints in the internal and admin VIPs can now be secured by TLS.
   </p></li><li class="listitem "><p>
    API endpoints can be provided with their own certificates (this is shown in
    the model examples) or they can simply use the default certificate.
   </p></li><li class="listitem "><p>
    The Barbican key management service API can be secured by TLS from the load
    balancer to the service endpoint.
   </p></li><li class="listitem "><p>
    You can add multiple trust chains (certificate authority (CA)
    certificates).
   </p></li><li class="listitem "><p>
    Fully qualified domain names (FQDNs) can be used for public endpoints and
    now they can be changed. The external name in the input model files (in
    <code class="literal">~/openstack/my_cloud/definition/data/network_groups.yml</code>) is
    where the domain name is indicated and changed.
   </p></li><li class="listitem "><p>
    There are two monitoring alarms specific to certificates, 14-days to
    certificate expiration and 1-day to expiration.
   </p></li><li class="listitem "><p>
    TLS can be turned off/on for individual endpoints.
   </p></li></ul></div><div class="sect1" id="id-1.5.9.6"><div class="titlepage"><div><div><h2 class="title"><span class="number">7.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Comparing Clean Installation and Upgrade of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <a title="Permalink" class="permalink" href="#id-1.5.9.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_overview.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_overview.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Clean install: all TLS-encrypted services are already listed under
   tls-components in <code class="literal">network_groups.yml</code>
  </p><p>
   You just have to:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Add your self-signed CA cert and server cert (for testing)
    </p></li><li class="listitem "><p>
     Or add your public (or company) CA-signed server cert and the public (or
     company) CA cert (for production)
    </p></li></ul></div><p>
   Upgrade: you do not have TLS enabled already on the internal endpoints so
   you need to
  </p><div class="itemizedlist " id="ul-j3y-k4t-vv"><ul class="itemizedlist"><li class="listitem "><p>
     Add your self-signed CA cert and server cert (for testing)
    </p></li><li class="listitem "><p>
     Or add your public (or company) CA-signed server cert and the public (or
     company) CA cert (for production)
    </p></li><li class="listitem "><p>
     Add all the services to tls-components in
     <code class="literal">network_groups.yml</code>
    </p></li></ul></div><p>
   For information on enabling and disabling TLS, see
   <a class="xref" href="#idg-all-security-tls-config-xml-1" title="7.2. TLS Configuration">Section 7.2, “TLS Configuration”</a>.
  </p><p>
   For instructions on installing certificates, see
   <a class="xref" href="#idg-all-security-tls-config-xml-1" title="7.2. TLS Configuration">Section 7.2, “TLS Configuration”</a>.
   
  </p></div><div class="sect1" id="idg-all-security-tls-config-xml-1"><div class="titlepage"><div><div><h2 class="title"><span class="number">7.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">TLS Configuration</span> <a title="Permalink" class="permalink" href="#idg-all-security-tls-config-xml-1">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span>idg-all-security-tls-config-xml-1</li></ul></div></div></div></div><p>
  In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, you can provide your own certificate authority and
  certificates for internal and public virtual IP addresses (VIPs), and you
  should do so for any production cloud. The certificates automatically
  generated by <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> are useful for testing and setup, but you should always
  install your own for production use. Certificate installation is discussed
  below.
 </p><div class="sect2" id="id-1.5.9.7.3"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Using the Default My Public Cert</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Read the following if you are using the default <code class="literal">cert-name:
   my-public-cert</code> in your model.
  </p><p>
   The bundled test cert for public endpoints, located at
   <code class="literal">~/openstack/my_cloud/config/tls/certs/my-public-cert</code>, is
   now expired but was left in the product in case you changed the content with
   your valid cert. Please verify if the certificate is expired and generate
   your own by following the guidelines further down on this page or by using a
   generic instruction from the web.
  </p><p>
   You can verify the expiry by running this command:
  </p><div class="verbatim-wrap"><pre class="screen">openssl x509 -in ~/openstack/my_cloud/config/tls/certs/my-public-cert -noout -enddate
notAfter=Feb 12 01:18:46 2019 GMT</pre></div></div><div class="sect2" id="id-1.5.9.7.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Certificate Terms</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Before you begin, the following list of terms will be helpful when
   generating and installing certificates.
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.5.9.7.4.3.1"><span class="term ">Openstack-generated public CA</span></dt><dd><p>
      An OpenStack-generated public CA
      (<code class="literal">openstack_frontend_cacert.crt</code>) is available for you
      in <code class="literal">/usr/local/share/ca-certificates</code>.
     </p></dd><dt id="id-1.5.9.7.4.3.2"><span class="term ">Fully qualified domain name (FQDN) of the public VIP</span></dt><dd><p>
      The registered domain name. A FQDN is not mandatory. It is valid to have
      no FQDN and use IP addresses instead. You can use FQDNs on public
      endpoints, and you may change them whenever the need arises.
     </p></dd><dt id="id-1.5.9.7.4.3.3"><span class="term ">Certificate authority (CA) certificate</span></dt><dd><p>
      Your certificates must be signed by a CA, such as your internal IT
      department or a public certificate authority. For this example we will
      use a self-signed certificate.
     </p></dd><dt id="id-1.5.9.7.4.3.4"><span class="term ">Server certificate</span></dt><dd><p>
      It is easy to confuse server certificates and CA certificates. Server
      certificates reside on the server and CA certificates reside on the
      client. A server certificate affirms that the server that sent it serves
      a set of IP addresses, domain names, and set of services. A CA
      certificate is used by the client to authenticate this claim.
     </p></dd><dt id="id-1.5.9.7.4.3.5"><span class="term ">SAN (subject-alt-name)</span></dt><dd><p>
      The set of IP addresses and domain names in a server certificate request:
      A template for a server certificate.
     </p></dd><dt id="id-1.5.9.7.4.3.6"><span class="term ">Certificate signing request (CSR)</span></dt><dd><p>
      A blob of data generated from a certificate request and sent to a CA,
      which would then sign it, produce a server certificate, and send it back.
     </p></dd><dt id="id-1.5.9.7.4.3.7"><span class="term ">External VIP</span></dt><dd><p>
      External virtual IP address
     </p></dd><dt id="id-1.5.9.7.4.3.8"><span class="term ">Internal VIP</span></dt><dd><p>
      Internal virtual IP address
     </p></dd></dl></div><p>
   The major difference between an external VIP certificate and an internal VIP
   certificate is that the internal VIP has approximately 40 domain names in
   the SAN. This is because each service has a different domain name in
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>. So it is unlikely that you can create an internal server
   certificate before running the configuration processor. But after a
   configuration processor run, a certificate request would be created for each
   of your cert-names.
  </p></div><div class="sect2" id="id-1.5.9.7.5"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring TLS in the input model</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   For this example certificate configuration, let us assume there is no FQDN
   for the external VIP and that you are going to use the default IP address
   provided by <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>. Let's also assume that for the internal VIP you
   will use the defaults as well. If you were to call your certificate
   authority "example-CA," the CA certificate would then be called
   "example-CA.crt" and the key would be called "example-CA.key." In the
   following examples, the external VIP certificate will be named
   "example-public-cert" and the internal VIP certificate will be named
   "example-internal-cert."
  </p><p>
   Any time you make a cert change when using your own CA:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     You should use a distinct name from those already existing in
     <code class="filename">config/tls/cacerts</code>. This also means you should not
     <span class="emphasis"><em>reuse</em></span> your CA names. You should use unique and
     distinguishable names such as MyCompanyXYZ_PrivateRootCA.crt. A new name
     is what indicates that a file is new or changed, so reusing a name means
     that the file is not considered changed even its contents have changed.
    </p></li><li class="listitem "><p>
     You should not remove any existing CA files from
     <code class="filename">config/tls/cacerts</code>.
    </p></li><li class="listitem "><p>
     If you want to remove an existing CA use the following steps:
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Remove the file.
      </p></li><li class="step "><p>
       Then run:
      </p><div class="verbatim-wrap"><pre class="screen">ansible -i hosts/verb_hosts FND-STN -a 'sudo keytool -delete -alias debian:&lt;filename to remove&gt; \
-keystore /usr/lib/jvm/java-7-openjdk-amd64/jre/lib/security/cacerts -storepass changeit'</pre></div></li></ol></div></div></li></ul></div><div id="id-1.5.9.7.5.5" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important</h6><p>
    Be sure to install your own certificate for all production clouds after
    installing and testing your cloud. If you ever want to test or troubleshoot
    later, you will be able to revert to the sample certificate to get back to
    a stable state for testing.
   </p></div><div id="id-1.5.9.7.5.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Unless this is a new deployment, do not update both the certificate and the
    CA together. Add the CA first and then run a site deploy. Then update the
    certificate and run tls-reconfigure, FND-CLU-stop, FND-CLU-start and then
    hlm-reconfigure. If a playbook has failed, rerun it with -vv to get detailed
    error information. The configure, HAproxy restart, and reconfigure steps are
    included below. If this is a new deployment and you are adding your own
    certs/CA before running site.yml this caveat does not apply.
   </p></div><p>
   You can add your own certificate by following the instructions below. All
   changes must go into the following file:
  </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/definition/data/network_groups.yml</pre></div><p>
   The entries for TLS for the internal and admin load balancers are:
  </p><div class="verbatim-wrap"><pre class="screen">- provider: ip-cluster
        name: lb
        tls-components:
        - default
        components:
        # These services do not currently support TLS so they are not listed
        # under tls-components
        - nova-metadata
        roles:
        - internal
        - admin
        cert-file: openstack-internal-cert
        # The openstack-internal-cert is a reserved name and
        # this certificate will be autogenerated. You
        # can bring in your own certificate with a different name

        # cert-file: customer-provided-internal-cert
        # replace this with name of file in "config/tls/certs/"</pre></div><p>
   The configuration processor will also create a request template for each
   named certificate under <code class="filename">info/cert_reqs/</code>, which looks
   like:
  </p><div class="verbatim-wrap"><pre class="screen">info/cert_reqs/customer-provided-internal-cert</pre></div></div><div class="sect2" id="id-1.5.9.7.6"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Generating and Signing Certificates</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   These request templates contain the subject <code class="literal">Alt-names</code>
   that the certificates need. You can add to this template before generating
   your certificate signing request.
  </p><p>
   You would then send the CSR to your CA to be signed, and once you receive
   the certificate, place it in <code class="filename">config/tls/certs</code>
  </p><p>
   When you bring in your own certificate, you may want to bring in the trust
   chains (or CA certificate) for this certificate. This is usually not
   required if the CA is a public signer that is typically bundled with the
   operating system. However, we suggest you include it anyway by copying the
   file into the directory <code class="filename">config/cacerts/</code>.
  </p></div><div class="sect2" id="idg-all-security-tls-config-xml-4"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">User-provided certificates and trust chains</span> <a title="Permalink" class="permalink" href="#idg-all-security-tls-config-xml-4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span>idg-all-security-tls-config-xml-4</li></ul></div></div></div></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> generates its own internal certificates but is designed to allow
   you to bring in your own certificates for the VIPs. Here is the general
   process.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     You must have a server certificate and a CA certificate to go with it
     (unless the signer is a public CA and it is already bundled with most
     distributions).
    </p></li><li class="step "><p>
     You must decide the names of the server certificates and configure the
     <code class="filename">network_groups.yml</code> file in the input model such that
     each load balancer provider has at least one cert-name associated with it.
    </p></li><li class="step "><p>
     Run the configuration processor. You may or may not have the certificate
     file at this point. The configuration processor would create certificate
     request file artefacts under <code class="filename">info/cert_reqs/</code> for each
     of the cert-name(s) in the <code class="literal">network_groups.yml</code> file.
     While there is no special reason to use the request file created for an
     external endpoint VIP certificate, it is important to use the request
     files created for internal certificates since the canonical names for the
     internal VIP as there can be many of them and they will be service
     specific. Each of these needs to be in the Subject Alt Names attribute of
     the. certificate.
    </p></li><li class="step "><p>
     Create a certificate signing request for this request file and send it to
     your internal CA or a public CA to get it certified and issued with a
     certificate. You will now have a server certificate and possibly a trust
     chain or CA certificate.
    </p></li><li class="step "><p>
     Upload to the Cloud Lifecycle Manager. Server certificates should be added to
     <code class="filename">config/tls/certs</code> and CA certificates should be added
     to <code class="filename">config/tls/cacerts</code>. The file extension should be
     <code class="filename">.crt</code> for the CA certificate to be processed by
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>. Detailed steps are next.
    </p></li></ol></div></div></div><div class="sect2" id="id-1.5.9.7.8"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Edit the Input Model to Include Your Certificate Files</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the load balancer configuration in
     <code class="filename">openstack/my_cloud/definition/data/network_groups.yml</code>:
    </p><div class="verbatim-wrap"><pre class="screen">load-balancers:
 - provider: ip-cluster
 name: lb
 tls-components:
 - default
 components:
 - cassandra
 - nova-metadata
 roles:
 - internal
 - admin
 cert-file: example-internal-cert #&lt;&lt;&lt;-------- Certificate name for the internal VIP

- provider: ip-cluster
 name: extlb
 external-name: myardana.test #&lt;&lt;&lt;------ Use just IP for the external VIP in this example
 tls-components:
 - default
 roles:
 - public
 cert-file: example-public-cert #&lt;&lt;&lt;-------- Certificate name for the external VIP</pre></div></li><li class="step "><p>
     Commit your changes to the local git repository and run the configuration
     processor:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
git add -A
git commit -m "changed VIP certificates"
ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="step "><p>
     Verify that certificate requests have been generated by the configuration
     processor for every certificate file configured in the
     <code class="filename">networks_groups.yml</code> file. In this example, there are
     two files, as shown from the list command:
    </p><div class="verbatim-wrap"><pre class="screen">ls ~/openstack/my_cloud/info/cert_reqs
example-internal-cert
example-public-cert</pre></div></li></ol></div></div></div><div class="sect2" id="self-signed"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Generating a Self-signed CA</span> <a title="Permalink" class="permalink" href="#self-signed">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span>self-signed</li></ul></div></div></div></div><div id="id-1.5.9.7.9.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    In a production setting you will not perform this step. You will use your
    company's CA or a valid public CA.
   </p></div><p>
   This section demonstrates to how you can create your own self-signed CA and
   then use this CA to sign server certificates. This CA can be your
   organization's IT internal CA that is self-signed and whose CA certificates
   are deployed on your organization's machines. This way the server
   certificate becomes legitimate.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Copy the commands below to the command line and execute. This will cause
     the two files to be created: <code class="filename">example-CA.key</code> and
     <code class="filename">example-CA.crt</code>.
    </p><div class="verbatim-wrap"><pre class="screen">export EXAMPLE_CA_KEY_FILE='example-CA.key'
export EXAMPLE_CA_CERT_FILE='example-CA.crt'
openssl req -x509 -batch -newkey rsa:2048 -nodes -out "${EXAMPLE_CA_CERT_FILE}" \
-keyout "${EXAMPLE_CA_KEY_FILE}" \
-subj "/C=UK/O=hp/CN=YourOwnUniqueCertAuthorityName" \
-days 365</pre></div><p>
     You can tweak the subj and days settings above to meet your needs, or to
     test. For instance, if you want to test what happens when a CA expires,
     you can set 'days' to a very low value.
    </p></li><li class="step "><p>
     Select the configuration processor-generated request file from
     <code class="filename">info/cert_reqs/</code>:
    </p><div class="verbatim-wrap"><pre class="screen">cat ~/openstack/my_cloud/info/cert_reqs/example-internal-cert</pre></div></li><li class="step "><p>
     Copy this file to your working directory and append a
     <code class="filename">.req</code> extension to it.
    </p><div class="verbatim-wrap"><pre class="screen">cp ~/openstack/my_cloud/info/cert_reqs/example-internal-cert \
  example-internal-cert.req</pre></div></li></ol></div></div><div class="complex-example"><div class="example" id="privateMetadata"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 7.1: </span><span class="name">Certificate request file </span><a title="Permalink" class="permalink" href="#privateMetadata">#</a></h6></div><div class="example-contents"><p>
    The certificate request file should look similar to the following example:
   </p><div class="verbatim-wrap"><pre class="screen">[req]
distinguished_name = req_distinguished_name
req_extensions = v3_req
prompt = no

[ req_distinguished_name ]
CN = "openstack-vip"

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = "deployerincloud-ccp-c0-m1-mgmt"
DNS.2 = "deployerincloud-ccp-vip-CEI-API-mgmt"
DNS.3 = "deployerincloud-ccp-vip-CND-API-mgmt"
<span class="emphasis"><em>[...]</em></span>
DNS.47 = "192.168.245.5"
IP.1 = "192.168.245.5"

=============end of certificate request file.</pre></div></div></div></div><div id="id-1.5.9.7.9.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    In the case of a public VIP certificate, please add all the FQDNs you
    want it to support Currently, <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> does not add the hostname for
    the external-name specified in <code class="literal">network_groups.yml</code> to
    the certificate request file. However, you can add it to the certificate
    request file manually. Here we assume that
    <code class="literal">myopenstack.test</code> is your external-name. In that case you
    would add this line (to the full sample certificate request file shown in
    <a class="xref" href="#privateMetadata" title="Certificate request file">Example 7.1, “Certificate request file”</a>):
   </p><div class="verbatim-wrap"><pre class="screen">DNS.48 = "myopenstack.test"</pre></div></div><div id="id-1.5.9.7.9.7" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Any attempt to use IP addresses rather than FQDNs in certificates must use
    subject alternate name entries that list both the IP address (needed for
    Google) and DNS with an IP (needed for a Python bug workaround). Failure to
    create the certificates in this manner will cause future installations of
    Go-based tools (such as Cloud Foundry, Stackato and other PaaS components)
    to fail.
   </p></div><p>
   In the case of a public VIP certificate, add all the FQDNs you want it to
   support. Openstack does not add the hostname for the external-name specified
   in <code class="filename">network_groups.yml</code> to the certificate request file.
   However, you can add it to the certificate request file manually. Assume
   that <code class="filename">myopenstack.test</code> is your external-name. In that
   case you would add this line to the full sample certificate request file
   shown above.
  </p><div class="verbatim-wrap"><pre class="screen">DNS.48 = "myopenstack.test"</pre></div><div id="id-1.5.9.7.9.10" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Any attempt to use IP addresses rather than FQDNs in certificates must use
    subject alternate name entries that list both the IP address (needed for
    Google) and DNS with an IP (needed for a Python bug workaround). Failure to
    create the certificates in this manner will cause future installations of
    Go-based tools (such as Cloud Foundry, Stackato and other PaaS components)
    to fail.
   </p></div></div><div class="sect2" id="id-1.5.9.7.10"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Generate a Certificate Signing Request</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.10">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div id="id-1.5.9.7.10.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    In a production setting you will not perform this step. You will use your
    company's CA or a valid public CA.
   </p></div><p>
   Now that you have a CA and a certificate request file, it is time to generate
   a CSR.
  </p><div id="id-1.5.9.7.10.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Please use a unique CN for your example Certificate Authority and do not
    install multiple CA certificates with the same CN into your cloud.
   </p></div><div class="verbatim-wrap"><pre class="screen">export EXAMPLE_SERVER_KEY_FILE='example-internal-cert.key'
export EXAMPLE_SERVER_CSR_FILE='example-internal-cert.csr'
export EXAMPLE_SERVER_REQ_FILE=example-internal-cert.req
openssl req -newkey rsa:2048 -nodes -keyout "$EXAMPLE_SERVER_KEY_FILE" \
-out "$EXAMPLE_SERVER_CSR_FILE" -extensions v3_req -config "$EXAMPLE_SERVER_REQ_FILE"</pre></div><p>
   In production you would usually send the generated
   <code class="filename">example-internal-cert.csr</code> file to your IT department.
   But in this example you are your own CA, so sign and generate a server
   certificate.
  </p></div><div class="sect2" id="id-1.5.9.7.11"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Generate a Server Certificate</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.11">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div id="id-1.5.9.7.11.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    In a production setting you will not perform this step. You will send the
    CSR created in the previous section to your company CA or a to a valid
    public CA and have them sign and send you back the certificate.
   </p></div><p>
   This section demonstrates how you would use the self-signed CA that you
   created earlier to sign and generate a server certificate. A server
   certificate is essentially a signed public key, the signer being a CA and
   trusted by a client. When you install this signed CA's certificate (called
   CA certificate or trust chain) on the client machine, you are telling the
   client to trust this CA, and to implicitly trust any server certificates
   that are signed by this CA. This creates a trust anchor.
  </p><p>
   <span class="bold"><strong>CA configuration file</strong></span>
  </p><p>
   When the CA signs the certificate, it uses a configuration file that tells
   it to verify the CSR. Note that in a production scenario the CA takes care
   of this for you.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Create a file called <code class="filename">openssl.cnf</code> and add the
     following contents to it.
    </p><div class="verbatim-wrap"><pre class="screen"># Copyright 2010 United States Government as represented by the
# Administrator of the National Aeronautics and Space Administration.
# All Rights Reserved.
#...

# OpenSSL configuration file.
#

# Establish working directory.

dir = .

[ ca ]
default_ca = CA_default

[ CA_default ]
serial = $dir/serial
database = $dir/index.txt
new_certs_dir = $dir/
certificate = $dir/cacert.pem
private_key = $dir/cakey.pem
unique_subject = no
default_crl_days = 365
default_days = 365
default_md = md5
preserve = no
email_in_dn = no
nameopt = default_ca
certopt = default_ca
policy = policy_match
copy_extensions = copy

[ policy_match ]
countryName = optional
stateOrProvinceName = optional
organizationName = optional
organizationalUnitName = optional
commonName = supplied
emailAddress = optional

[ req ]
default_bits = 1024 # Size of keys
default_keyfile = key.pem # name of generated keys
default_md = md5 # message digest algorithm
string_mask = nombstr # permitted characters
distinguished_name = req_distinguished_name
req_extensions = v3_req
x509_extensions = v3_ca

[ req_distinguished_name ]
# Variable name Prompt string
#---------------------- ----------------------------------
0.organizationName = Organization Name (company)
organizationalUnitName = Organizational Unit Name (department, division)
emailAddress = Email Address
emailAddress_max = 40
localityName = Locality Name (city, district)
stateOrProvinceName = State or Province Name (full name)
countryName = Country Name (2 letter code)
countryName_min = 2
countryName_max = 2
commonName = Common Name (hostname, IP, or your name)
commonName_max = 64

[ v3_ca ]
basicConstraints = CA:TRUE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer:always
subjectAltName = @alt_names

[ v3_req ]
basicConstraints = CA:FALSE
subjectKeyIdentifier = hash

[ alt_names ]

######### end of openssl.cnf #########</pre></div></li><li class="step "><p>
     Sign the server certificate with your CA. Copy the comands below to the
     command line and execute. This will cause the file,
     <code class="filename">example-internal-cert.crt</code>, to be created.
    </p><div class="verbatim-wrap"><pre class="screen">export EXAMPLE_SERVER_CERT_FILE='example-internal-cert.crt'
export EXAMPLE_SERVER_CSR_FILE='example-internal-cert.csr'
export EXAMPLE_CA_KEY_FILE='example-CA.key'
export EXAMPLE_CA_CERT_FILE='example-CA.crt'

touch index.txt
openssl rand -hex -out serial 6

openssl ca -batch -notext -md sha256 -in "$EXAMPLE_SERVER_CSR_FILE" \
-cert "$EXAMPLE_CA_CERT_FILE" \
-keyfile "$EXAMPLE_CA_KEY_FILE" \
-out "$EXAMPLE_SERVER_CERT_FILE" \
-config openssl.cnf -extensions v3_req</pre></div></li><li class="step "><p>
     Concatenate both the server key and certificate in preparation for
     uploading to the Cloud Lifecycle Manager.
    </p><div class="verbatim-wrap"><pre class="screen">cat example-internal-cert.key example-internal-cert.crt &gt; example-internal-cert</pre></div></li><li class="step "><p>
     You have only created the <code class="literal">internal-cert</code> in this
     example. Repeat the above sequence for
     <code class="literal">example-public-cert</code>. Make sure you use the appropriate
     certificate request generated by the configuration processor.
    </p></li></ol></div></div></div><div class="sect2" id="id-1.5.9.7.12"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Upload to the Cloud Lifecycle Manager</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.12">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     The two files created from the example above will need to be uploaded to
     the Cloud Lifecycle Manager and copied into <code class="filename">config/tls</code>:
    </p><div class="itemizedlist " id="idg-all-security-tls-config-xml-7"><ul class="itemizedlist"><li class="listitem "><p>
       example-internal-cert
      </p></li><li class="listitem "><p>
       example-CA.crt
      </p></li></ul></div></li><li class="step "><p>
     On the Cloud Lifecycle Manager, execute the following copy commands. If you created an
     external cert, copy that in a similar manner.
    </p><div class="verbatim-wrap"><pre class="screen">cp example-internal-cert ~/openstack/my_cloud/config/tls/certs/
cp example-CA.crt ~/openstack/my_cloud/config/tls/cacerts/</pre></div></li><li class="step "><p>
     Log into the Cloud Lifecycle Manager node. Save and commit the changes to the local Git
     repository:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
git add -A
git commit -m "updated certificate and CA"</pre></div></li><li class="step "><p>
     Rerun the <code class="literal">config-processor-run</code> playbook, and run
     <code class="filename">ready-deployment.yml</code>:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     If you receive any prompts, enter the required information.
    </p><div id="id-1.5.9.7.12.2.5.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      For automated installation (for example, CI) you can specify the required
      passwords on the Ansible command line. For example, the command below
      will disable encryption by the configuration processor:
     </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="" -e rekey=""</pre></div></div></li><li class="step "><p>
     Run this series of runbooks to complete the deployment:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml
ansible-playbook -i hosts/verb_hosts FND-CLU-stop.yml
ansible-playbook -i hosts/verb_hosts FND-CLU-start.yml
ansible-playbook -i hosts/verb_hosts monasca-stop.yml
ansible-playbook -i hosts/verb_hosts monasca-start.yml
ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect2" id="idg-all-security-tls-config-xml-8"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.11 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring the Cipher Suite</span> <a title="Permalink" class="permalink" href="#idg-all-security-tls-config-xml-8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span>idg-all-security-tls-config-xml-8</li></ul></div></div></div></div><p>
   By default, the cipher suite is set to:
   <code class="literal">HIGH:!aNULL:!eNULL:!DES:!3DES</code>. This setting is
   recommended in the
   <a class="link" href="http://docs.openstack.org/security-guide/secure-communication/introduction-to-ssl-and-tls.html" target="_blank">OpenStack
   documentation</a>. You may override this by editing
   <code class="filename">config/haproxy/defaults.yml</code>. The parameters can be
   found under the <code class="literal">haproxy_globals</code> list.
  </p><div class="verbatim-wrap"><pre class="screen">- "ssl-default-bind-ciphers HIGH:!aNULL:!eNULL:!DES:!3DES"
- "ssl-default-server-ciphers HIGH:!aNULL:!eNULL:!DES:!3DES"</pre></div><p>
   Make the changes as needed. Keep the two options identical.
  </p></div><div class="sect2" id="id-1.5.9.7.14"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.12 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Testing</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.14">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   You can determine if an endpoint is behind TLS by running the following
   command, which probes a Keystone identity service endpoint that is behind
   TLS:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>echo | openssl s_client -connect 192.168.245.5:5000 | \
  openssl x509 -fingerprint -noout
depth=0 CN = openstack-vip
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 CN = openstack-vip
verify error:num=27:certificate not trusted
verify return:1
depth=0 CN = openstack-vip
verify error:num=21:unable to verify the first certificate
verify return:1
DONE
SHA1 Fingerprint=C6:46:1E:59:C6:11:BF:72:5E:DD:FC:FF:B0:66:A7:A2:CC:32:1C:B8</pre></div><p>
   The next command probes a MariaDB endpoint that is not behind TLS:
  </p><div class="verbatim-wrap"><pre class="screen">echo | openssl s_client -connect 192.168.245.5:3306 | openssl x509 -fingerprint -noout
140448358213264:error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol:s23_clnt.c:795:
unable to load certificate
140454148159120:error:0906D06C:PEM routines:PEM_read_bio:no start line:pem_lib.c:703:Expecting: TRUSTED CERTIFICATE</pre></div></div><div class="sect2" id="id-1.5.9.7.15"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.13 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Verifying That the Trust Chain is Correctly Deployed</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.15">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   You can determine if the trust chain is correctly deployed by running the
   following commands:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>echo | openssl s_client -connect 192.168.245.9:5000 2&gt;/dev/null \
  | grep code
Verify return code: 21 (unable to verify the first certificate)
<code class="prompt user">tux &gt; </code>echo | openssl s_client -connect 192.168.245.9:5000 -CAfile \
  /usr/local/share/ca-certificates/openstack_frontend_cacert.crt 2&gt;/dev/null \
  | grep code
Verify return code: 0 (ok)</pre></div><p>
   The first command produces error 21, which is then fixed by providing
   the CA certificate file. This verifies that the CA certificate matches the
   server certificate.
  </p></div><div class="sect2" id="id-1.5.9.7.16"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.2.14 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Turning TLS on or off</span> <a title="Permalink" class="permalink" href="#id-1.5.9.7.16">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_config.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_config.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   You should leave TLS enabled in production. However, if you need to disable
   it for any reason, you must change <code class="literal">tls-components</code> to
   <code class="literal">components</code> in <code class="filename">network_groups.yml</code> (as
   shown earlier) and comment out the cert-file. Additionally, if you have a
   <code class="filename">network_groups.yml</code> file from a previous installation,
   TLS will not be enabled unless you change <code class="literal">components</code> to
   <code class="literal">tls-components</code> in that file. By default, Horizon is
   configured with TLS in the input model. You should not disable TLS in the
   input model for Horizon as that is a public endpoint and is required.
   Additionally, you should keep all services behind TLS, but using the input
   model file <code class="filename">network_groups.yml</code> you may turn TLS off for
   a service for troubleshooting or debugging. TLS should always be enabled for
   production environments.
  </p><p>
   If you are using an example input model on a clean install, all supported
   TLS services will be enabled before deployment of your cloud. If you want to
   change this setting later, such as when upgrading, you can change the input
   model and reconfigure the system. The process is as follows:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the input model <code class="filename">network_groups.yml</code> file
     appropriately as described above, changing
     <code class="literal">tls-components</code> to <code class="literal">components</code>.
    </p></li><li class="step "><p>
     Commit the changes to the Git repository:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
git add -A
git commit -m "TLS change"</pre></div></li><li class="step "><p>
     Change directories again and run the configuration processor and ready
     deployment playbooks:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     Change directories again and run the reconfigure playbook:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div></li></ol></div></div></div></div><div class="sect1" id="TLS-MySQL"><div class="titlepage"><div><div><h2 class="title"><span class="number">7.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling TLS for MySQL Traffic</span> <a title="Permalink" class="permalink" href="#TLS-MySQL">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_mysql.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_mysql.xml</li><li><span class="ds-label">ID: </span>TLS-MySQL</li></ul></div></div></div></div><p>
  MySQL traffic can be encrypted using TLS. For completely new <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
  deployments using the supplied input model example files, you will have to
  uncomment the commented entries for
  <code class="literal">tls-component-endpoints:</code>. For upgrades from a previous
  version, you will have to add the entries to your input model files if you
  have not already done so. This topic explains how to do both.
 </p><div class="sect2" id="client"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling TLS on the database server for client access</span> <a title="Permalink" class="permalink" href="#client">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_mysql.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_mysql.xml</li><li><span class="ds-label">ID: </span>client</li></ul></div></div></div></div><div class="procedure " id="start"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit <code class="literal">network_groups.yml</code> to either add mysql under
     tls-component-endpoints in your existing file from a previous version, or
     uncomment it if installing from scratch.
    </p><div class="verbatim-wrap"><pre class="screen">tls-component-endpoints:
  - mysql</pre></div></li><li class="step " id="deployReconfig"><p>
     After making the necessary changes, commit the changed file to git and run
     the config-processor-run and reconfigure Ansible playbooks:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "My changed config"
cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="&lt;encryption key&gt;" -e rekey=""
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible</pre></div></li><li class="step "><p>
     Next, either run <code class="filename">site.yml</code> if you are installing a
     new system:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts site.yml</pre></div></li><li class="step "><p>
     or ardana-reconfigure if you are reconfiguring an existing one:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect2" id="id-1.5.9.8.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.3.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">MySQL replication over TLS</span> <a title="Permalink" class="permalink" href="#id-1.5.9.8.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_mysql.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_mysql.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   MySQL replication over TLS is disabled. This is true even if you followed
   the instruction to turn on Mysql TLS in the previous section. Those steps
   turn on the service interactions to the database.
  </p><p>
   <span class="bold"><strong>Turning on MySQL replication over TLS</strong></span>
  </p><div id="id-1.5.9.8.4.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Using TLS connections for MySQL replication will incur a performance cost.
   </p></div><p>
   You should have already enabled TLS for MySQL client interactions in the
   previous section. If not, read <a class="xref" href="#client" title="7.3.1. Enabling TLS on the database server for client access">Section 7.3.1, “Enabling TLS on the database server for client access”</a>.
  </p><p>
   TLS for MySQL replication is not turned on by default. Therefore, you will
   need to follow a manual process. Again, the steps are different for new
   systems and upgrades.
  </p></div><div class="sect2" id="replicationNew"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.3.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling TLS for MySQL replication on a new deployment</span> <a title="Permalink" class="permalink" href="#replicationNew">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_mysql.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_mysql.xml</li><li><span class="ds-label">ID: </span>replicationNew</li></ul></div></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Log in to the Cloud Lifecycle Manager node and before running the config
     processor, edit the
     <code class="literal">~/openstack/my_cloud/config/mariadb/defaults.yml</code> file.
    </p></li><li class="step "><p>
     Search for mysql_gcomms_bind_tls. You should find this section:
    </p><div class="verbatim-wrap"><pre class="screen"># TLS disabled for cluster
#mysql_gcomms_bind_tls: "{{ host.bind['FND_MDB'].mysql_gcomms.tls }}"
mysql_gcomms_bind_tls: False</pre></div></li><li class="step "><p>
     Uncomment the appropriate line so the file looks like this:
    </p><div class="verbatim-wrap"><pre class="screen"># TLS disabled for cluster
mysql_gcomms_bind_tls: "{{ host.bind['FND_MDB'].mysql_gcomms.tls }}"
#mysql_gcomms_bind_tls: False</pre></div></li><li class="step "><p>
     Follow the steps to deploy or reconfigure your cloud:
     <a class="xref" href="#deployReconfig" title="Step 2">Step 2</a> in <a class="xref" href="#client" title="7.3.1. Enabling TLS on the database server for client access">Section 7.3.1, “Enabling TLS on the database server for client access”</a>.
    </p></li></ol></div></div></div><div class="sect2" id="id-1.5.9.8.6"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.3.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling TLS for MySQL replication on an existing system</span> <a title="Permalink" class="permalink" href="#id-1.5.9.8.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_mysql.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_mysql.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   If your cluster is already up, perform these steps to enable MySQL
   replication over TLS:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the following two files:
     <code class="literal">~/openstack/my_cloud/config/mariadb/defaults.yml</code> and
     <code class="literal">~/scratch/ansible/next/ardana/ansible/roles/FND-MDB/defaults/main.yml</code>.
     Note that these files are identical. The first is a master file and the
     second is a scratch version that is used for the current deployment. Make
     the same changes as explained in <a class="xref" href="#replicationNew" title="7.3.3. Enabling TLS for MySQL replication on a new deployment">Section 7.3.3, “Enabling TLS for MySQL replication on a new deployment”</a>.
    </p></li><li class="step "><p>
     Then run the following command:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts tls-percona-reconfigure.yml</pre></div><p>
     After this your MySQL should come up and replicate over TLS. You need to
     follow this section again if you ever want to switch TLS off for MySQL
     replication. You also must repeat these steps if any lifecycle operation
     changes the mysql_gcomms_bind_tls option.
    </p></li></ol></div></div></div><div class="sect2" id="id-1.5.9.8.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.3.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Testing whether a service is using TLS</span> <a title="Permalink" class="permalink" href="#id-1.5.9.8.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_mysql.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_mysql.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Almost all services that have a database are able to communicate over TLS.
   You can test whether a service, in this example the Identity service
   (Keystone), is communicating with MySQL over TLS by executing the following
   steps:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Log into the Cloud Lifecycle Manager as root and run the mysql command.
    </p><div class="verbatim-wrap"><pre class="screen">root@&lt;server&gt;:~# mysql</pre></div><p>
     Type 'help;' or '\h' for help. Type '\c' to clear the current input
     statement.
    </p></li><li class="listitem "><p>
     Run:
    </p><div class="verbatim-wrap"><pre class="screen">mysql&gt; select * from information_schema.user_statistics where user='keystone'\G</pre></div></li><li class="listitem "><p>
     Note the results. TOTAL_SSL_CONNECTIONS should not be zero:
    </p><div class="verbatim-wrap"><pre class="screen">*************************** 1. row ***************************
                  USER: keystone
     TOTAL_CONNECTIONS: 316
CONCURRENT_CONNECTIONS: 0
        CONNECTED_TIME: 905790
             BUSY_TIME: 205
              CPU_TIME: 141
        BYTES_RECEIVED: 197137617
            BYTES_SENT: 801964
  BINLOG_BYTES_WRITTEN: 0
          ROWS_FETCHED: 972421
          ROWS_UPDATED: 6893
       TABLE_ROWS_READ: 1025866
       SELECT_COMMANDS: 660209
       UPDATE_COMMANDS: 3039
        OTHER_COMMANDS: 299746
   COMMIT_TRANSACTIONS: 0
 ROLLBACK_TRANSACTIONS: 295200
    DENIED_CONNECTIONS: 0
      LOST_CONNECTIONS: 83
         ACCESS_DENIED: 0
         EMPTY_QUERIES: 71778
 TOTAL_SSL_CONNECTIONS: 298
1 row in set (0.00 sec)

mysql&gt;</pre></div></li></ol></div></div></div><div class="sect1" id="TLS-RabbitMQ"><div class="titlepage"><div><div><h2 class="title"><span class="number">7.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling TLS for RabbitMQ Traffic</span> <a title="Permalink" class="permalink" href="#TLS-RabbitMQ">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_rabbit_mq.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_rabbit_mq.xml</li><li><span class="ds-label">ID: </span>TLS-RabbitMQ</li></ul></div></div></div></div><p>
  RabbitMQ traffic can be encrypted using TLS. To enable it, you will have to
  add entries for <code class="literal">tls-component-endpoints:</code> in your input
  model files if you have not already done so. This topic explains how.
 </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
    Edit <code class="literal">openstack/my_cloud/definition/data/network_groups.yml</code>,
    adding <code class="literal">rabbitmq</code> to the
    <code class="literal">tls-component-endpoints</code> section:
   </p><div class="verbatim-wrap"><pre class="screen">tls-component-endpoints:
     - barbican-api
     - mysql
     - rabbitmq</pre></div></li><li class="listitem "><p>
    Commit the changes:
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "My changed config"</pre></div></li><li class="listitem "><p>
    Then run the typical deployment steps:
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="&lt;encryption key&gt;" -e rekey=""
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
    Change directories:
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible</pre></div></li><li class="listitem "><p>
    Then for a fresh TLS install run:
   </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts site.yml</pre></div></li><li class="listitem "><p>
    Or, to reconfigure an existing system run:
   </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div></li></ol></div><div class="sect2" id="id-1.5.9.9.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.4.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Testing</span> <a title="Permalink" class="permalink" href="#id-1.5.9.9.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-tls_rabbit_mq.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-tls_rabbit_mq.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   On the one of the rabbitmq nodes you can list the clients and their TLS
   status by running:
  </p><div class="verbatim-wrap"><pre class="screen">$ sudo rabbitmqctl -q list_connections ssl state ssl_protocol user name</pre></div><p>
   You will see output like this where true indicates the client is using TLS
   for the connection, and false, as shown here, indicates the connection is
   over TCP:
  </p><div class="verbatim-wrap"><pre class="screen">Listing connections ...

rmq_barbican_user       false</pre></div><p>
   Other indicators will be <code class="literal">rabbit_use_ssl = True</code> in the
   Oslo messaging section of client configurations. The list of clients that
   support TLS are as follows:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Barbican
    </p></li><li class="listitem "><p>
     Ceilometer
    </p></li><li class="listitem "><p>
     Cinder
    </p></li><li class="listitem "><p>
     Designate
    </p></li><li class="listitem "><p>
     Eon
    </p></li><li class="listitem "><p>
     Glance
    </p></li><li class="listitem "><p>
     Heat
    </p></li><li class="listitem "><p>
     Ironic
    </p></li><li class="listitem "><p>
     Keystone
    </p></li><li class="listitem "><p>
     Monasca
    </p></li><li class="listitem "><p>
     Neutron
    </p></li><li class="listitem "><p>
     Nova
    </p></li><li class="listitem "><p>
     Octavia
    </p></li></ul></div></div></div><div class="sect1" id="troubleshootng-tls"><div class="titlepage"><div><div><h2 class="title"><span class="number">7.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Troubleshooting TLS</span> <a title="Permalink" class="permalink" href="#troubleshootng-tls">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-troubleshooting_tls.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-troubleshooting_tls.xml</li><li><span class="ds-label">ID: </span>troubleshootng-tls</li></ul></div></div></div></div><div class="sect2" id="id-1.5.9.10.2"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Troubleshooting TLS certificate errors when running playbooks with a limit</span> <a title="Permalink" class="permalink" href="#id-1.5.9.10.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-troubleshooting_tls.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-troubleshooting_tls.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Has the deployer been restarted after the original site installation or is
   this a new deployer? If so, TLS certificates need to be bootstrapped before
   a playbook is run with limits. You can do this by running the following
   command.
  </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml --limit TLS-CA</pre></div></div><div class="sect2" id="id-1.5.9.10.3"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Certificate Update Failure</span> <a title="Permalink" class="permalink" href="#id-1.5.9.10.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-troubleshooting_tls.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-troubleshooting_tls.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   In general, if a certificate update fails, it is because of the following:
   Haproxy has not restarted or the Trust chain is not installed. This is the
   certificate of the CA that signed the server certificate.
  </p></div><div class="sect2" id="id-1.5.9.10.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Troubleshooting trust chain installation</span> <a title="Permalink" class="permalink" href="#id-1.5.9.10.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-troubleshooting_tls.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-troubleshooting_tls.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   It is important to note that while <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span> allows you to add new
   trust chains, it would be better if you add all the required trust chains
   during the initial deploy. Trust chain changes can impact services.
  </p><p>
   However, this does not apply to certificates. There is a certificate-related
   issue whereby haproxy is not restarted if certificate content has been
   changed but the certificate file name remained the same. If you are having
   issues and you have replaced the content of existing CA file with new
   content, create another CA file with a new name. Also make sure the CA file
   has a .crt extension.
  </p><p>
   Do not update both certificate and the CA together. Add the CA first and
   then run a site deploy. Then update the certificate and run tls-reconfigure,
   FND-CLU-stop, FND-CLU-start and then ardana-reconfigure. If you know which
   playbook failed, rerun it with -vv to get detaled error information. The
   configure, HAproxy restart, and reconfigure steps are included in
   <a class="xref" href="#idg-all-security-tls-config-xml-1" title="7.2. TLS Configuration">Section 7.2, “TLS Configuration”</a>.
  </p><p>
   You can run the following commands to see if client libraries see the CA
   you have added:
  </p><div class="verbatim-wrap"><pre class="screen">~/scratch/ansible/next/ardana/ansible$ ansible -i hosts/verb_hosts FND-STN -a 'sudo keytool -list -alias \
    debian:username-internal-cacert-001.pem -keystore /usr/lib/jvm/java-7-openjdk-amd64/jre/lib/security/cacerts -storepass changeit'
  padawan-ccp-c0-m1-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-comp0001-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-comp0003-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-comp0002-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-c1-m1-mgmt | success | rc=0 &gt;&gt;
  debian:username-internal-cacert-001.pem, May 9, 2016, trustedCertEntry,
  Certificate fingerprint (SHA1): E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43

  padawan-ccp-c1-m2-mgmt | success | rc=0 &gt;&gt;
  debian:username-internal-cacert-001.pem, May 9, 2016, trustedCertEntry,
  Certificate fingerprint (SHA1): E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43

  padawan-ccp-c1-m3-mgmt | success | rc=0 &gt;&gt;
  debian:username-internal-cacert-001.pem, May 9, 2016, trustedCertEntry,
  Certificate fingerprint (SHA1): E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43</pre></div><p>
   Java client libraries are used by Monasca, so compute nodes will not have
   them. So the first three errors are expected. Check that the fingerprint is
   correct by checking the CA:
  </p><div class="verbatim-wrap"><pre class="screen">~/scratch/d002-certs/t002$ openssl x509 -in example-CA.crt -noout -fingerprint
  SHA1 Fingerprint=E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43</pre></div><p>
   If they do not match, there likely was a name collision. Add the CA cert again
   with a new file name. If you get Monasca errors but find that the
   fingerprints match, try stopping and restarting Monasca.
  </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts monasca-stop.yml
ansible-playbook -i hosts/verb_hosts monasca-start.yml</pre></div></div><div class="sect2" id="id-1.5.9.10.5"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.5.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Expired TLS Certificates</span> <a title="Permalink" class="permalink" href="#id-1.5.9.10.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-troubleshooting_tls.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-troubleshooting_tls.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Use the following steps to re-create expired TLS certificates for MySQL
   Percona clusters.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Regenerate the TLS certificates on the deployer.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/hos/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml --limit DEPLOYER_HOST</pre></div></li><li class="step "><p>
     Distribute the regenerated TLS certificates to the MySQL Percona clusters.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/hos/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts --extra-vars "mysql_certs_needs_regeneration=true" tls-percona-reconfigure.yml</pre></div></li><li class="step "><p>
     Verify Percona cluster status on a controller node
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>sudo mysql -e 'show status'</pre></div></li></ol></div></div><p>
   Use the following steps to re-create expired TLS certificates for RabbitMQ.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Determine if SSL certificate for RabbitMQ is expired
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root # </code>cd /etc/rabbitmq
<code class="prompt user">root # </code>openssl x509 -noout -text -in control-plane-1-rabbitmq.pem | grep After
Not After : Nov 6 15:15:38 2018 GMT</pre></div></li><li class="step "><p>
     Regenerate the TLS certificates on the deployer.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/hos/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml --limit DEPLOYER_HOST</pre></div></li><li class="step "><p>
     Reconfigure RabbitMQ. Certificate will be re-created if the input model is
     correct.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts --extra-vars "rabbitmq_tls_certs_force_regeneration=true" rabbitmq-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect2" id="id-1.5.9.10.6"><div class="titlepage"><div><div><h3 class="title"><span class="number">7.5.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Troubleshooting certificates</span> <a title="Permalink" class="permalink" href="#id-1.5.9.10.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-troubleshooting_tls.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-troubleshooting_tls.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Certificates can fail in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span> due to the following.
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Trust chain issue. This is dealt with in the previous section
    </p></li><li class="listitem "><p>
     Wrong certificate: Compare the fingerprints. If they differ, then you have
     a wrong certificate somewhere.
    </p></li><li class="listitem "><p>
     Date range of the certificate is either in the future or expired: Check
     the dates and change certificates as necessary, observing the naming
     cautions above.
    </p></li><li class="listitem "><p>
     TLS handshake fails because the client does not support the ciphers the
     server offers. It is possible that you reused a certificate created for a
     different network model. Make sure the request file found under
     <code class="filename">info/cert_req/</code> are used to create the certificate.
     If not, the service VIP
     names may not match.
    </p></li></ul></div></div></div></div><div class="chapter " id="header-poisoning"><div class="titlepage"><div><div><h1 class="title"><span class="number">8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Preventing Host Header Poisoning</span> <a title="Permalink" class="permalink" href="#header-poisoning">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-header_poisoning.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-header_poisoning.xml</li><li><span class="ds-label">ID: </span>header-poisoning</li></ul></div></div></div></div><div class="line"></div><p>
  Depending on the environment and context of your <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> deployment, it may
  be advisable to configure Horizon to protect against Host header poisoning
  (see ref. #1 below) by using Django's ALLOWED_HOSTS setting (see ref. #2
  below). To configure Horizon to use the ALLOWED_HOSTS setting, take the
  following steps:
 </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
    Edit the haproxy settings to reconfigure the health check for Horizon to
    specify the allowed hostname(s). This needs to be done first, before
    configuring Horizon itself. Otherwise, if Horizon is first configured to
    restrict the values of the "Host" header on incoming HTTP requests, the
    haproxy health checks will start to fail. So, the haproxy configuration
    needs to be updated first, if this is being done on an existing
    installation.
   </p><div class="orderedlist "><ol class="orderedlist" type="a"><li class="listitem "><p>
      On your Cloud Lifecycle Manager node, make a backup copy of this file and then open
      <span class="bold"><strong>/usr/share/ardana/input-model/2.0/services/horizon.yml</strong></span>
     </p></li><li class="listitem "><p>
      Find the line that contains "option httpchk" and modify it so it reads
      the following way:
     </p><div class="verbatim-wrap"><pre class="screen">- "option httpchk GET / HTTP/1.1\r\nHOST:\ my.example.com"
# Note the escaped escape characters.</pre></div><p>
      In this example, my.example.com is the hostname associated with the
      Horizon VIP on the external API network. However, you are not restricted
      to just one allowed host. In addition, allowed hosts can contain
      wildcards (though not in the horizon.yml file; there you must have an
      actual resolvable hostname or a routeable IP address). However, for this
      change to the haproxy healthcheck, it is suggested that the hostname
      associated with the Horizon VIP on the external API network be used.
     </p></li></ol></div></li><li class="listitem "><p>
    Edit the template file that will be use for Horizon's local_settings.py
    configuration file
   </p><div class="orderedlist "><ol class="orderedlist" type="a"><li class="listitem "><p>
      While still on your Cloud Lifecycle Manager node, open
      <code class="filename">~/openstack/my_cloud/config/horizon/local_settings.py</code>.
     </p></li><li class="listitem "><p>
      Change the line that sets the "ALLOWED_HOSTS" setting. This can be a list
      of hostnames and (V)IPs that eventually get routed to Horizon. Wildcards
      are supported.
     </p><div class="verbatim-wrap"><pre class="screen">ALLOWED_HOSTS = ['my.example.com', '*.example.net', '192.168.245.6']</pre></div><p>
      In the above example, any HTTP request received with a hostname not
      matching any in this list will receive an HTTP 400 reply.
     </p></li><li class="listitem "><p>
      Commit the change with a "git commit -a" command.
     </p></li></ol></div></li><li class="listitem "><p>
    Run the configuration processor
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem "><p>
    Enable the configuration: This can be done in one of a few ways: As part of
    a site deploy play as part of an upgrade play or by re-running the FND-CLU
    and Horizon deploys on an existing deployment: If modifying an existing
    deploy, the FND-CLU deploy will need to be run first, since changing the
    ALLOWED_HOSTS setting in Horizon first will cause the default health check
    to fail, if it does not specify a <code class="literal">Host</code> header in the
    HTTP request sent to
    check the health of Horizon's Apache virtual host.
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts horizon-deploy.yml
ansible-playbook -i hosts/verb_hosts FND-CLU-deploy.yml</pre></div></li></ol></div><p>
  References:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    <a class="link" href="https://www.djangoproject.com/weblog/2013/feb/19/security/#s-issue-host-header-poisoning" target="_blank">https://www.djangoproject.com/weblog/2013/feb/19/security/#s-issue-host-header-poisoning</a>
   </p></li><li class="listitem "><p>
    <a class="link" href="https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts" target="_blank">https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts</a>
   </p></li></ul></div></div><div class="chapter " id="password-encryption"><div class="titlepage"><div><div><h1 class="title"><span class="number">9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Encryption of Passwords and Sensitive Data</span> <a title="Permalink" class="permalink" href="#password-encryption">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-encrypted_storage.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-encrypted_storage.xml</li><li><span class="ds-label">ID: </span>password-encryption</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#id-1.5.11.4"><span class="number">9.1 </span><span class="name">SSH Introduction</span></a></span></dt><dt><span class="section"><a href="#protection"><span class="number">9.2 </span><span class="name">Protecting sensitive data on the Cloud Lifecycle Manager</span></a></span></dt><dt><span class="section"><a href="#id-1.5.11.6"><span class="number">9.3 </span><span class="name">Interacting with Encrypted Files</span></a></span></dt></dl></div></div><p>
  In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, sensitive connection data is encrypted. The passwords
  that are encrypted include:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    Inter-service passwords generated by the configuration processor (Keystone,
    MariaDB, RabbitMQ and Cassandra passwords)
   </p></li><li class="listitem "><p>
    Secret keys generated by the configuration processor (MariaDB cluster-id,
    erlang cookie for RabbitMQ, Horizon secret key, Keystone admin token)
   </p></li><li class="listitem "><p>
    User-supplied passwords (IPMI passwords, Block Storage back-end passwords)
   </p></li></ul></div><div class="sect1" id="id-1.5.11.4"><div class="titlepage"><div><div><h2 class="title"><span class="number">9.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">SSH Introduction</span> <a title="Permalink" class="permalink" href="#id-1.5.11.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-encrypted_storage.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-encrypted_storage.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><thead><tr><th>What is encrypted</th><th>Encryption mechanism</th><th>Is password changeable</th><th>Is encryption key changeable</th></tr></thead><tbody><tr><td>
       <p>
        Inter-service passwords and secret keys generated by the configuration
        processor (Keystone, MariaDB, RabbitMQ and Cassandra passwords)
       </p>
      </td><td>Uses PyCrypto libraries &amp; Ansible vault for encryption</td><td>No</td><td>
       <p>
        Yes
       </p>
       <p>
        Passphrase for the encryption key will be prompted when running Ansible
        playbook. Can also use command
        <code class="command">ask-ansible-pass</code>
       </p>
      </td></tr><tr><td>
       <p>
        User supplied passwords (IPMI passwords, Block Storage back-end
        passwords)
       </p>
      </td><td>OpenSSL</td><td>Yes</td><td>
       <p>
        Yes
       </p>
       <p>
        The environment variable ARDANA_USER_PASSWORD_ENCRYPT_KEY must contain the
        key used to encrypt those passwords.
       </p>
      </td></tr></tbody></table></div><p>
   Other protected data:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The SSH private key used by Ansible to connect to client nodes from the
     Cloud Lifecycle Manager is protected with a passphrase.
    </p></li><li class="listitem "><p>
     The Swift swift-hash prefix and suffix values are encrypted.
    </p></li><li class="listitem "><p>
     All of the Ansible variables generated by the configuration processor are
     encrypted and held in Ansible Vault.
    </p></li></ul></div><p>
   However, if a user wants to change the encryption keys then that can be done
   for all categories of password and secret-keys listed below, and the
   processes are documented.
  </p><p>
   The SSH private key passphrase needs to be entered once before any Ansible
   plays are run against the cloud.
  </p><p>
   The configuration processor encryption key will be prompted for when the
   relevant Ansible play is run. Once the configuration processor output has
   been encrypted, all subsequent Ansible plays need to have --ask-ansible-pass
   added to the command line to ensure that the encryption key which is needed
   by Ansible is prompted for.
  </p><p>
   Finally, if user-supplied passwords have been encrypted (this process uses
   the OpenSSL library) then the environment variable
   ARDANA_USER_PASSWORD_ENCRYPT_KEY must contain the key used to encrypt those
   passwords.
  </p><p>
   In the case where the ARDANA_USER_PASSWORD_ENCRYPT_KEY environment variable is
   either null, the empty string, or not defined, then no encryption will be
   performed on your passwords when using the ardanaencrypt.py script.
  </p><p>
   The generated passwords are stored in Ansible inputs generated by the
   configuration processor and also in the persistent state information
   maintained by the configuration processor.
  </p></div><div class="sect1" id="protection"><div class="titlepage"><div><div><h2 class="title"><span class="number">9.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Protecting sensitive data on the Cloud Lifecycle Manager</span> <a title="Permalink" class="permalink" href="#protection">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-encrypted_storage.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-encrypted_storage.xml</li><li><span class="ds-label">ID: </span>protection</li></ul></div></div></div></div><p>
   There are a number of mechanisms that can be used to protect sensitive data
   such as passwords, some Ansible inputs, and the SSH key used by Ansible on
   the Cloud Lifecycle Manager. See the installation documents for details. Please
   remember the need to guard against exposure of your environment variables,
   which may happen through observation over the shoulder.
  </p><p>
   There are instructions included in the installation documents that show how
   to encrypt your data using the <code class="literal">ardanaencrypt.py</code> script. You
   may want to change the encryption keys used to protect your sensitive data
   in the future and this shows you how:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <span class="bold"><strong>SSH keys</strong></span> - Run the command below to
     change the passphrase used to protect the key:
    </p><div class="verbatim-wrap"><pre class="screen">ssh-keygen -f id_rsa -p</pre></div></li><li class="listitem "><p>
     <span class="bold"><strong>configuration processor Key</strong></span> - If you wish
     to change an encryption password that you have already used when running
     the configuration processor then enter the existing password at the first
     prompt and the new password at the second prompt when running the
     configuration processor playbook. See <span class="intraxref">Book “<em class="citetitle ">Installing with Cloud Lifecycle Manager</em>”, Chapter 12 “Installing Mid-scale and Entry-scale KVM”</span> for
     more details.
    </p></li><li class="listitem "><p>
     <span class="bold"><strong>IPMI passwords if encrypted with
     <code class="literal">ardanaencrypt.py</code></strong></span> - Rerun the utility specifying
     a new encryption key when prompted. You will need to enter the plain text
     passwords at the password prompt.
    </p></li></ul></div></div><div class="sect1" id="id-1.5.11.6"><div class="titlepage"><div><div><h2 class="title"><span class="number">9.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Interacting with Encrypted Files</span> <a title="Permalink" class="permalink" href="#id-1.5.11.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-encrypted_storage.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-encrypted_storage.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Once you have enabled encryption in your environment you may have a need to
   interact with these encrypted files at a later time. This section will show
   you how.
  </p><p>
   <span class="bold"><strong>ardanaencrypt.py script password encryption</strong></span>
  </p><p>
   If you used the <code class="literal">ardanaencrypt.py</code> script to encrypt your IPMI
   or other passwords and have a need to view them later, you can do so with
   these steps.
  </p><p>
   You will want to ensure that the
   <code class="literal">ARDANA_USER_PASSWORD_ENCRYPT_KEY</code> environment variable is set
   prior to running these commands:
  </p><div class="verbatim-wrap"><pre class="screen">export ARDANA_USER_PASSWORD_ENCRYPT_KEY="&lt;encryption_key&gt;"</pre></div><p>
   To view an encrypted password, you can use this command below which will
   promot you for the encrypted password value. It will then output the
   decrypted value:
  </p><div class="verbatim-wrap"><pre class="screen">./ardanaencrypt.py -d</pre></div><p>
   <span class="bold"><strong>Configuration processor encryption key</strong></span>
  </p><p>
   If you have used the encryption options available with the configuration
   processor, which uses Ansible vault, you can do so with these commands. Each
   of these commands will prompt you for the password you used when setting the
   encryption initially.
  </p><p>
   To view an encrypted file in read-only mode, use this command:
  </p><div class="verbatim-wrap"><pre class="screen">ansible-vault view &lt;filename&gt;</pre></div><p>
   To edit an encrypted file, use this command. This allows you to edit a
   decrypted version of the file without the need to decrypt and re-encrypt it:
  </p><div class="verbatim-wrap"><pre class="screen">ansible-vault edit &lt;filename&gt;</pre></div><p>
   For other available commands, use the help file:
  </p><div class="verbatim-wrap"><pre class="screen">ansible-vault -h</pre></div></div></div><div class="chapter " id="encryption-ephemeral"><div class="titlepage"><div><div><h1 class="title"><span class="number">10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Encryption of Ephemeral Volumes</span> <a title="Permalink" class="permalink" href="#encryption-ephemeral">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-encrypted_ephvol.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-encrypted_ephvol.xml</li><li><span class="ds-label">ID: </span>encryption-ephemeral</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#id-1.5.12.4"><span class="number">10.1 </span><span class="name">Enabling ephemeral volume encryption</span></a></span></dt></dl></div></div><p>
  By default, ephemeral volumes are not encrypted. If you wish to enable this
  feature, you should use the following steps.
 </p><div id="id-1.5.12.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
   For more details about this feature, see
   <a class="link" href="http://specs.openstack.org/openstack/nova-specs/specs/juno/approved/lvm-ephemeral-storage-encryption.html" target="_blank">Ephemeral
   storage encryption for LVM backend</a>.
  </p></div><div class="sect1" id="id-1.5.12.4"><div class="titlepage"><div><div><h2 class="title"><span class="number">10.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling ephemeral volume encryption</span> <a title="Permalink" class="permalink" href="#id-1.5.12.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-encrypted_ephvol.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-encrypted_ephvol.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Before deploying the Compute nodes you will need to change the disk
   configuration to create a new <code class="literal">volume-group</code> which will be
   used for your ephemeral disks. To do this, following these steps:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Log in to the Cloud Lifecycle Manager.
    </p></li><li class="listitem "><p>
     Add details about the volume-group you will be using for your encrypted
     volumes. You have two options for this, you can either create a new
     volume-group or add the details for an already existing volume-group.
    </p><div class="orderedlist "><ol class="orderedlist" type="a"><li class="listitem "><p>
       To create a new volume-group, add the following lines to your Compute
       disk configuration file.
      </p><p>
       The location of the Compute disk configuration file is:
      </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/definition/data/disks_compute.yml</pre></div><div class="verbatim-wrap"><pre class="screen">name: vg-comp
       physical-volumes:
         - /dev/sdb</pre></div></li><li class="listitem "><p>
       To utilize an existing volume-group you can add the following lines to
       your <code class="literal">nova.conf</code> file, using the name of your
       volume-group:
      </p><div class="verbatim-wrap"><pre class="screen">[libvirt]
images_type = lvm
images_volume_group = &lt;volume_group_name&gt;</pre></div></li></ol></div><div id="id-1.5.12.4.3.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      The requirement here is to have free space available on a
      <code class="literal">volume-group</code>. The correct disk to use and the name for
      the volume group will depend on your environment's needs.
     </p></div></li><li class="listitem "><p>
     Modify the <code class="literal">nova.conf</code> file for the Compute and API
     nodes. Verify that the following entries exist, if they do not then add
     them and then restart the <code class="literal">nova-compute</code> and
     <code class="literal">nova-api</code> services:
    </p><div class="verbatim-wrap"><pre class="screen">[libvirt]
images_type = lvm
images_volume_group = vg-comp

[ephemeral_storage_encryption]
key_size = 256
cipher = aes-xts-plain64
enabled = True

[keymgr]
api_class = nova.keymgr.barbican.BarbicanKeyManager

[barbican]
endpoint_template = https://192.168.245.9:9311/v1</pre></div><p>
     To restart the services, use the following commands:
    </p><div class="verbatim-wrap"><pre class="screen">sudo systemctl restart nova-compute
sudo systemctl restart nova-api</pre></div></li><li class="listitem "><p>
     Assign the role in Keystone using the CLI tool. Using the openstack client
     you can assign the user <code class="literal">key-manager:creator</code> role for
     the project.
    </p></li><li class="listitem "><p>
     Boot an instance with an ephermal disk and verify that the disk is
     encrypted. Once the instance is active it is possible to check on the
     Compute node if the ephermal disk is encrypted.
    </p><p>
     SSH into the Compute node then run the following commands:
    </p><div class="verbatim-wrap"><pre class="screen">sudo dmsetup status
cryptsetup -v status &lt;name_of_ephemeral_disk&gt;</pre></div></li></ol></div></div></div><div class="chapter " id="topic-rmq-j1v-4t"><div class="titlepage"><div><div><h1 class="title"><span class="number">11 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Refining Access Control with AppArmor</span> <a title="Permalink" class="permalink" href="#topic-rmq-j1v-4t">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-using_apparmor.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-using_apparmor.xml</li><li><span class="ds-label">ID: </span>topic-rmq-j1v-4t</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#apparmor-openstack"><span class="number">11.1 </span><span class="name">AppArmor in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span></span></a></span></dt></dl></div></div><p>
  AppArmor is a Mandatory Access Control (MAC) system as opposed to a
  discretionary access control system. It is a kernel-level security module for
  Linux that controls access to low-level resources based on rights granted via
  policies to a program rather than to a user role. It enforces rules at the
  lowest software layer (the kernel level) preventing software from
  circumventing resource restrictions that reside at levels above the kernel.
  With AppArmor, the final gatekeeper is closest to the hardware.
 </p><p>
  Controlling resource access per application versus per user role allows you
  to enforce rules based on specifically what a program can do versus trying to
  create user roles that are broad enough yet specific enough to apply to a
  group of users. In addition, it prevents the trap of having to predict all
  possible vulnerabilities in order to be secure.
 </p><p>
  AppArmor uses a hybrid of whitelisting and blacklisting rules, and its
  security policies are/can be cascading, permitting inheritance from different
  or more general policies. Policies are enforced on a per-process basis.
 </p><p>
  AppArmor also lets you tie a process to a CPU core if you want, and set
  process priority.
 </p><p>
  AppArmor profiles are loaded into the kernel, typically on boot. They can run
  in either enforcement or complain modes. In enforcement mode, the policy is
  enforced and policy violation attempts are reported. In complain mode, policy
  violation attempts are reported but not prevented.
 </p><div class="sect1" id="apparmor-openstack"><div class="titlepage"><div><div><h2 class="title"><span class="number">11.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">AppArmor in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span></span> <a title="Permalink" class="permalink" href="#apparmor-openstack">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-using_apparmor.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-using_apparmor.xml</li><li><span class="ds-label">ID: </span>apparmor-openstack</li></ul></div></div></div></div><p>
   At this time, AppArmor is not enabled by default in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>.
   However, we recommend enabling it for key virtualization processes on
   compute nodes. For more information, see the
   <a class="link" href="https://documentation.suse.com/sles/12-SP5/single-html/SLES-security/#part-apparmor" target="_blank">https://documentation.suse.com/sles/12-SP5/single-html/SLES-security/#part-apparmor</a>.
  </p></div></div><div class="chapter " id="dar"><div class="titlepage"><div><div><h1 class="title"><span class="number">12 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Data at Rest Encryption</span> <a title="Permalink" class="permalink" href="#dar">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-dar.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-dar.xml</li><li><span class="ds-label">ID: </span>dar</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#configure-KMIP-ESKM"><span class="number">12.1 </span><span class="name">Configuring KMIP and ESKM</span></a></span></dt><dt><span class="section"><a href="#id-1.5.14.9"><span class="number">12.2 </span><span class="name">Configuring Cinder volumes for encryption</span></a></span></dt><dt><span class="section"><a href="#id-1.5.14.10"><span class="number">12.3 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><p>
  The data at rest encryption features in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span> include the Barbican
  key management service for safely storing encryption keys, and Cinder volume
  encryption. This topic explains how to configure a back end for Barbican key
  storage, and how to configure Cinder volumes to be encrypted.
 </p><p>
  The Barbican service in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span> supports two types of back ends for
  safely storing encryption keys:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    A native database back end
   </p></li><li class="listitem "><p>
    An HSM device (KMIP + Micro Focus ESKM)
   </p></li></ul></div><p>
  <span class="bold"><strong>Configuring the key management back-end key
  store</strong></span>
 </p><p>
  Using the Cloud Lifecycle Manager reconfigure playbook, you can configure one of two back ends
  for the Barbican key management service:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    Native database: This is the default configuration in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>.
   </p></li><li class="listitem "><p>
    KMIP + Atalla ESKM: For a KMIP device, an SSL client certificate is needed
    as HSM devices generally require two-way SSL for security reasons. You will
    need a client certificate, a client private key and client root certificate
    authority recognized by your HSM device.
   </p></li></ul></div><div class="sect1" id="configure-KMIP-ESKM"><div class="titlepage"><div><div><h2 class="title"><span class="number">12.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring KMIP and ESKM</span> <a title="Permalink" class="permalink" href="#configure-KMIP-ESKM">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-dar.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-dar.xml</li><li><span class="ds-label">ID: </span>configure-KMIP-ESKM</li></ul></div></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     To configure KMIP + Atalla ESKM in place of the default database, begin by
     providing certificate information by modifying the sample configuration
     file, <code class="literal">barbican_kmip_plugin_config_sample.yml</code>, on the
     Cloud Lifecycle Manager node:
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/ardana/ansible/roles/KEYMGR-API/files/samples/barbican_kmip_plugin_config_sample.yml</pre></div></li><li class="listitem "><p>
     Copy this file to a temporary directory such as /tmp.
    </p></li><li class="listitem "><p>
     Edit the file to provide either client certificates as absolute file paths
     as shown below in bold, or by pasting certificate and key content directly
     into the file.
    </p><div id="id-1.5.14.8.2.3.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      File paths take precedence over content variables if both are provided.
     </p></div></li><li class="listitem "><p>
     To set file path variables, open <code class="literal">kmip_plugin_certs.yml
     </code>for editing and setting the paths to the cert files:
    </p><div class="verbatim-wrap"><pre class="screen">vi /tmp/kmip_plugin_certs.yml
  # File paths takes precedence over cert content if both are provided.
  # Here file path refers to local filesystem path where ansible is
  # executed.
  <span class="bold"><strong>client_cert_file_path: /path/to/cert/file </strong></span>
  <span class="bold"><strong>client_key_file_path: /path/to/key/file</strong></span>
  <span class="bold"><strong>client_cacert_file_path: /path/to/cacert/file</strong></span></pre></div></li><li class="listitem "><p>
     Alternatively, set the content variables by opening
     <code class="literal">/tmp/kmip_plugin_certs.yml</code> and copy the certificates
     and keys directly into the file.
    </p><div class="verbatim-wrap"><pre class="screen">vi /tmp/kmip_plugin_certs.yml
  # Following are samples you need to replace with your
  # own content here or via file path approach mentioned above.
  client_cert_content: |
      -----BEGIN CERTIFICATE-----
      MIID0jCCArqgAwIBAgICAKQwDQYJKoZIhvcNAQELBQAwgZQxCzAJBgNVBAYTAlVT
      MQswCQYDVQQIEwJDTzEUMBIGA1UEBxMLRnQuIENvbGxpbnMxGDAWBgNVBAoTD0hl
      ...
      d2xldHQgUGFja2FyZDEMMAoGA1UECxMDQ1RMMRYwFAYDVQQDFA1LTUlQX0xvY2Fs
      L7x0qB6Zaf3IBkOZqf5bMfAQoKfxww==
      -----END CERTIFICATE-----
  client_key_content: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEowIBAAKCAQEArjYVZzdsSMsk520UD1E94jl0/AZGLlsAB152dEP5E9C3mXzQ
      ZYvfApMh8PFc53gZwLBCb4joy1r8mZj/e7CwCUuo1cJHR9xnhwdK3RLeRbU3dfW8
      ...
      98DmYxBio8+wQWQdiAPRRthtnvhSWL67oYACPwvWUJJ+D18HfpWCEgCmBU3a8ZHc
      AaW8rRXtMZzuujGgAbA1hpf5z1lHuiG/X7/XMDVGiRALMyBbHV57
      -----END RSA PRIVATE KEY-----
  client_cacert_content: |
      -----BEGIN CERTIFICATE-----
      MIIEmjCCA4KgAwIBAgIBADANBgkqhkiG9w0BAQsFADCBlDELMAkGA1UEBhMCVVMx
      CzAJBgNVBAgTAkNPMRQwEgYDVQQHEwtGdC4gQ29sbGluczEYMBYGA1UEChMPSGV3
      ...
      FAimEB/a2E+A0oxwuHmhMg0kOpDuXIWn4BW+Z6z5h1j3PFyg/CZ548Fz0XOgvXC7
      Ejpkd+5R+24HloruUV1R2EYvmlr8UMFX80og11u+
      -----END CERTIFICATE-----</pre></div></li><li class="listitem "><p>
     Provide certificate information to the Barbican service using the
     <code class="literal">barbican-reconfigure.yml</code> playbook:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml -e@/tmp/kmip_plugin_certs.yml</pre></div></li><li class="listitem "><p>
     Provide HSM connection credentials for the Barbican service. In this step,
     provide the KMIP plug-in connection details to the Barbican service: Open
     the file <code class="literal">barbican_deploy_config.yml</code> found here:
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/ardana/ansible/roles/barbican-common/vars/barbican_deploy_config.yml</pre></div></li><li class="listitem "><p>
     Set the value of <code class="literal">use_kmip_secretstore_plugin</code> to
     <code class="literal">True</code> to use the KMIP plug-in or
     <code class="literal">False</code> to use the default secret store plugin
     (store_crypto).
    </p></li><li class="listitem "><p>
     Next, add KMIP client connection credentials and KMIP server hostname and
     port to <code class="literal">barbican_deploy_config.yml</code>:
    </p><div class="verbatim-wrap"><pre class="screen">#######################################################################
#################### KMIP Plugin Configuration Section ################
#######################################################################
# Flag to reflect  whether KMIP plugin is to be used as back end for
#storing secrets
use_kmip_secretstore_plugin: True
# Note: Connection username needs to match with 'Common Name' provided
# in client cert request (CSR).
barbican_kmip_username: userName barbican_kmip_password: password
barbican_kmip_port: 1234 barbican_kmip_host: 111.222.333.444</pre></div></li><li class="listitem "><p>
     Commit the changes to git:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
git add -A
git commit -m "My config"</pre></div><p>
     and run the <code class="literal">barbican-reconfigure.yml</code> playbook in the
     deployment area:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</pre></div></li></ol></div></div><div class="sect1" id="id-1.5.14.9"><div class="titlepage"><div><div><h2 class="title"><span class="number">12.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring Cinder volumes for encryption</span> <a title="Permalink" class="permalink" href="#id-1.5.14.9">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-dar.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-dar.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The data-at-rest encryption model in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> provides support for
   encrypting Cinder volumes (Volume Encryption). These encrypted volumes are
   protected with an encryption key that can be stored in an HSM appliance.
  </p><p>
   Assuming Barbican and Cinder services have been installed, you can configure
   a Cinder volume type for encryption. Doing so will create a new Cinder
   volume type, "LUKS," that can be selected when creating a new volume. Such
   volumes will be encrypted using a 256bit AES key:
  </p><div class="verbatim-wrap"><pre class="screen">source  ~/service.osrc
openstack role add --user admin --project admin cinder_admin
cinder type-­create LUKS
cinder encryption-type-create \
  --cipher aes-xts-plain64 --key_size 256 --control_location \
  front-end LUKS nova.volume.encryptors.luks.LuksEncryptor

+--------------------------------------+-------------------------------------------+-----------------+----------+------------------+
|            Volume Type ID            |                  Provider                 |      Cipher     | Key Size | Control Location |
+--------------------------------------+-------------------------------------------+-----------------+----------+------------------+
| 99ed804b-7ed9-41a5-9c5e-e2002e9f9bb4 | nova.volume.encryptors.luks.LuksEncryptor | aes-xts-plain64 |   256    |    front-end     |
+--------------------------------------+-------------------------------------------+-----------------+----------+------------------+</pre></div><p>
   You should now be able to create a new volume with the type LUKS, which will
   request a new key from Barbican. Once created, you can attach the new volume
   to an instance:
  </p><div class="verbatim-wrap"><pre class="screen"> cinder create --display-name testVolumeEncrypted --volume-type LUKS --availability-zone nova 1</pre></div><p>
   The volume list (<code class="literal">cinder show </code>with the volume ID) should
   now show that you have a new volume and that it is encrypted.
  </p><div class="verbatim-wrap"><pre class="screen">cinder show 2ebf610b-98bf-4914-aee1-9b866d7b1897
    +---------------------------------------+--------------------------------------+
    |                Property               |                Value                 |
    +---------------------------------------+--------------------------------------+
    |              attachments              |                  []                  |
    |           availability_zone           |                 nova                 |
    |                bootable               |                false                 |
    |          consistencygroup_id          |                 None                 |
    |               created_at              |      2016-03-04T00:17:45.000000      |
    |              description              |                 None                 |
    |               encrypted               |                 True                 |
    |                   id                  | 2ebf610b-98bf-4914-aee1-9b866d7b1897 |
    |                metadata               |                  {}                  |
    |            migration_status           |                 None                 |
    |              multiattach              |                False                 |
    |                  name                 |         testVolumeEncrypted          |
    |         os-vol-host-attr:host         |  ha-volume-manager@lvm-1#LVM_iSCSI   |
    |     os-vol-mig-status-attr:migstat    |                 None                 |
    |     os-vol-mig-status-attr:name_id    |                 None                 |
    |      os-vol-tenant-attr:tenant_id     |   5f3b093c603f4dc8bc377d04e5385d42   |
    |   os-volume-replication:driver_data   |                 None                 |
    | os-volume-replication:extended_status |                 None                 |
    |           replication_status          |               disabled               |
    |                  size                 |                  1                   |
    |              snapshot_id              |                 None                 |
    |              source_volid             |                 None                 |
    |                 status                |              available               |
    |                user_id                |   3bdde5491e174a8aafcbc5a88e01cac7   |
    |              volume_type              |                 LUKS                 |
    +---------------------------------------+--------------------------------------+</pre></div><p>
   When using an ESKM appliance as the back end, you can also confirm that key
   operations are going to your HSM via its admin portal.
  </p><div class="verbatim-wrap"><pre class="screen">UUID                                    Owner             Object Type      State       Creation Date
8d54f41d-91dd-4f5e-bcfe-964af8213a8c        barbican     SymmetricKey     PreActive   2016-03-02 13:58:58</pre></div></div><div class="sect1" id="id-1.5.14.10"><div class="titlepage"><div><div><h2 class="title"><span class="number">12.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">For More Information</span> <a title="Permalink" class="permalink" href="#id-1.5.14.10">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-dar.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-dar.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   For more information on data at rest security with ESKM, see
   <a class="link" href="http://files.asset.microfocus.com/4aa6-5241/en/4aa6-5241.pdf" target="_blank">Data
   Security Protection for <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></a>.
  </p></div></div><div class="chapter " id="glance-rate-limit"><div class="titlepage"><div><div><h1 class="title"><span class="number">13 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Glance-API Rate Limit (CVE-2016-8611)</span> <a title="Permalink" class="permalink" href="#glance-rate-limit">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-glance-rate-limit.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-glance-rate-limit.xml</li><li><span class="ds-label">ID: </span>glance-rate-limit</li></ul></div></div></div></div><div class="line"></div><p>
  Within the Glance service, calls to the POST method within v1 or v2/images
  creates records in <code class="literal">queued</code> status. No limit is enforced
  within the Glance API on the number of images a single tenant may
  create. The only limit is on the total amount of storage a single user may
  consume. More information about this vulnerability is at <a class="link" href="https://nvd.nist.gov/vuln/detail/CVE-2016-8611" target="_blank">https://nvd.nist.gov/vuln/detail/CVE-2016-8611</a>
 </p><p>
  Therefore a user could maliciously or unintentionally fill multiple database
  tables (images, image_properties, image_tags, image_members) with useless
  image records, thereby causing a denial of service by lengthening transaction
  response times in the Glance database.
 </p><p>
  This issue can be mitigated with a rate limiter to the glance-api haproxy
  endpoints. Only POST requests are affected. Instance launch is not impacted.
  The number of images that can be created in a 60 minute window is limited.
  The default value is 600 connections per 60 minute window which should cover
  most normal glance-api use cases. When the number of connections has been
  exceeded, the user is locked out for the duration of the 60 minute
  interval. The value for the number of connections per 60 minute period can be
  overridden by editing the <code class="filename">control_plane.yml</code> file.
 </p><p>
  The following steps will implement the rate limiter patch.
 </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
    Edit <code class="filename">control_plane.yml</code>, adding the following glance_rate_limit
    entry. Change the <code class="literal">glance_rate_limit</code> if the default 600 connections does not
    fit your situation.
   </p><div class="verbatim-wrap"><pre class="screen">- glance-api:
    ha_mode: false
    glance_stores: 'file'
    glance_default_store: 'file'
    glance_rate_limit: <em class="replaceable ">LIMIT</em></pre></div></li><li class="step "><p>
    Commit the change to Git
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git add -A
git commit "Change glance rate limit"</pre></div></li><li class="step "><p>
    Run playbooks
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml
<code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost FND-CLU-reconfigure.yml</pre></div></li></ol></div></div><p>
  Access attempts are logged in
  <code class="filename">/var/log/haproxy.log</code>. Users who exceed the limit will
  see a message such as:
 </p><div class="verbatim-wrap"><pre class="screen">429 Too Many Requests
You have sent too many requests in a given amount of time.

HTTP/1.0 429 Too Many Requests
Cache-Control: no-cache
Connection: close
Content-Type: text/html</pre></div></div><div class="chapter " id="idg-all-security-middleware-auditing-xml-1"><div class="titlepage"><div><div><h1 class="title"><span class="number">14 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Security Audit Logs</span> <a title="Permalink" class="permalink" href="#idg-all-security-middleware-auditing-xml-1">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-middleware_auditing.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-middleware_auditing.xml</li><li><span class="ds-label">ID: </span>idg-all-security-middleware-auditing-xml-1</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="#id-1.5.16.2"><span class="number">14.1 </span><span class="name">The need for auditing</span></a></span></dt><dt><span class="section"><a href="#id-1.5.16.3"><span class="number">14.2 </span><span class="name">Audit middleware</span></a></span></dt><dt><span class="section"><a href="#id-1.5.16.4"><span class="number">14.3 </span><span class="name">Centralized auditing configuration</span></a></span></dt></dl></div></div><div class="sect1" id="id-1.5.16.2"><div class="titlepage"><div><div><h2 class="title"><span class="number">14.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">The need for auditing</span> <a title="Permalink" class="permalink" href="#id-1.5.16.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-middleware_auditing.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-middleware_auditing.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Enterprises need the ability to audit and monitor workflows and data in
   accordance with their strict corporate, industry or governmental policies
   and compliance requirements such as FIPS-140-2, PCI-DSS, HIPAA, SOX, or ISO.
   To meet this need, <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> supports CADF (Cloud Auditing Data
   Federation)-compliant security audit logs that can easily be integrated with
   your organization's Security Information and Event Management (SIEM) tools.
   Such auditing is valuable not only to meet regulatory compliance
   requirements, but also for correlating threat forensics.
  </p><p>
   Note that logs from existing OpenStack services can also be used for
   auditing purposes, even though they are not in a consistent audit friendly
   CADF format today. All logs can easily be integrated with a SIEM tool such
   as HPE ArcSight, Splunk etc.
  </p></div><div class="sect1" id="id-1.5.16.3"><div class="titlepage"><div><div><h2 class="title"><span class="number">14.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Audit middleware</span> <a title="Permalink" class="permalink" href="#id-1.5.16.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-middleware_auditing.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-middleware_auditing.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Audit middleware is python middleware logic that addresses the
   aforementioned logging shortcomings. Audit middleware constructs audit event
   data in easily consumed CADF format. This data can be mined to answer
   critical questions about activities over REST resources such as who made the
   request, when, why, and so forth.
  </p><p>
   Audit middleware supports delivery of audit data via the Oslo messaging
   notifier feature. Each service is configured to route data to an
   audit-specific log file.
  </p><p>
   The following are key aspects of auditing support in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Auditing is disabled by default and can be enabled only after <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
     installation.
    </p></li><li class="listitem "><p>
     Auditing support has been added to eight <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> services (Nova, Cinder,
     Glance, Keystone, Neutron, Heat, Barbican, and Ceilometer).
    </p></li><li class="listitem "><p>
     Auditing has been added for interactions where REST API calls are invoked.
    </p></li><li class="listitem "><p>
     All audit events are recorded in a service-specific audit log file.
    </p></li><li class="listitem "><p>
     Auditing configuration is centrally managed and indicates for which
     services auditing is currently disabled or enabled.
    </p></li><li class="listitem "><p>
     Auditing can be enabled or disabled on a per-service basis.
    </p></li></ul></div></div><div class="sect1" id="id-1.5.16.4"><div class="titlepage"><div><div><h2 class="title"><span class="number">14.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Centralized auditing configuration</span> <a title="Permalink" class="permalink" href="#id-1.5.16.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/security-middleware_auditing.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-middleware_auditing.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, all auditing configuration is centrally managed and controlled
   via input model YAML files on the Cloud Lifecycle Manager node. The settings are
   configured in the file
   <code class="literal">~/openstack/my_cloud/definition/cloudConfig.yml</code> in a newly
   added audit-settings section shown below the following table.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="col1" /><col class="col2" /><col class="col3" /><col class="col4" /><col class="col5" /><col class="col6" /></colgroup><thead><tr><th>Key</th><th>Value (default)</th><th>Type</th><th>Description</th><th>Expected value(s)</th><th>Comments</th></tr></thead><tbody><tr><td>default</td><td>disabled</td><td>String</td><td>Flag to globally enable or disable auditing for all services.</td><td><span class="emphasis"><em>disabled, enabled</em></span>
      </td><td>
       <p>
        A service's auditing behavior is determined via this default key value
        unless it is listed explicitly in the enabled-services or
        disabled-services list.
       </p>
      </td></tr><tr><td>enabled-services</td><td>[] (empty list)</td><td>yaml list</td><td>
       <p>
        Setting to explicitly enable auditing for listed services regardless of
        default flag setting.
       </p>
      </td><td>
       <p>
        <span class="emphasis"><em>nova, cinder, glance, keystone, neutron, heat, barbican,
        ceilometer </em></span>
       </p>
      </td><td>
       <p>
        To enable a specific service, either add the service name in the
        enabled-services list when default is set to
        <code class="literal">disabled</code> or remove from disabled-services list when
        default is set to <code class="literal">enabled</code>.
       </p>
       <p>
        If a service name is present in both enabled-services and
        disabled-services, then auditing will be enabled for that service.
       </p>
      </td></tr><tr><td>disabled-services</td><td>Nova, Barbican, Keystone, Cinder, Ceilometer, Neutron</td><td>yaml list</td><td>
       <p>
        Setting to explicitly disable auditing for listed services regardless
        of default flag setting.
       </p>
      </td><td>
       <p>
        <span class="emphasis"><em>nova, cinder, glance, keystone,neutron, heat, barbican,
        ceilometer </em></span>
       </p>
      </td><td>
       <p>
        To disable a specific service, either add the service name in
        disabled-services when default is set to <code class="literal">enabled</code>. or
        remove from enabled-services list when default is set to
        <code class="literal">disabled</code>.
       </p>
      </td></tr></tbody></table></div><p>
   Audit settings in <code class="literal">cloudConfig.yml</code> with default set to
   <code class="literal">disabled</code> and services selectively enabled:
  </p><div class="verbatim-wrap"><pre class="screen">product:
    version: 2
    cloud:
    ....
    ....
    # Disc space needs to be allocated to the audit directory before enabling
    # auditing.
    # keystone and nova has auditing enabled
    # cinder, ceilometer, glance, neutron, heat, barbican have auditing disabled
    audit-settings:
    audit-dir: /var/audit
    default: disabled
    enabled-services:
    - keystone
    - nova
    disabled-services:
    - cinder
    - ceilometer</pre></div><p>
   Audit setting in <code class="literal">cloudConfig.yml</code> with default set to
   <code class="literal">enabled</code> and services selectively disabled:
  </p><div class="verbatim-wrap"><pre class="screen">product:
    version: 2
    cloud:
    ....
    ....
    # Disc space needs to be allocated to the audit directory before enabling
    # auditing.
    # keystone, nova, glance, neutron, heat, barbican has auditing enabled
    # cinder, ceilometer has auditing disabled
    audit-settings:
    audit-dir: /var/audit
    default: enabled
    enabled-services:
    - keystone
    - nova
    disabled-services:
    - cinder
    - ceilometer</pre></div><p>
   Because auditing is disabled by default, you will need to follow the steps
   below to enable it:
  </p><div class="orderedlist " id="ul-udn-cft-lv"><ol class="orderedlist" type="1"><li class="listitem "><p>
     <span class="intraxref">Book “Operations Guide”, Chapter 12 “Managing Monitoring, Logging, and Usage Reporting”, Section 12.2 “Centralized Logging Service”, Section 12.2.7 “Audit Logging Overview”, Section 12.2.7.1 “Audit Logging Checklist”</span>
    </p></li><li class="listitem "><p>
     <span class="intraxref">Book “Operations Guide”, Chapter 12 “Managing Monitoring, Logging, and Usage Reporting”, Section 12.2 “Centralized Logging Service”, Section 12.2.7 “Audit Logging Overview”, Section 12.2.7.2 “Enable Audit Logging”</span>
    </p></li></ol></div><p>
   For instructions on backing up and restoring audit logs, see:
   <span class="intraxref">Book “Operations Guide”, Chapter 14 “Backup and Restore”, Section 14.13 “Backing up and Restoring Audit Logs”</span> .
  </p></div></div></div></div><div class="page-bottom"><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>