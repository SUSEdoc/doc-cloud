<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SUSE OpenStack Cloud 8 | Security Guide | SUSE® OpenStack Cloud: Preventing Host Header Poisoning</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="SUSE® OpenStack Cloud: Preventing Host Header Poisonin…"/>
<meta name="description" content="Depending on the environment and context of your SUSE OpenStack Cloud deployment, it may be advisable to configure Horizon to protect against Host he…"/>
<meta name="product-name" content="SUSE OpenStack Cloud"/>
<meta name="product-number" content="8"/>
<meta name="book-title" content="Security Guide"/>
<meta name="chapter-title" content="Chapter 8. SUSE® OpenStack Cloud: Preventing Host Header Poisoning"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 8"/>
<meta property="og:title" content="SUSE® OpenStack Cloud: Preventing Host Header Poisonin…"/>
<meta property="og:description" content="Depending on the environment and context of your SUSE OpenStack Cloud deployment, it may be advisable to configure Horizon to protect against Host he…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SUSE® OpenStack Cloud: Preventing Host Header Poisonin…"/>
<meta name="twitter:description" content="Depending on the environment and context of your SUSE OpenStack Cloud deployment, it may be advisable to configure Horizon to protect against Host he…"/>
<link rel="prev" href="tls30overview.html" title="Chapter 7. Transport Layer Security (TLS) Overview"/><link rel="next" href="password-encryption.html" title="Chapter 9. Encryption of Passwords and Sensitive Data"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-header_poisoning.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Security Guide</a><span> / </span><a class="crumb" href="header-poisoning.html">SUSE® OpenStack Cloud: Preventing Host Header Poisoning</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Security Guide</div><ol><li><a href="newsecurity.html" class=" "><span class="title-number">1 </span><span class="title-name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Features Overview</span></a></li><li><a href="barbican.html" class=" "><span class="title-number">2 </span><span class="title-name">Key Management with the Barbican Service</span></a></li><li><a href="barbicanAdmin.html" class=" "><span class="title-number">3 </span><span class="title-name">Key Management Service Administration</span></a></li><li><a href="roleSegregation.html" class=" "><span class="title-number">4 </span><span class="title-name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Service Admin Role Segregation in the Identity Service</span></a></li><li><a href="cha-security-rbac.html" class=" "><span class="title-number">5 </span><span class="title-name">Role-Based Access Control in Neutron</span></a></li><li><a href="x509-certificate-auth.html" class=" "><span class="title-number">6 </span><span class="title-name">Configuring Keystone and Horizon to use X.509 Client Certificates</span></a></li><li><a href="tls30overview.html" class=" "><span class="title-number">7 </span><span class="title-name">Transport Layer Security (TLS) Overview</span></a></li><li><a href="header-poisoning.html" class=" you-are-here"><span class="title-number">8 </span><span class="title-name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Preventing Host Header Poisoning</span></a></li><li><a href="password-encryption.html" class=" "><span class="title-number">9 </span><span class="title-name">Encryption of Passwords and Sensitive Data</span></a></li><li><a href="encryption-ephemeral.html" class=" "><span class="title-number">10 </span><span class="title-name">Encryption of Ephemeral Volumes</span></a></li><li><a href="topic-rmq-j1v-4t.html" class=" "><span class="title-number">11 </span><span class="title-name">Refining Access Control with AppArmor</span></a></li><li><a href="dar.html" class=" "><span class="title-number">12 </span><span class="title-name">Data at Rest Encryption</span></a></li><li><a href="glance-rate-limit.html" class=" "><span class="title-number">13 </span><span class="title-name">Glance-API Rate Limit (CVE-2016-8611)</span></a></li><li><a href="idg-all-security-middleware-auditing-xml-1.html" class=" "><span class="title-number">14 </span><span class="title-name">Security Audit Logs</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="header-poisoning" data-id-title="SUSE® OpenStack Cloud: Preventing Host Header Poisoning"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber"><span class="phrase"><span class="phrase">8</span></span></span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Preventing Host Header Poisoning</span></span> <a title="Permalink" class="permalink" href="header-poisoning.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-header_poisoning.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Depending on the environment and context of your <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> deployment, it may
  be advisable to configure Horizon to protect against Host header poisoning
  (see ref. #1 below) by using Django's ALLOWED_HOSTS setting (see ref. #2
  below). To configure Horizon to use the ALLOWED_HOSTS setting, take the
  following steps:
 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Edit the haproxy settings to reconfigure the health check for Horizon to
    specify the allowed hostname(s). This needs to be done first, before
    configuring Horizon itself. Otherwise, if Horizon is first configured to
    restrict the values of the "Host" header on incoming HTTP requests, the
    haproxy health checks will start to fail. So, the haproxy configuration
    needs to be updated first, if this is being done on an existing
    installation.
   </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
      On your Cloud Lifecycle Manager node, make a backup copy of this file and then open
      <span class="bold"><strong>/usr/share/ardana/input-model/2.0/services/horizon.yml</strong></span>
     </p></li><li class="listitem"><p>
      Find the line that contains "option httpchk" and modify it so it reads
      the following way:
     </p><div class="verbatim-wrap"><pre class="screen">- "option httpchk GET / HTTP/1.1\r\nHOST:\ my.example.com"
# Note the escaped escape characters.</pre></div><p>
      In this example, my.example.com is the hostname associated with the
      Horizon VIP on the external API network. However, you are not restricted
      to just one allowed host. In addition, allowed hosts can contain
      wildcards (though not in the horizon.yml file; there you must have an
      actual resolvable hostname or a routeable IP address). However, for this
      change to the haproxy healthcheck, it is suggested that the hostname
      associated with the Horizon VIP on the external API network be used.
     </p></li></ol></div></li><li class="listitem"><p>
    Edit the template file that will be use for Horizon's local_settings.py
    configuration file
   </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
      While still on your Cloud Lifecycle Manager node, open
      <code class="filename">~/openstack/my_cloud/config/horizon/local_settings.py</code>.
     </p></li><li class="listitem"><p>
      Change the line that sets the "ALLOWED_HOSTS" setting. This can be a list
      of hostnames and (V)IPs that eventually get routed to Horizon. Wildcards
      are supported.
     </p><div class="verbatim-wrap"><pre class="screen">ALLOWED_HOSTS = ['my.example.com', '*.example.net', '192.168.245.6']</pre></div><p>
      In the above example, any HTTP request received with a hostname not
      matching any in this list will receive an HTTP 400 reply.
     </p></li><li class="listitem"><p>
      Commit the change with a "git commit -a" command.
     </p></li></ol></div></li><li class="listitem"><p>
    Run the configuration processor
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
    Enable the configuration: This can be done in one of a few ways: As part of
    a site deploy play as part of an upgrade play or by re-running the FND-CLU
    and Horizon deploys on an existing deployment: If modifying an existing
    deploy, the FND-CLU deploy will need to be run first, since changing the
    ALLOWED_HOSTS setting in Horizon first will cause the default health check
    to fail, if it does not specify a <code class="literal">Host</code> header in the
    HTTP request sent to
    check the health of Horizon's Apache virtual host.
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts horizon-deploy.yml
ansible-playbook -i hosts/verb_hosts FND-CLU-deploy.yml</pre></div></li></ol></div><p>
  References:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    <a class="link" href="https://www.djangoproject.com/weblog/2013/feb/19/security/#s-issue-host-header-poisoning" target="_blank">https://www.djangoproject.com/weblog/2013/feb/19/security/#s-issue-host-header-poisoning</a>
   </p></li><li class="listitem"><p>
    <a class="link" href="https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts" target="_blank">https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts</a>
   </p></li></ul></div></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="tls30overview.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 7 </span>Transport Layer Security (TLS) Overview</span></a> </div><div><a class="pagination-link next" href="password-encryption.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 9 </span>Encryption of Passwords and Sensitive Data</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>