<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Key Management with the Barbican Service | Security Guide | SUSE OpenStack Cloud 8</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.2.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.81.0 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE OpenStack Cloud" /><meta name="product-number" content="8" /><meta name="book-title" content="Security Guide" /><meta name="chapter-title" content="Chapter 2. Key Management with the Barbican Service" /><meta name="description" content="Barbican is an OpenStack key management service offering secure storage, provisioning, and management of key data. The Barbican service provides management of secrets, keys and certificates via multiple storage back-ends. The support for various back ends is provided via a plug-in mechanism, a Key M…" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 8" /><link rel="home" href="index.html" title="Documentation" /><link rel="up" href="book-security.html" title="Security Guide" /><link rel="prev" href="newsecurity.html" title="Chapter 1. SUSE® OpenStack Cloud: Security Features Overview" /><link rel="next" href="barbicanAdmin.html" title="Chapter 3. Key Management Service Administration" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.svg" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Security Guide"><span class="book-icon">Security Guide</span></a><span> › </span><a class="crumb" href="barbican.html">Key Management with the Barbican Service</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="newsecurity.html"><span class="number">1 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Features Overview</span></a></li><li class="inactive"><a href="barbican.html"><span class="number">2 </span><span class="name">Key Management with the Barbican Service</span></a></li><li class="inactive"><a href="barbicanAdmin.html"><span class="number">3 </span><span class="name">Key Management Service Administration</span></a></li><li class="inactive"><a href="roleSegregation.html"><span class="number">4 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Service Admin Role Segregation in the Identity Service</span></a></li><li class="inactive"><a href="cha-security-rbac.html"><span class="number">5 </span><span class="name">Role-Based Access Control in Neutron</span></a></li><li class="inactive"><a href="x509-certificate-auth.html"><span class="number">6 </span><span class="name">Configuring Keystone and Horizon to use X.509 Client Certificates</span></a></li><li class="inactive"><a href="tls30overview.html"><span class="number">7 </span><span class="name">Transport Layer Security (TLS) Overview</span></a></li><li class="inactive"><a href="header-poisoning.html"><span class="number">8 </span><span class="name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Preventing Host Header Poisoning</span></a></li><li class="inactive"><a href="password-encryption.html"><span class="number">9 </span><span class="name">Encryption of Passwords and Sensitive Data</span></a></li><li class="inactive"><a href="encryption-ephemeral.html"><span class="number">10 </span><span class="name">Encryption of Ephemeral Volumes</span></a></li><li class="inactive"><a href="topic-rmq-j1v-4t.html"><span class="number">11 </span><span class="name">Refining Access Control with AppArmor</span></a></li><li class="inactive"><a href="dar.html"><span class="number">12 </span><span class="name">Data at Rest Encryption</span></a></li><li class="inactive"><a href="glance-rate-limit.html"><span class="number">13 </span><span class="name">Glance-API Rate Limit (CVE-2016-8611)</span></a></li><li class="inactive"><a href="idg-all-security-middleware-auditing-xml-1.html"><span class="number">14 </span><span class="name">Security Audit Logs</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 1. SUSE® OpenStack Cloud: Security Features Overview" href="newsecurity.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 3. Key Management Service Administration" href="barbicanAdmin.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Security Guide"><span class="book-icon">Security Guide</span></a><span> › </span><a class="crumb" href="barbican.html">Key Management with the Barbican Service</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 1. SUSE® OpenStack Cloud: Security Features Overview" href="newsecurity.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 3. Key Management Service Administration" href="barbicanAdmin.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="barbican"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber "><span class="phrase"><span class="phrase">8</span></span></span></div><div><h1 class="title"><span class="number">2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Key Management with the Barbican Service</span> <a title="Permalink" class="permalink" href="barbican.html#">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>barbican</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="barbican.html#idg-all-security-barbican-xml-4"><span class="number">2.1 </span><span class="name">Barbican Service Overview</span></a></span></dt><dt><span class="section"><a href="barbican.html#features"><span class="number">2.2 </span><span class="name">Key Features</span></a></span></dt><dt><span class="section"><a href="barbican.html#idg-all-security-barbican-xml-6"><span class="number">2.3 </span><span class="name">Installation</span></a></span></dt><dt><span class="section"><a href="barbican.html#sec-barbican-audit"><span class="number">2.4 </span><span class="name">Auditing Barbican Events</span></a></span></dt><dt><span class="section"><a href="barbican.html#id-1.5.4.6"><span class="number">2.5 </span><span class="name">Barbican Key Management Service Bootstrap Data</span></a></span></dt><dt><span class="section"><a href="barbican.html#idg-all-security-barbican-xml-11"><span class="number">2.6 </span><span class="name">Known issues and workarounds</span></a></span></dt></dl></div></div><div class="sect1" id="idg-all-security-barbican-xml-4"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Barbican Service Overview</span> <a title="Permalink" class="permalink" href="barbican.html#idg-all-security-barbican-xml-4">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-xml-4</li></ul></div></div></div></div><p>
   Barbican is an <span class="productname">OpenStack</span> key management service offering secure storage,
   provisioning, and management of key data. The Barbican service provides
   management of secrets, keys and certificates via multiple storage back-ends.
   The support for various back ends is provided via a plug-in mechanism, a Key
   Management Interoperability Protocol (KMIP) plug-in for a KMIP-compliant HSM
   Hardware Secure Module (HSM) device. Barbican supports symmetric and
   asymmetric key generation using various algorithms. Cinder, neutron-lbaas v2
   and Nova will integrate with Barbican for their encryption key
   generation and storage.
  </p><p>
   Barbican has two types of core feature sets:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The <span class="emphasis"><em>Barbican component</em></span>, a Web Server Gateway
     Interface (WSGI) application that exposes a REST API for
     secrets/containers/orders.
    </p></li><li class="listitem "><p>
     <span class="emphasis"><em>Barbican workers</em></span> for asynchronous processing,
     which is used for various messaging-event-driven tasks related to
     certificate generation.
    </p></li></ul></div></div><div class="sect1" id="features"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Key Features</span> <a title="Permalink" class="permalink" href="barbican.html#features">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>features</li></ul></div></div></div></div><p>
   The major features of the Barbican key management service are:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The ability to encrypt volumes/disks. In an <span class="productname">OpenStack</span> context, this
     means support for encrypting Cinder volumes (volume encryption). Cinder
     has its own key manager interface (KeyMgr) and can use BarbicanClient as
     one of its implementations. By default in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, Cinder uses
     Barbican as its key manager when Barbican is enabled. KeyMgr
     encrypts data
     in the virtualization host before writing data to the remote disk. There
     are three options available in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       Tenant-based encryption for block volume storage using Barbican
       for KMS,
      </p></li><li class="listitem "><p>
       Barbican with KMIP and PKCS11 and external KMS (certified with
       Micro Focus ESKM),
      </p></li><li class="listitem "><p>
       3PAR StoreServ Data-At-Rest Encryption,
      </p></li></ul></div></li><li class="listitem "><p>
     Storage and retrieval of secrets (passwords)
    </p></li><li class="listitem "><p>
     Certificate management for Load Balancer as a Service V2 (previously known
     as Neutron-LBaaS)
    </p></li><li class="listitem "><p>
     The ability to define and manage access policies for key material
    </p></li><li class="listitem "><p>
     Administrative functionality, and the ability to control the lifecycle of
     key material
    </p></li><li class="listitem "><p>
     A well-defined auditing ability in <span class="productname">OpenStack</span> services for key access
     and lifecycle events
    </p></li><li class="listitem "><p>
     Key management as a service for PaaS application(s) deployed on an
     <span class="productname">OpenStack</span> cloud
    </p></li><li class="listitem "><p>
     The ability to scale key management effectively and make it highly
     available (able to handle failover)
    </p></li></ul></div><div id="id-1.5.4.3.4" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning</h6><p>
    Do not delete the certificate container associated with your load balancer
    listeners before deleting the load balancers themselves. If you delete the
    certificate first, future operations on your load balancers and failover
    will stop working.
   </p></div></div><div class="sect1" id="idg-all-security-barbican-xml-6"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Installation</span> <a title="Permalink" class="permalink" href="barbican.html#idg-all-security-barbican-xml-6">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-xml-6</li></ul></div></div></div></div><p>
   New installations of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     For new installations, no changes are needed for Barbican to be
     enabled.
     When installing your cloud, you should use the input models which already
     define the necessary Barbican components. When using the pre-defined
     input model files that come with <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, nothing else needs to be
     done in those files.
    </p></li><li class="listitem "><p>
     Generate a master key.
    </p><div id="id-1.5.4.4.3.2.2" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg" /><h6>Warning</h6><p>
      Do not change your master key after deploying it to Barbican.
     </p></div></li><li class="listitem "><p>
     If you decide to make configuration changes to your clean install of
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>, you will need to redeploy the Barbican service. For
     details on available customization options, please see
     <a class="xref" href="barbicanAdmin.html" title="Chapter 3. Key Management Service Administration">Chapter 3, <em>Key Management Service Administration</em></a>.
    </p></li></ul></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.4.4"><span class="name">Master Key Configuration</span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.4.4">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><p>
   Barbican currently supports databases and KMIP as its secret store
   back-ends.
   In <span class="productname">OpenStack</span> upstream additional back-ends are available, such as the
   PKCS11 and dogtag plug-ins, but they are not tested or supported by
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
  </p><p>
   In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, by default Barbican is configured to use a database as a
   secret (keys) storage back-end.
   This back-end encrypts Barbican-managed keys with a
   project level key (<span class="emphasis"><em>KEK</em></span>/Key Encryption Key) before
   storing it in the database. Project-level keys are encrypted using a master
   key. As part of the initial Barbican configuration, you must generate
   and configure this master key.
  </p><p>
   When Barbican is used with <code class="literal">simple_crypto_plugin</code> as
   its secret store back-end, its master key needs to be defined
   <span class="bold"><strong>before initial deployment</strong></span>. If no key is
   specified before deployment, the default master key is
   used—<span class="bold"><strong>this practice is discouraged</strong></span>.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Generate the master key using the provided python *generate_kek* script on
     the Cloud Lifecycle Manager node:
    </p><div class="verbatim-wrap"><pre class="screen">python ~/openstack/ardana/ansible/roles/KEYMGR-API/templates/generate_kek</pre></div><p>
     The master key is generated at stdout from this command.
    </p></li><li class="step "><p>
     Set the master key in
     <code class="filename">~/openstack/my_cloud/config/barbican/barbican_deploy_config.yml</code>.
    </p></li><li class="step "><p>
     If there is an existing <code class="literal">barbican_customer_master_key</code>
     value, replace it with the generated master key you just generated.
    </p></li><li class="step "><p>
     Commit the change to the Git repository:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "My config"</pre></div></li><li class="step "><p>
     Run ready-deployment:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     When the master key is set, continue with your cloud deployment.
    </p></li></ol></div></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.4.9"><span class="name">Upgrade Master Key Configuration</span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.4.9">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Check the master key.
    </p><p>
     If a master key is already defined, check
     <code class="filename">~/openstack/ardana/ansible/roles/barbican-common/vars/barbican_deploy_config.yml</code>
     for <code class="literal">barbican_customer_master_key</code> value. If the value
     does not have a prefix <code class="literal">@ardana@</code>, it is not encrypted.
     It is highly recommended to encrypt this value.
    </p></li><li class="step "><p>
     Encrypt the existing key during upgrade:
    </p><ol type="a" class="substeps "><li class="step "><p>
       Set up the environment variable.
      </p><div class="verbatim-wrap"><pre class="screen">ARDANA_USER_PASSWORD_ENCRYPT_KEY</pre></div><p>
       which contains the key used to encrypt Barbican master key.
      </p></li><li class="step "><p>
       Before you run any playbooks, you need to export the encryption key in
       the following environment variable:
      </p><ol type="i" class="substeps "><li class="step "><div class="verbatim-wrap"><pre class="screen">export ARDANA_USER_PASSWORD_ENCRYPT_KEY=&lt;USER_ENCRYPTION_KEY&gt;</pre></div></li><li class="step "><div class="verbatim-wrap"><pre class="screen">python
*roles/KEYMGR-API/templates/generate_kek &lt;barbican_customer_master_key&gt;</pre></div></li><li class="step "><p>
         Master key is generated at stdout.
        </p></li><li class="step "><p>
         Set this master key in file
        </p><div class="verbatim-wrap"><pre class="screen">~/openstack/ardana/ansible/roles/barbican-common/vars/barbican_deploy_config.yml</pre></div></li><li class="step "><p>
         Replace existing <code class="literal">barbican_customer_master_key</code> value
         with the master key you just generated.
        </p></li><li class="step "><p>
         Commit the change in git repository.
        </p></li><li class="step "><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
         When the master key is set, continue with cloud deployment.
        </p></li></ol></li></ol></li><li class="step "><p>
     Changing the master key during the upgrade process is discouraged.
     Changing the master key will result in a read error for existing secrets
     as they were encrypted using the previous master key.
    </p></li></ol></div></div><div id="id-1.5.4.4.11" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
    For a Barbican deployment with a database back-end, the master key
    needs to be generated and configured before Barbican is deployed for
    the first time.
    Once the master key is set, it must not be modified.
   </p></div><div id="id-1.5.4.4.12" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
    Changing the master key can result in read errors for existing secrets as
    those secrets are stored in the database and are encrypted using the
    previous master key. Once a new master key is used, Barbican will not
    be able to read those secrets. Also it will not be able to create new
    secrets within that project as the project key is encrypted using previous
    master key.
   </p></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.4.13"><span class="name">KMIP Plug-in Support</span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.4.13">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><p>
   Barbican has a KMIP plug-in to store encryption keys (called secrets in
   Barbican service terminology) in an HSM device using the KMIP protocol.
   This plug-in has been tested against Micro Focus ESKM with KMIP server. To
   enable support for it, Barbican needs to be configured with the
   corresponding plug-in
   connection details, and client certificate information needs to be defined
   in its configuration. The ESKM KMIP server uses a client certificate to
   validate a KMIP client connection established by the Barbican server.
   As part of that KMIP configuration, playbooks provide a mechanism to upload
   your client certs to nodes hosting the Barbican API server.
  </p><p>
   KMIP deployment instructions can be found in
   <a class="xref" href="dar.html#configure-KMIP-ESKM" title="12.1. Configuring KMIP and ESKM">Section 12.1, “Configuring KMIP and ESKM”</a>.
  </p><div id="id-1.5.4.4.16" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg" /><h6>Note</h6><p>
    Installation and deployment of the Micro Focus ESKM or any other HSM devices
    and dependent components is beyond the scope of this document. Please refer
    the relevant documentation for your choice of product. For example, you can
    get more information on Micro Focus ESKM and related Data Security and
    Encryption Products at
    <a class="link" href="https://software.microfocus.com/en-us/products/eskm-enterprise-secure-key-management/overview" target="_blank">https://software.microfocus.com/en-us/products/eskm-enterprise-secure-key-management/overview</a>.
   </p></div></div><div class="sect1" id="sec-barbican-audit"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Auditing Barbican Events</span> <a title="Permalink" class="permalink" href="barbican.html#sec-barbican-audit">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>sec-barbican-audit</li></ul></div></div></div></div><p>
   The Barbican service supports auditing and uses
   <a class="xref" href="idg-all-security-middleware-auditing-xml-1.html" title="Chapter 14. Security Audit Logs">Chapter 14, <em>Security Audit Logs</em></a> to generate
   auditing data in Cloud Auditing Data Federation (CADF) format. The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
   input model has a mechanism to enable and disable auditing on a per-service
   basis. When Barbican auditing is enabled, it writes audit messages to
   an audit log file that is separate from the Barbican internal logging.
   The base location of audit log file is driven by common auditing
   configuration.
  </p><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.5.3"><span class="name">Enabling and Disabling Auditing</span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.5.3">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><p>
   The auditing of Barbican events can be enabled and disabled through the
   Barbican reconfigure playbook. As part of the configuration of
   Barbican, its audit messages can be directed to a log or to a
   messaging queue. By default, messages are written to the Barbican log
   file. Once an architecture-level decision is made with regards to the
   default consumer of audit events (either logging or messaging), the
   Barbican service can be configured to use
   it as the default option when auditing is enabled.
  </p><p>
   Auditing can be disabled or enabled by following these steps on the Cloud Lifecycle Manager
   node.
  </p><div class="procedure " id="id-1.5.4.5.6"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 2.1: </span><span class="name">Enabling or Disabling Auditing </span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.5.6">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the file
     <code class="literal">~/openstack/my_cloud/definition/cloudConfig.yml</code>. All
     audit-related configuration is defined in the audit-settings section. You
     must use valid YAML syntax when specifying values.
    </p></li><li class="step "><p>
     Any service (including Barbican) that is listed under
     enabled-services or disabled-services will override the default setting.
     To enable auditing, make sure that the Barbican service name is in
     the enabled-services list
     of the <code class="literal">audit-settings</code> section or is not present in
     disabled-services list when default: is set to enabled.
    </p><p>
     The relevant section of <code class="literal">cloudConfig.yml</code> is shown below.
     Enabled-services are commented out.
    </p><p>
     The <code class="literal">default: enabled</code> setting applies to all services.
     If you want to disable (or enable) a few, whichever is the opposite of the
     default global setting you used, you can do so in a disabled-services (or
     enabled-services) section below it. Here the enabled-services entry is
     commented out. You should only have either a default of enabled (or
     disabled) or a section of disabled (or enabled). There is no need to
     duplicate the setting.
    </p><div class="verbatim-wrap"><pre class="screen">audit-settings:
     default: enabled
     #enabled-services:
     #  - keystone
     #  - barbican
     disabled-services:
        - nova
        - barbican
        - keystone
        - cinder
        - ceilometer
        - neutron</pre></div></li><li class="step "><p>
     When you are satisfied with your settings, copy the files to
     <code class="literal">~/openstack/my_cloud/definition/</code>, and commit the
     changes in the git repository. For example, if you are using the Entry
     Scale KVM model, you would copy from
     <code class="filename">~/openstack/examples/entry-scale-kvm</code> and commit.
    </p><div class="verbatim-wrap"><pre class="screen"> cp -r ~/openstack/examples/entry-scale-kvm/* ~/openstack/my_cloud/definition/
 cd ~/openstack
 git add -A
 git commit -m "My config"</pre></div></li><li class="step "><p>
     Run the configuration processor and ready-deployment:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
 ansible-playbook -i hosts/localhost config-processor-run.yml
 ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
     Run barbican-reconfigure:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
 ansible-playbook -i hosts/verb_hosts barbican-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect1" id="id-1.5.4.6"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Barbican Key Management Service Bootstrap Data</span> <a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.6">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   When the key management service is installed, some of the Keystone-related
   initial data is bootstrapped as part of its initial deployment. The data
   added is primarily related to Barbican user, roles, service and
   endpoint definitions, and Barbican role assignments.
  </p><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.6.3"><span class="name">User, Roles, Service and Endpoint Definitions</span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.6.3">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><thead><tr><th>Type</th><th>Name or key-value pair</th><th>Purpose</th><th>Comments</th></tr></thead><tbody><tr><td>
       <p>
        Keystone User Account
       </p>
      </td><td>
       <p>
        barbican
       </p>
      </td><td>
       <p>
        Barbican user account associated with administrative privileges.
       </p>
      </td><td>
       <p>
        Password is randomly generated and made available in the Barbican
        client environment setup script, <code class="literal">barbican.osrc,</code>, on
        the Cloud Lifecycle Manager node.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone User Account
       </p>
      </td><td>
       <p>
        barbican_service
       </p>
      </td><td>
       <p>
        Service account used for Keystone token validation by
        <code class="literal">barbican</code> service.
       </p>
      </td><td>
       <p>
        Password is randomly generated and stored in barbican paste
        configuration, <code class="filename">barbican-api-paste.ini</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:creator
       </p>
      </td><td>
       <p>
        Barbican specific role with privilege to create, modify, list, and
        delete keys and certificates.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined for
        <code class="literal">creator</code> role in upstream Barbican. Referenced in the
        service policy config file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:admin
       </p>
      </td><td>
       <p>
        Barbican-specific role that has administrative privileges. Privileges
        include modifications (update and delete) in container's consumer,
        transport keys, certificate authorities (CA), assignment, and
        management of per-project CA.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined for<code class="literal">admin</code>
        role in upstream Barbican. Referenced in the service policy config
        file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:observer
       </p>
      </td><td>
       <p>
        Barbican specific role which has privileges limited to read/list of
        keys, certificates.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined
        for<code class="literal">observer</code> role in upstream Barbican. Referenced in
        the service policy config file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:auditor
       </p>
      </td><td>
       <p>
        Barbican specific role which has privileges limited to reading
        metadata
        of keys, certificates. This role does not allow reading and listing of
        actual keys and certificates.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined for<code class="literal">auditor</code>
        role in upstream Barbican. Referenced in the service policy config
        file, <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Role
       </p>
      </td><td>
       <p>
        key-manager:service-admin
       </p>
      </td><td>
       <p>
        Barbican specific role which has privilege to modify global
        preferred CA and modify default project quotas.
       </p>
      </td><td>
       <p>
        This role has the same privileges defined
        for <code class="literal">key-manager:service-admin</code> role in upstream
        Barbican. Referenced in the service policy config file,
        <code class="filename">policy.json</code>.
       </p>
      </td></tr><tr><td>
       <p>
        Keystone Service
       </p>
      </td><td>
       <p>
        name: barbican type: key-manager
       </p>
      </td><td>
       <p>
        Barbican service definition. Service type is
        <span class="emphasis"><em>key-manager</em></span>.
       </p>
      </td><td> </td></tr><tr><td>
       <p>
        Keystone Endpoint
       </p>
      </td><td>
       <p>
        interface: internal region: region1
       </p>
      </td><td>
       <p>
        Barbican internal endpoint. This is the load-balanced endpoint exposed
        for internal service usage.
       </p>
      </td><td> </td></tr><tr><td>
       <p>
        Keystone Endpoint
       </p>
      </td><td>
       <p>
        interface: public region: region1
       </p>
      </td><td>
       <p>
        Barbican public endpoint. This is the load-balanced endpoint exposed
        for external/public service usage.
       </p>
      </td><td> </td></tr></tbody></table></div><div xmlns:dm="urn:x-suse:ns:docmanager" class="sect4 bridgehead"><h5 class="title" id="id-1.5.4.6.5"><span class="name">Role Assignments</span><a title="Permalink" class="permalink" href="barbican.html#id-1.5.4.6.5">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h5></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><thead><tr><th>User name</th><th>Project name</th><th>Role name</th><th>Purpose</th></tr></thead><tbody><tr><td>barbican</td><td>admin</td><td>key-manager:admin</td><td>
       <p>
        User is assigned Barbican administration privileges on Keystone-defined
        <code class="literal">admin</code> project. This allows the user to manage
        Barbican resources associated with that project using the Barbican CLI
        setup.
       </p>
      </td></tr><tr><td>barbican</td><td>admin</td><td>key-manager:service-admin </td><td>
       <p>
        User is assigned Barbican service administration privileges on
        Keystone-defined <code class="literal">admin</code> project. This role and the
        one above allows full Barbican-related administration capabilities.
       </p>
      </td></tr><tr><td>barbican</td><td>admin</td><td>admin</td><td>
       <p>
        User assigned Keystone defined administrative role on its
        <code class="literal">admin</code> project. This way customer can continue to use
         Barbican CLI and <span class="productname">OpenStack</span> CLI without need to switch when testing
        or verifying data.
       </p>
      </td></tr><tr><td>admin</td><td>admin</td><td>key-manager:admin</td><td>
       <p>
        Keystone-defined <code class="literal">admin</code> user is given Barbican
        related administrative privileges on Keystone-defined
        <code class="literal">admin</code> project.
       </p>
      </td></tr><tr><td>admin</td><td>admin</td><td>key-manager:service-admin</td><td>
       <p>
        In lines of above role assignment, Barbican specific service
        administrator role
        is assigned to allow global preferred CA and quotas modifications.
       </p>
      </td></tr><tr><td>barbican_service</td><td>services</td><td>service</td><td>
       <p>
        Barbican service account is given <code class="literal">service</code> role
        on <code class="literal">services</code> project for token validation. API server
        uses this for creating scoped service token and then includes it as
        <code class="literal">X-Service-Token</code> when requesting customer/client
        token validation from Keystone.
       </p>
      </td></tr></tbody></table></div></div><div class="sect1" id="idg-all-security-barbican-xml-11"><div class="titlepage"><div><div><h2 class="title"><span class="number">2.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Known issues and workarounds</span> <a title="Permalink" class="permalink" href="barbican.html#idg-all-security-barbican-xml-11">#</a><a class="report-bug" rel="nofollow" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_8/xml/security-barbican.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>security-barbican.xml</li><li><span class="ds-label">ID: </span>idg-all-security-barbican-xml-11</li></ul></div></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Make sure that in your Certificate Signing Request (CSR) <code class="literal">Common
     Name</code> matches the <code class="literal">barbican_kmip_username</code> value
     defined in
     <code class="filename">roles/barbican-common/vars/barbican_deploy_config.yml</code>.
     Otherwise you may see an internal server error message in Barbican for
     secret create request.
    </p></li><li class="listitem "><p>
     Barbican does not return a clear error message with regards to client
     certificate setup and its connectivity with KMIP server. During secret
     create request, a general "Internal Server Error" is returned when the
     certificate is invalid or missing any of necessary client certificate data
     (client certificate, key and CA root certificate).
    </p></li></ol></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="barbicanAdmin.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 3 </span>Key Management Service Administration</span></a><a class="nav-link" href="newsecurity.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 1 </span><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Features Overview</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>