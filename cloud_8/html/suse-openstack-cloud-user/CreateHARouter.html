<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Creating a Highly Available Router | User Guide | SUSE OpenStack Cloud 8</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.17 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE OpenStack Cloud" /><meta name="product-number" content="8" /><meta name="book-title" content="User Guide" /><meta name="chapter-title" content="Chapter 6. Creating a Highly Available Router" /><meta name="description" content="CVR (Centralized Virtual Routing) and DVR (Distributed Virtual Routing) are two types of technologies which can be used to provide routing processes in SUSE OpenStack Cloud 8. You can create Highly Available (HA) versions of CVR and DVR routers by using the options in the table below when creating y…" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 8" /><link rel="home" href="index.html" title="Documentation" /><link rel="up" href="user-cloudadmin.html" title="Part I. Cloud Admin User Guide" /><link rel="prev" href="install-cli.html" title="Chapter 5. Installing the Command-Line Clients" /><link rel="next" href="user-nonadmin.html" title="Part II. Project User Guide" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #FABEBE;"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Documentation"><span class="book-icon">Documentation</span></a><span> › </span><a class="crumb" href="book-user.html">User Guide</a><span> › </span><a class="crumb" href="user-cloudadmin.html">Cloud Admin User Guide</a><span> › </span><a class="crumb" href="CreateHARouter.html">Creating a Highly Available Router</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>User Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="user-cloudadmin.html"><span class="number">I </span><span class="name">Cloud Admin User Guide</span></a><ol><li class="inactive"><a href="using-opsconsole.html"><span class="number">1 </span><span class="name">Using the Operations Console</span></a></li><li class="inactive"><a href="user-dashboard-overview.html"><span class="number">2 </span><span class="name">Using the Dashboard</span></a></li><li class="inactive"><a href="cloudadmin-gui.html"><span class="number">3 </span><span class="name">Cloud Admin Actions with the Dashboard</span></a></li><li class="inactive"><a href="CreateCloudAdmin.html"><span class="number">4 </span><span class="name">Cloud Admin Actions with the Command Line</span></a></li><li class="inactive"><a href="install-cli.html"><span class="number">5 </span><span class="name">Installing the Command-Line Clients</span></a></li><li class="inactive"><a href="CreateHARouter.html"><span class="number">6 </span><span class="name">Creating a Highly Available Router</span></a></li></ol></li><li class="inactive"><a href="user-nonadmin.html"><span class="number">II </span><span class="name">Project User Guide</span></a><ol><li class="inactive"><a href="using-container-as-a-service-overview.html"><span class="number">7 </span><span class="name">Using Container as a Service (Magnum)</span></a></li><li class="inactive"><a href="idg-all-userguide-create-network-xml-1.html"><span class="number">8 </span><span class="name">Creating a Private Network</span></a></li><li class="inactive"><a href="create-keypair.html"><span class="number">9 </span><span class="name">Creating a Key Pair</span></a></li><li class="inactive"><a href="user-image-upload.html"><span class="number">10 </span><span class="name">Creating and Uploading a Glance Image</span></a></li><li class="inactive"><a href="lbaas-dashboard.html"><span class="number">11 </span><span class="name">Creating a Load Balancer with the Dashboard</span></a></li><li class="inactive"><a href="HP2-0LBaaS.html"><span class="number">12 </span><span class="name">Using Load Balancing as a Service (LBaaS)</span></a></li><li class="inactive"><a href="LBaaSHeat.html"><span class="number">13 </span><span class="name">Using Load Balancing as a Service with Orchestration Service</span></a></li><li class="inactive"><a href="HP2-0FWaaS.html"><span class="number">14 </span><span class="name">Using Firewall as a Service (FWaaS)</span></a></li><li class="inactive"><a href="UsingVPNaaS.html"><span class="number">15 </span><span class="name">Using VPN as a Service (VPNaaS)</span></a></li></ol></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 5. Installing the Command-Line Clients" href="install-cli.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Part II. Project User Guide" href="user-nonadmin.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #FABEBE;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Documentation"><span class="book-icon">Documentation</span></a><span> › </span><a class="crumb" href="book-user.html">User Guide</a><span> › </span><a class="crumb" href="user-cloudadmin.html">Cloud Admin User Guide</a><span> › </span><a class="crumb" href="CreateHARouter.html">Creating a Highly Available Router</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 5. Installing the Command-Line Clients" href="install-cli.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Part II. Project User Guide" href="user-nonadmin.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="CreateHARouter"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber "><span class="phrase"><span class="phrase">8</span></span></span></div><div><h2 class="title"><span class="number">6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating a Highly Available Router</span> <a title="Permalink" class="permalink" href="CreateHARouter.html#">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/networking-create_ha_router.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>networking-create_ha_router.xml</li><li><span class="ds-label">ID: </span>CreateHARouter</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="CreateHARouter.html#CVRDVR"><span class="number">6.1 </span><span class="name">CVR and DVR High Available Routers</span></a></span></dt><dt><span class="section"><a href="CreateHARouter.html#CreateRouter"><span class="number">6.2 </span><span class="name">Creating a High Availability Router</span></a></span></dt><dt><span class="section"><a href="CreateHARouter.html#TestRouter"><span class="number">6.3 </span><span class="name">Test Router for High Availability</span></a></span></dt></dl></div></div><div class="sect1" id="CVRDVR"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">CVR and DVR High Available Routers</span> <a title="Permalink" class="permalink" href="CreateHARouter.html#CVRDVR">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/networking-create_ha_router.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>networking-create_ha_router.xml</li><li><span class="ds-label">ID: </span>CVRDVR</li></ul></div></div></div></div><p>
   CVR (Centralized Virtual Routing) and DVR (Distributed Virtual Routing) are
   two types of technologies which can be used to provide routing processes in
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> <span class="phrase"><span class="phrase">8</span></span>. You can create Highly Available (HA) versions of CVR and
   DVR routers by using the options in the table below when creating your
   router.
  </p><p>
   The neutron command for creating a router <code class="literal">neutron router-create
   router_name --distributed=True|False --ha=True|False</code> requires
   administrative permissions. See the example in the next section, Creating a
   High Availability Router.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="center" class="c1" /><col align="center" class="c2" /><col align="center" class="c3" /><col align="left" class="c4" /></colgroup><thead><tr><th align="center">--distributed</th><th align="center">--ha</th><th align="center">Router Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="center">False</td><td align="center">False</td><td align="center">CVR</td><td align="left">Centralized Virtual Router</td></tr><tr><td align="center">False</td><td align="center">True</td><td align="center">CVRHA</td><td align="left">Centralized Virtual Router with L3 High Availablity</td></tr><tr><td align="center">True</td><td align="center">False</td><td align="center">DVR</td><td align="left">Distributed Virtual Router without SNAT High Availability</td></tr><tr><td align="center">True</td><td align="center">True</td><td align="center">DVRHA</td><td align="left">Distributed Virtual Router with SNAT High Availability</td></tr></tbody></table></div></div><div class="sect1" id="CreateRouter"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating a High Availability Router</span> <a title="Permalink" class="permalink" href="CreateHARouter.html#CreateRouter">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/networking-create_ha_router.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>networking-create_ha_router.xml</li><li><span class="ds-label">ID: </span>CreateRouter</li></ul></div></div></div></div><p>
   You can create a highly available router using the neutron command line
   interface.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     To create the HA router simply add <code class="literal">--ha=True</code> to the
     neutron router-create command. If you want to also make the router
     distributed, add <code class="literal">--distributed=True</code>. In this example, a
     DVR SNAT HA router is created with the name <code class="literal">routerHA</code>.
    </p><div class="verbatim-wrap"><pre class="screen">$ neutron router-create routerHA --distributed=True --ha=True</pre></div></li><li class="listitem "><p>
     Set the gateway for the external network and add interface
    </p><div class="verbatim-wrap"><pre class="screen">$ neutron router-gateway-set routerHA &lt;ext-net-id&gt;
$ neutron router-interface-add routerHA &lt;private_subnet_id&gt;</pre></div></li><li class="listitem "><p>
     Once the router is created, gateway set and interface attached, you now
     have a router with high availability.
    </p></li></ol></div></div><div class="sect1" id="TestRouter"><div class="titlepage"><div><div><h2 class="title"><span class="number">6.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Test Router for High Availability</span> <a title="Permalink" class="permalink" href="CreateHARouter.html#TestRouter">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/develop/xml/networking-create_ha_router.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>networking-create_ha_router.xml</li><li><span class="ds-label">ID: </span>TestRouter</li></ul></div></div></div></div><p>
   You can demonstrate that the router is HA by running a continuous ping from
   a VM instance that is running on the private network to an external server
   such as a public DNS. As the ping is running, list the l3 agents hosting the
   router and identify the agent that is responsible for hosting the active
   router. Induce the failover mechanism by creating a catastrophic event like
   shutting down node hosting the l3 agent. Once the node is shut down, you
   will see that the ping from the VM to the external network continues to run
   as the backup l3 agent takes over. To verify the agent hosting the primary
   router has changed, list the agents hosting the router. You will see a
   different agent is now hosting the active router.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Boot an instance on the private network
    </p><div class="verbatim-wrap"><pre class="screen">$ nova boot --image &lt;image_id&gt; --flavor &lt;flavor_id&gt; --nic net_id=&lt;private_net_id&gt; --key_name &lt;key&gt; VM1</pre></div></li><li class="listitem "><p>
     Log into the VM using the ssh keys
    </p><div class="verbatim-wrap"><pre class="screen">ssh -i &lt;key&gt; &lt;ipaddress of VM1&gt;</pre></div></li><li class="listitem "><p>
     Start a ping to X.X.X.X. While pinging, make sure there is no packet loss
     and leave the ping running.
    </p><div class="verbatim-wrap"><pre class="screen">$ ping X.X.X.X</pre></div></li><li class="listitem "><p>
     Check which agent is hosting the active router
    </p><div class="verbatim-wrap"><pre class="screen">$ neutron l3-agent-list-hosting-router &lt;router_id&gt;</pre></div></li><li class="listitem "><p>
     Shutdown the node hosting the agent.
    </p></li><li class="listitem "><p>
     Within 10 seconds, check again to see which L3 agent is hosting the active
     router
    </p><div class="verbatim-wrap"><pre class="screen">$ neutron l3-agent-list-hosting-router &lt;router_id&gt;</pre></div></li><li class="listitem "><p>
     You will see a different agent.
    </p></li></ol></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="user-nonadmin.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Part II </span>Project User Guide</span></a><a class="nav-link" href="install-cli.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 5 </span>Installing the Command-Line Clients</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2020 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>