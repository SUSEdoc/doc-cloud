<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SUSE OpenStack Cloud 9 | Security Guide | Transport Layer Security (TLS) Overview</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Transport Layer Security (TLS) Overview | SUSE OpenSta…"/>
<meta name="description" content="The Transport Layer Security (TLS) protocol, successor to SSL, provides the mechanisms to ensure authentication, non-repudiation, confidentiality, an…"/>
<meta name="product-name" content="SUSE OpenStack Cloud"/>
<meta name="product-number" content="9"/>
<meta name="book-title" content="Security Guide"/>
<meta name="chapter-title" content="Chapter 8. Transport Layer Security (TLS) Overview"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 9"/>
<meta property="og:title" content="Transport Layer Security (TLS) Overview | SUSE OpenSta…"/>
<meta property="og:description" content="The Transport Layer Security (TLS) protocol, successor to SSL, provides the mechanisms to ensure authentication, non-repudiation, confidentiality, an…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Transport Layer Security (TLS) Overview | SUSE OpenSta…"/>
<meta name="twitter:description" content="The Transport Layer Security (TLS) protocol, successor to SSL, provides the mechanisms to ensure authentication, non-repudiation, confidentiality, an…"/>
<link rel="prev" href="x509-certificate-auth.html" title="Chapter 7. Configuring keystone and horizon to use X.509 Client Certificates"/><link rel="next" href="header-poisoning.html" title="Chapter 9. Preventing Host Header Poisoning"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_overview.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Security Guide</a><span> / </span><a class="crumb" href="tls30overview.html">Transport Layer Security (TLS) Overview</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Security Guide</div><ol><li><a href="newsecurity.html" class=" "><span class="title-number">1 </span><span class="title-name"><span class="phrase"><span class="phrase">SUSE® <span class="productname">OpenStack</span> Cloud</span></span>: Security Planning and Features</span></a></li><li><a href="barbican.html" class=" "><span class="title-number">2 </span><span class="title-name">Key Management with the barbican Service</span></a></li><li><a href="barbicanAdmin.html" class=" "><span class="title-number">3 </span><span class="title-name">Key Management Service Administration</span></a></li><li><a href="roleSegregation.html" class=" "><span class="title-number">4 </span><span class="title-name">Service Admin Role Segregation in the Identity Service</span></a></li><li><a href="cha-security-rbac.html" class=" "><span class="title-number">5 </span><span class="title-name">Role-Based Access Control in neutron</span></a></li><li><a href="sg-logging.html" class=" "><span class="title-number">6 </span><span class="title-name">Enabling Network Security Group Logging</span></a></li><li><a href="x509-certificate-auth.html" class=" "><span class="title-number">7 </span><span class="title-name">Configuring keystone and horizon to use X.509 Client Certificates</span></a></li><li><a href="tls30overview.html" class=" you-are-here"><span class="title-number">8 </span><span class="title-name">Transport Layer Security (TLS) Overview</span></a></li><li><a href="header-poisoning.html" class=" "><span class="title-number">9 </span><span class="title-name">Preventing Host Header Poisoning</span></a></li><li><a href="password-encryption.html" class=" "><span class="title-number">10 </span><span class="title-name">Encryption of Passwords and Sensitive Data</span></a></li><li><a href="encryption-ephemeral.html" class=" "><span class="title-number">11 </span><span class="title-name">Encryption of Ephemeral Volumes</span></a></li><li><a href="topic-rmq-j1v-4t.html" class=" "><span class="title-number">12 </span><span class="title-name">Refining Access Control with AppArmor</span></a></li><li><a href="dar.html" class=" "><span class="title-number">13 </span><span class="title-name">Data at Rest Encryption</span></a></li><li><a href="glance-rate-limit.html" class=" "><span class="title-number">14 </span><span class="title-name">glance-API Rate Limit (CVE-2016-8611)</span></a></li><li><a href="idg-all-security-middleware-auditing-xml-1.html" class=" "><span class="title-number">15 </span><span class="title-name">Security Audit Logs</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="tls30overview" data-id-title="Transport Layer Security (TLS) Overview"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber">9</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">8 </span><span class="title-name">Transport Layer Security (TLS) Overview</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_overview.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The Transport Layer Security (TLS) protocol, successor to SSL, provides the
  mechanisms to ensure authentication, non-repudiation, confidentiality, and
  integrity of user communications to and between the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> services from
  internal and public endpoints.
 </p><p>
  OpenStack endpoints are HTTP (REST) services providing APIs to other
  OpenStack services on the management network. All traffic to OpenStack
  services coming in on the public endpoints and some traffic between services
  can be secured using TLS connections.
 </p><p>
  In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9, the following are enabled for TLS
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    API endpoints in the internal and admin VIPs can now be secured by TLS.
   </p></li><li class="listitem"><p>
    API endpoints can be provided with their own certificates (this is shown in
    the model examples) or they can simply use the default certificate.
   </p></li><li class="listitem"><p>
    The barbican key management service API can be secured by TLS from the load
    balancer to the service endpoint.
   </p></li><li class="listitem"><p>
    You can add multiple trust chains (certificate authority (CA)
    certificates).
   </p></li><li class="listitem"><p>
    Fully qualified domain names (FQDNs) can be used for public endpoints and
    now they can be changed. The external name in the input model files (in
    <code class="literal">~/openstack/my_cloud/definition/data/network_groups.yml</code>) is
    where the domain name is indicated and changed.
   </p></li><li class="listitem"><p>
    There are two monitoring alarms specific to certificates, 14-days to
    certificate expiration and 1-day to expiration.
   </p></li><li class="listitem"><p>
    TLS can be turned off/on for individual endpoints.
   </p></li></ul></div><section class="sect1" id="id-1.4.10.6" data-id-title="Comparing Clean Installation and Upgrade of SUSE OpenStack Cloud"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.1 </span><span class="title-name">Comparing Clean Installation and Upgrade of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.6">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_overview.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Clean install: all TLS-encrypted services are already listed under
   tls-components in <code class="literal">network_groups.yml</code>
  </p><p>
   You just have to:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Add your self-signed CA cert and server cert (for testing)
    </p></li><li class="listitem"><p>
     Or add your public (or company) CA-signed server cert and the public (or
     company) CA cert (for production)
    </p></li></ul></div><p>
   Upgrade: you do not have TLS enabled already on the internal endpoints so
   you need to
  </p><div class="itemizedlist" id="ul-j3y-k4t-vv"><ul class="itemizedlist"><li class="listitem"><p>
     Add your self-signed CA cert and server cert (for testing)
    </p></li><li class="listitem"><p>
     Or add your public (or company) CA-signed server cert and the public (or
     company) CA cert (for production)
    </p></li><li class="listitem"><p>
     Add all the services to tls-components in
     <code class="literal">network_groups.yml</code>
    </p></li></ul></div><p>
   For information on enabling and disabling TLS, see
   <a class="xref" href="tls30overview.html#idg-all-security-tls-config-xml-1" title="8.2. TLS Configuration">Section 8.2, “TLS Configuration”</a>.
  </p><p>
   For instructions on installing certificates, see
   <a class="xref" href="tls30overview.html#idg-all-security-tls-config-xml-1" title="8.2. TLS Configuration">Section 8.2, “TLS Configuration”</a>.
   
  </p></section><section class="sect1" id="idg-all-security-tls-config-xml-1" data-id-title="TLS Configuration"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.2 </span><span class="title-name">TLS Configuration</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#idg-all-security-tls-config-xml-1">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_config.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9, you can provide your own certificate authority and
  certificates for internal and public virtual IP addresses (VIPs), and you
  should do so for any production cloud. The certificates automatically
  generated by <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> are useful for testing and setup, but you should always
  install your own for production use. For further information, see <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 41 “Configuring Transport Layer Security (TLS)”</span>
 </p></section><section class="sect1" id="TLS-MySQL" data-id-title="Enabling TLS for MySQL Traffic"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.3 </span><span class="title-name">Enabling TLS for MySQL Traffic</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#TLS-MySQL">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_mysql.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  MySQL traffic can be encrypted using TLS. For completely new <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
  deployments using the supplied input model example files, you will have to
  uncomment the commented entries for
  <code class="literal">tls-component-endpoints:</code>. For upgrades from a previous
  version, you will have to add the entries to your input model files if you
  have not already done so. This topic explains how to do both.
 </p><section class="sect2" id="client" data-id-title="Enabling TLS on the database server for client access"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.3.1 </span><span class="title-name">Enabling TLS on the database server for client access</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#client">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_mysql.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure" id="start"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Edit <code class="literal">network_groups.yml</code> to either add mysql under
     tls-component-endpoints in your existing file from a previous version, or
     uncomment it if installing from scratch.
    </p><div class="verbatim-wrap"><pre class="screen">tls-component-endpoints:
  - mysql</pre></div></li><li class="step" id="deployReconfig"><p>
     After making the necessary changes, commit the changed file to git and run
     the config-processor-run and reconfigure Ansible playbooks:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "My changed config"
cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="&lt;encryption key&gt;" -e rekey=""
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible</pre></div></li><li class="step"><p>
     Next, either run <code class="filename">site.yml</code> if you are installing a
     new system:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts site.yml</pre></div></li><li class="step"><p>
     or ardana-reconfigure if you are reconfiguring an existing one:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div></li></ol></div></div></section><section class="sect2" id="id-1.4.10.8.4" data-id-title="MySQL replication over TLS"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.3.2 </span><span class="title-name">MySQL replication over TLS</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.8.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_mysql.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   MySQL replication over TLS is disabled. This is true even if you followed
   the instruction to turn on Mysql TLS in the previous section. Those steps
   turn on the service interactions to the database.
  </p><p>
   <span class="bold"><strong>Turning on MySQL replication over TLS</strong></span>
  </p><div id="id-1.4.10.8.4.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
    Using TLS connections for MySQL replication will incur a performance cost.
   </p></div><p>
   You should have already enabled TLS for MySQL client interactions in the
   previous section. If not, read <a class="xref" href="tls30overview.html#client" title="8.3.1. Enabling TLS on the database server for client access">Section 8.3.1, “Enabling TLS on the database server for client access”</a>.
  </p><p>
   TLS for MySQL replication is not turned on by default. Therefore, you will
   need to follow a manual process. Again, the steps are different for new
   systems and upgrades.
  </p></section><section class="sect2" id="replicationNew" data-id-title="Enabling TLS for MySQL replication on a new deployment"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.3.3 </span><span class="title-name">Enabling TLS for MySQL replication on a new deployment</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#replicationNew">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_mysql.xml" title="Edit source document"> </a></div></div></div></div></div><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Log in to the Cloud Lifecycle Manager node and before running the config
     processor, edit the
     <code class="literal">~/openstack/my_cloud/config/mariadb/defaults.yml</code> file.
    </p></li><li class="step"><p>
     Search for mysql_gcomms_bind_tls. You should find this section:
    </p><div class="verbatim-wrap"><pre class="screen"># TLS disabled for cluster
#mysql_gcomms_bind_tls: "{{ host.bind['FND_MDB'].mysql_gcomms.tls }}"
mysql_gcomms_bind_tls: False</pre></div></li><li class="step"><p>
     Uncomment the appropriate line so the file looks like this:
    </p><div class="verbatim-wrap"><pre class="screen"># TLS enabled for cluster
mysql_gcomms_bind_tls: "{{ host.bind['FND_MDB'].mysql_gcomms.tls }}"
#mysql_gcomms_bind_tls: False</pre></div></li><li class="step"><p>
     Follow the steps to deploy or reconfigure your cloud:
     <a class="xref" href="tls30overview.html#deployReconfig" title="Step 2">Step 2</a> in <a class="xref" href="tls30overview.html#client" title="8.3.1. Enabling TLS on the database server for client access">Section 8.3.1, “Enabling TLS on the database server for client access”</a>.
    </p></li></ol></div></div></section><section class="sect2" id="id-1.4.10.8.6" data-id-title="Enabling TLS for MySQL replication on an existing system"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.3.4 </span><span class="title-name">Enabling TLS for MySQL replication on an existing system</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.8.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_mysql.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   If your cluster is already up, perform these steps to enable MySQL
   replication over TLS:
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Edit the following two files:
     <code class="literal">~/openstack/my_cloud/config/mariadb/defaults.yml</code> and
     <code class="literal">~/scratch/ansible/next/ardana/ansible/roles/FND-MDB/defaults/main.yml</code>.
     Note that these files are identical. The first is a master file and the
     second is a scratch version that is used for the current deployment. Make
     the same changes as explained in <a class="xref" href="tls30overview.html#replicationNew" title="8.3.3. Enabling TLS for MySQL replication on a new deployment">Section 8.3.3, “Enabling TLS for MySQL replication on a new deployment”</a>.
    </p></li><li class="step"><p>
     Then run the following command:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts tls-percona-reconfigure.yml</pre></div><p>
     After this your MySQL should come up and replicate over TLS. You need to
     follow this section again if you ever want to switch TLS off for MySQL
     replication. You also must repeat these steps if any lifecycle operation
     changes the mysql_gcomms_bind_tls option.
    </p></li></ol></div></div></section><section class="sect2" id="id-1.4.10.8.7" data-id-title="Testing whether a service is using TLS"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.3.5 </span><span class="title-name">Testing whether a service is using TLS</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.8.7">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_mysql.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Almost all services that have a database are able to communicate over TLS.
   You can test whether a service, in this example the Identity service
   (keystone), is communicating with MySQL over TLS by executing the following
   steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Log into a node member of the database cluster, change to the root user
     (such as by using <code class="command">sudo -i</code>) and run the mysql command.
    </p><div class="verbatim-wrap"><pre class="screen">root@&lt;server&gt;:~# mysql</pre></div><p>
     Type 'help;' or '\h' for help. Type '\c' to clear the current input
     statement.
    </p></li><li class="listitem"><p>
     Run:
    </p><div class="verbatim-wrap"><pre class="screen">mysql&gt; select * from information_schema.user_statistics where user='keystone'\G</pre></div></li><li class="listitem"><p>
     Note the results. TOTAL_SSL_CONNECTIONS should not be zero:
    </p><div class="verbatim-wrap"><pre class="screen">*************************** 1. row ***************************
                  USER: keystone
     TOTAL_CONNECTIONS: 316
CONCURRENT_CONNECTIONS: 0
        CONNECTED_TIME: 905790
             BUSY_TIME: 205
              CPU_TIME: 141
        BYTES_RECEIVED: 197137617
            BYTES_SENT: 801964
  BINLOG_BYTES_WRITTEN: 0
          ROWS_FETCHED: 972421
          ROWS_UPDATED: 6893
       TABLE_ROWS_READ: 1025866
       SELECT_COMMANDS: 660209
       UPDATE_COMMANDS: 3039
        OTHER_COMMANDS: 299746
   COMMIT_TRANSACTIONS: 0
 ROLLBACK_TRANSACTIONS: 295200
    DENIED_CONNECTIONS: 0
      LOST_CONNECTIONS: 83
         ACCESS_DENIED: 0
         EMPTY_QUERIES: 71778
 TOTAL_SSL_CONNECTIONS: 298
1 row in set (0.00 sec)

mysql&gt;</pre></div></li></ol></div></section></section><section class="sect1" id="TLS-RabbitMQ" data-id-title="Enabling TLS for RabbitMQ Traffic"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.4 </span><span class="title-name">Enabling TLS for RabbitMQ Traffic</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#TLS-RabbitMQ">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_rabbit_mq.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  RabbitMQ traffic can be encrypted using TLS. To enable it, you will have to
  add entries for <code class="literal">tls-component-endpoints:</code> in your input
  model files if you have not already done so. This topic explains how.
 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Edit <code class="literal">openstack/my_cloud/definition/data/network_groups.yml</code>,
    adding <code class="literal">rabbitmq</code> to the
    <code class="literal">tls-component-endpoints</code> section:
   </p><div class="verbatim-wrap"><pre class="screen">tls-component-endpoints:
     - barbican-api
     - mysql
     - rabbitmq</pre></div></li><li class="listitem"><p>
    Commit the changes:
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "My changed config"</pre></div></li><li class="listitem"><p>
    Then run the typical deployment steps:
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml -e encrypt="&lt;encryption key&gt;" -e rekey=""
ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
    Change directories:
   </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible</pre></div></li><li class="listitem"><p>
    Then for a fresh TLS install run:
   </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts site.yml</pre></div></li><li class="listitem"><p>
    Or, to reconfigure an existing system run:
   </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div></li></ol></div><section class="sect2" id="id-1.4.10.9.4" data-id-title="Testing"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.4.1 </span><span class="title-name">Testing</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.9.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-tls_rabbit_mq.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   On the one of the rabbitmq nodes you can list the clients and their TLS
   status by running:
  </p><div class="verbatim-wrap"><pre class="screen">$ sudo rabbitmqctl -q list_connections ssl state ssl_protocol user name</pre></div><p>
   You will see output like this where true indicates the client is using TLS
   for the connection, and false, as shown here, indicates the connection is
   over TCP:
  </p><div class="verbatim-wrap"><pre class="screen">Listing connections ...

rmq_barbican_user       false</pre></div><p>
   Other indicators will be <code class="literal">rabbit_use_ssl = True</code> in the
   Oslo messaging section of client configurations. The list of clients that
   support TLS are as follows:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     barbican
    </p></li><li class="listitem"><p>
     cinder
    </p></li><li class="listitem"><p>
     designate
    </p></li><li class="listitem"><p>
     Eon
    </p></li><li class="listitem"><p>
     glance
    </p></li><li class="listitem"><p>
     heat
    </p></li><li class="listitem"><p>
     ironic
    </p></li><li class="listitem"><p>
     keystone
    </p></li><li class="listitem"><p>
     monasca
    </p></li><li class="listitem"><p>
     neutron
    </p></li><li class="listitem"><p>
     nova
    </p></li><li class="listitem"><p>
     Octavia
    </p></li></ul></div></section></section><section class="sect1" id="troubleshootng-tls" data-id-title="Troubleshooting TLS"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">8.5 </span><span class="title-name">Troubleshooting TLS</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#troubleshootng-tls">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-troubleshooting_tls.xml" title="Edit source document"> </a></div></div></div></div></div><section class="sect2" id="id-1.4.10.10.2" data-id-title="Troubleshooting TLS certificate errors when running playbooks with a limit"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.5.1 </span><span class="title-name">Troubleshooting TLS certificate errors when running playbooks with a limit</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.10.2">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-troubleshooting_tls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Has the deployer been restarted after the original site installation or is
   this a new deployer? If so, TLS certificates need to be bootstrapped before
   a playbook is run with limits. You can do this by running the following
   command.
  </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml --limit TLS-CA</pre></div></section><section class="sect2" id="id-1.4.10.10.3" data-id-title="Certificate Update Failure"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.5.2 </span><span class="title-name">Certificate Update Failure</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.10.3">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-troubleshooting_tls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   In general, if a certificate update fails, it is because of the following:
   Haproxy has not restarted or the Trust chain is not installed. This is the
   certificate of the CA that signed the server certificate.
  </p></section><section class="sect2" id="id-1.4.10.10.4" data-id-title="Troubleshooting trust chain installation"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.5.3 </span><span class="title-name">Troubleshooting trust chain installation</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.10.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-troubleshooting_tls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   It is important to note that while <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 allows you to add new
   trust chains, it would be better if you add all the required trust chains
   during the initial deploy. Trust chain changes can impact services.
  </p><p>
   However, this does not apply to certificates. There is a certificate-related
   issue whereby haproxy is not restarted if certificate content has been
   changed but the certificate file name remained the same. If you are having
   issues and you have replaced the content of existing CA file with new
   content, create another CA file with a new name. Also make sure the CA file
   has a .crt extension.
  </p><p>
   Do not update both certificate and the CA together. Add the CA first and
   then run a site deploy. Then update the certificate and run tls-reconfigure,
   FND-CLU-stop, FND-CLU-start and then ardana-reconfigure. If you know which
   playbook failed, rerun it with -vv to get detaled error information. The
   configure, HAproxy restart, and reconfigure steps are included in
   <a class="xref" href="tls30overview.html#idg-all-security-tls-config-xml-1" title="8.2. TLS Configuration">Section 8.2, “TLS Configuration”</a>.
  </p><p>
   You can run the following commands to see if client libraries see the CA
   you have added:
  </p><div class="verbatim-wrap"><pre class="screen">~/scratch/ansible/next/ardana/ansible$ ansible -i hosts/verb_hosts FND-STN -a 'sudo keytool -list -alias \
    debian:username-internal-cacert-001.pem -keystore /usr/lib/jvm/java-7-openjdk-amd64/jre/lib/security/cacerts -storepass changeit'
  padawan-ccp-c0-m1-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-comp0001-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-comp0003-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-comp0002-mgmt | FAILED | rc=1 &gt;&gt;
  sudo: keytool: command not found

  padawan-ccp-c1-m1-mgmt | success | rc=0 &gt;&gt;
  debian:username-internal-cacert-001.pem, May 9, 2016, trustedCertEntry,
  Certificate fingerprint (SHA1): E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43

  padawan-ccp-c1-m2-mgmt | success | rc=0 &gt;&gt;
  debian:username-internal-cacert-001.pem, May 9, 2016, trustedCertEntry,
  Certificate fingerprint (SHA1): E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43

  padawan-ccp-c1-m3-mgmt | success | rc=0 &gt;&gt;
  debian:username-internal-cacert-001.pem, May 9, 2016, trustedCertEntry,
  Certificate fingerprint (SHA1): E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43</pre></div><p>
   Java client libraries are used by monasca, so compute nodes will not have
   them. So the first three errors are expected. Check that the fingerprint is
   correct by checking the CA:
  </p><div class="verbatim-wrap"><pre class="screen">~/scratch/d002-certs/t002$ openssl x509 -in example-CA.crt -noout -fingerprint
  SHA1 Fingerprint=E7:B2:6E:9E:00:FB:86:0F:E5:46:CD:B8:C5:67:13:53:4E:3D:8F:43</pre></div><p>
   If they do not match, there likely was a name collision. Add the CA cert again
   with a new file name. If you get monasca errors but find that the
   fingerprints match, try stopping and restarting monasca.
  </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts monasca-stop.yml
ansible-playbook -i hosts/verb_hosts monasca-start.yml</pre></div></section><section class="sect2" id="id-1.4.10.10.5" data-id-title="Expired TLS Certificates"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.5.4 </span><span class="title-name">Expired TLS Certificates</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.10.5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-troubleshooting_tls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Use the following steps to re-create expired TLS certificates for MySQL
   Percona clusters.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
      Determine if the TLS certificates for MySQL / Percsona have expired.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd /etc/mysql/
<code class="prompt user">ardana &gt; </code>openssl x509 -noout -enddate -in control-plane-1-mysql-internal-cert.pem</pre></div></li><li class="step"><p>
     Regenerate the TLS certificates on the deployer.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/hos/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml --limit DEPLOYER_HOST</pre></div></li><li class="step"><p>
     Distribute the regenerated TLS certificates to the MySQL Percona clusters.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/hos/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts --extra-vars "mysql_certs_needs_regeneration=true" tls-percona-reconfigure.yml</pre></div></li><li class="step"><p>
     Verify Percona cluster status on a controller node
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>sudo mysql -e 'show status'</pre></div></li></ol></div></div><p>
   Use the following steps to re-create expired TLS certificates for RabbitMQ.
  </p><div class="procedure"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step"><p>
     Determine if SSL certificate for RabbitMQ is expired
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root # </code>cd /etc/rabbitmq
<code class="prompt user">root # </code>openssl x509 -noout -text -in control-plane-1-rabbitmq.pem | grep After
Not After : Nov 6 15:15:38 2018 GMT</pre></div></li><li class="step"><p>
     Regenerate the TLS certificates on the deployer.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/hos/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts tls-reconfigure.yml --limit DEPLOYER_HOST</pre></div></li><li class="step"><p>
     Reconfigure RabbitMQ. Certificate will be re-created if the input model is
     correct.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts --extra-vars "rabbitmq_tls_certs_force_regeneration=true" rabbitmq-reconfigure.yml</pre></div></li></ol></div></div></section><section class="sect2" id="id-1.4.10.10.6" data-id-title="Troubleshooting certificates"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">8.5.5 </span><span class="title-name">Troubleshooting certificates</span></span> <a title="Permalink" class="permalink" href="tls30overview.html#id-1.4.10.10.6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/security-troubleshooting_tls.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Certificates can fail in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 due to the following.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Trust chain issue. This is dealt with in the previous section
    </p></li><li class="listitem"><p>
     Wrong certificate: Compare the fingerprints. If they differ, then you have
     a wrong certificate somewhere.
    </p></li><li class="listitem"><p>
     Date range of the certificate is either in the future or expired: Check
     the dates and change certificates as necessary, observing the naming
     cautions above.
    </p></li><li class="listitem"><p>
     TLS handshake fails because the client does not support the ciphers the
     server offers. It is possible that you reused a certificate created for a
     different network model. Make sure the request file found under
     <code class="filename">info/cert_req/</code> are used to create the certificate.
     If not, the service VIP
     names may not match.
    </p></li></ul></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="x509-certificate-auth.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 7 </span>Configuring keystone and horizon to use X.509 Client Certificates</span></a> </div><div><a class="pagination-link next" href="header-poisoning.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 9 </span>Preventing Host Header Poisoning</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="tls30overview.html#id-1.4.10.6"><span class="title-number">8.1 </span><span class="title-name">Comparing Clean Installation and Upgrade of <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span></a></span></li><li><span class="section"><a href="tls30overview.html#idg-all-security-tls-config-xml-1"><span class="title-number">8.2 </span><span class="title-name">TLS Configuration</span></a></span></li><li><span class="section"><a href="tls30overview.html#TLS-MySQL"><span class="title-number">8.3 </span><span class="title-name">Enabling TLS for MySQL Traffic</span></a></span></li><li><span class="section"><a href="tls30overview.html#TLS-RabbitMQ"><span class="title-number">8.4 </span><span class="title-name">Enabling TLS for RabbitMQ Traffic</span></a></span></li><li><span class="section"><a href="tls30overview.html#troubleshootng-tls"><span class="title-number">8.5 </span><span class="title-name">Troubleshooting TLS</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>