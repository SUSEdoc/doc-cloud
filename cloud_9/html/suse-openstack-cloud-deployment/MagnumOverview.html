<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Magnum Overview | Deployment Guide using Cloud Lifecycle Manager | SUSE OpenStack Cloud 9</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.2.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.81.0 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE OpenStack Cloud" /><meta name="product-number" content="9" /><meta name="book-title" content="Deployment Guide using Cloud Lifecycle Manager" /><meta name="chapter-title" content="Chapter 26. Magnum Overview" /><meta name="description" content="The SUSE OpenStack Cloud Magnum Service provides container orchestration engines such as Docker Swarm, Kubernetes, and Apache Mesos available as first class resources. SUSE OpenStack Cloud Magnum uses heat to orchestrate an OS image which contains Docker and Kubernetes and runs that image in either …" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 9" /><link rel="home" href="index.html" title="Documentation" /><link rel="up" href="cloudinstallation.html" title="Part IV. Cloud Installation" /><link rel="prev" href="DesignateInstallOverview.html" title="Chapter 25. DNS Service Installation Overview" /><link rel="next" href="install-esx-ovsvapp.html" title="Chapter 27. Installing ESX Computes and OVSvAPP" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #E11;"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Documentation"><span class="book-icon">Documentation</span></a><span> › </span><a class="crumb" href="book-deployment.html">Deployment Guide using Cloud Lifecycle Manager</a><span> › </span><a class="crumb" href="cloudinstallation.html">Cloud Installation</a><span> › </span><a class="crumb" href="MagnumOverview.html">Magnum Overview</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Deployment Guide using Cloud Lifecycle Manager</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="planning-index.html"><span class="number">I </span><span class="name">Planning an Installation using Cloud Lifecycle Manager</span></a><ol><li class="inactive"><a href="register-suse-overview.html"><span class="number">1 </span><span class="name">Registering SLES</span></a></li><li class="inactive"><a href="min-hardware.html"><span class="number">2 </span><span class="name">Hardware and Software Support Matrix</span></a></li><li class="inactive"><a href="idg-planning-planning-recommended-hardware-minimums-xml-1.html"><span class="number">3 </span><span class="name">Recommended Hardware Minimums for the Example Configurations</span></a></li><li class="inactive"><a href="HP3-0HA.html"><span class="number">4 </span><span class="name">High Availability</span></a></li></ol></li><li class="inactive"><a href="architecture.html"><span class="number">II </span><span class="name">Cloud Lifecycle Manager Overview</span></a><ol><li class="inactive"><a href="cha-input-model-intro-concept.html"><span class="number">5 </span><span class="name">Input Model</span></a></li><li class="inactive"><a href="configurationobjects.html"><span class="number">6 </span><span class="name">Configuration Objects</span></a></li><li class="inactive"><a href="othertopics.html"><span class="number">7 </span><span class="name">Other Topics</span></a></li><li class="inactive"><a href="cpinfofiles.html"><span class="number">8 </span><span class="name">Configuration Processor Information Files</span></a></li><li class="inactive"><a href="example-configurations.html"><span class="number">9 </span><span class="name">Example Configurations</span></a></li><li class="inactive"><a href="modify-compute-input-model.html"><span class="number">10 </span><span class="name">Modifying Example Configurations for Compute Nodes</span></a></li><li class="inactive"><a href="modify-input-model.html"><span class="number">11 </span><span class="name">Modifying Example Configurations for Object Storage using Swift</span></a></li><li class="inactive"><a href="alternative-configurations.html"><span class="number">12 </span><span class="name">Alternative Configurations</span></a></li></ol></li><li class="inactive"><a href="preinstall.html"><span class="number">III </span><span class="name">Pre-Installation</span></a><ol><li class="inactive"><a href="preinstall-overview.html"><span class="number">13 </span><span class="name">Overview</span></a></li><li class="inactive"><a href="preinstall-checklist.html"><span class="number">14 </span><span class="name">Pre-Installation Checklist</span></a></li><li class="inactive"><a href="cha-depl-dep-inst.html"><span class="number">15 </span><span class="name">Installing the Cloud Lifecycle Manager server</span></a></li><li class="inactive"><a href="app-deploy-smt-lcm.html"><span class="number">16 </span><span class="name">Installing and Setting Up an SMT Server on the Cloud Lifecycle Manager server (Optional)</span></a></li><li class="inactive"><a href="cha-depl-repo-conf-lcm.html"><span class="number">17 </span><span class="name">Software Repository Setup</span></a></li><li class="inactive"><a href="multipath-boot-from-san.html"><span class="number">18 </span><span class="name">Boot from SAN and Multipath Configuration</span></a></li></ol></li><li class="inactive"><a href="cloudinstallation.html"><span class="number">IV </span><span class="name">Cloud Installation</span></a><ol><li class="inactive"><a href="cloudinstallation-overview.html"><span class="number">19 </span><span class="name">Overview</span></a></li><li class="inactive"><a href="preparing-standalone.html"><span class="number">20 </span><span class="name">Preparing for Stand-Alone Deployment</span></a></li><li class="inactive"><a href="install-gui.html"><span class="number">21 </span><span class="name">Installing with the Install UI</span></a></li><li class="inactive"><a href="using-git.html"><span class="number">22 </span><span class="name">Using Git for Configuration Management</span></a></li><li class="inactive"><a href="install-standalone.html"><span class="number">23 </span><span class="name">Installing a Stand-Alone Cloud Lifecycle Manager</span></a></li><li class="inactive"><a href="install-kvm.html"><span class="number">24 </span><span class="name">Installing Mid-scale and Entry-scale KVM</span></a></li><li class="inactive"><a href="DesignateInstallOverview.html"><span class="number">25 </span><span class="name">DNS Service Installation Overview</span></a></li><li class="inactive"><a href="MagnumOverview.html"><span class="number">26 </span><span class="name">Magnum Overview</span></a></li><li class="inactive"><a href="install-esx-ovsvapp.html"><span class="number">27 </span><span class="name">Installing ESX Computes and OVSvAPP</span></a></li><li class="inactive"><a href="integrate-nsx-vsphere.html"><span class="number">28 </span><span class="name">Integrating NSX for vSphere</span></a></li><li class="inactive"><a href="install-ironic-overview.html"><span class="number">29 </span><span class="name">Installing Baremetal (Ironic)</span></a></li><li class="inactive"><a href="install-swift.html"><span class="number">30 </span><span class="name">Installation for <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Entry-scale Cloud with Swift Only</span></a></li><li class="inactive"><a href="install-sles-compute.html"><span class="number">31 </span><span class="name">Installing SLES Compute</span></a></li><li class="inactive"><a href="install-ardana-manila.html"><span class="number">32 </span><span class="name">Installing manila and Creating manila Shares</span></a></li><li class="inactive"><a href="install-heat-templates.html"><span class="number">33 </span><span class="name">Installing SUSE CaaS Platform heat Templates</span></a></li><li class="inactive"><a href="install-caasp-terraform.html"><span class="number">34 </span><span class="name">Installing SUSE CaaS Platform v4 using terraform</span></a></li><li class="inactive"><a href="integrations.html"><span class="number">35 </span><span class="name">Integrations</span></a></li><li class="inactive"><a href="troubleshooting-installation.html"><span class="number">36 </span><span class="name">Troubleshooting the Installation</span></a></li><li class="inactive"><a href="esx-troubleshooting-installation.html"><span class="number">37 </span><span class="name">Troubleshooting the ESX</span></a></li></ol></li><li class="inactive"><a href="post-install.html"><span class="number">V </span><span class="name">Post-Installation</span></a><ol><li class="inactive"><a href="cloud-verification.html"><span class="number">38 </span><span class="name">Post Installation Tasks</span></a></li><li class="inactive"><a href="ui-verification.html"><span class="number">39 </span><span class="name">UI Verification</span></a></li><li class="inactive"><a href="install-openstack-clients.html"><span class="number">40 </span><span class="name">Installing OpenStack Clients</span></a></li><li class="inactive"><a href="tls30.html"><span class="number">41 </span><span class="name">Configuring Transport Layer Security (TLS)</span></a></li><li class="inactive"><a href="config-availability-zones.html"><span class="number">42 </span><span class="name">Configuring Availability Zones</span></a></li><li class="inactive"><a href="OctaviaInstall.html"><span class="number">43 </span><span class="name">Configuring Load Balancer as a Service</span></a></li><li class="inactive"><a href="postinstall-checklist.html"><span class="number">44 </span><span class="name">Other Common Post-Installation Tasks</span></a></li></ol></li><li class="inactive"><a href="cha-inst-trouble.html"><span class="number">VI </span><span class="name">Support</span></a><ol><li class="inactive"><a href="sec-depl-trouble-faq.html"><span class="number">45 </span><span class="name">FAQ</span></a></li><li class="inactive"><a href="sec-installation-trouble-support.html"><span class="number">46 </span><span class="name">Support</span></a></li><li class="inactive"><a href="inst-support-ptf.html"><span class="number">47 </span><span class="name">
    Applying PTFs (Program Temporary Fixes) Provided by SUSE L3 Support
   </span></a></li><li class="inactive"><a href="inst-support-ptf-test.html"><span class="number">48 </span><span class="name">
    Testing PTFs (Program Temporary Fixes) on a Single Node
   </span></a></li></ol></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 25. DNS Service Installation Overview" href="DesignateInstallOverview.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 27. Installing ESX Computes and OVSvAPP" href="install-esx-ovsvapp.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #E11;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Documentation"><span class="book-icon">Documentation</span></a><span> › </span><a class="crumb" href="book-deployment.html">Deployment Guide using Cloud Lifecycle Manager</a><span> › </span><a class="crumb" href="cloudinstallation.html">Cloud Installation</a><span> › </span><a class="crumb" href="MagnumOverview.html">Magnum Overview</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 25. DNS Service Installation Overview" href="DesignateInstallOverview.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 27. Installing ESX Computes and OVSvAPP" href="install-esx-ovsvapp.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="MagnumOverview"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber ">9</span></div><div><h2 class="title"><span class="number">26 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Magnum Overview</span> <a title="Permalink" class="permalink" href="MagnumOverview.html#">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/installation-installation-magnum-magnum_overview.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>installation-installation-magnum-magnum_overview.xml</li><li><span class="ds-label">ID: </span>MagnumOverview</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="MagnumOverview.html#MagnumArchitecture"><span class="number">26.1 </span><span class="name">Magnum Architecture</span></a></span></dt><dt><span class="section"><a href="MagnumOverview.html#MagnumInstall"><span class="number">26.2 </span><span class="name">Install the Magnum Service</span></a></span></dt><dt><span class="section"><a href="MagnumOverview.html#MagnumIntegrateDNS"><span class="number">26.3 </span><span class="name">Integrate Magnum with the DNS Service</span></a></span></dt></dl></div></div><p>
  The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Magnum Service provides container orchestration engines such as
  Docker Swarm, Kubernetes, and Apache Mesos available as first class
  resources. <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Magnum uses heat to orchestrate an OS image which
  contains Docker and Kubernetes and runs that image in either virtual machines
  or bare metal in a cluster configuration.
 </p><div class="sect1" id="MagnumArchitecture"><div class="titlepage"><div><div><h2 class="title"><span class="number">26.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Magnum Architecture</span> <a title="Permalink" class="permalink" href="MagnumOverview.html#MagnumArchitecture">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/installation-installation-magnum-magnum_architecture.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>installation-installation-magnum-magnum_architecture.xml</li><li><span class="ds-label">ID: </span>MagnumArchitecture</li></ul></div></div></div></div><p>
  As an OpenStack API service, Magnum provides Container as a Service (CaaS)
  functionality. Magnum is capable of working with container orchestration
  engines (COE) such as Kubernetes, Docker Swarm, and Apache Mesos. Some
  operations work with a User CRUD (Create, Read, Update, Delete) filter.
 </p><p>
  <span class="bold"><strong>Components</strong></span>
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    <span class="bold"><strong>Magnum API</strong></span>: RESTful API for cluster and
    cluster template operations.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Magnum Conductor</strong></span>: Performs operations on
    clusters requested by Magnum API in an asynchronous manner.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Magnum CLI</strong></span>: Command-line interface to the
    Magnum API.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Etcd (planned, currently using public
    service)</strong></span>: Remote key/value storage for distributed cluster
    bootstrap and discovery.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Kubemaster (in case of Kubernetes COE)</strong></span>:
    One or more VM(s) or baremetal server(s), representing a control plane for
    Kubernetes cluster.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Kubeminion (in case of Kubernetes COE)</strong></span>:
    One or more VM(s) or baremetal server(s), representing a workload node for
    Kubernetes cluster.
   </p></li></ul></div><div class="table" id="table-ebc-x5v-jz"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 26.1: </span><span class="name">Data </span><a title="Permalink" class="permalink" href="MagnumOverview.html#table-ebc-x5v-jz">#</a></h6></div><div class="table-contents"><table class="table" summary="Data" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /><col class="c5" /><col class="c6" /></colgroup><thead><tr><th>Data Name</th><th>Confidentiality</th><th>Integrity</th><th>Availability</th><th>Backup?</th><th>Description</th></tr></thead><tbody><tr><td>Session Tokens</td><td>Confidential</td><td>High</td><td>Medium</td><td>No</td><td>Session tokens not stored.</td></tr><tr><td>System Request</td><td>Confidential</td><td>High</td><td>Medium</td><td>No</td><td>Data in motion or in MQ not stored.</td></tr><tr><td>MariaDB Database "Magnum"</td><td>Confidential</td><td>High</td><td>High</td><td>Yes</td><td>Contains user preferences. Backed up to swift daily.</td></tr><tr><td>etcd data</td><td>Confidential</td><td>High</td><td>Low</td><td>No</td><td>Kubemaster IPs and cluster info. Only used during cluster bootstrap.</td></tr></tbody></table></div></div><div class="figure" id="magnum-service-arch-diagram"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/media-magnum-magnum_service_arch_diagram.png" target="_blank"><img src="images/media-magnum-magnum_service_arch_diagram.png" width="" alt="Service Architecture Diagram for Kubernetes" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 26.1: </span><span class="name">Service Architecture Diagram for Kubernetes </span><a title="Permalink" class="permalink" href="MagnumOverview.html#magnum-service-arch-diagram">#</a></h6></div></div><div class="table" id="table-fst-gxv-jz"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 26.2: </span><span class="name">Interfaces </span><a title="Permalink" class="permalink" href="MagnumOverview.html#table-fst-gxv-jz">#</a></h6></div><div class="table-contents"><table class="table" summary="Interfaces" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /><col class="c5" /></colgroup><thead><tr><th>Interface</th><th>Network</th><th>Request</th><th>Response</th><th>Operation Description</th></tr></thead><tbody><tr><td>1</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Manage clusters
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> User
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Manage objects that
       belong to current project
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Magnum API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       CRUD operations on cluster templates and clusters
      </p>
     </td></tr><tr><td>2a</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> AMQP over HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Enqueue messages
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Magnum API
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> RabbitMQ username,
       password
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> RabbitMQ queue
       read/write operations
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> RabbitMQ
      </p>
     </td><td>
      <p>
       Operation status
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Notifications issued when cluster CRUD operations requested
      </p>
     </td></tr><tr><td>2b</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> AMQP over HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Read queued messages
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Magnum Conductor
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> RabbitMQ username,
       password
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> RabbitMQ queue
       read/write operations
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> RabbitMQ
      </p>
     </td><td>
      <p>
       Operation status
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Notifications issued when cluster CRUD operations requested
      </p>
     </td></tr><tr><td>3</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> MariaDB over HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Persist data in MariaDB
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Magnum Conductor
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> MariaDB username,
       password
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Magnum database
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> MariaDB
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Persist cluster/cluster template data, read persisted data
      </p>
     </td></tr><tr><td>4</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Create per-cluster user in
       dedicated domain, no role assignments initially
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Magnum Conductor
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Trustee domain admin
       username, password
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Manage users in
       dedicated Magnum domain
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> keystone
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Magnum generates user record in a dedicated keystone domain for each
       cluster
      </p>
     </td></tr><tr><td>5</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Create per-cluster user stack
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Magnum Conductor
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> heat
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Magnum creates heat stack for each cluster
      </p>
     </td></tr><tr><td>6</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External Network
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Bootstrap a cluster in public
       discovery <a class="link" href="https://discovery.etcd.io/" target="_blank">https://discovery.etcd.io/</a>
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Magnum Conductor
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Unguessable URL over
       HTTPS. URL is only available to software processes needing it.
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Read and update
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Public discovery service
      </p>
     </td><td>
      <p>
       Cluster discovery URL
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Create key/value registry of specified size in public storage. This is
       used to stand up a cluster of kubernetes master nodes (refer to
       interface call #12).
      </p>
     </td></tr><tr><td>7</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Create cinder volumes
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> heat Engine
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> cinder API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       heat creates cinder volumes as part of stack.
      </p>
     </td></tr><tr><td>8</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Create networks, routers, load
       balancers
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> heat Engine
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> neutron API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       heat creates networks, routers, load balancers as part of the stack.
      </p>
     </td></tr><tr><td>9</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Create nova VMs, attach
       volumes
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> heat Engine
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> nova API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       heat creates nova VMs as part of the stack.
      </p>
     </td></tr><tr><td>10</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Internal-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Read pre-configured glance
       image
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> nova
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> glance API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       nova uses pre-configured image in glance to bootstrap VMs.
      </p>
     </td></tr><tr><td>11a</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> heat notification
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Cluster member (VM or ironic
       node)
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> heat API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       heat uses OS::heat::WaitCondition resource. VM is expected to call heat
       notification URL upon completion of certain bootstrap operation.
      </p>
     </td></tr><tr><td>11b</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> heat notification
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Cluster member (VM or ironic
       node)
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> keystone token
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Limited to scope of
       authorized user
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> heat API
      </p>
     </td><td>
      <p>
       Operation status with or without data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       heat uses OS::heat::WaitCondition resource. VM is expected to call heat
       notification URL upon completion of certain bootstrap operation.
      </p>
     </td></tr><tr><td>12</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External-API
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Update cluster member state in
       a public registry at https://discovery.etcd.io
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Cluster member (VM or ironic
       node)
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Unguessable URL over HTTPS
       only available to software processes needing it.
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Read and update
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Public discovery service
      </p>
     </td><td>
      <p>
       Operation status
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Update key/value pair in a registry created by interface call #6.
      </p>
     </td></tr><tr><td>13a</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> VxLAN encapsulated private
       network on the Guest network
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Various communications inside
       Kubernetes cluster
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Cluster member (VM or ironic
       node)
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Cluster member (VM or ironic
       node)
      </p>
     </td><td>
      <p>
       Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Various calls performed to build Kubernetes clusters, deploy
       applications and put workload
      </p>
     </td></tr><tr><td>13b</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> VxLAN encapsulated private
       network on the Guest network
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Various communications inside
       Kubernetes cluster
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Cluster member (VM or ironic
       node)
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Cluster member (VM or ironic
       node)
      </p>
     </td><td>
      <p>
       Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Various calls performed to build Kubernetes clusters, deploy
       applications and put workload
      </p>
     </td></tr><tr><td>14</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Guest/External
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Download container images
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Cluster member (VM or ironic
       node)
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> None
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> None
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> External
      </p>
     </td><td>
      <p>
       Container image data
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> TLS certificate
      </p>
     </td><td>
      <p>
       Kubernetes makes calls to external repositories to download pre-packed
       container images
      </p>
     </td></tr><tr><td>15a</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External/EXT_VM (Floating IP)
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Octavia load balancer
      </p>
     </td><td>
      <p>
       Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
     </td><td>
      <p>
       External workload handled by container applications
      </p>
     </td></tr><tr><td>15b</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> Guest
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Cluster member (VM or ironic
       node)
      </p>
     </td><td>
      <p>
       Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
     </td><td>
      <p>
       External workload handled by container applications
      </p>
     </td></tr><tr><td>15c</td><td>
      <p>
       <span class="bold"><strong>Name:</strong></span> External/EXT_VM (Floating IP)
      </p>
      <p>
       <span class="bold"><strong>Protocol:</strong></span> HTTPS
      </p>
     </td><td>
      <p>
       <span class="bold"><strong>Request:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Requester:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Authorization:</strong></span> Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Listener:</strong></span> Cluster member (VM or ironic
       node)
      </p>
     </td><td>
      <p>
       Tenant specific
      </p>
      <p>
       <span class="bold"><strong>Credentials:</strong></span> Tenant specific
      </p>
     </td><td>
      <p>
       External workload handled by container applications
      </p>
     </td></tr></tbody></table></div></div><p>
  <span class="bold"><strong>Dependencies</strong></span>
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    keystone
   </p></li><li class="listitem "><p>
    RabbitMQ
   </p></li><li class="listitem "><p>
    MariaDB
   </p></li><li class="listitem "><p>
    heat
   </p></li><li class="listitem "><p>
    glance
   </p></li><li class="listitem "><p>
    nova
   </p></li><li class="listitem "><p>
    cinder
   </p></li><li class="listitem "><p>
    neutron
   </p></li><li class="listitem "><p>
    barbican
   </p></li><li class="listitem "><p>
    swift
   </p></li></ul></div><p>
  <span class="bold"><strong>Implementation</strong></span>
 </p><p>
  Magnum API and Magnum Conductor are run on the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> controllers (or core
  nodes in case of mid-scale deployments).
 </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/media-networkImages-Mid-Scale-AllNetworks.png" target="_blank"><img src="images/media-networkImages-Mid-Scale-AllNetworks.png" width="" /></a></div></div><div class="table" id="security-groups-table"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 26.3: </span><span class="name">Security Groups </span><a title="Permalink" class="permalink" href="MagnumOverview.html#security-groups-table">#</a></h6></div><div class="table-contents"><table class="table" summary="Security Groups" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><thead><tr><th>Source CIDR/Security Group</th><th>Port/Range</th><th>Protocol</th><th>Notes</th></tr></thead><tbody><tr><td>Any IP</td><td>22</td><td>SSH</td><td>Tenant Admin access</td></tr><tr><td>Any IP/Kubernetes Security Group</td><td>2379-2380</td><td>HTTPS</td><td>Etcd Traffic</td></tr><tr><td>Any IP/Kubernetes Security Group</td><td>6443</td><td>HTTPS</td><td>kube-apiserver</td></tr><tr><td>Any IP/Kubernetes Security Group</td><td>7080</td><td>HTTPS</td><td>kube-apiserver</td></tr><tr><td>Any IP/Kubernetes Security Group</td><td>8080</td><td>HTTPS</td><td>kube-apiserver</td></tr><tr><td>Any IP/Kubernetes Security Group</td><td>30000-32767</td><td>HTTPS</td><td>kube-apiserver</td></tr><tr><td>Any IP/Kubernetes Security Group</td><td>any</td><td>tenant app specific</td><td>tenant app specific</td></tr></tbody></table></div></div><div class="table" id="network-ports-table"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 26.4: </span><span class="name">Network Ports </span><a title="Permalink" class="permalink" href="MagnumOverview.html#network-ports-table">#</a></h6></div><div class="table-contents"><table class="table" summary="Network Ports" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /></colgroup><thead><tr><th>Port/Range</th><th>Protocol</th><th>Notes</th></tr></thead><tbody><tr><td>22</td><td>SSH</td><td>Admin Access</td></tr><tr><td>9511</td><td>HTTPS</td><td>Magnum API Access</td></tr><tr><td>2379-2380</td><td>HTTPS</td><td>Etcd (planned)</td></tr><tr><td> </td><td> </td><td> </td></tr></tbody></table></div></div><p>
  Summary of controls spanning multiple components and interfaces:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    <span class="bold"><strong>Audit</strong></span>: Magnum performs logging. Logs are
    collected by the centralized logging service.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Authentication</strong></span>: Authentication via
    keystone tokens at APIs. Password authentication to MQ and DB using
    specific users with randomly-generated passwords.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Authorization</strong></span>: OpenStack provides admin
    and non-admin roles that are indicated in session tokens. Processes run at
    minimum privilege. Processes run as unique user/group definitions
    (magnum/magnum). Appropriate filesystem controls prevent other processes
    from accessing service’s files. Magnum config file is mode 600. Logs
    written using group adm, user magnum, mode 640. IPtables ensure that no
    unneeded ports are open. Security Groups provide authorization controls
    between in-cloud components.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Availability</strong></span>: Redundant hosts, clustered
    DB, and fail-over provide high availability.
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Confidentiality</strong></span>: Network connections over
    TLS. Network separation via VLANs. Data and config files protected via
    filesystem controls. Unencrypted local traffic is bound to localhost.
    Separation of customer traffic on the TUL network via Open Flow (VxLANs).
   </p></li><li class="listitem "><p>
    <span class="bold"><strong>Integrity</strong></span>: Network connections over TLS.
    Network separation via VLANs. DB API integrity protected by SQL Alchemy.
    Data and config files are protected by filesystem controls. Unencrypted
    traffic is bound to localhost.
   </p></li></ul></div></div><div class="sect1" id="MagnumInstall"><div class="titlepage"><div><div><h2 class="title"><span class="number">26.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Install the Magnum Service</span> <a title="Permalink" class="permalink" href="MagnumOverview.html#MagnumInstall">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/installation-installation-magnum-magnum_install.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>installation-installation-magnum-magnum_install.xml</li><li><span class="ds-label">ID: </span>MagnumInstall</li></ul></div></div></div></div><p>
  Installing the Magnum Service can be performed as part of a new
  <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 environment or can be added to an existing <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9
  environment. Both installations require container management services,
  running in Magnum cluster VMs with access to specific Openstack API
  endpoints. The following TCP ports need to be open in your firewall to allow
  access from VMs to external (public) <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> endpoints.
 </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /></colgroup><thead><tr><th>TCP Port</th><th>Service</th></tr></thead><tbody><tr><td>5000</td><td>Identity</td></tr><tr><td>8004</td><td>heat</td></tr><tr><td>9511</td><td>Magnum</td></tr></tbody></table></div><p>
  Magnum is dependent on the following OpenStack services.
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    keystone
   </p></li><li class="listitem "><p>
    heat
   </p></li><li class="listitem "><p>
    nova KVM
   </p></li><li class="listitem "><p>
    neutron
   </p></li><li class="listitem "><p>
    glance
   </p></li><li class="listitem "><p>
    cinder
   </p></li><li class="listitem "><p>
    swift
   </p></li><li class="listitem "><p>
    barbican
   </p></li></ul></div><div id="id-1.3.6.9.4.6" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning</h6><p>
   Magnum relies on the public discovery service
   <span class="emphasis"><em>https://discovery.etcd.io</em></span> during cluster bootstrapping
   and update. This service does not perform authentication checks. Although
   running a cluster cannot be harmed by unauthorized changes in the public
   discovery registry, it can be compromised during a cluster update operation.
   To avoid this, it is recommended that you keep your cluster discovery URL
   (that is,
   <code class="literal">https://discovery.etc.io/<em class="replaceable ">SOME_RANDOM_ID</em></code>)
   secret.
  </p></div><div class="sect2" id="id-1.3.6.9.4.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">26.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Installing Magnum as part of new <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 environment</span> <a title="Permalink" class="permalink" href="MagnumOverview.html#id-1.3.6.9.4.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/installation-installation-magnum-magnum_install.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>installation-installation-magnum-magnum_install.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Magnum components are already included in example <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> models based on
   nova KVM, such as <span class="bold"><strong>entry-scale-kvm</strong></span>,
   <span class="bold"><strong>entry-scale-kvm-mml</strong></span> and
   <span class="bold"><strong>mid-scale</strong></span>. These models contain the Magnum
   dependencies (see above). You can follow generic installation instruction
   for Mid-Scale and Entry-Scale KM model by using this guide:
   <a class="xref" href="install-kvm.html" title="Chapter 24. Installing Mid-scale and Entry-scale KVM">Chapter 24, <em>Installing Mid-scale and Entry-scale KVM</em></a>.
  </p><div id="id-1.3.6.9.4.7.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
      If you modify the cloud model to utilize a dedicated Cloud Lifecycle Manager, add
      <code class="literal">magnum-client</code> item to the list of service components
      for the Cloud Lifecycle Manager cluster.
     </p></li><li class="listitem "><p>
      Magnum needs a properly configured external endpoint. While preparing the
      cloud model, ensure that <code class="literal">external-name</code> setting in
      <code class="literal">data/network_groups.yml</code> is set to valid hostname,
      which can be resolved on DNS server, and a valid TLS certificate is
      installed for your external endpoint. For non-production test
      installations, you can omit <code class="literal">external-name</code>. In test
      installations, the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> installer will use an IP address as a public
      endpoint hostname, and automatically generate a new certificate, signed
      by the internal CA. Please refer to <a class="xref" href="tls30.html" title="Chapter 41. Configuring Transport Layer Security (TLS)">Chapter 41, <em>Configuring Transport Layer Security (TLS)</em></a> for more
      details.
     </p></li></ol></div></div></div><div class="sect2" id="sec-magnum-exist"><div class="titlepage"><div><div><h3 class="title"><span class="number">26.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Adding Magnum to an Existing <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Environment</span> <a title="Permalink" class="permalink" href="MagnumOverview.html#sec-magnum-exist">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/installation-installation-magnum-magnum_install.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>installation-installation-magnum-magnum_install.xml</li><li><span class="ds-label">ID: </span>sec-magnum-exist</li></ul></div></div></div></div><p>
   Adding Magnum to an already deployed <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 installation or during
   an upgrade can be achieved by performing the following steps.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Add items listed below to the list of service components in
     <code class="literal">~/openstack/my_cloud/definition/data/control_plane.yml</code>.
     Add them to clusters which have <code class="literal">server-role</code> set to
     <code class="literal">CONTROLLER-ROLE</code> (entry-scale models) or
     <code class="literal">CORE_ROLE</code> (mid-scale model).
    </p><div class="verbatim-wrap"><pre class="screen">- magnum-api
- magnum-conductor</pre></div></li><li class="step "><p>
     If your environment utilizes a dedicated Cloud Lifecycle Manager, add
     <code class="literal">magnum-client</code> to the list of service components for the
     Cloud Lifecycle Manager.
    </p></li><li class="step "><p>
     Commit your changes to the local git repository. Run the following
     playbooks as described in <a class="xref" href="using-git.html" title="Chapter 22. Using Git for Configuration Management">Chapter 22, <em>Using Git for Configuration Management</em></a> for your
     installation.
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       <code class="literal">config-processor-run.yml</code>
      </p></li><li class="listitem "><p>
       <code class="literal">ready-deployment.yml</code>
      </p></li><li class="listitem "><p>
       <code class="literal">site.yml</code>
      </p></li></ul></div></li><li class="step "><p>
     Ensure that your external endpoint is configured correctly. The current
     public endpoint configuration can be verified by running the following
     commands on the Cloud Lifecycle Manager.
    </p><div class="verbatim-wrap"><pre class="screen">$ source service.osrc
$ openstack endpoint list --interface=public --service=identity
+-----------+---------+--------------+----------+---------+-----------+------------------------+
| ID        | Region  | Service Name | Service  | Enabled | Interface | URL                    |
|           |         |              | Type     |         |           |                        |
+-----------+---------+--------------+----------+---------+-----------+------------------------+
| d83...aa3 | region0 | keystone     | identity | True    | public    | https://10.245.41.168: |
|           |         |              |          |         |           |             5000/v2.0  |
+-----------+---------+--------------+----------+---------+-----------+------------------------+</pre></div><p>
     Ensure that the endpoint URL is using either an IP address, or a valid
     hostname, which can be resolved on the DNS server. If the URL is using an
     invalid hostname (for example, <code class="literal">myardana.test</code>), follow
     the steps in <a class="xref" href="tls30.html" title="Chapter 41. Configuring Transport Layer Security (TLS)">Chapter 41, <em>Configuring Transport Layer Security (TLS)</em></a> to configure a valid external
     endpoint. You will need to update the <code class="literal">external-name</code>
     setting in the <code class="literal">data/network_groups.yml</code> to a valid
     hostname, which can be resolved on DNS server, and provide a valid TLS
     certificate for the external endpoint. For non-production test
     installations, you can omit the <code class="literal">external-name</code>. The
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> installer will use an IP address as public endpoint hostname, and
     automatically generate a new certificate, signed by the internal CA.
     For more information, see <a class="xref" href="tls30.html" title="Chapter 41. Configuring Transport Layer Security (TLS)">Chapter 41, <em>Configuring Transport Layer Security (TLS)</em></a>.
    </p></li></ol></div></div><div id="id-1.3.6.9.4.8.4" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning</h6><p>
    By default <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> stores the private key used by Magnum and its
    passphrase in barbican which provides a secure place to store such
    information. You can change this such that this sensitive information is
    stored on the file system or in the database without encryption. Making
    such a change exposes you to the risk of this information being exposed
    to others. If stored in the database then any database backups, or a
    database breach, could lead to the disclosure of the sensitive
    information. Similarly, if stored unencrypted on the file system this
    information is exposed more broadly than if stored in barbican.
   </p></div></div></div><div class="sect1" id="MagnumIntegrateDNS"><div class="titlepage"><div><div><h2 class="title"><span class="number">26.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Integrate Magnum with the DNS Service</span> <a title="Permalink" class="permalink" href="MagnumOverview.html#MagnumIntegrateDNS">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/installation-installation-magnum-magnum_integrate_dns.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>installation-installation-magnum-magnum_integrate_dns.xml</li><li><span class="ds-label">ID: </span>MagnumIntegrateDNS</li></ul></div></div></div></div><p>
  Integration with DNSaaS may be needed if:
 </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
    The external endpoint is configured to use <code class="literal">myardana.test</code>
    as host name and <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> front-end certificate is issued for this host name.
   </p></li><li class="listitem "><p>
    Minions are registered using nova VM names as hostnames Kubernetes API
    server. Most kubectl commands will not work if the VM name (for example,
    <code class="literal">cl-mu3eevqizh-1-b3vifun6qtuh-kube-minion-ff4cqjgsuzhy</code>)
    is not getting resolved at the provided DNS server.
   </p></li></ol></div><p>
  Follow these steps to integrate the Magnum Service with the DNS Service.
 </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
    Allow connections from VMs to EXT-API
   </p><div class="verbatim-wrap"><pre class="screen">sudo modprobe 8021q
sudo ip link add link virbr5 name vlan108 type vlan id 108
sudo ip link set dev vlan108 up
sudo ip addr add 192.168.14.200/24 dev vlan108
sudo iptables -t nat -A POSTROUTING -o vlan108 -j MASQUERADE</pre></div></li><li class="step "><p>
    Run the designate reconfigure playbook.
   </p><div class="verbatim-wrap"><pre class="screen">$ cd ~/scratch/ansible/next/ardana/ansible/
$ ansible-playbook -i hosts/verb_hosts designate-reconfigure.yml</pre></div></li><li class="step "><p>
    Set up designate to resolve myardana.test correctly.
   </p><div class="verbatim-wrap"><pre class="screen">$ openstack zone create --email hostmaster@myardana.test myardana.test.
# wait for status to become active
$ EXTERNAL_VIP=$(grep HZN-WEB-extapi /etc/hosts | awk '{ print $1 }')
$ openstack recordset create --records $EXTERNAL_VIP --type A myardana.test. myardana.test.
# wait for status to become active
$ LOCAL_MGMT_IP=$(grep `hostname` /etc/hosts | awk '{ print $1 }')
$ nslookup myardana.test $LOCAL_MGMT_IP
Server:        192.168.14.2
Address:       192.168.14.2#53
Name:          myardana.test
Address:       192.168.14.5</pre></div></li><li class="step "><p>
    If you need to add/override a top level domain record, the following
    example should be used, substituting proxy.example.org with your own real
    address:
   </p><div class="verbatim-wrap"><pre class="screen">$ openstack tld create --name net
$ openstack zone create --email hostmaster@proxy.example.org proxy.example.org.
$ openstack recordset create --records 16.85.88.10 --type A proxy.example.org. proxy.example.org.
$ nslookup proxy.example.org. 192.168.14.2
Server:        192.168.14.2
Address:       192.168.14.2#53
Name:          proxy.example.org
Address:       16.85.88.10</pre></div></li><li class="step "><p>
    Enable propagation of dns_assignment and dns_name attributes to neutron
    ports, as per <a class="link" href="https://docs.openstack.org/neutron/rocky/admin/config-dns-int.html" target="_blank">https://docs.openstack.org/neutron/rocky/admin/config-dns-int.html</a>
   </p><div class="verbatim-wrap"><pre class="screen"># optionally add 'dns_domain = &lt;some domain name&gt;.' to [DEFAULT] section
# of ardana/ansible/roles/neutron-common/templates/neutron.conf.j2
stack@ksperf2-cp1-c1-m1-mgmt:~/openstack$ cat &lt;&lt;-EOF &gt;&gt;ardana/services/designate/api.yml

   provides-data:
   -   to:
       -   name: neutron-ml2-plugin
       data:
       -   option: extension_drivers
           values:
           -   dns
EOF
$ git commit -a -m "Enable DNS support for neutron ports"
$ cd ardana/ansible
$ ansible-playbook -i hosts/localhost config-processor-run.yml
$ ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="step "><p>
    Enable DNSaaS registration of created VMs by editing the
    <code class="filename">~/openstack/ardana/ansible/roles/neutron-common/templates/neutron.conf.j2</code>
    file. You will need to add <code class="literal">external_dns_driver =
    designate</code> to the <span class="bold"><strong>[DEFAULT]</strong></span>
    section and create a new <span class="bold"><strong>[designate]</strong></span>
    section for the designate specific configurations.
   </p><div class="verbatim-wrap"><pre class="screen">...
advertise_mtu = False
dns_domain = ksperf.
external_dns_driver = designate
{{ neutron_api_extensions_path|trim }}
{{ neutron_vlan_transparent|trim }}

# Add additional options here

[designate]
url = https://10.240.48.45:9001
admin_auth_url = https://10.240.48.45:35357/v3
admin_username = designate
admin_password = P8lZ9FdHuoW
admin_tenant_name = services
allow_reverse_dns_lookup = True
ipv4_ptr_zone_prefix_size = 24
ipv6_ptr_zone_prefix_size = 116
ca_cert = /etc/ssl/certs/ca-certificates.crt</pre></div></li><li class="step "><p>
    Commit your changes.
   </p><div class="verbatim-wrap"><pre class="screen">$ git commit -a -m "Enable DNSaaS registration of nova VMs"
[site f4755c0] Enable DNSaaS registration of nova VMs
1 file changed, 11 insertions(+)</pre></div></li></ol></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="install-esx-ovsvapp.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 27 </span>Installing ESX Computes and OVSvAPP</span></a><a class="nav-link" href="DesignateInstallOverview.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 25 </span>DNS Service Installation Overview</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>