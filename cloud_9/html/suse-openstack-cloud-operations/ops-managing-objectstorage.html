<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><title>SUSE OpenStack Cloud 9 | Operations Guide CLM | Managing Object Storage</title><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<meta name="title" content="Managing Object Storage | SUSE OpenStack Cloud 9"/>
<meta name="description" content="Information about managing and configuring the Object Storage service."/>
<meta name="product-name" content="SUSE OpenStack Cloud"/>
<meta name="product-number" content="9"/>
<meta name="book-title" content="Operations Guide CLM"/>
<meta name="chapter-title" content="Chapter 9. Managing Object Storage"/>
<meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi"/>
<meta name="tracker-type" content="bsc"/>
<meta name="tracker-bsc-component" content="Documentation"/>
<meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 9"/>
<meta property="og:title" content="Managing Object Storage | SUSE OpenStack Cloud 9"/>
<meta property="og:description" content="Information about managing and configuring the Object Storage service."/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Managing Object Storage | SUSE OpenStack Cloud 9"/>
<meta name="twitter:description" content="Information about managing and configuring the Object Storage service."/>
<link rel="prev" href="ops-managing-blockstorage.html" title="Chapter 8. Managing Block Storage"/><link rel="next" href="ops-managing-networking.html" title="Chapter 10. Managing Networking"/>
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/jquery-1.12.4.min.js" type="text/javascript"> </script><script src="static/js/script.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script><meta name="edit-url" content="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-managing_objectstorage.xml"/></head><body class="draft wide offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">Operations Guide CLM</a><span> / </span><a class="crumb" href="ops-managing-objectstorage.html">Managing Object Storage</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">Operations Guide CLM</div><ol><li><a href="gettingstarted-ops.html" class=" "><span class="title-number">1 </span><span class="title-name">Operations Overview</span></a></li><li><a href="tutorials.html" class=" "><span class="title-number">2 </span><span class="title-name">Tutorials</span></a></li><li><a href="clm-admin-ui.html" class=" "><span class="title-number">3 </span><span class="title-name">Cloud Lifecycle Manager Admin UI User Guide</span></a></li><li><a href="third-party-integrations.html" class=" "><span class="title-number">4 </span><span class="title-name">Third-Party Integrations</span></a></li><li><a href="ops-managing-identity.html" class=" "><span class="title-number">5 </span><span class="title-name">Managing Identity</span></a></li><li><a href="ops-managing-compute.html" class=" "><span class="title-number">6 </span><span class="title-name">Managing Compute</span></a></li><li><a href="ops-managing-esx.html" class=" "><span class="title-number">7 </span><span class="title-name">Managing ESX</span></a></li><li><a href="ops-managing-blockstorage.html" class=" "><span class="title-number">8 </span><span class="title-name">Managing Block Storage</span></a></li><li><a href="ops-managing-objectstorage.html" class=" you-are-here"><span class="title-number">9 </span><span class="title-name">Managing Object Storage</span></a></li><li><a href="ops-managing-networking.html" class=" "><span class="title-number">10 </span><span class="title-name">Managing Networking</span></a></li><li><a href="ops-managing-dashboards.html" class=" "><span class="title-number">11 </span><span class="title-name">Managing the Dashboard</span></a></li><li><a href="ops-managing-orchestration.html" class=" "><span class="title-number">12 </span><span class="title-name">Managing Orchestration</span></a></li><li><a href="topic-ttn-5fg-4v.html" class=" "><span class="title-number">13 </span><span class="title-name">Managing Monitoring, Logging, and Usage Reporting</span></a></li><li><a href="using-container-as-a-service-overview.html" class=" "><span class="title-number">14 </span><span class="title-name">Managing Container as a Service (Magnum)</span></a></li><li><a href="system-maintenance.html" class=" "><span class="title-number">15 </span><span class="title-name">System Maintenance</span></a></li><li><a href="manage-ops-console.html" class=" "><span class="title-number">16 </span><span class="title-name">Operations Console</span></a></li><li><a href="bura-overview.html" class=" "><span class="title-number">17 </span><span class="title-name">Backup and Restore</span></a></li><li><a href="idg-all-operations-troubleshooting-troubleshooting-issues-xml-1.html" class=" "><span class="title-number">18 </span><span class="title-name">Troubleshooting Issues</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="ops-managing-objectstorage" data-id-title="Managing Object Storage"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber">9</span></div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">9 </span><span class="title-name">Managing Object Storage</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-managing_objectstorage.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Information about managing and configuring the Object Storage service.
 </p><p>
  The Object Storage service may be deployed in a full-fledged manner, with
  proxy nodes engaging rings for managing the accounts, containers,
  and objects being stored. Or, it may simply be deployed as a front-end to
  SUSE Enterprise Storage, offering Object Storage APIs with an external back-end.
 </p><p>
  In the former case, managing your Object Storage environment includes tasks
  related to ensuring your swift rings stay balanced, and that and other
  topics are discussed in more detail in this section. swift includes many
  commands and utilities for these purposes.
 </p><p>
  When used as a front-end to SUSE Enterprise Storage, many swift constructs such as rings
  and ring balancing, replica dispersion, etc. do not apply, as swift itself
  is not responsible for the mechanics of object storage.
 </p><section class="sect1" id="swift-healthcheck" data-id-title="Running the swift Dispersion Report"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.1 </span><span class="title-name">Running the swift Dispersion Report</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#swift-healthcheck">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_dispersion_report.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  swift contains a tool called <code class="literal">swift-dispersion-report</code> that
  can be used to determine whether your containers and objects have three
  replicas like they are supposed to. This tool works by populating a
  percentage of partitions in the system with containers and objects (using
  <code class="literal">swift-dispersion-populate</code>) and then running the report to
  see if all the replicas of these containers and objects are in the correct
  place. For a more detailed explanation of this tool in Openstack swift,
  please see
  <a class="link" href="http://docs.openstack.org/developer/swift/admin_guide.html#cluster-health" target="_blank">OpenStack
  swift - Administrator's Guide</a>.
 </p><section class="sect2" id="id-1.5.11.6.3" data-id-title="Configuring the swift dispersion populate"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.1 </span><span class="title-name">Configuring the swift dispersion populate</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#id-1.5.11.6.3">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_dispersion_report.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Once a swift system has been fully deployed in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9, you can
   setup the swift-dispersion-report using the default parameters found in
   <code class="filename">~/openstack/ardana/ansible/roles/swift-dispersion/templates/dispersion.conf.j2</code>.
   This populates 1% of the partitions on the system and if you are happy with
   this figure, please proceed to step 2 below. Otherwise, follow step 1 to
   edit the configuration file.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     If you wish to change the dispersion coverage percentage, then connect
     to the Cloud Lifecycle Manager server and change the value of
     <code class="literal">dispersion_coverage</code> in the
     <code class="filename">~/openstack/ardana/ansible/roles/swift-dispersion/templates/dispersion.conf.j2</code>
     file to the value you wish to use. In the example below we have altered
     the file to create 5% dispersion:
    </p><div class="verbatim-wrap"><pre class="screen">...
[dispersion]
auth_url = {{ keystone_identity_uri }}/v3
auth_user = {{ swift_dispersion_tenant }}:{{ swift_dispersion_user }}
auth_key = {{ swift_dispersion_password  }}
endpoint_type = {{ endpoint_type }}
auth_version = {{ disp_auth_version }}
# Set this to the percentage coverage. We recommend a value
# of 1%. You can increase this to get more coverage. However, if you
# decrease the value, the dispersion containers and objects are
# not deleted.
<span class="bold"><strong>dispersion_coverage = 5.0</strong></span></pre></div></li><li class="listitem"><p>
     Commit your configuration to the Git repository
     (<span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>), as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git add -A
<code class="prompt user">ardana &gt; </code>git commit -m "My config or other commit message"</pre></div></li><li class="listitem"><p>
     Run the configuration processor:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
     Update your deployment directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     Reconfigure the swift servers:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-reconfigure.yml</pre></div></li><li class="listitem"><p>
     Run this playbook to populate your swift system for the health check:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-dispersion-populate.yml</pre></div></li></ol></div></section><section class="sect2" id="id-1.5.11.6.4" data-id-title="Running the swift dispersion report"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.1.2 </span><span class="title-name">Running the swift dispersion report</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#id-1.5.11.6.4">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_dispersion_report.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Check the status of the swift system by running the swift dispersion report
   with this playbook:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-dispersion-report.yml</pre></div><p>
   The output of the report will look similar to this:
  </p><div class="verbatim-wrap"><pre class="screen">TASK: [swift-dispersion | report | Display dispersion report results] *********
ok: [padawan-ccp-c1-m1-mgmt] =&gt; {
    "var": {
        "dispersion_report_result.stdout_lines": [
            "Using storage policy: General ",
            "",
            "[KQueried 40 containers for dispersion reporting, 0s, 0 retries",
            "100.00% of container copies found (120 of 120)",
            "Sample represents 0.98% of the container partition space",
            "",
            "[KQueried 40 objects for dispersion reporting, 0s, 0 retries",
            "There were 40 partitions missing 0 copies.",
            "100.00% of object copies found (120 of 120)",
            "Sample represents 0.98% of the object partition space"
        ]
    }
}
...</pre></div><p>
   In addition to being able to run the report above, there will be a cron-job
   scheduled to run every 2 hours located on the primary proxy node of your
   cloud environment. It will run <code class="literal">dispersion-report</code> and save
   the results to the following location on its local filesystem:
  </p><div class="verbatim-wrap"><pre class="screen">/var/cache/swift/dispersion-report</pre></div><p>
   When interpreting the results you get from this report, we recommend using
   <a class="link" href="http://docs.openstack.org/developer/swift/admin_guide.html#cluster-health" target="_blank">swift
   Administrator's Guide - Cluster Health</a>
  </p></section></section><section class="sect1" id="swift-recon" data-id-title="Gathering Swift Data"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.2 </span><span class="title-name">Gathering Swift Data</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#swift-recon">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-validating_swift_recon.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The <code class="literal">swift-recon</code> command retrieves data from swift servers
  and displays the results. To use this command, log on as a root user to any
  node which is running the swift-proxy service.
 </p><section class="sect2" id="idg-all-operations-objectstorage-validating-swift-recon-xml-7" data-id-title="Notes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.2.1 </span><span class="title-name">Notes</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#idg-all-operations-objectstorage-validating-swift-recon-xml-7">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-validating_swift_recon.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   For help with the <code class="literal">swift-recon</code> command you can use this:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo swift-recon --help</pre></div><div id="id-1.5.11.7.3.4" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>
    The <code class="literal">--driveaudit</code> option is not supported.
   </p></div><div id="id-1.5.11.7.3.5" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>
    <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> does not support ec_type <code class="literal">isa_l_rs_vand</code> and
    <code class="literal">ec_num_parity_fragments</code> greater than or equal to
    <span class="bold"><strong>5</strong></span> in the storage-policy configuration.
    This particular policy is known to harm data durability.
   </p></div></section><section class="sect2" id="idg-all-operations-objectstorage-validating-swift-recon-xml-8" data-id-title="Using the swift-recon Command"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.2.2 </span><span class="title-name">Using the swift-recon Command</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#idg-all-operations-objectstorage-validating-swift-recon-xml-8">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-validating_swift_recon.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following command retrieves and displays disk usage information:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo swift-recon --diskusage</pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo swift-recon --diskusage
===============================================================================
--&gt; Starting reconnaissance on 3 hosts
===============================================================================
[2015-09-14 16:01:40] Checking disk usage now
Distribution Graph:
 10%    3 *********************************************************************
 11%    1 ***********************
 12%    2 **********************************************
Disk usage: space used: 13745373184 of 119927734272
Disk usage: space free: 106182361088 of 119927734272
Disk usage: lowest: 10.39%, highest: 12.96%, avg: 11.4613798613%
===============================================================================</pre></div><p>
   In the above example, the results for several nodes are combined together.
   You can also view the results from individual nodes by adding the
   <span class="bold"><strong>-v</strong></span> option as shown in the following
   example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo swift-recon --diskusage -v
===============================================================================
--&gt; Starting reconnaissance on 3 hosts
===============================================================================
[2015-09-14 16:12:30] Checking disk usage now
-&gt; http://192.168.245.3:6000/recon/diskusage: [{'device': 'disk1', 'avail': 17398411264, 'mounted': True, 'used': 2589544448, 'size': 19987955712}, {'device': 'disk0', 'avail': 17904222208, 'mounted': True, 'used': 2083733504, 'size': 19987955712}]
-&gt; http://192.168.245.2:6000/recon/diskusage: [{'device': 'disk1', 'avail': 17769721856, 'mounted': True, 'used': 2218233856, 'size': 19987955712}, {'device': 'disk0', 'avail': 17793581056, 'mounted': True, 'used': 2194374656, 'size': 19987955712}]
-&gt; http://192.168.245.4:6000/recon/diskusage: [{'device': 'disk1', 'avail': 17912147968, 'mounted': True, 'used': 2075807744, 'size': 19987955712}, {'device': 'disk0', 'avail': 17404235776, 'mounted': True, 'used': 2583719936, 'size': 19987955712}]
Distribution Graph:
 10%    3 *********************************************************************
 11%    1 ***********************
 12%    2 **********************************************
Disk usage: space used: 13745414144 of 119927734272
Disk usage: space free: 106182320128 of 119927734272
Disk usage: lowest: 10.39%, highest: 12.96%, avg: 11.4614140152%
===============================================================================</pre></div><p>
   By default, <code class="literal">swift-recon</code> uses the object-0 ring for
   information about nodes and drives. For some commands, it is appropriate to
   specify <span class="bold"><strong>account</strong></span>,
   <span class="bold"><strong>container</strong></span>, or
   <span class="bold"><strong>object</strong></span> to indicate the type of ring. For
   example, to check the checksum of the account ring, use the following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo swift-recon --md5 account
===============================================================================
--&gt; Starting reconnaissance on 3 hosts
===============================================================================
[2015-09-14 16:17:28] Checking ring md5sums
3/3 hosts matched, 0 error[s] while checking hosts.
===============================================================================
[2015-09-14 16:17:28] Checking swift.conf md5sum
3/3 hosts matched, 0 error[s] while checking hosts.
===============================================================================</pre></div></section></section><section class="sect1" id="topic-pcv-fy4-nt" data-id-title="Gathering Swift Monitoring Metrics"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.3 </span><span class="title-name">Gathering Swift Monitoring Metrics</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#topic-pcv-fy4-nt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-lm_scan_metering.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The <code class="literal">swiftlm-scan</code> command is the mechanism used to gather
  metrics for the monasca system. These metrics are used to derive alarms. For
  a list of alarms that can be generated from this data, see
  <a class="xref" href="idg-all-operations-troubleshooting-troubleshooting-issues-xml-1.html#alarmdefinitions" title="18.1.1. Alarm Resolution Procedures">Section 18.1.1, “Alarm Resolution Procedures”</a>.
 </p><p>
  To view the metrics, use the <code class="literal">swiftlm-scan</code> command
  directly. Log on to the swift node as the root user. The following example
  shows the command and a snippet of the output:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo swiftlm-scan --pretty
. . .
  {
    "dimensions": {
      "device": "sdc",
      "hostname": "padawan-ccp-c1-m2-mgmt",
      "service": "object-storage"
    },
    "metric": "swiftlm.swift.drive_audit",
    "timestamp": 1442248083,
    "value": 0,
    "value_meta": {
      "msg": "No errors found on device: sdc"
    }
  },
. . .</pre></div><div id="id-1.5.11.8.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
   To make the JSON file easier to read, use the <code class="literal">--pretty</code>
   option.
  </p></div><p>
  The fields are as follows:
 </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">metric</code>
     </td><td style="border-bottom: 1px solid ; ">
      <p>
       Specifies the name of the metric.
      </p>
     </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">dimensions</code>
     </td><td style="border-bottom: 1px solid ; ">
      <p>
       Provides information about the source or location of the metric. The
       dimensions differ depending on the metric in question. The following
       dimensions are used by <code class="literal">swiftlm-scan</code>:
      </p>
      <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         <span class="bold"><strong>service</strong></span>: This is always
         <span class="bold"><strong>object-storage</strong></span>.
        </p></li><li class="listitem"><p>
         <span class="bold"><strong>component</strong></span>: This identifies the
         component. For example,
         <span class="bold"><strong>swift-object-server</strong></span> indicates that
         the metric is about the swift-object-server process.
        </p></li><li class="listitem"><p>
         <span class="bold"><strong>hostname</strong></span>: This is the name of the
         node the metric relates to. This is not necessarily the name of the
         current node.
        </p></li><li class="listitem"><p>
         <span class="bold"><strong>url</strong></span>: If the metric is associated with
         a URL, this is the URL.
        </p></li><li class="listitem"><p>
         <span class="bold"><strong>port</strong></span>: If the metric relates to
         connectivity to a node, this is the port used.
        </p></li><li class="listitem"><p>
         <span class="bold"><strong>device</strong></span>: This is the block device a
         metric relates to.
        </p></li></ul></div>
     </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">value</code></td><td style="border-bottom: 1px solid ; ">
      <p>
       The value of the metric. For many metrics, this is simply the value of
       the metric. However, if the value indicates a status. If
       <code class="literal">value_meta</code> contains a
       <span class="bold"><strong>msg</strong></span> field, the value is a status. The
       following status values are used:
      </p>
      <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         0 - no error
        </p></li><li class="listitem"><p>
         1 - warning
        </p></li><li class="listitem"><p>
         2 - failure
        </p></li></ul></div>
     </td></tr><tr><td style="border-right: 1px solid ; "><code class="literal">value_meta</code>
     </td><td>
      <p>
       Additional information. The <span class="bold"><strong>msg</strong></span> field
       is the most useful of this information.
      </p>
     </td></tr></tbody></table></div><section class="sect2" id="id-1.5.11.8.8" data-id-title="Optional Parameters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.3.1 </span><span class="title-name">Optional Parameters</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#id-1.5.11.8.8">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-lm_scan_metering.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   You can focus on specific sets of metrics by using one of the following
   optional parameters:
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--replication</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Checks replication and health status.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--file-ownership</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Checks that swift owns its relevant files and directories.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--drive-audit</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Checks for logged events about corrupted sectors (unrecoverable read
        errors) on drives.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--connectivity</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Checks connectivity to various servers used by the swift system,
        including:
       </p>
       <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Checks this node can connect to all memcachd servers
         </p></li><li class="listitem"><p>
          Checks that this node can connect to the keystone service (only
          applicable if this is a proxy server node)
         </p></li></ul></div>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--swift-services</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Check that the relevant swift processes are running.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--network-interface</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Checks NIC speed and reports statistics for each interface.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">--check-mounts</code></td><td style="border-bottom: 1px solid ; ">
       <p>
        Checks that the node has correctly mounted drives used by swift.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; "><code class="literal">--hpssacli</code></td><td>
       <p>
        If this server uses a Smart Array Controller, this checks the operation
        of the controller and disk drives.
       </p>
      </td></tr></tbody></table></div></section></section><section class="sect1" id="topic-m13-dgp-nt" data-id-title="Using the swift Command-line Client (CLI)"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.4 </span><span class="title-name">Using the swift Command-line Client (CLI)</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#topic-m13-dgp-nt">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_cli.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  OpenStackClient (OSC) is a command-line client for OpenStack with a uniform
  command structure for OpenStack services. Some swift commands do not
  have OSC equivalents. The <code class="literal">swift</code> utility (or swift
  CLI) is installed on the Cloud Lifecycle Manager node and also on all other nodes running the
  swift proxy service. To use this utility on the Cloud Lifecycle Manager, you can use the
  <code class="literal">~/service.osrc</code> file as a basis and then edit it with the
  credentials of another user if you need to.
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cp ~/service.osrc ~/swiftuser.osrc</pre></div><p>
  Then you can use your preferred editor to edit swiftuser.osrc so you can
  authenticate using the <code class="literal">OS_USERNAME</code>,
  <code class="literal">OS_PASSWORD</code>, and <code class="literal">OS_PROJECT_NAME</code> you
  wish to use. For example, if you want use the <code class="literal">demo</code> user
  that is created automatically for you, it would look like this:
 </p><div class="verbatim-wrap"><pre class="screen">unset OS_DOMAIN_NAME
export OS_IDENTITY_API_VERSION=3
export OS_AUTH_VERSION=3
export OS_PROJECT_NAME=demo
export OS_PROJECT_DOMAIN_NAME=Default
export OS_USERNAME=demo
export OS_USER_DOMAIN_NAME=Default
export OS_PASSWORD=&lt;password&gt;
export OS_AUTH_URL=&lt;auth_URL&gt;
export OS_ENDPOINT_TYPE=internalURL
# OpenstackClient uses OS_INTERFACE instead of OS_ENDPOINT
export OS_INTERFACE=internal
export OS_CACERT=/etc/ssl/certs/ca-certificates.crt
export OS_COMPUTE_API_VERSION=2</pre></div><p>
  You must use the appropriate password for the demo user and select the
  correct endpoint for the <span class="bold"><strong>OS_AUTH_URL</strong></span> value,
  which should be in the <code class="literal">~/service.osrc</code> file you copied.
 </p><p>
  You can then examine the following account data using this command:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack object store account show</pre></div><p>
  Example showing an environment with no containers or objects:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack object store account show
        Account: AUTH_205804d000a242d385b8124188284998
     Containers: 0
        Objects: 0
          Bytes: 0
X-Put-Timestamp: 1442249536.31989
     Connection: keep-alive
    X-Timestamp: 1442249536.31989
     X-Trans-Id: tx5493faa15be44efeac2e6-0055f6fb3f
   Content-Type: text/plain; charset=utf-8</pre></div><p>
  Use the following command to create a container:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container create <em class="replaceable">CONTAINER_NAME</em></pre></div><p>
  Example, creating a container named <code class="literal">documents</code>:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container create documents</pre></div><p>
  The newly created container appears. But there are no objects:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container show documents
         Account: AUTH_205804d000a242d385b8124188284998
       Container: documents
         Objects: 0
           Bytes: 0
        Read ACL:
       Write ACL:
         Sync To:
        Sync Key:
   Accept-Ranges: bytes
X-Storage-Policy: General
      Connection: keep-alive
     X-Timestamp: 1442249637.69486
      X-Trans-Id: tx1f59d5f7750f4ae8a3929-0055f6fbcc
    Content-Type: text/plain; charset=utf-8</pre></div><p>
  Upload a document:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack object create <em class="replaceable">CONTAINER_NAME</em> <em class="replaceable">FILENAME</em></pre></div><p>
  Example:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack object create documents mydocument
mydocument</pre></div><p>
  List objects in the container:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack object list <em class="replaceable">CONTAINER_NAME</em></pre></div><p>
  Example using a container called <code class="literal">documents</code>:
 </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack object list documents
mydocument</pre></div><div id="id-1.5.11.9.25" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
   This is a brief introduction to the <code class="command">swift</code> CLI. Use the
   <code class="command">swift --help</code> command for more information. You can also
   use the OpenStack CLI, see <code class="command">openstack -h</code> for more
   information.
  </p></div></section><section class="sect1" id="swift-ring-management" data-id-title="Managing swift Rings"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.5 </span><span class="title-name">Managing swift Rings</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#swift-ring-management">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-ring_management.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  swift rings are a machine-readable description of which disk drives are used
  by the Object Storage service (for example, a drive is used to store account
  or object data). Rings also specify the policy for data storage (for example,
  defining the number of replicas). The rings are automatically built during
  the initial deployment of your cloud, with the configuration provided during
  setup of the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Input Model. For more information, see
  <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 5 “Input Model”</span>.
 </p><p>
  After successful deployment of your cloud, you may want to change or modify
  the configuration for swift. For example, you may want to add or remove swift
  nodes, add additional storage policies, or upgrade the size of the disk
  drives. For instructions, see <a class="xref" href="ops-managing-objectstorage.html#change-swift-rings" title="9.5.5. Applying Input Model Changes to Existing Rings">Section 9.5.5, “Applying Input Model Changes to Existing Rings”</a> and
  <a class="xref" href="ops-managing-objectstorage.html#add-storage-policy" title="9.5.6. Adding a New Swift Storage Policy">Section 9.5.6, “Adding a New Swift Storage Policy”</a>.
 </p><div id="id-1.5.11.10.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
   The process of modifying or adding a configuration is similar to other
   configuration or topology changes in the cloud. Generally, you make the
   changes to the input model files at
   <code class="literal">~/openstack/my_cloud/definition/</code> on the Cloud Lifecycle Manager and then
   run Ansible playbooks to reconfigure the system.
  </p></div><p>
  Changes to the rings require several phases to complete, therefore, you may
  need to run the playbooks several times over several days.
 </p><p>
  The following topics cover ring management.
 </p><section class="sect2" id="swift-ring-rebalance" data-id-title="Rebalancing Swift Rings"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.1 </span><span class="title-name">Rebalancing Swift Rings</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#swift-ring-rebalance">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-rebalanced_explained.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The swift ring building process tries to distribute data evenly among the
  available disk drives. The data is stored in partitions. (For more
  information, see <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 11 “Modifying Example Configurations for Object Storage using Swift”, Section 11.10 “Understanding Swift Ring Specifications”</span>.) If you, for example,
  double the number of disk drives in a ring, you need to move 50% of the
  partitions to the new drives so that all drives contain the same number of
  partitions (and hence same amount of data). However, it is not possible to
  move the partitions in a single step. It can take minutes to hours to move
  partitions from the original drives to their new drives (this process is
  called the replication process).
 </p><p>
  If you move all partitions at once, there would be a period where swift would
  expect to find partitions on the new drives, but the data has not yet
  replicated there so that swift could not return the data to the user.
  Therefore, swift will not be able to find all of the data in the middle of
  replication because some data has finished replication while other bits of
  data are still in the old locations and have not yet been moved. So it is
  considered best practice to move only one replica at a time. If the replica
  count is 3, you could first move 16.6% of the partitions and then wait until
  all data has replicated. Then move another 16.6% of partitions. Wait again
  and then finally move the remaining 16.6% of partitions. For any given
  object, only one of the replicas is moved at a time.
 </p><section class="sect3" id="id-1.5.11.10.7.4" data-id-title="Reasons to Move Partitions Gradually"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.1.1 </span><span class="title-name">Reasons to Move Partitions Gradually</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#id-1.5.11.10.7.4">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-rebalanced_explained.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Due to the following factors, you must move the partitions gradually:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     Not all devices are of the same size. <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 automatically
     assigns different weights to drives so that smaller drives store fewer
     partitions than larger drives.
    </p></li><li class="listitem"><p>
     The process attempts to keep replicas of the same partition in different
     servers.
    </p></li><li class="listitem"><p>
     Making a large change in one step (for example, doubling the number of
     drives in the ring), would result in a lot of network traffic due to the
     replication process and the system performance suffers. There are two ways
     to mitigate this:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
       Add servers in smaller groups
      </p></li><li class="listitem"><p>
       Set the weight-step attribute in the ring specification. For more
       information, see <a class="xref" href="ops-managing-objectstorage.html#swift-weight-att" title="9.5.2. Using the Weight-Step Attributes to Prepare for Ring Changes">Section 9.5.2, “Using the Weight-Step Attributes to Prepare for Ring Changes”</a>.
      </p></li></ul></div></li></ul></div></section></section><section class="sect2" id="swift-weight-att" data-id-title="Using the Weight-Step Attributes to Prepare for Ring Changes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.2 </span><span class="title-name">Using the Weight-Step Attributes to Prepare for Ring Changes</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#swift-weight-att">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_weight_attribute.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  swift rings are built during a deployment and this process sets the weights
  of disk drives such that smaller disk drives have a smaller weight than
  larger disk drives. When making changes in the ring, you should limit the
  amount of change that occurs. <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 does this by limiting the
  weights of the new drives to a smaller value and then building new rings.
  Once the replication process has finished, <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 will increase the
  weight and rebuild rings to trigger another round of replication. (For more
  information, see <a class="xref" href="ops-managing-objectstorage.html#swift-ring-rebalance" title="9.5.1. Rebalancing Swift Rings">Section 9.5.1, “Rebalancing Swift Rings”</a>.)
 </p><p>
  In addition, you should become familiar with how the replication process
  behaves on your system during normal operation. Before making ring changes,
  use the <code class="literal">swift-recon</code> command to determine the typical
  oldest replication times for your system. For instructions, see
  <a class="xref" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t" title="9.5.4. Determining When to Rebalance and Deploy a New Ring">Section 9.5.4, “Determining When to Rebalance and Deploy a New Ring”</a>.
 </p><p>
  In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, the weight-step attribute is set in the ring specification of
  the input model. The weight-step value specifies a maximum value for the
  change of the weight of a drive in any single rebalance. For example, if you
  add a drive of 4TB, you would normally assign a weight of 4096. However, if
  the weight-step attribute is set to 1024 instead then when you add that drive
  the weight is initially set to 1024. The next time you rebalance the ring,
  the weight is set to 2048. The subsequent rebalance would then set the weight
  to the final value of 4096.
 </p><p>
  The value of the weight-step attribute is dependent on the size of the
  drives, number of the servers being added, and how experienced you are with
  the replication process. A common starting value is to use 20% of the size of
  an individual drive. For example, when adding X number of 4TB drives a value
  of 820 would be appropriate. As you gain more experience with your system,
  you may increase or reduce this value.
 </p><section class="sect3" id="setting-weight-step-attribute" data-id-title="Setting the weight-step attribute"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.2.1 </span><span class="title-name">Setting the weight-step attribute</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#setting-weight-step-attribute">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_weight_attribute.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Perform the following steps to set the weight-step attribute:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Log in to the Cloud Lifecycle Manager.
    </p></li><li class="listitem"><p>
     Edit the
     <code class="filename">~/openstack/my_cloud/definition/data/swift/swift_config.yml</code> file
     containing the ring-specifications for the account, container, and object
     rings.
    </p><p>
     Add the weight-step attribute to the ring in this format:
    </p><div class="verbatim-wrap"><pre class="screen">- name: account
  weight-step: <em class="replaceable">WEIGHT_STEP_VALUE</em>
  display-name: Account Ring
  min-part-hours: 16
  ...</pre></div><p>
     For example, to set weight-step to 820, add the attribute like this:
    </p><div class="verbatim-wrap"><pre class="screen">- name: account
  weight-step: <span class="bold"><strong>820</strong></span>
  display-name: Account Ring
  min-part-hours: 16
  ...</pre></div></li><li class="listitem"><p>
     Repeat step 2 for the other rings, if necessary (container, object-0,
     etc).
    </p></li><li class="listitem"><p>
     Run the configuration processor:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
     Use the playbook to create a deployment directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     To complete the configuration, use the ansible playbooks documented in
     <a class="xref" href="ops-managing-objectstorage.html#swift-ansible-playbooks" title="9.5.3. Managing Rings Using swift Playbooks">Section 9.5.3, “Managing Rings Using swift Playbooks”</a>.
    </p></li></ol></div></section></section><section class="sect2" id="swift-ansible-playbooks" data-id-title="Managing Rings Using swift Playbooks"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.3 </span><span class="title-name">Managing Rings Using swift Playbooks</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#swift-ansible-playbooks">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_ring_mgmt.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The following table describes how playbooks relate to ring management.
 </p><p>
  All of these playbooks will be run from the Cloud Lifecycle Manager from the
  <code class="literal">~/scratch/ansible/next/ardana/ansible</code> directory.
 </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Playbook</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Description</th><th style="border-bottom: 1px solid ; ">Notes</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">swift-update-from-model-rebalance-rings.yml</code>
     </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
      <p>
       There are two steps in this playbook:
      </p>
      <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Make delta
        </p><p>
         It processes the input model and compares it against the existing
         rings. After comparison, it produces a list of differences between
         the input model and the existing rings. This is called the ring
         delta. The ring delta covers drives being added, drives being
         removed, weight changes, and replica count changes.
        </p></li></ul></div>
      <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Rebalance
        </p><p>
         The ring delta is then converted into a series of commands (such as
         <code class="literal">add</code>) to the swift-ring-builder program. Finally,
         the <code class="literal">rebalance</code> command is issued to the
         swift-ring-builder program.
        </p></li></ul></div>
     </td><td style="border-bottom: 1px solid ; ">
      <p>
       This playbook performs its actions on the first node running the
       swift-proxy service. (For more information, see
       <a class="xref" href="idg-all-operations-troubleshooting-troubleshooting-issues-xml-1.html#topic-rtc-s3t-mt" title="18.6.2.4. Identifying the Swift Ring Building Server">Section 18.6.2.4, “Identifying the Swift Ring Building Server”</a>.) However, it also scans all swift
       nodes to find the size of disk drives.
      </p>
      <p>
       If there are no changes in the ring delta, the
       <code class="literal">rebalance</code> command is still executed to rebalance the
       rings. If <code class="literal">min-part-hours</code> has not yet elapsed or if
       no partitions need to be moved, new rings are not written.
      </p>
     </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">swift-compare-model-rings.yml</code>
     </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
      <p>
       There are two steps in this playbook:
      </p>
      <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Make delta
        </p><p>
         This is the same as described for
         <code class="literal">swift-update-from-model-rebalance-rings.yml</code>.
        </p></li></ul></div>
      <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
         Report
        </p><p>
         This prints a summary of the proposed changes that will be made to
         the rings (that is, what would happen if you rebalanced).
        </p></li></ul></div>
      <p>
       The playbook reports any issues or problems it finds with the input
       model.
      </p>
      <p>
       This playbook can be useful to confirm that there are no errors in the
       input model. It also allows you to check that when you change the input
       model, that the proposed ring changes are as expected. For example, if
       you have added a server to the input model, but this playbook reports
       that no drives are being added, you should determine the cause.
      </p>
     </td><td style="border-bottom: 1px solid ; ">
      <p>
       There is troubleshooting information related to the information that
       you receive in this report that you can view on this page:
       <a class="xref" href="idg-all-operations-troubleshooting-troubleshooting-issues-xml-1.html#sec-input-swift-error" title="18.6.2.3. Interpreting Swift Input Model Validation Errors">Section 18.6.2.3, “Interpreting Swift Input Model Validation Errors”</a>.
      </p>
     </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">swift-deploy.yml</code>
     </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
      <p>
       <code class="literal">swift-deploy.yml</code> is responsible for installing
       software and configuring swift on nodes. As part of installing and
       configuring, it runs the
       <code class="literal">swift-update-from-model-rebalance-rings.yml</code> and
       <code class="literal">swift-reconfigure.yml</code> playbooks.
      </p>
     </td><td style="border-bottom: 1px solid ; ">
      <p>
       This playbook is included in the <code class="literal">ardana-deploy.yml</code> and
       <code class="literal">site.yml</code> playbooks, so if you run either of those
       playbooks, the <code class="literal">swift-deploy.yml</code> playbook is also
       run.
      </p>
     </td></tr><tr><td style="border-right: 1px solid ; "><code class="literal">swift-reconfigure.yml</code>
     </td><td style="border-right: 1px solid ; ">
      <p>
       <code class="literal">swift-reconfigure.yml</code> takes rings that the
       <code class="literal">swift-update-from-model-rebalance-rings.yml</code>
       playbook has changed and copies those rings to all swift nodes.
      </p>
     </td><td>
      <p>
       Every time that you directly use the
       <code class="literal">swift-update-from-model-rebalance-rings.yml</code>
       playbook, you must copy these rings to the system using the
       <code class="literal">swift-reconfigure.yml</code> playbook. If you forget and
       run <code class="literal">swift-update-from-model-rebalance-rings.yml</code>
       twice, the process may move two replicates of some partitions at the
       same time.
      </p>
     </td></tr></tbody></table></div><section class="sect3" id="variables" data-id-title="Optional Ansible variables related to ring management"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.3.1 </span><span class="title-name">Optional Ansible variables related to ring management</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#variables">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_ring_mgmt.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The following optional variables may be specified when running the playbooks
   outlined above. They are specified using the <code class="literal">--extra-vars</code>
   option.
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Variable</th><th style="border-bottom: 1px solid ; ">Description and Use</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><code class="literal">limit_ring</code>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        Limit changes to the named ring. Other rings will not be examined or
        updated. This option may be used with any of the swift playbooks. For
        example, to only update the <code class="literal">object-1</code> ring, use the
        following command:
       </p>
<div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-update-from-model-rebalance-rings.yml --extra-vars "limit-ring=object-1"</pre></div>
      </td></tr><tr><td style="border-right: 1px solid ; ">drive_detail</td><td>
       <p>
        Used only with the swift-compare-model-rings.yml playbook. The playbook
        will include details of changes to every drive where the model and
        existing rings differ. If you omit the drive_detail variable, only
        summary information is provided. The following shows how to use the
        drive_detail variable:
       </p>
<div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-compare-model-rings.yml --extra-vars "drive_detail=yes"</pre></div>
      </td></tr></tbody></table></div></section><section class="sect3" id="id-1.5.11.10.9.6" data-id-title="Interpreting the report from the swift-compare-model-rings.yml playbook"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.3.2 </span><span class="title-name">Interpreting the report from the swift-compare-model-rings.yml playbook</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#id-1.5.11.10.9.6">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_ring_mgmt.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The <code class="literal">swift-compare-model-rings.yml</code> playbook compares the
   existing swift rings with the input model and prints a report telling you
   how the rings and the model differ. Specifically, it will tell you what
   actions will take place when you next run the
   <code class="literal">swift-update-from-model-rebalance-rings.yml</code> playbook (or
   a playbook such as <code class="literal">ardana-deploy.yml</code> that runs
   <code class="literal">swift-update-from-model-rebalance-rings.yml</code>).
  </p><p>
   The <code class="literal">swift-compare-model-rings.yml</code> playbook will make no
   changes, but is just an advisory report.
  </p><p>
   Here is an example output from the playbook. The report is between
   "report.stdout_lines" and "PLAY RECAP":
  </p><div class="verbatim-wrap"><pre class="screen">TASK: [swiftlm-ring-supervisor | validate-input-model | Print report] *********
ok: [ardana-cp1-c1-m1-mgmt] =&gt; {
    "var": {
        "report.stdout_lines": [
            "Rings:",
            "  ACCOUNT:",
            "    ring exists (minimum time to next rebalance: 8:07:33)",
            "    will remove 1 devices (18.00GB)",
            "    ring will be rebalanced",
            "  CONTAINER:",
            "    ring exists (minimum time to next rebalance: 8:07:35)",
            "    no device changes",
            "    ring will be rebalanced",
            "  OBJECT-0:",
            "    ring exists (minimum time to next rebalance: 8:07:34)",
            "    no device changes",
            "    ring will be rebalanced"
        ]
    }
}</pre></div><p>
   The following describes the report in more detail:
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Message</th><th style="border-bottom: 1px solid ; ">Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        ring exists
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The ring already exists on the system.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        ring will be created
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The ring does not yet exist on the system.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        no device changes
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The devices in the ring exactly match the input model. There are no
        servers being added or removed and the weights are appropriate for the
        size of the drives.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        minimum time to next rebalance
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        If this time is <code class="literal">0:00:00</code>, if you run one of the swift
        playbooks that update rings, the ring will be rebalanced.
       </p>
       <p>
        If the time is non-zero, it means that not enough time has elapsed
        since the ring was last rebalanced. Even if you run a swift playbook
        that attempts to change the ring, the ring will not actually
        rebalance. This time is determined by the
        <code class="literal">min-part-hours</code> attribute.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        set-weight ardana-ccp-c1-m1-mgmt:disk0:/dev/sdc 8.00 &gt; 12.00 &gt; 18.63
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The weight of disk0 (mounted on /dev/sdc) on server
        <code class="literal">ardana-ccp-c1-m1-mgmt</code> is currently set to 8.0 but
        should be 18.83 given the size of the drive. However, in this example,
        we cannot go directly from 8.0 to 18.63 because of the weight-step
        attribute. Hence, the proposed weight change is from 8.0 to 12.0.
       </p>
       <p>
        This information is only shown when you the
        <code class="literal">drive_detail=yes</code> argument when running the playbook.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        will change weight on 12 devices (6.00TB)
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The weight of 12 devices will be increased. This might happen for
        example, if a server had been added in a prior ring update. However,
        with use of the <code class="literal">weight-step</code> attribute, the system
        gradually increases the weight of these new devices. In this example,
        the change in weight represents 6TB of total available storage. For
        example, if your system currently has 100TB of available storage, when
        the weight of these devices is changed, there will be 106TB of
        available storage. If your system is 50% utilized, this means that when
        the ring is rebalanced, up to 3TB of data may be moved by the
        replication process. This is an estimate - in practice, because only
        one copy of a given replica is moved in any given rebalance, it may not
        be possible to move this amount of data in a single ring rebalance.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        add: ardana-ccp-c1-m1-mgmt:disk0:/dev/sdc
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The disk0 device will be added to the ardana-ccp-c1-m1-mgmt server. This
        happens when a server is added to the input model or if a disk model is
        changed to add additional devices.
       </p>
       <p>
        This information is only shown when you the
        <code class="literal">drive_detail=yes</code> argument when running the
        playbook.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        remove: ardana-ccp-c1-m1-mgmt:disk0:/dev/sdc
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The device is no longer in the input model and will be removed from the
        ring. This happens if a server is removed from the model, a disk drive
        is removed from a disk model or the server is marked for removal using
        the pass-through feature.
       </p>
       <p>
        This information is only shown when you the
        <code class="literal">drive_detail=yes</code> argument when running the
        playbook.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        will add 12 devices (6TB)
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        There are 12 devices in the input model that have not yet been added to
        the ring. Usually this is because one or more servers have been added.
        In this example, this could be one server with 12 drives or two
        servers, each with 6 drives. The size in the report is the change in
        total available capacity. When the weight-step attribute is used, this
        may be a fraction of the total size of the disk drives. In this
        example, 6TB of capacity is being added. For example, if your system
        currently has 100TB of available storage, when these devices are added,
        there will be 106TB of available storage. If your system is 50%
        utilized, this means that when the ring is rebalanced, up to 3TB of
        data may be moved by the replication process. This is an estimate - in
        practice, because only one copy of a given replica is moved in any
        given rebalance, it may not be possible to move this amount of data in
        a single ring rebalance.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        will remove 12 devices (6TB)
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        There are 12 devices in rings that no longer appear in the input model.
        Usually this is because one or more servers have been removed. In this
        example, this could be one server with 12 drives or two servers, each
        with 6 drives. The size in the report is the change in total removed
        capacity. In this example, 6TB of capacity is being removed. For
        example, if your system currently has 100TB of available storage, when
        these devices are removed, there will be 94TB of available storage. If
        your system is 50% utilized, this means that when the ring is
        rebalanced, approximately 3TB of data must be moved by the replication
        process.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        min-part-hours will be changed
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The <code class="literal">min-part-hours</code> attribute has been changed in the
        ring specification in the input model.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       <p>
        replica-count will be changed
       </p>
      </td><td style="border-bottom: 1px solid ; ">
       <p>
        The <code class="literal">replica-count</code> attribute has been changed in the
        ring specification in the input model.
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       <p>
        ring will be rebalanced
       </p>
      </td><td>
       <p>
        This is always reported. Every time the
        <code class="literal">swift-update-from-model-rebalance-rings.yml</code> playbook
        is run, it will execute the swift-ring-builder rebalance command. This
        happens even if there were no input model changes. If the ring is
        already well balanced, the swift-ring-builder will not rewrite the
        ring.
       </p>
      </td></tr></tbody></table></div></section></section><section class="sect2" id="topic-ohx-j1t-4t" data-id-title="Determining When to Rebalance and Deploy a New Ring"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.4 </span><span class="title-name">Determining When to Rebalance and Deploy a New Ring</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-safe_rebalance_deploy_ring.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Before deploying a new ring, you must be sure the change that has been
  applied to the last ring is complete (that is, all the partitions are in
  their correct location). There are three aspects to this:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Is the replication system busy?
   </p><p>
    You might want to postpone a ring change until after replication has
    finished. If the replication system is busy repairing a failed drive, a
    ring change will place additional load on the system. To check that
    replication has finished, use the <code class="literal">swift-recon</code> command
    with the <span class="bold"><strong>--replication</strong></span> argument. (For more
    information, see <a class="xref" href="ops-managing-objectstorage.html#swift-recon" title="9.2. Gathering Swift Data">Section 9.2, “Gathering Swift Data”</a>.) The
    oldest completion time can indicate that the replication process is very
    busy. If it is more than 15 or 20 minutes then the object replication
    process are probably still very busy. The following example indicates
    that the oldest completion is 120 seconds, so that the replication
    process is probably not busy:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root # </code>swift-recon --replication
===============================================================================
--&gt; Starting reconnaissance on 3 hosts
===============================================================================
[2015-10-02 15:31:45] Checking on replication
[replication_time] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%, no_result: 0, reported: 3
Oldest completion was 2015-10-02 15:31:32 (120 seconds ago) by 192.168.245.4:6000.
Most recent completion was 2015-10-02 15:31:43 (10 seconds ago) by 192.168.245.3:6000.
===============================================================================</pre></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    Are there drive or server failures?
   </p><p>
    A drive failure does not preclude deploying a new ring. In principle, there
    should be two copies elsewhere. However, another drive failure in the
    middle of replication might make data temporary unavailable. If possible,
    postpone ring changes until all servers and drives are operating normally.
   </p></li><li class="listitem"><p>
    Has <code class="literal">min-part-hours</code> elapsed?
   </p><p>
    The <code class="literal">swift-ring-builder</code> will refuse to build a new ring
    until the <code class="literal">min-part-hours</code> has elapsed since the last time
    it built rings. You must postpone changes until this time has elapsed.
   </p><p>
    You can determine how long you must wait by running the
    <code class="literal">swift-compare-model-rings.yml</code> playbook, which will tell
    you how long you until the <code class="literal">min-part-hours</code> has elapsed.
    For more details, see <a class="xref" href="ops-managing-objectstorage.html#swift-ansible-playbooks" title="9.5.3. Managing Rings Using swift Playbooks">Section 9.5.3, “Managing Rings Using swift Playbooks”</a>.
   </p><p>
    You can change the value of <code class="literal">min-part-hours</code>. (For
    instructions, see <a class="xref" href="ops-managing-objectstorage.html#min-part-hours" title="9.5.7. Changing min-part-hours in Swift">Section 9.5.7, “Changing min-part-hours in Swift”</a>).
   </p></li><li class="listitem"><p>
    Is the swift dispersion report clean?
   </p><p>
    Run the <code class="literal">swift-dispersion-report.yml</code> playbook (as
    described in <a class="xref" href="ops-managing-objectstorage.html#swift-healthcheck" title="9.1. Running the swift Dispersion Report">Section 9.1, “Running the swift Dispersion Report”</a>) and
    examine the results. If the replication process has not yet replicated
    partitions that were moved to new drives in the last ring rebalance, the
    dispersion report will indicate that some containers or objects are
    missing a copy.
   </p><p>
    For example:
   </p><div class="verbatim-wrap"><pre class="screen">There were 462 partitions missing one copy.</pre></div><p>
    Assuming all servers and disk drives are operational, the reason for the
    missing partitions is that the replication process has not yet managed to
    copy a replica into the partitions.
   </p><p>
    You should wait an hour and rerun the dispersion report process and examine
    the report. The number of partitions missing one copy should have reduced.
    Continue to wait until this reaches zero before making any further ring
    rebalances.
   </p><div id="id-1.5.11.10.10.4.3.7" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     It is normal to see partitions missing one copy if disk drives or
     servers are down. If all servers and disk drives are mounted, and you
     did not recently perform a ring rebalance, you should investigate
     whether there are problems with the replication process. You can use the
     Operations Console to investigate replication issues.
    </p></div><div id="id-1.5.11.10.10.4.3.8" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.svg"/><div class="admon-title">Important</div><p>
     If there are any partitions missing two copies, you must reboot or repair
     any failed servers and disk drives as soon as possible. Do not shutdown
     any swift nodes in this situation. Assuming a replica count of 3, if you
     are missing two copies you are in danger of losing the only remaining
     copy.
    </p></div></li></ul></div></section><section class="sect2" id="change-swift-rings" data-id-title="Applying Input Model Changes to Existing Rings"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.5 </span><span class="title-name">Applying Input Model Changes to Existing Rings</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#change-swift-rings">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-input_model_change_existing_rings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This page describes a general approach for making changes to your existing
  swift rings. This approach applies to actions such as adding and removing a
  server and replacing and upgrading disk drives, and must be performed as a
  series of phases, as shown below:
 </p><section class="sect3" id="change-inputmodel" data-id-title="Changing the Input Model Configuration Files"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.5.1 </span><span class="title-name">Changing the Input Model Configuration Files</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#change-inputmodel">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-input_model_change_existing_rings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The first step to apply new changes to the swift environment is to update
   the configuration files. Follow these steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Log in to the Cloud Lifecycle Manager.
    </p></li><li class="listitem"><p>
     Set the weight-step attribute, as needed, for the nodes you are altering.
     (For instructions, see <a class="xref" href="ops-managing-objectstorage.html#swift-weight-att" title="9.5.2. Using the Weight-Step Attributes to Prepare for Ring Changes">Section 9.5.2, “Using the Weight-Step Attributes to Prepare for Ring Changes”</a>).
    </p></li><li class="listitem"><p>
     Edit the configuration files as part of the Input Model as appropriate.
     (For general information about the Input Model, see
     <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 6 “Configuration Objects”, Section 6.14 “Networks”</span>. For more specific information about
     the swift parts of the configuration files, see
     <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 11 “Modifying Example Configurations for Object Storage using Swift”</span>)
    </p></li><li class="listitem"><p>
     Once you have completed all of the changes, commit your configuration to
     the local git repository. (For more information,
     see<span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>.) :
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git add -A
<code class="prompt user">root # </code>git commit -m "commit message"</pre></div></li><li class="listitem"><p>
     Run the configuration processor:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
     Create a deployment directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     Run the swift playbook that will validate your configuration files and
     give you a report as an output:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">root # </code>ansible-playbook -i hosts/verb_hosts swift-compare-model-rings.yml</pre></div></li><li class="listitem"><p>
     Use the report to validate that the number of drives proposed to be added
     or deleted, or the weight change, is correct. Fix any errors in your input
     model. At this stage, no changes have been made to rings.
    </p></li></ol></div></section><section class="sect3" id="first-rebalance" data-id-title="First phase of Ring Rebalance"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.5.2 </span><span class="title-name">First phase of Ring Rebalance</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#first-rebalance">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-input_model_change_existing_rings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To begin the rebalancing of the swift rings, follow these steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     After going through the steps in the section above, deploy your changes to
     all of the swift nodes in your environment by running this playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-deploy.yml</pre></div></li><li class="listitem"><p>
     Wait until replication has finished or <code class="literal">min-part-hours</code>
     has elapsed (whichever is longer). For more information, see
     <a class="xref" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t" title="9.5.4. Determining When to Rebalance and Deploy a New Ring">Section 9.5.4, “Determining When to Rebalance and Deploy a New Ring”</a>
    </p></li></ol></div></section><section class="sect3" id="weight-change" data-id-title="Weight Change Phase of Ring Rebalance"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.5.3 </span><span class="title-name">Weight Change Phase of Ring Rebalance</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#weight-change">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-input_model_change_existing_rings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   At this stage, no changes have been made to the input model. However, when
   you set the <code class="literal">weight-step</code> attribute, the rings that were
   rebuilt in the previous rebalance phase have weights that are different than
   their target/final value. You gradually move to the target/final weight by
   rebalancing a number of times as described on this page. For more
   information about the weight-step attribute, see
   <a class="xref" href="ops-managing-objectstorage.html#swift-weight-att" title="9.5.2. Using the Weight-Step Attributes to Prepare for Ring Changes">Section 9.5.2, “Using the Weight-Step Attributes to Prepare for Ring Changes”</a>.
  </p><p>
   To begin the re-balancing of the rings, follow these steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Rebalance the rings by running the playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-update-from-model-rebalance-rings.yml</pre></div></li><li class="listitem"><p>
     Run the reconfiguration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-reconfigure.yml</pre></div></li><li class="listitem"><p>
     Wait until replication has finished or <code class="literal">min-part-hours</code>
     has elapsed (whichever is longer). For more information, see
     <a class="xref" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t" title="9.5.4. Determining When to Rebalance and Deploy a New Ring">Section 9.5.4, “Determining When to Rebalance and Deploy a New Ring”</a>
    </p></li><li class="listitem"><p>
     Run the following command and review the report:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-compare-model-rings.yml --limit SWF*</pre></div><p>
     The following is an example of the output after executing the above
     command. In the example <span class="bold"><strong>no</strong></span> weight changes
     are proposed:
    </p><div class="verbatim-wrap"><pre class="screen">TASK: [swiftlm-ring-supervisor | validate-input-model | Print report] *********
ok: [padawan-ccp-c1-m1-mgmt] =&gt; {
    "var": {
        "report.stdout_lines": [
            "Need to add 0 devices",
            "Need to remove 0 devices",
            "<span class="bold"><strong>Need to set weight on 0 devices</strong></span>"
        ]
    }
}</pre></div></li><li class="listitem"><p>
     When there are no proposed weight changes, you proceed to the final phase.
    </p></li><li class="listitem"><p>
     If there are proposed weight changes repeat this phase again.
    </p></li></ol></div></section><section class="sect3" id="final-rebalance" data-id-title="Final Rebalance Phase"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.5.4 </span><span class="title-name">Final Rebalance Phase</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#final-rebalance">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-input_model_change_existing_rings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The final rebalance phase moves all replicas to their final destination.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Rebalance the rings by running the playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-update-from-model-rebalance-rings.yml | tee /tmp/rebalance.log</pre></div><div id="id-1.5.11.10.11.6.3.1.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      The output is saved for later reference.
     </p></div></li><li class="listitem"><p>
     Review the output from the previous step. If the output for all rings is
     similar to the following, the rebalance had no effect. That is, the rings
     are balanced and no further changes are needed. In addition, the ring
     files were not changed so you do not need to deploy them to the swift
     nodes:
    </p><div class="verbatim-wrap"><pre class="screen">"Running: swift-ring-builder /etc/swiftlm/cloud1/cp1/builder_dir/account.builder rebalance 999",
      "NOTE: No partitions could be reassigned.",
      "Either none need to be or none can be due to min_part_hours [16]."</pre></div><p>
     The text <span class="bold"><strong>No partitions could be
     reassigned</strong></span> indicates that no further rebalances are necessary.
     If this is true for all the rings, you have completed the final phase.
    </p><div id="id-1.5.11.10.11.6.3.2.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
      You must have allowed enough time to elapse since the last rebalance.
      As mentioned in the above example, <code class="literal">min_part_hours [16]</code>
      means that you must wait at least 16 hours since the last rebalance. If
      not, you should wait until enough time has elapsed and repeat this
      phase.
     </p></div></li><li class="listitem"><p>
     Run the <code class="literal">swift-reconfigure.yml</code> playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-reconfigure.yml</pre></div></li><li class="listitem"><p>
     Wait until replication has finished or <code class="literal">min-part-hours</code>
     has elapsed (whichever is longer). For more information see
     <a class="xref" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t" title="9.5.4. Determining When to Rebalance and Deploy a New Ring">Section 9.5.4, “Determining When to Rebalance and Deploy a New Ring”</a>
    </p></li><li class="listitem"><p>
     Repeat the above steps until the ring is rebalanced.
    </p></li></ol></div></section><section class="sect3" id="system-changes" data-id-title="System Changes that Change Existing Rings"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.5.5 </span><span class="title-name">System Changes that Change Existing Rings</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#system-changes">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-input_model_change_existing_rings.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   There are many system changes ranging from adding servers to replacing
   drives, which might require you to rebuild and rebalance your rings.
  </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; "><span class="bold"><strong>Actions</strong></span>
      </th><th style="border-bottom: 1px solid ; "><span class="bold"><strong>Process</strong></span>
      </th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Adding Servers(s)</td><td style="border-bottom: 1px solid ; ">
       <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          If not already done, set the weight change attribute. For
          instructions, see <a class="xref" href="ops-managing-objectstorage.html#swift-weight-att" title="9.5.2. Using the Weight-Step Attributes to Prepare for Ring Changes">Section 9.5.2, “Using the Weight-Step Attributes to Prepare for Ring Changes”</a>
         </p></li><li class="listitem"><p>
          Add servers in phases:
         </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            This reduces the impact of the changes on your system.
           </p></li><li class="listitem"><p>
            If your rings use swift zones, ensure that you add the same
            number of servers to each zone at each phase.
           </p></li></ul></div></li></ul></div>
       <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          To add a server, see <a class="xref" href="system-maintenance.html#sec-swift-add-object-node" title="15.1.5.1.1. Adding a Swift Object Node">Section 15.1.5.1.1, “Adding a Swift Object Node”</a>.
         </p></li><li class="listitem"><p>
          Incrementally change the weights and perform the final rebalance. For
          instructions, see <a class="xref" href="ops-managing-objectstorage.html#final-rebalance" title="9.5.5.4. Final Rebalance Phase">Section 9.5.5.4, “Final Rebalance Phase”</a>.
         </p></li></ul></div>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Removing Server(s)</td><td style="border-bottom: 1px solid ; ">
       <p>
        In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>, when you remove servers from the input model, the
        disk drives are removed from the ring - the weight is not gradually
        reduced using the <code class="literal">weight-step</code> attribute.
       </p>
       <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Remove servers in phases:
         </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            This reduces the impact of the changes on your system.
           </p></li><li class="listitem"><p>
            If your rings use swift zones, ensure you remove the same number of
            servers for each zone at each phase.
           </p></li></ul></div></li></ul></div>
       <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          To remove a server, see <a class="xref" href="system-maintenance.html#remove-swift-node" title="15.1.5.1.4. Removing a Swift Node">Section 15.1.5.1.4, “Removing a Swift Node”</a>.
         </p></li><li class="listitem"><p>
          To perform the final rebalance, see <a class="xref" href="ops-managing-objectstorage.html#final-rebalance" title="9.5.5.4. Final Rebalance Phase">Section 9.5.5.4, “Final Rebalance Phase”</a>.
         </p></li></ul></div>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
       Adding Disk Drive(s)
      </td><td style="border-bottom: 1px solid ; ">
	<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
	   If not already done, set the weight attribute. For instructions, see <a class="xref" href="ops-managing-objectstorage.html#swift-weight-att" title="9.5.2. Using the Weight-Step Attributes to Prepare for Ring Changes">Section 9.5.2, “Using the Weight-Step Attributes to Prepare for Ring Changes”</a>.
	  </p></li><li class="listitem"><p>
	   Add the drives to your input model.
	  </p></li></ul></div>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Replacing Disk Drive(s)</td><td style="border-bottom: 1px solid ; ">
       <p>
        When a drive fails, replace it as soon as possible. Do not attempt to
        remove it from the ring - this creates operator overhead. swift will
        continue to store the correct number of replicas by handing off objects
        to other drives instead of the failed drive.
       </p>
       <p>
        If the disk drives are of the same size as the original when the
        drive is replaced, no ring changes are required. You can confirm this
        by running the
        <code class="literal">swift-update-from-model-rebalance-rings.yml</code>
        playbook. It should report that no weight changes are needed.
       </p>
       <p>
        For a single drive replacement, even if the drive is significantly
        larger than the original drives, you do not need to rebalance the ring
        (however, the extra space on the drive will not be used).
       </p>
      </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Upgrading Disk Drives</td><td style="border-bottom: 1px solid ; ">
       <p>
        If the drives are different size (for example, you are upgrading your
        system), you can proceed as follows:
       </p>
       <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          If not already done, set the weight-step attribute
         </p></li><li class="listitem"><p>
          Replace drives in phases:
         </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            Avoid replacing too many drives at once.
           </p></li><li class="listitem"><p>
            If your rings use swift zones, upgrade a number of drives in the
            same zone at the same time - not drives in several zones.
           </p></li><li class="listitem"><p>
            It is also safer to upgrade one server instead of drives in several
            servers at the same time.
           </p></li><li class="listitem"><p>
            Remember that the final size of all swift zones must be the same,
            so you may need to replace a small number of drives in one zone,
            then a small number in second zone, then return to the first zone
            and replace more drives, etc.
           </p></li></ul></div></li></ul></div>
      </td></tr><tr><td style="border-right: 1px solid ; ">
       Removing Disk Drive(s)
      </td><td>
       <p>
	When removing a disk drive from the input model, keep in mind that this
	drops the disk out of the ring without allowing Swift to move the data
	off it first. While it should be fine in a properly replicated healthy
	cluster, we do not recommend this approach. A better solution is to
	step down <code class="literal">weight_step</code> to 0 to allow Swift to move
	data.
       </p>
      </td></tr></tbody></table></div></section></section><section class="sect2" id="add-storage-policy" data-id-title="Adding a New Swift Storage Policy"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.6 </span><span class="title-name">Adding a New Swift Storage Policy</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#add-storage-policy">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-add_new_storage_policy.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  This page describes how to add an additional storage policy to an existing
  system. For an overview of storage policies, see
  <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 11 “Modifying Example Configurations for Object Storage using Swift”, Section 11.11 “Designing Storage Policies”</span>.
 </p><p>
  <span class="bold"><strong>To Add a Storage Policy</strong></span>
 </p><p>
  Perform the following steps to add the storage policy to an existing system.
 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Log in to the Cloud Lifecycle Manager.
   </p></li><li class="listitem"><p>
    Select a storage policy index and ring name.
   </p><p>
    For example, if you already have object-0 and object-1 rings in your
    ring-specifications (usually in the
    <code class="filename">~/openstack/my_cloud/definition/data/swift/swift_config.yml</code> file),
    the next index is 2 and the ring name is object-2.
   </p></li><li class="listitem"><p>
    Select a user-visible name so that you can see when you examine container
    metadata or when you want to specify the storage policy used when you
    create a container. The name should be a single word (hyphen and dashes are
    allowed).
   </p></li><li class="listitem"><p>
    Decide if this new policy will be the default for all new containers.
   </p></li><li class="listitem"><p>
    Decide on other attributes such as <code class="literal">partition-power</code> and
    <code class="literal">replica-count</code> if you are using a standard replication
    ring. However, if you are using an erasure coded ring, you also need to
    decide on other attributes: <code class="literal">ec-type</code>,
    <code class="literal">ec-num-data-fragments</code>,
    <code class="literal">ec-num-parity-fragments</code>, and
    <code class="literal">ec-object-segment-size</code>. For more details on the required
    attributes, see <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 11 “Modifying Example Configurations for Object Storage using Swift”, Section 11.10 “Understanding Swift Ring Specifications”</span>.
   </p></li><li class="listitem"><p>
    Edit the <code class="literal">ring-specifications</code> attribute (usually in the
    <code class="filename">~/openstack/my_cloud/definition/data/swift/swift_config.yml</code> file)
    and add the new ring specification. If this policy is to be the default
    storage policy for new containers, set the <code class="literal">default</code>
    attribute to <span class="bold"><strong>yes</strong></span>.
   </p><div id="id-1.5.11.10.12.5.6.2" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
       Ensure that only one object ring has the
       <code class="literal">default</code> attribute set to <code class="literal">yes</code>. If
       you set two rings as default, swift processes will not start.
      </p></li><li class="listitem"><p>
       Do not specify the <code class="literal">weight-step</code> attribute for the new
       object ring. Since this is a new ring there is no need to gradually
       increase device weights.
      </p></li></ol></div></div></li><li class="listitem"><p>
    Update the appropriate disk model to use the new storage policy (for
    example, the <code class="literal">data/disks_swobj.yml</code> file). The following
    sample shows that the <span class="bold"><strong>object-2</strong></span> has been
    added to the list of existing rings that use the drives:
   </p><div class="verbatim-wrap"><pre class="screen">disk-models:
- name: SWOBJ-DISKS
  ...
  device-groups:
  - name: swobj
    devices:
       ...
    consumer:
        name: swift
        attrs:
            rings:
            - object-0
            - object-1
            - <span class="bold"><strong>object-2</strong></span>
  ...</pre></div><div id="id-1.5.11.10.12.5.7.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>
     You must use the new object ring on at least one node that runs the
     <code class="literal">swift-object</code> service. If you skip this step and
     continue to run the <code class="literal">swift-compare-model-rings.yml</code> or
     <code class="literal">swift-deploy.yml</code> playbooks, they will fail with an
     error <span class="emphasis"><em>There are no devices in this ring, or all devices have
     been deleted</em></span>, as shown below:
    </p><div class="verbatim-wrap"><pre class="screen">TASK: [swiftlm-ring-supervisor | build-rings | Build ring (make-delta, rebalance)] ***
failed: [padawan-ccp-c1-m1-mgmt] =&gt; {"changed": true, "cmd": ["swiftlm-ring-supervisor", "--make-delta", "--rebalance"], "delta": "0:00:03.511929", "end": "2015-10-07 14:02:03.610226", "rc": 2, "start": "2015-10-07 14:02:00.098297", "warnings": []}
...
Running: swift-ring-builder /etc/swiftlm/cloud1/cp1/builder_dir/object-2.builder rebalance 999
ERROR: -------------------------------------------------------------------------------
An error has occurred during ring validation. Common
causes of failure are rings that are empty or do not
have enough devices to accommodate the replica count.
Original exception message:
There are no devices in this ring, or all devices have been deleted
-------------------------------------------------------------------------------</pre></div></div></li><li class="listitem"><p>
    Commit your configuration:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git add -A
<code class="prompt user">ardana &gt; </code>git commit -m "commit message"</pre></div></li><li class="listitem"><p>
    Run the configuration processor:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
    Create a deployment directory:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
    Validate the changes by running the
    <code class="literal">swift-compare-model-rings.yml</code> playbook:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-compare-model-rings.yml</pre></div><p>
    If any errors occur, correct them. For instructions, see
    <a class="xref" href="idg-all-operations-troubleshooting-troubleshooting-issues-xml-1.html#sec-input-swift-error" title="18.6.2.3. Interpreting Swift Input Model Validation Errors">Section 18.6.2.3, “Interpreting Swift Input Model Validation Errors”</a>. Then, re-run steps
    <span class="bold"><strong>5 - 10</strong></span>.
    
   </p></li><li class="listitem"><p>
    Create the new ring (for example, object-2). Then verify the swift service
    status and reconfigure the swift node to use a new storage policy, by
    running these playbooks:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-status.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-deploy.yml</pre></div></li></ol></div><p>
  After adding a storage policy, there is no need to rebalance the ring.
 </p></section><section class="sect2" id="min-part-hours" data-id-title="Changing min-part-hours in Swift"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.7 </span><span class="title-name">Changing min-part-hours in Swift</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#min-part-hours">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_min_part_hours.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  The <code class="literal">min-part-hours</code> parameter specifies the number of
  hours you must wait before swift will allow a given partition to be moved.
  In other words, it constrains how often you perform ring rebalance
  operations. Before changing this value, you should get some experience with
  how long it takes your system to perform replication after you make ring
  changes (for example, when you add servers).
 </p><p>
  See <a class="xref" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t" title="9.5.4. Determining When to Rebalance and Deploy a New Ring">Section 9.5.4, “Determining When to Rebalance and Deploy a New Ring”</a> for more information about
  determining when replication has completed.
 </p><section class="sect3" id="idg-all-operations-objectstorage-swift-min-part-hours-xml-7" data-id-title="Changing the min-part-hours Value"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.7.1 </span><span class="title-name">Changing the min-part-hours Value</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#idg-all-operations-objectstorage-swift-min-part-hours-xml-7">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_min_part_hours.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   To change the <code class="literal">min-part-hours</code> value, following these
   steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Log in to the Cloud Lifecycle Manager.
    </p></li><li class="listitem"><p>
     Edit your
     <code class="filename">~/openstack/my_cloud/definition/data/swift/swift_config.yml</code> file
     and change the value(s) of <code class="literal">min-part-hours</code> for the rings
     you desire. The value is expressed in hours and a value of zero is not
     allowed.
    </p></li><li class="listitem"><p>
     Commit your configuration to the local Git repository
     (<span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>), as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>git add -A
<code class="prompt user">ardana &gt; </code>git commit -m "My config or other commit message"</pre></div></li><li class="listitem"><p>
     Run the configuration processor:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
     Update your deployment directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     Apply the changes by running this playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-deploy.yml</pre></div></li></ol></div></section></section><section class="sect2" id="changing-swift-zone" data-id-title="Changing Swift Zone Layout"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.5.8 </span><span class="title-name">Changing Swift Zone Layout</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#changing-swift-zone">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-changing_swift_zone.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  Before changing the number of swift zones or the assignment of servers to
  specific zones, you must ensure that your system has sufficient storage
  available to perform the operation. Specifically, if you are adding a new
  zone, you may need additional storage. There are two reasons for this:
 </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
    You cannot simply change the swift zone number of disk drives in the ring.
    Instead, you need to remove the server(s) from the ring and then re-add
    the server(s) with a new swift zone number to the ring. At the point where
    the servers are removed from the ring, there must be sufficient spare
    capacity on the remaining servers to hold the data that was originally
    hosted on the removed servers.
   </p></li><li class="listitem"><p>
    The total amount of storage in each swift zone must be the same. This is
    because new data is added to each zone at the same rate. If one zone has a
    lower capacity than the other zones, once that zone becomes full, you
    cannot add more data to the system – even if there is unused space in
    the other zones.
   </p></li></ul></div><p>
  As mentioned above, you cannot simply change the swift zone number of disk
  drives in an existing ring. Instead, you must remove and then re-add
  servers. This is a summary of the process:
 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Identify appropriate server groups that correspond to the desired swift
    zone layout.
   </p></li><li class="listitem"><p>
    Remove the servers in a server group from the rings. This process may be
    protracted, either by removing servers in small batches or by using the
    weight-step attribute so that you limit the amount of replication traffic
    that happens at once.
   </p></li><li class="listitem"><p>
    Once all the targeted servers are removed, edit the
    <code class="literal">swift-zones</code> attribute in the ring specifications to add
    or remove a swift zone.
   </p></li><li class="listitem"><p>
    Re-add the servers you had temporarily removed to the rings. Again you may
    need to do this in batches or rely on the weight-step attribute.
   </p></li><li class="listitem"><p>
    Continue removing and re-adding servers until you reach your final
    configuration.
   </p></li></ol></div><section class="sect3" id="idg-all-operations-objectstorage-changing-swift-zone-xml-5" data-id-title="Process for Changing Swift Zones"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">9.5.8.1 </span><span class="title-name">Process for Changing Swift Zones</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#idg-all-operations-objectstorage-changing-swift-zone-xml-5">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-changing_swift_zone.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   This section describes the detailed process or reorganizing swift zones. As
   a concrete example, we assume we start with a single swift zone and the
   target is three swift zones. The same general process would apply if you
   were reducing the number of zones as well.
  </p><p>
   The process is as follows:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Identify the appropriate server groups that represent the desired final
     state. In this example, we are going to change the swift zone layout as
     follows:
    </p><div class="informaltable"><table style="border-collapse: collapse; border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Original Layout</th><th style="border-bottom: 1px solid ; ">Target Layout</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; ">
<div class="verbatim-wrap"><pre class="screen">swift-zones:
  - 1d: 1
    server-groups:
       - AZ1
       - AZ2
       - AZ3</pre></div>
        </td><td>
<div class="verbatim-wrap"><pre class="screen">swift-zones:
   - 1d: 1
     server-groups:
        - AZ1
   - id: 2
        - AZ2
   - id: 3
        - AZ3</pre></div>
        </td></tr></tbody></table></div><p>
     The plan is to move servers from server groups <code class="literal">AZ2</code> and
     <code class="literal">AZ3</code> to a new swift zone number. The servers in
     <code class="literal">AZ1</code> will remain in swift zone 1.
    </p></li><li class="listitem"><p>
     If you have not already done so, consider setting the weight-step
     attribute as described in <a class="xref" href="ops-managing-objectstorage.html#swift-weight-att" title="9.5.2. Using the Weight-Step Attributes to Prepare for Ring Changes">Section 9.5.2, “Using the Weight-Step Attributes to Prepare for Ring Changes”</a>.
    </p></li><li class="listitem"><p>
     Identify the servers in the <code class="literal">AZ2</code> server group. You may
     remove all servers at once or remove them in batches. If this is the first
     time you have performed a major ring change, we suggest you remove one or
     two servers only in the first batch. When you see how long this takes and
     the impact replication has on your system you can then use that experience
     to decide whether you can remove a larger batch of servers, or increase or
     decrease the weight-step attribute for the next server-removal cycle. To
     remove a server, use steps 2-9 as described in
     <a class="xref" href="system-maintenance.html#remove-swift-node" title="15.1.5.1.4. Removing a Swift Node">Section 15.1.5.1.4, “Removing a Swift Node”</a> ensuring that you
     do not remove the servers from the input model.
     
    </p></li><li class="listitem"><p>
     This process may take a number of ring rebalance cycles until the disk
     drives are removed from the ring files. Once this happens, you can edit
     the ring specifications and add swift zone 2 as shown in this example:
    </p><div class="verbatim-wrap"><pre class="screen">swift-zones:
  - id: 1
    server-groups:
      - AZ1
      - AZ3
  - id: 2
       - AZ2</pre></div></li><li class="listitem"><p>
     The server removal process in step #3
     
     set the "remove" attribute in the
     <code class="literal">pass-through</code> attribute of the servers in server group
     <code class="literal">AZ2</code>. Edit the input model files and remove this
     <code class="literal">pass-through</code> attribute. This signals to the system that
     the servers should be used the next time we rebalance the rings (that is,
     the server should be added to the rings).
    </p></li><li class="listitem"><p>
     Commit your configuration to the local Git repository
     (<span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>), as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>git add -A
<code class="prompt user">ardana &gt; </code>git commit -m "My config or other commit message"</pre></div></li><li class="listitem"><p>
     Run the configuration processor:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
     Use the playbook to create a deployment directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     Rebuild and deploy the swift rings containing the re-added servers by
     running this playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-deploy.yml</pre></div></li><li class="listitem"><p>
     Wait until replication has finished. For more details, see
     <a class="xref" href="ops-managing-objectstorage.html#topic-ohx-j1t-4t" title="9.5.4. Determining When to Rebalance and Deploy a New Ring">Section 9.5.4, “Determining When to Rebalance and Deploy a New Ring”</a>.
    </p></li><li class="listitem"><p>
     You may need to continue to rebalance the rings. For instructions, see the
     "Final Rebalance Stage" steps at <a class="xref" href="ops-managing-objectstorage.html#change-swift-rings" title="9.5.5. Applying Input Model Changes to Existing Rings">Section 9.5.5, “Applying Input Model Changes to Existing Rings”</a>.
    </p></li><li class="listitem"><p>
     At this stage, the servers in server group <code class="literal">AZ2</code> are
     responsible for swift zone 2. Repeat the process in steps #3-9 to remove
     the servers in server group <code class="literal">AZ3</code> from the rings and then
     re-add them to swift zone 3. The ring specifications for zones (step 4)
     should be as follows:
    </p><div class="verbatim-wrap"><pre class="screen">swift-zones:
  - 1d: 1
    server-groups:
      - AZ1
  - id: 2
      - AZ2
  - id: 3
      - AZ3</pre></div></li><li class="listitem"><p>
     Once complete, all data should be dispersed (that is, each replica is
     located) in the swift zones as specified in the input model.
    </p></li></ol></div></section></section></section><section class="sect1" id="topic-el2-cqv-mv" data-id-title="Configuring your swift System to Allow Container Sync"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">9.6 </span><span class="title-name">Configuring your swift System to Allow Container Sync</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#topic-el2-cqv-mv">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_container_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
  swift has a feature where all the contents of a container can be mirrored to
  another container through background synchronization. swift operators
  configure their system to allow/accept sync requests to/from other systems,
  and the user specifies where to sync their container to along with a secret
  synchronization key. For an overview of this feature, refer to
  <a class="link" href="http://docs.openstack.org/developer/swift/overview_container_sync.html" target="_blank">OpenStack
  swift - Container to Container Synchronization</a>.
 </p><section class="sect2" id="idg-all-operations-objectstorage-swift-container-sync-xml-5" data-id-title="Notes and limitations"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.1 </span><span class="title-name">Notes and limitations</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#idg-all-operations-objectstorage-swift-container-sync-xml-5">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_container_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   The container synchronization is done as a background action. When you put
   an object into the source container, it will take some time before it
   becomes visible in the destination container. Storage services will not
   necessarily copy objects in any particular order, meaning they may be
   transferred in a different order to which they were created.
  </p><p>
   Container sync may not be able to keep up with a moderate upload rate to a
   container. For example, if the average object upload rate to a container is
   greater than one object per second, then container sync may not be able to
   keep the objects synced.
  </p><p>
   If container sync is enabled on a container that already has a large number
   of objects then container sync may take a long time to sync the data. For
   example, a container with one million 1KB objects could take more than 11
   days to complete a sync.
  </p><p>
   You may operate on the destination container just like any other container
   -- adding or deleting objects -- including the objects that are in the
   destination container because they were copied from the source container. To
   decide how to handle object creation, replacement or deletion, the system
   uses timestamps to determine what to do. In general, the latest timestamp
   "wins". That is, if you create an object, replace it, delete it and the
   re-create it, the destination container will eventually contain the most
   recently created object. However, if you also create and delete objects in
   the destination container, you get some subtle behaviours as follows:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
     If an object is copied to the destination container and then deleted, it
     remains deleted in the destination even though there is still a copy in
     the source container. If you modify the object (replace or change its
     metadata) in the source container, it will reappear in the destination
     again.
    </p></li><li class="listitem"><p>
     The same applies to a replacement or metadata modification of an object in
     the destination container -- the object will remain as-is unless there is
     a replacement or modification in the source container.
    </p></li><li class="listitem"><p>
     If you replace or modify metadata of an object in the destination
     container and then delete it in the source container, it is
     <span class="bold"><strong>not</strong></span> deleted from the destination. This is
     because your modified object has a later timestamp than the object you
     deleted in the source.
    </p></li><li class="listitem"><p>
     If you create an object in the source container and before the system has
     a chance to copy it to the destination, you also create an object of the
     same name in the destination, then the object in the destination is
     <span class="bold"><strong>not</strong></span> overwritten by the source container's
     object.
    </p></li></ul></div><p>
   <span class="bold"><strong>Segmented objects</strong></span>
  </p><p>
   Segmented objects (objects larger than 5GB) will not work seamlessly with
   container synchronization. If the manifest object is copied to the
   destination container before the object segments, when you perform a GET
   operation on the manifest object, the system may fail to find some or all of
   the object segments. If your manifest and object segments are in different
   containers, do not forget that both containers must be synchonized and that
   the container name of the object segments must be the same on both source
   and destination.
  </p></section><section class="sect2" id="idg-all-operations-objectstorage-swift-container-sync-xml-6" data-id-title="Prerequisites"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.2 </span><span class="title-name">Prerequisites</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#idg-all-operations-objectstorage-swift-container-sync-xml-6">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_container_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Container to container synchronization requires that SSL certificates are
   configured on both the source and destination systems. For more information
   on how to implement SSL, see <span class="intraxref">Book “<em class="citetitle">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 41 “Configuring Transport Layer Security (TLS)”</span>.
  </p></section><section class="sect2" id="configure" data-id-title="Configuring container sync"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.3 </span><span class="title-name">Configuring container sync</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#configure">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_container_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   Container to container synchronization requires that both the source and
   destination swift systems involved be configured to allow/accept this.  In
   the context of container to container synchronization, swift uses the term
   <span class="emphasis"><em>cluster</em></span> to denote a swift system. swift
   <span class="emphasis"><em>clusters</em></span> correspond to <span class="emphasis"><em>Control
   Planes</em></span> in <span class="productname">OpenStack</span> terminology.
   </p><p>
   <span class="bold"><strong>Gather the public API endpoints for both swift
   systems</strong></span>
  </p><p>
   Gather information about the external/public URL used by each system, as
   follows:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     On the Cloud Lifecycle Manager of one system, get the public API endpoint of the
     system by running the following commands:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source ~/service.osrc
<code class="prompt user">ardana &gt; </code>openstack endpoint list | grep swift</pre></div><p>
     The output of the command will look similar to this:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack endpoint list | grep swift
| 063a84b205c44887bc606c3ba84fa608 | region0 | swift           | object-store    | True    | admin     | https://10.13.111.176:8080/v1/AUTH_%(tenant_id)s |
| 3c46a9b2a5f94163bb5703a1a0d4d37b | region0 | swift           | object-store    | True    | public    | <span class="bold"><strong>https://10.13.120.105:8080/v1</strong></span>/AUTH_%(tenant_id)s |
| a7b2f4ab5ad14330a7748c950962b188 | region0 | swift           | object-store    | True    | internal  | https://10.13.111.176:8080/v1/AUTH_%(tenant_id)s |</pre></div><p>
     The portion that you want is the endpoint up to, but not including, the
     <code class="literal">AUTH</code> part. It is bolded in the above example,
     <code class="literal">https://10.13.120.105:8080/v1</code>.
    </p></li><li class="listitem"><p>
     Repeat these steps on the other swift system so you have both of the
     public API endpoints for them.
    </p></li></ol></div><p>
   <span class="bold"><strong>Validate connectivity between both systems</strong></span>
  </p><p>
   The swift nodes running the <code class="literal">swift-container</code> service must
   be able to connect to the public API endpoints of each other for the
   container sync to work. You can validate connectivity on each system using
   these steps.
  </p><p>
   For the sake of the examples, we will use the terms
   <span class="emphasis"><em>source</em></span> and <span class="emphasis"><em>destination</em></span> to notate
   the nodes doing the synchronization.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Log in to a swift node running the <code class="literal">swift-container</code>
     service on the source system. You can determine this by looking at the
     service list in your
     <code class="literal">~/openstack/my_cloud/info/service_info.yml</code> file for a list
     of the servers containing this service.
    </p></li><li class="listitem"><p>
     Verify the SSL certificates by running this command against the
     destination swift server:
    </p><div class="verbatim-wrap"><pre class="screen">echo | openssl s_client -connect <em class="replaceable">PUBLIC_API_ENDPOINT</em>:8080 -CAfile /etc/ssl/certs/ca-certificates.crt</pre></div><p>
     If the connection was successful you should see a return code of
     <code class="literal">0 (ok)</code> similar to this:
    </p><div class="verbatim-wrap"><pre class="screen">...
Timeout   : 300 (sec)
Verify return code: 0 (ok)</pre></div></li><li class="listitem"><p>
     Also verify that the source node can connect to the destination swift
     system using this command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>curl -k <em class="replaceable">DESTINATION_IP OR HOSTNAME</em>:8080/healthcheck</pre></div><p>
     If the connection was successful, you should see a response of
     <code class="literal">OK</code>.
    </p></li><li class="listitem"><p>
     Repeat these verification steps on any system involved in your container
     synchronization setup.
    </p></li></ol></div><p>
   <span class="bold"><strong>Configure container to container
   synchronization</strong></span>
  </p><p>
   Both the source and destination swift systems must be configured the same
   way, using sync realms. For more details on how sync realms work, see
   <a class="link" href="http://docs.openstack.org/developer/swift/overview_container_sync.html#configuring-container-sync" target="_blank">OpenStack
   swift - Configuring Container Sync</a>.
  </p><p>
   To configure one of the systems, follow these steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Log in to the Cloud Lifecycle Manager.
    </p></li><li class="listitem"><p>
     Edit the
     <code class="literal">~/openstack/my_cloud/config/swift/container-sync-realms.conf.j2</code>
     file and uncomment the sync realm section.
    </p><p>
     Here is a sample showing this section in the file:
    </p><div class="verbatim-wrap"><pre class="screen">#Add sync realms here, for example:
# [realm1]
# key = realm1key
# key2 = realm1key2
# cluster_name1 = https://host1/v1/
# cluster_name2 = https://host2/v1/</pre></div></li><li class="listitem"><p>
     Add in the details for your source and destination systems. Each realm you
     define is a set of clusters that have agreed to allow container syncing
     between them. These values are case sensitive.
    </p><p>
     Only one <code class="literal">key</code> is required. The second key is optional
     and can be provided to allow an operator to rotate keys if desired. The
     values for the clusters must contain the prefix
     <code class="literal">cluster_</code> and will be populated with the public API
     endpoints for the systems.
    </p></li><li class="listitem"><p>
     Commit the changes to git:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git add -A
<code class="prompt user">ardana &gt; </code>git commit -a -m "Add node &lt;name&gt;"</pre></div></li><li class="listitem"><p>
     Run the configuration processor:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div></li><li class="listitem"><p>
     Update the deployment directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     Run the swift reconfigure playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-reconfigure.yml</pre></div></li><li class="listitem"><p>
     Run this command to validate that your container synchronization is
     configured:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source ~/service.osrc
<code class="prompt user">ardana &gt; </code>swift capabilities</pre></div><p>
     Here is a snippet of the output showing the container sync information.
     This should be populated with your cluster names:
    </p><div class="verbatim-wrap"><pre class="screen">...
Additional middleware: container_sync
 Options:
  realms: {u'INTRACLUSTER': {u'clusters': {u'THISCLUSTER': {}}}}</pre></div></li><li class="listitem"><p>
     Repeat these steps on any other swift systems that will be involved in
     your sync realms.
    </p></li></ol></div></section><section class="sect2" id="intra-cluster-sync" data-id-title="Configuring Intra Cluster Container Sync"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">9.6.4 </span><span class="title-name">Configuring Intra Cluster Container Sync</span></span> <a title="Permalink" class="permalink" href="ops-managing-objectstorage.html#intra-cluster-sync">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a><a target="_blank" class="icon-editsource" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-objectstorage-swift_container_sync.xml" title="Edit source document"> </a></div></div></div></div></div><p>
   It is possible to use the swift container sync functionality to sync objects
   between containers within the same swift system. swift is automatically
   configured to allow intra cluster container sync. Each swift PAC server will
   have an intracluster container sync realm defined in
   <code class="literal">/etc/swift/container-sync-realms.conf</code>.
  </p><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"># The intracluster realm facilitates syncing containers on this system
[intracluster]
key = lQ8JjuZfO
# key2 =
cluster_thiscluster = http://<em class="replaceable">SWIFT-PROXY-VIP</em>:8080/v1/</pre></div><p>
   The keys defined in <code class="literal">/etc/swift/container-sync-realms.conf</code>
   are used by the container-sync daemon to determine trust. On top of this
   the containers that will be in sync will need a seperate shared key they
   both define in container metadata to establish their trust between each other.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Create two containers, for example container-src and container-dst. In
     this example we will sync one way from container-src to container-dst.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container create container-src
<code class="prompt user">ardana &gt; </code>openstack container create container-dst</pre></div></li><li class="listitem"><p>
     Determine your swift account. In the following example it is AUTH_1234
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container show
                                 Account: AUTH_1234
                              Containers: 3
                                 Objects: 42
                                   Bytes: 21692421
Containers in policy "erasure-code-ring": 3
   Objects in policy "erasure-code-ring": 42
     Bytes in policy "erasure-code-ring": 21692421
                            Content-Type: text/plain; charset=utf-8
             X-Account-Project-Domain-Id: default
                             X-Timestamp: 1472651418.17025
                              X-Trans-Id: tx81122c56032548aeae8cd-0057cee40c
                           Accept-Ranges: bytes</pre></div></li><li class="listitem"><p>
     Configure container-src to sync to container-dst using a key specified
     by both containers. Replace <em class="replaceable">KEY</em> with your key.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container set -t '//intracluster/thiscluster/AUTH_1234/container-dst' -k '<em class="replaceable">KEY</em>' container-src</pre></div></li><li class="listitem"><p>
     Configure container-dst to accept synced objects with this key
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container set -k '<em class="replaceable">KEY</em>' container-dst</pre></div></li><li class="listitem"><p>
     Upload objects to container-src. Within a number of minutes the objects
     should be automatically synced to container-dst.
    </p></li></ol></div><p>
   <span class="bold"><strong>Changing the intracluster realm key</strong></span>
  </p><p>
   The intracluster realm key used by container sync to sync objects between
   containers in the same swift system is automatically generated. The process
   for changing passwords is described in
   <a class="xref" href="ops-managing-identity.html#servicePasswords" title="5.7. Changing Service Passwords">Section 5.7, “Changing Service Passwords”</a>.
  </p><p>
   The steps to change the intracluster realm key are as follows.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     On the Cloud Lifecycle Manager create a file called
     <code class="literal">~/openstack/change_credentials/swift_data_metadata.yml</code>
     with the contents included below. The <code class="literal">consuming-cp</code> and
     <code class="literal">cp</code> are the control plane name specified in
     <code class="literal">~/openstack/my_cloud/definition/data/control_plane.yml</code>
     where the swift-container service is running.
    </p><div class="verbatim-wrap"><pre class="screen">swift_intracluster_sync_key:
 metadata:
 - clusters:
   - swpac
   component: swift-container
   consuming-cp: control-plane-1
   cp: control-plane-1
 version: '2.0'</pre></div></li><li class="listitem"><p>
     Run the following commands
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem"><p>
     Reconfigure the swift credentials
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts swift-reconfigure-credentials-change.yml</pre></div></li><li class="listitem"><p>
     Delete
     <code class="literal">~/openstack/change_credentials/swift_data_metadata.yml</code>
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>rm ~/openstack/change_credentials/swift_data_metadata.yml</pre></div></li><li class="listitem"><p>
     On a swift PAC server check that the intracluster realm key has been
     updated in <code class="literal">/etc/swift/container-sync-realms.conf</code>
    </p><div class="verbatim-wrap"><pre class="screen"># The intracluster realm facilitates syncing containers on this system
[intracluster]
key = aNlDn3kWK</pre></div></li><li class="listitem"><p>
     Update any containers using the intracluster container sync to use the new
     intracluster realm key
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack container set -k 'aNlDn3kWK' container-src
<code class="prompt user">ardana &gt; </code>openstack container set -k 'aNlDn3kWK' container-dst</pre></div></li></ol></div></section></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="ops-managing-blockstorage.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 8 </span>Managing Block Storage</span></a> </div><div><a class="pagination-link next" href="ops-managing-networking.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 10 </span>Managing Networking</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="ops-managing-objectstorage.html#swift-healthcheck"><span class="title-number">9.1 </span><span class="title-name">Running the swift Dispersion Report</span></a></span></li><li><span class="section"><a href="ops-managing-objectstorage.html#swift-recon"><span class="title-number">9.2 </span><span class="title-name">Gathering Swift Data</span></a></span></li><li><span class="section"><a href="ops-managing-objectstorage.html#topic-pcv-fy4-nt"><span class="title-number">9.3 </span><span class="title-name">Gathering Swift Monitoring Metrics</span></a></span></li><li><span class="section"><a href="ops-managing-objectstorage.html#topic-m13-dgp-nt"><span class="title-number">9.4 </span><span class="title-name">Using the swift Command-line Client (CLI)</span></a></span></li><li><span class="section"><a href="ops-managing-objectstorage.html#swift-ring-management"><span class="title-number">9.5 </span><span class="title-name">Managing swift Rings</span></a></span></li><li><span class="section"><a href="ops-managing-objectstorage.html#topic-el2-cqv-mv"><span class="title-number">9.6 </span><span class="title-name">Configuring your swift System to Allow Container Sync</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2022</span></div></div></footer></body></html>