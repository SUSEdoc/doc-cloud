<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Managing Identity | Operations Guide CLM | SUSE OpenStack Cloud 9</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.17 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE OpenStack Cloud" /><meta name="product-number" content="9" /><meta name="book-title" content="Operations Guide CLM" /><meta name="chapter-title" content="Chapter 5. Managing Identity" /><meta name="description" content="The Identity service provides the structure for user authentication to your cloud." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE OpenStack Cloud 9" /><link rel="home" href="index.html" title="Documentation" /><link rel="up" href="book-operations.html" title="Operations Guide CLM" /><link rel="prev" href="third-party-integrations.html" title="Chapter 4. Third-Party Integrations" /><link rel="next" href="ops-managing-compute.html" title="Chapter 6. Managing Compute" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #FABEBE;"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Documentation"><span class="book-icon">Documentation</span></a><span> › </span><a class="crumb" href="book-operations.html">Operations Guide CLM</a><span> › </span><a class="crumb" href="ops-managing-identity.html">Managing Identity</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Operations Guide CLM</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="gettingstarted-ops.html"><span class="number">1 </span><span class="name">Operations Overview</span></a></li><li class="inactive"><a href="tutorials.html"><span class="number">2 </span><span class="name">Tutorials</span></a></li><li class="inactive"><a href="clm-admin-ui.html"><span class="number">3 </span><span class="name">Cloud Lifecycle Manager Admin UI User Guide</span></a></li><li class="inactive"><a href="third-party-integrations.html"><span class="number">4 </span><span class="name">Third-Party Integrations</span></a></li><li class="inactive"><a href="ops-managing-identity.html"><span class="number">5 </span><span class="name">Managing Identity</span></a></li><li class="inactive"><a href="ops-managing-compute.html"><span class="number">6 </span><span class="name">Managing Compute</span></a></li><li class="inactive"><a href="ops-managing-esx.html"><span class="number">7 </span><span class="name">Managing ESX</span></a></li><li class="inactive"><a href="ops-managing-blockstorage.html"><span class="number">8 </span><span class="name">Managing Block Storage</span></a></li><li class="inactive"><a href="ops-managing-objectstorage.html"><span class="number">9 </span><span class="name">Managing Object Storage</span></a></li><li class="inactive"><a href="ops-managing-networking.html"><span class="number">10 </span><span class="name">Managing Networking</span></a></li><li class="inactive"><a href="ops-managing-dashboards.html"><span class="number">11 </span><span class="name">Managing the Dashboard</span></a></li><li class="inactive"><a href="ops-managing-orchestration.html"><span class="number">12 </span><span class="name">Managing Orchestration</span></a></li><li class="inactive"><a href="topic-ttn-5fg-4v.html"><span class="number">13 </span><span class="name">Managing Monitoring, Logging, and Usage Reporting</span></a></li><li class="inactive"><a href="using-container-as-a-service-overview.html"><span class="number">14 </span><span class="name">Managing Container as a Service (Magnum)</span></a></li><li class="inactive"><a href="system-maintenance.html"><span class="number">15 </span><span class="name">System Maintenance</span></a></li><li class="inactive"><a href="manage-ops-console.html"><span class="number">16 </span><span class="name">Operations Console</span></a></li><li class="inactive"><a href="bura-overview.html"><span class="number">17 </span><span class="name">Backup and Restore</span></a></li><li class="inactive"><a href="idg-all-operations-troubleshooting-troubleshooting-issues-xml-1.html"><span class="number">18 </span><span class="name">Troubleshooting Issues</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 4. Third-Party Integrations" href="third-party-integrations.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 6. Managing Compute" href="ops-managing-compute.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #FABEBE;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Documentation"><span class="book-icon">Documentation</span></a><span> › </span><a class="crumb" href="book-operations.html">Operations Guide CLM</a><span> › </span><a class="crumb" href="ops-managing-identity.html">Managing Identity</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 4. Third-Party Integrations" href="third-party-integrations.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 6. Managing Compute" href="ops-managing-compute.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="ops-managing-identity"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname "><span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span></span> <span class="productnumber ">9</span></div><div><h1 class="title"><span class="number">5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Managing Identity</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-managing_identity.xml" title="Edit the source file for this section">Edit source</a></h1><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-managing_identity.xml</li><li><span class="ds-label">ID: </span>ops-managing-identity</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="ops-managing-identity.html#sec-operation-identity-overview"><span class="number">5.1 </span><span class="name">The Identity Service</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#supported-upstream-keystone-features"><span class="number">5.2 </span><span class="name">Supported Upstream Keystone Features</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#sec-operation-identity"><span class="number">5.3 </span><span class="name">Understanding Domains, Projects, Users, Groups, and Roles</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#topic-ffs-dvz-nw"><span class="number">5.4 </span><span class="name">Identity Service Token Validation Example</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#topic-qmz-fg3-btx"><span class="number">5.5 </span><span class="name">Configuring the Identity Service</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#admin-password"><span class="number">5.6 </span><span class="name">Retrieving the Admin Password</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#servicePasswords"><span class="number">5.7 </span><span class="name">Changing Service Passwords</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#topic-m43-2j3-bt"><span class="number">5.8 </span><span class="name">Reconfiguring the Identity service</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#ldap"><span class="number">5.9 </span><span class="name">Integrating LDAP with the Identity Service</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#k2kfed"><span class="number">5.10 </span><span class="name">keystone-to-keystone Federation</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#websso"><span class="number">5.11 </span><span class="name">Configuring Web Single Sign-On</span></a></span></dt><dt><span class="section"><a href="ops-managing-identity.html#topic-qtp-cn3-bt"><span class="number">5.12 </span><span class="name">Identity Service Notes and Limitations</span></a></span></dt></dl></div></div><p>
  The Identity service provides the structure for user authentication to your
  cloud.
 </p><div class="sect1" id="sec-operation-identity-overview"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">The Identity Service</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#sec-operation-identity-overview">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_overview.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_overview.xml</li><li><span class="ds-label">ID: </span>sec-operation-identity-overview</li></ul></div></div></div></div><p>
  This topic explains the purpose and mechanisms of the identity service.
 </p><p>
  The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Identity service, based on the OpenStack keystone API, is
  responsible for providing UserID authentication and access authorization to
  enable organizations to achieve their access security and compliance
  objectives and successfully deploy OpenStack. In short, the Identity service
  is the gateway to the rest of the OpenStack services.
 </p><div class="sect2" id="idg-all-operations-configuring-identity-identity-overview-xml-7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Which version of the Identity service should you use?</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-overview-xml-7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_overview.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_overview.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-identity-overview-xml-7</li></ul></div></div></div></div><p>
   Use Identity API version 3.0, as previous versions no longer exist as
   endpoints for Identity API queries.
  </p><p>
   Similarly, when performing queries, you must use the OpenStack CLI (the
   <code class="command">openstack</code> command), and not the keystone CLI
   (<code class="command">keystone</code>) as the latter is only compatible with API
   versions prior to 3.0.
  </p></div><div class="sect2" id="idg-all-operations-configuring-identity-identity-overview-xml-8"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Authentication</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-overview-xml-8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_overview.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_overview.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-identity-overview-xml-8</li></ul></div></div></div></div><p>
   The authentication function provides the initial login function to
   OpenStack. keystone supports multiple sources of authentication, including a
   native or built-in authentication system. The keystone native system can be
   used for all user management functions for proof of concept deployments or
   small deployments not requiring integration with a corporate authentication
   system, but it lacks some of the advanced functions usually found in user
   management systems such as forcing password changes. The focus of the
   keystone native authentication system is to be the source of authentication
   for OpenStack-specific users required for the operation of the various
   OpenStack services. These users are stored by keystone in a default domain;
   the addition of these IDs to an external authentication system is not
   required.
  </p><p>
   keystone is more commonly integrated with external authentication systems
   such as OpenLDAP or Microsoft Active Directory. These systems are usually
   centrally deployed by organizations to serve as the single source of user
   management and authentication for all in-house deployed applications and
   systems requiring user authentication. In addition to LDAP and Microsoft
   Active Directory, support for integration with Security Assertion Markup
   Language (SAML)-based identity providers from companies such as Ping, CA,
   IBM, Oracle, and others is also nearly "production-ready".
  </p><p>
   keystone also provides architectural support via the underlying Apache
   deployment for other types of authentication systems such as Multi-Factor
   Authentication. These types of systems typically require driver support and
   integration from the respective provider vendors.
  </p><div id="id-1.5.7.3.5.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    While support for Identity Providers and Multi-factor authentication is
    available in keystone, it has not yet been certified by the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
    engineering team and is an experimental feature in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
   </p></div><p>
   LDAP-compatible directories such as OpenLDAP and Microsoft Active Directory
   are recommended alternatives to using the keystone local authentication.
   Both methods are widely used by organizations and are integrated with a
   variety of other enterprise applications. These directories act as the
   single source of user information within an organization. keystone can be
   configured to authenticate against an LDAP-compatible directory on a
   per-domain basis.
  </p><p>
   Domains, as explained in <a class="xref" href="ops-managing-identity.html#sec-operation-identity" title="5.3. Understanding Domains, Projects, Users, Groups, and Roles">Section 5.3, “Understanding Domains, Projects, Users, Groups, and Roles”</a>,
   can be configured so that based on the user ID, a incoming user is
   automatically mapped to a specific domain. This domain can then be
   configured to authenticate against a specific LDAP directory. The user
   credentials provided by the user to keystone are passed along to the
   designated LDAP source for authentication. This communication can be
   optionally configured to be secure via SSL encryption. No special LDAP
   administrative access is required, and only read-only access is needed for
   this configuration. keystone will not add any LDAP information. All user
   additions, deletions, and modifications are performed by the application's
   front end in the LDAP directories. After a user has been successfully
   authenticated, they are then assigned to the groups, roles, and projects
   defined by the keystone domain or project administrators. This information
   is stored within the keystone service database.
  </p><p>
   Another form of external authentication provided by the keystone service is
   via integration with SAML-based Identity Providers (IdP) such as Ping
   Identity, IBM Tivoli, and Microsoft Active Directory Federation Server. A
   SAML-based identity provider provides authentication that is often called
   "single sign-on". The IdP server is configured to authenticate against
   identity sources such as Active Directory and provides a single
   authentication API against multiple types of downstream identity sources.
   This means that an organization could have multiple identity storage sources
   but a single authentication source. In addition, if a user has logged into
   one such source during a defined session time frame, they do not need to
   re-authenticate within the defined session. Instead, the IdP will
   automatically validate the user to requesting applications and services.
  </p><p>
   A SAML-based IdP authentication source is configured with keystone on a
   per-domain basis similar to the manner in which native LDAP directories are
   configured. Extra mapping rules are required in the configuration that
   define which keystone group an incoming UID is automatically assigned to.
   This means that groups need to be defined in keystone first, but it also
   removes the requirement that a domain or project admin assign user roles and
   project membership on a per-user basis. Instead, groups are used to define
   project membership and roles and incoming users are automatically mapped to
   keystone groups based on their upstream group membership. This provides a
   very consistent role-based access control (RBAC) model based on the upstream
   identity source. The configuration of this option is fairly straightforward.
   IdP vendors such as Ping and IBM are contributing to the maintenance of this
   function and have also produced their own integration documentation.
   Microsoft Active Directory Federation Services (ADFS) is used for functional
   testing and future documentation.
  </p><p>
   In addition to SAML-based IdP, keystone also supports external authentication
   with a third party IdP using OpenID Connect protocol by leveraging the
   capabilities provided by the Apache2 <a class="link" href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">auth_mod_openidc</a> module. The configuration
   of OpenID Connect is similar to SAML.
  </p><p>
   The third keystone-supported authentication source is known as Multi-Factor
   Authentication (MFA). MFA typically requires an external source of
   authentication beyond a login name and password, and can include options
   such as SMS text, a temporal token generator, a fingerprint scanner, etc.
   Each of these types of MFA are usually specific to a particular MFA vendor.
   The keystone architecture supports an MFA-based authentication system, but
   this has not yet been certified or documented for <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
  </p></div><div class="sect2" id="idg-all-operations-configuring-identity-identity-overview-xml-9"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.1.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Authorization</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-overview-xml-9">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_overview.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_overview.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-identity-overview-xml-9</li></ul></div></div></div></div><p>
   The second major function provided by the keystone service is access
   authorization that determines what resources and actions are available based
   on the UserID, the role of the user, and the projects that a user is
   provided access to. All of this information is created, managed, and stored
   by keystone. These functions are applied via the horizon web interface, the
   OpenStack command-line interface, or the direct keystone API.
  </p><p>
   keystone provides support for organizing users via three entities including:
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.5.7.3.6.4.1"><span class="term ">Domains</span></dt><dd><p>
      Domains provide the highest level of organization. Domains are intended
      to be used as high-level containers for multiple projects. A domain can
      represent different tenants, companies or organizations for an OpenStack
      cloud deployed for public cloud deployments or represent major business
      units, functions, or any other type of top-level organization unit in an
      OpenStack private cloud deployment. Each domain has at least one Domain
      Admin assigned to it. This Domain Admin can then create multiple projects
      within the domain and assign the project admin role to specific project
      owners. Each domain created in an OpenStack deployment is unique and the
      projects assigned to a domain cannot exist in another domain.
     </p></dd><dt id="id-1.5.7.3.6.4.2"><span class="term ">Projects</span></dt><dd><p>
      Projects are entities within a domain that represent groups of users,
      each user role within that project, and how many underlying
      infrastructure resources can be consumed by members of the project.
     </p></dd><dt id="id-1.5.7.3.6.4.3"><span class="term ">Groups</span></dt><dd><p>
      Groups are an optional function and provide the means of assigning
      project roles to multiple users at once.
     </p></dd></dl></div><p>
   keystone also provides the means to create and assign roles to groups of
   users or individual users. The role names are created and user assignments
   are made within keystone. The actual function of a role is defined currently
   per each OpenStack service via scripts. When a user requests access to an
   OpenStack service, his access token contains information about his assigned
   project membership and role for that project. This role is then matched to
   the service-specific script and the user is allowed to perform functions
   within that service defined by the role mapping.
  </p></div></div><div class="sect1" id="supported-upstream-keystone-features"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Supported Upstream Keystone Features</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#supported-upstream-keystone-features">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-keystone_features.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-keystone_features.xml</li><li><span class="ds-label">ID: </span>supported-upstream-keystone-features</li></ul></div></div></div></div><div class="sect2" id="section-azv-113-jx"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">OpenStack upstream features that are enabled by default in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#section-azv-113-jx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-keystone_features.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-keystone_features.xml</li><li><span class="ds-label">ID: </span>section-azv-113-jx</li></ul></div></div></div></div><p>
   The following supported keystone features are enabled by default in the
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 release.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Name</th><th>User/Admin</th><th>Note: API support only. No CLI/UI support</th></tr></thead><tbody><tr><td>Implied Roles</td><td>Admin</td><td>https://blueprints.launchpad.net/keystone/+spec/implied-roles</td></tr><tr><td>Domain-Specific Roles</td><td>Admin</td><td>https://blueprints.launchpad.net/keystone/+spec/domain-specific-roles</td></tr><tr><td>Fernet Token Provider</td><td>User and Admin</td><td>https://docs.openstack.org/keystone/rocky/admin/identity-fernet-token-faq.html</td></tr></tbody></table></div><p>
   <span class="bold"><strong>Implied rules</strong></span>
  </p><p>
   To allow for the practice of hierarchical permissions in user roles, this
   feature enables roles to be linked in such a way that they function as a
   hierarchy with role inheritance.
  </p><p>
   When a user is assigned a superior role, the user will also be assigned all
   roles implied by any subordinate roles. The hierarchy of the assigned roles
   will be expanded when issuing the user a token.
  </p><p>
   <span class="bold"><strong>Domain-specific roles</strong></span>
  </p><p>
   This feature extends the principle of <span class="bold"><strong>implied
   roles</strong></span> to include a set of roles that are specific to a domain. At
   the time a token is issued, the domain-specific roles are not included in
   the token, however, the roles that they map to are.
  </p><p>
   <span class="bold"><strong>Fernet token provider</strong></span>
  </p><p>
   Provides tokens in the Fernet format. This feature is automatically configured
   and is enabled by default. Fernet tokens are preferred and used by default
   instead of the older UUID token format.
  </p></div><div class="sect2" id="section-rpw-21h-jx"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">OpenStack upstream features that are disabled by default in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#section-rpw-21h-jx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-keystone_features.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-keystone_features.xml</li><li><span class="ds-label">ID: </span>section-rpw-21h-jx</li></ul></div></div></div></div><p>
   The following is a list of features which are fully supported in the
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 release, but are disabled by default. Customers can run a
   playbook to enable the features.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Name</th><th>User/Admin</th><th>Reason Disabled</th></tr></thead><tbody><tr><td>Support multiple LDAP backends via per-domain configuration</td><td>Admin</td><td>Needs explicit configuration.</td></tr><tr><td>WebSSO</td><td>User and Admin</td><td>Needs explicit configuration.</td></tr><tr><td>keystone-to-keystone (K2K) federation</td><td>User and Admin</td><td>Needs explicit configuration.</td></tr><tr><td>Domain-specific config in SQL</td><td>Admin</td><td>Domain specific configuration options can be stored in SQL instead of
                        configuration files, using the new REST APIs.</td></tr></tbody></table></div><p>
   <span class="bold"><strong>Multiple LDAP backends for each domain</strong></span>
  </p><p>
   This feature allows identity backends to be configured on a domain-by-domain
   basis. Domains will be capable of having their own exclusive LDAP service
   (or multiple services). A single LDAP service can also serve multiple
   domains, with each domain in a separate subtree.
  </p><p>
   To implement this feature, individual domains will require domain-specific
   configuration files. Domains that do not implement this feature will
   continue to share a common backend driver.
  </p><p>
   <span class="bold"><strong>WebSSO</strong></span>
  </p><p>
   This feature enables the keystone service to provide federated identity
   services through a token-based single sign-on page. This feature is disabled
   by default, as it requires explicit configuration.
  </p><p>
   <span class="bold"><strong>keystone-to-keystone (K2K) federation</strong></span>
  </p><p>
   This feature enables separate keystone instances to federate identities
   among the instances, offering inter-cloud authorization. This feature is
   disabled by default, as it requires explicit configuration.
  </p><p>
   <span class="bold"><strong>Domain-specific config in SQL</strong></span>
  </p><p>
   Using the new REST APIs, domain-specific configuration options can be stored
   in a SQL database instead of in configuration files.
  </p></div><div class="sect2" id="section-fm3-mch-jx"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Stack upstream features that have been specifically disabled in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#section-fm3-mch-jx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-keystone_features.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-keystone_features.xml</li><li><span class="ds-label">ID: </span>section-fm3-mch-jx</li></ul></div></div></div></div><p>
   The following is a list of extensions which are disabled by default in
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9, according to keystone policy.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>Target Release</th><th>Name</th><th>User/Admin</th><th>Reason Disabled</th></tr></thead><tbody><tr><td>TBD</td><td>Endpoint Filtering</td><td>Admin</td><td>
       <p>
        This extension was implemented to facilitate service activation.
        However, due to lack of enforcement at the service side, this feature
        is only half effective right now.
       </p>
      </td></tr><tr><td>TBD</td><td>Endpoint Policy</td><td>Admin</td><td>
       <p>
        This extension was intended to facilitate policy (policy.json)
        management and enforcement. This feature is useless right now due to
        lack of the needed middleware to utilize the policy files stored in
        keystone.
       </p>
      </td></tr><tr><td>TBD</td><td>OATH 1.0a</td><td>User and Admin</td><td>
       <p>
        Complexity in workflow. Lack of adoption. Its alternative, keystone
        Trust, is enabled by default. HEAT is using keystone Trust.
       </p>
      </td></tr><tr><td>TBD</td><td>Revocation Events</td><td>Admin</td><td>
       <p>
        For PKI token only and PKI token is disabled by default due to
        usability concerns.
       </p>
      </td></tr><tr><td>TBD</td><td>OS CERT</td><td>Admin</td><td>
       <p>
        For PKI token only and PKI token is disabled by default due to
        usability concerns.
       </p>
      </td></tr><tr><td>TBD</td><td>PKI Token</td><td>Admin</td><td>
       <p>
        PKI token is disabled by default due to usability concerns.
       </p>
      </td></tr><tr><td>TBD</td><td>Driver level caching</td><td>Admin</td><td>
       <p>
        Driver level caching is disabled by default due to complexity in setup.
       </p>
      </td></tr><tr><td>TBD</td><td>Tokenless Authz</td><td>Admin</td><td>
       <p>
        Tokenless authorization with X.509 SSL client certificate.
       </p>
      </td></tr><tr><td>TBD</td><td>TOTP Authentication</td><td>User</td><td>
       <p>
        Not fully baked. Has not been battle-tested.
       </p>
      </td></tr><tr><td>TBD</td><td>is_admin_project</td><td>Admin</td><td>
       <p>
        No integration with the services.
       </p>
      </td></tr></tbody></table></div></div></div><div class="sect1" id="sec-operation-identity"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Understanding Domains, Projects, Users, Groups, and Roles</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#sec-operation-identity">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>sec-operation-identity</li></ul></div></div></div></div><p>
  The identity service uses these concepts for authentication within your cloud
  and these are descriptions of each of them.
 </p><p>
  The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 identity service uses OpenStack keystone and the concepts
  of domains, projects, users, groups, and roles to manage authentication. This
  page describes how these work together.
 </p><div class="sect2" id="domains-projects-roles"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.3.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Domains, Projects, Users, Groups, and Roles</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#domains-projects-roles">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>domains-projects-roles</li></ul></div></div></div></div><p>
   Most large business organizations use an identity system such as Microsoft
   Active Directory to store and manage their internal user information. A
   variety of applications such as HR systems are, in turn, used to manage the
   data inside of Active Directory. These same organizations often deploy a
   separate user management system for external users such as contractors,
   partners, and customers. Multiple authentication systems are then deployed
   to support multiple types of users.
  </p><p>
   An LDAP-compatible directory such as Active Directory provides a top-level
   organization or domain component. In this example, the organization is
   called Acme. The domain component (DC) is defined as acme.com. Underneath
   the top level domain component are entities referred to as organizational
   units (OU). Organizational units are typically designed to reflect the
   entity structure of the organization. For example, this particular schema
   has 3 different organizational units for the Marketing, IT, and Contractors
   units or departments of the Acme organization. Users (and other types of
   entities like printers) are then defined appropriately underneath each
   organizational entity. The keystone domain entity can be used to match the
   LDAP OU entity; each LDAP OU can have a corresponding keystone domain
   created. In this example, both the Marketing and IT domains represent
   internal employees of Acme and use the same authentication source. The
   Contractors domain contains all external people associated with Acme.
   UserIDs associated with the Contractor domain are maintained in a separate
   user directory and thus have a different authentication source assigned to
   the corresponding keystone-defined Contractors domain.
  </p><p>
   A public cloud deployment usually supports multiple, separate organizations.
   keystone domains can be created to provide a domain per organization with
   each domain configured to the underlying organization's authentication
   source. For example, the ABC company would have a keystone domain created
   called "abc". All users authenticating to the "abc" domain would be
   authenticated against the authentication system provided by the ABC
   organization; in this case ldap://ad.abc.com
  </p></div><div class="sect2" id="domains"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.3.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Domains</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#domains">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>domains</li></ul></div></div></div></div><p>
   A domain is a top-level container targeted at defining major organizational
   entities.
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Domains can be used in a multi-tenant OpenStack deployment to segregate
     projects and users from different companies in a public cloud deployment
     or different organizational units in a private cloud setting.
    </p></li><li class="listitem "><p>
     Domains provide the means to identify multiple authentication sources.
    </p></li><li class="listitem "><p>
     Each domain is unique within an OpenStack implementation.
    </p></li><li class="listitem "><p>
     Multiple projects can be assigned to a domain but each project can only
     belong to a single domain.
    </p></li><li class="listitem "><p>
     Each domain has an assigned "admin".
    </p></li><li class="listitem "><p>
     Each project has an assigned "admin".
    </p></li><li class="listitem "><p>
     Domains are created by the "admin" service account and domain admins are
     assigned by the "admin" user.
    </p></li><li class="listitem "><p>
     The "admin" UserID (UID) is created during the keystone installation, has
     the "admin" role assigned to it, and is defined as the "Cloud Admin". This
     UID is created using the "magic" or "secret" admin token found in the
     default 'keystone.conf' file installed during <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> keystone
     installation after the keystone service has been installed. This secret
     token should be removed after installation and the "admin" password
     changed.
    </p></li><li class="listitem "><p>
     The "default" domain is created automatically during the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> keystone
     installation.
    </p></li><li class="listitem "><p>
     The "default" domain contains all OpenStack service accounts that are
     installed during the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> keystone installation process.
    </p></li><li class="listitem "><p>
     No users but the OpenStack service accounts should be assigned to the
     "default" domain.
    </p></li><li class="listitem "><p>
     Domain admins can be any UserID inside or outside of the domain.
    </p></li></ul></div></div><div class="sect2" id="domain-admin"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.3.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Domain Administrator</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#domain-admin">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>domain-admin</li></ul></div></div></div></div><p>
   A UUID is a domain administrator for a given domain if that UID has a
   domain-scoped token scoped for the given domain. This means that the UID has
   the "admin" role assigned to it for the selected domain.
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The Cloud Admin UID assigns the domain administrator role for a domain to
     a selected UID.
    </p></li><li class="listitem "><p>
     A domain administrator can create and delete local users who have
     authenticated against keystone. These users will be assigned to the domain
     belonging to the domain administrator who creates the UserID.
    </p></li><li class="listitem "><p>
     A domain administrator can only create users and projects within her
     assigned domains.
    </p></li><li class="listitem "><p>
     A domain administrator can assign the "admin" role of their domains to
     another UID or revoke it; each UID with the "admin" role for a specified
     domain will be a co-administrator for that domain.
    </p></li><li class="listitem "><p>
     A UID can be assigned to be the domain admin of multiple domains.
    </p></li><li class="listitem "><p>
     A domain administrator can assign non-admin roles to any users and groups
     within their assigned domain, including projects owned by their assigned
     domain.
    </p></li><li class="listitem "><p>
     A domain admin UID can belong to projects within their administered
     domains.
    </p></li><li class="listitem "><p>
     Each domain can have a different authentication source.
    </p></li><li class="listitem "><p>
     The domain field is used during the initial login to define the source of
     authentication.
    </p></li><li class="listitem "><p>
     The "List Users" function can only be executed by a UID with the domain
     admin role.
    </p></li><li class="listitem "><p>
     A domain administrator can assign a UID from outside of their domain the
     "domain admin" role, but it is assumed that the domain admin would know the
     specific UID and would not need to list users from an external domain.
    </p></li><li class="listitem "><p>
     A domain administrator can assign a UID from outside of their domain the
     "project admin" role for a specific project within their domain, but it is
     assumed that the domain admin would know the specific UID and would not
     need to list users from an external domain.
    </p></li><li class="listitem "><p>
     Any user that needs the ability to create a user in a project should be
     granted the "admin" role for the domain where the user and the project
     reside.
    </p></li><li class="listitem "><p>
     In order for the horizon <span class="guimenu ">Compute</span> › <span class="guimenu ">Images</span> panel to properly fill the "Owner"
     column, any user that is granted the admin role on a project must also be
     granted the "member" or "admin" role in the domain.
    </p></li></ul></div></div><div class="sect2" id="projects"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.3.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Projects</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#projects">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>projects</li></ul></div></div></div></div><p>
   The domain administrator creates projects within his assigned domain and
   assigns the project admin role to each project to a selected UID. A UID is a
   project administrator for a given project if that UID has a project-scoped
   token scoped for the given project. There can be multiple projects per
   domain. The project admin sets the project quota settings, adds/deletes
   users and groups to and from the project, and defines the user/group roles
   for the assigned project. Users can be belong to multiple projects and have
   different roles on each project. Users are assigned to a specific domain and
   a default project. Roles are assigned per project.
  </p></div><div class="sect2" id="users-groups"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.3.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Users and Groups</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#users-groups">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>users-groups</li></ul></div></div></div></div><p>
   Each user belongs to one domain only. Domain assignments are defined either
   by the domain configuration files or by a domain administrator when creating
   a new, local (user authenticated against keystone) user. There is no current
   method for "moving" a user from one domain to another. A user can belong to
   multiple projects within a domain with a different role assignment per
   project. A group is a collection of users. Users can be assigned to groups
   either by the project admin or automatically via mappings if an external
   authentication source is defined for the assigned domain. Groups can be
   assigned to multiple projects within a domain and have different roles
   assigned to the group per project. A group can be assigned the "admin" role
   for a domain or project. All members of the group will be an "admin" for the
   selected domain or project.
  </p></div><div class="sect2" id="roles"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.3.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Roles</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#roles">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-understanding_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-understanding_identity.xml</li><li><span class="ds-label">ID: </span>roles</li></ul></div></div></div></div><p>
   Service roles represent the functionality used to implement the OpenStack
   role based access control (RBAC), model used to manage access to each
   OpenStack service. Roles are named and assigned per user or group for each
   project by the identity service. Role definition and policy
   enforcement are defined outside of the identity service independently by
   each OpenStack service. The token generated by the identity service for each
   user authentication contains the role assigned to that user for a particular
   project. When a user attempts to access a specific OpenStack service, the
   role is parsed by the service, compared to the service-specific policy file,
   and then granted the resource access defined for that role by the service
   policy file.
  </p><p>
   Each service has its own service policy file with the
   /etc/[SERVICE_CODENAME]/policy.json file name format where
   [SERVICE_CODENAME] represents a specific OpenStack service name. For
   example, the OpenStack nova service would have a policy file called
   /etc/nova/policy.json. With Service policy files can be modified and
   deployed to control nodes from the Cloud Lifecycle Manager. Administrators are
   advised to validate policy changes before checking in the changes to the
   site branch of the local git repository before rolling the changes into
   production. Do not make changes to policy files without having a way to
   validate them.
  </p><p>
   The policy files are located at the following site branch locations on the
   Cloud Lifecycle Manager.
  </p><div class="verbatim-wrap"><pre class="screen">~/openstack/ardana/ansible/roles/GLA-API/templates/policy.json.j2
~/openstack/ardana/ansible/roles/ironic-common/files/policy.json
~/openstack/ardana/ansible/roles/KEYMGR-API/templates/policy.json
~/openstack/ardana/ansible/roles/heat-common/files/policy.json
~/openstack/ardana/ansible/roles/CND-API/templates/policy.json
~/openstack/ardana/ansible/roles/nova-common/files/policy.json
~/openstack/ardana/ansible/roles/CEI-API/templates/policy.json.j2
~/openstack/ardana/ansible/roles/neutron-common/templates/policy.json.j2</pre></div><p>
   For test and validation, policy files can be modified in a non-production
   environment from the <code class="filename">~/scratch/</code> directory. For a specific
   policy file, run a search for policy.json. To deploy policy changes for a
   service, run the service specific reconfiguration playbook (for example,
   nova-reconfigure.yml). For a complete list of reconfiguration playbooks,
   change directories to <code class="filename">~/scratch/ansible/next/ardana/ansible</code>
   and run this command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>ls | grep reconfigure</pre></div><p>
   A read-only role named <code class="literal">project_observer</code> is explicitly
   created in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9. Any user who is granted this role can use
   <code class="literal">list_project</code>.
  </p></div></div><div class="sect1" id="topic-ffs-dvz-nw"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Identity Service Token Validation Example</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#topic-ffs-dvz-nw">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_token_validation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_token_validation.xml</li><li><span class="ds-label">ID: </span>topic-ffs-dvz-nw</li></ul></div></div></div></div><p>
  The following diagram illustrates the flow of typical Identity service
  (keystone) requests/responses between <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> services and the Identity
  service. It shows how keystone issues and validates tokens to ensure the
  identity of the caller of each service.
 </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/media-keystone-KeystoneTokenValidationExample.png" target="_blank"><img src="images/media-keystone-KeystoneTokenValidationExample.png" width="" /></a></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     
     horizon sends an HTTP authentication request to keystone for user
     credentials.
    </p></li><li class="listitem "><p>
     
     keystone validates the credentials and replies with token.
    </p></li><li class="listitem "><p>
     
     horizon sends a POST request, with token to nova to start
     provisioning a virtual machine.
    </p></li><li class="listitem "><p>
     
     nova sends token to keystone for validation.
    </p></li><li class="listitem "><p>
     
     keystone validates the token.
    </p></li><li class="listitem "><p>
     
     nova forwards a request for an image with the attached token.
    </p></li><li class="listitem "><p>
     
     glance sends token to keystone for validation.
    </p></li><li class="listitem "><p>
     
     keystone validates the token.
    </p></li><li class="listitem "><p>
     
     glance provides image-related information to nova.
    </p></li><li class="listitem "><p>
     
     nova sends request for networks to neutron with token.
    </p></li><li class="listitem "><p>
     
     neutron sends token to keystone for validation.
    </p></li><li class="listitem "><p>
     
     keystone validates the token.
    </p></li><li class="listitem "><p>
     
     neutron provides network-related information to nova.
    </p></li><li class="listitem "><p>
     
     nova reports the status of the virtual machine provisioning request.
    </p></li></ol></div></div><div class="sect1" id="topic-qmz-fg3-btx"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring the Identity Service</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#topic-qmz-fg3-btx">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span>topic-qmz-fg3-btx</li></ul></div></div></div></div><div class="sect2" id="id-1.5.7.7.2"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">What is the Identity service?</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.7.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> Identity service, based on the OpenStack keystone API, provides
   UserID authentication and access authorization to help organizations achieve
   their access security and compliance objectives and successfully deploy
   OpenStack. In short, the Identity service is the gateway to the rest of the
   OpenStack services.
  </p><p>
   The identity service is installed automatically by the Cloud Lifecycle Manager
   (just after MySQL and RabbitMQ). When your cloud is up and running, you can
   customize keystone in a number of ways, including integrating with LDAP
   servers. This topic describes the default configuration. See
   <a class="xref" href="ops-managing-identity.html#topic-m43-2j3-bt" title="5.8. Reconfiguring the Identity service">Section 5.8, “Reconfiguring the Identity service”</a> for changes you can
   implement. Also see <a class="xref" href="ops-managing-identity.html#ldap" title="5.9. Integrating LDAP with the Identity Service">Section 5.9, “Integrating LDAP with the Identity Service”</a> for information
   on integrating with an LDAP provider.
  </p></div><div class="sect2" id="idg-all-operations-configuring-identity-configure-identity-xml-6"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Which version of the Identity service should you use?</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-configure-identity-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-configure-identity-xml-6</li></ul></div></div></div></div><p>
   Note that you should use identity API version 3.0. Identity API v2.0 was has
   been deprecated. Many features such as LDAP integration and fine-grained
   access control will not work with v2.0. The following are a few questions you
   may have regarding versions.
  </p><p>
   <span class="bold"><strong>Why does the keystone identity catalog still show
   version 2.0?</strong></span>
  </p><p>
   Tempest tests still use the v2.0 API. They are in the process of migrating
   to v3.0. We will remove the v2.0 version once tempest has migrated the
   tests. The Identity catalog has version 2.0 just to support tempest
   migration.
  </p><p>
   <span class="bold"><strong>Will the keystone identity v3.0 API work if the
   identity catalog has only the v2.0 endpoint?</strong></span>
  </p><p>
   Identity v3.0 does not rely on the content of the catalog. It will continue
   to work regardless of the version of the API in the catalog.
  </p><p>
   <span class="bold"><strong>Which CLI client should you use?</strong></span>
  </p><p>
   You should use the OpenStack CLI, not the keystone CLI, because it is
   deprecated. The keystone CLI does not support the v3.0 API; only the
   OpenStack CLI supports the v3.0 API.
  </p></div><div class="sect2" id="idg-all-operations-configuring-identity-configure-identity-xml-7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Authentication</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-configure-identity-xml-7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-configure-identity-xml-7</li></ul></div></div></div></div><p>
   The authentication function provides the initial login function to
   OpenStack. keystone supports multiple sources of authentication, including a
   native or built-in authentication system. You can use the keystone native
   system for all user management functions for proof-of-concept deployments or
   small deployments not requiring integration with a corporate authentication
   system, but it lacks some of the advanced functions usually found in user
   management systems such as forcing password changes. The focus of the
   keystone native authentication system is to be the source of authentication
   for OpenStack-specific users required to operate various OpenStack services.
   These users are stored by keystone in a default domain; the addition of
   these IDs to an external authentication system is not required.
  </p><p>
   keystone is more commonly integrated with external authentication systems
   such as OpenLDAP or Microsoft Active Directory. These systems are usually
   centrally deployed by organizations to serve as the single source of user
   management and authentication for all in-house deployed applications and
   systems requiring user authentication. In addition to LDAP and Microsoft
   Active Directory, support for integration with Security Assertion Markup
   Language (SAML)-based identity providers from companies such as Ping, CA,
   IBM, Oracle, and others is also nearly "production-ready."
  </p><p>
   keystone also provides architectural support through the underlying Apache
   deployment for other types of authentication systems, such as multi-factor
   authentication. These types of systems typically require driver support and
   integration from the respective providers.
  </p><div id="id-1.5.7.7.4.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    While support for Identity providers and multi-factor authentication is
    available in keystone, it has not yet been certified by the <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>
    engineering team and is an experimental feature in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
   </p></div><p>
   LDAP-compatible directories such as OpenLDAP and Microsoft Active Directory
   are recommended alternatives to using keystone local authentication. Both
   methods are widely used by organizations and are integrated with a variety
   of other enterprise applications. These directories act as the single source
   of user information within an organization. You can configure keystone to
   authenticate against an LDAP-compatible directory on a per-domain basis.
  </p><p>
   Domains, as explained in <a class="xref" href="ops-managing-identity.html#sec-operation-identity" title="5.3. Understanding Domains, Projects, Users, Groups, and Roles">Section 5.3, “Understanding Domains, Projects, Users, Groups, and Roles”</a>,
   can be configured so that, based on the user ID, an incoming user is
   automatically mapped to a specific domain. You can then configure this
   domain to authenticate against a specific LDAP directory. User credentials
   provided by the user to keystone are passed along to the designated LDAP
   source for authentication. You can optionally configure this communication
   to be secure through SSL encryption. No special LDAP administrative access
   is required, and only read-only access is needed for this configuration.
   keystone will not add any LDAP information. All user additions, deletions,
   and modifications are performed by the application's front end in the LDAP
   directories. After a user has been successfully authenticated, that user
   is then assigned to the groups, roles, and projects defined by the
   keystone domain or project administrators. This information is stored in
   the keystone service database.
  </p><p>
   Another form of external authentication provided by the keystone service is
   through integration with SAML-based identity providers (IdP) such as Ping
   Identity, IBM Tivoli, and Microsoft Active Directory Federation Server. A
   SAML-based identity provider provides authentication that is often called
   "single sign-on." The IdP server is configured to authenticate against
   identity sources such as Active Directory and provides a single
   authentication API against multiple types of downstream identity sources.
   This means that an organization could have multiple identity storage sources
   but a single authentication source. In addition, if a user has logged into
   one such source during a defined session time frame, that user does not need
   to reauthenticate within the defined session. Instead, the IdP automatically
   validates the user to requesting applications and services.
  </p><p>
   A SAML-based IdP authentication source is configured with keystone on a
   per-domain basis similar to the manner in which native LDAP directories are
   configured. Extra mapping rules are required in the configuration that
   define which keystone group an incoming UID is automatically assigned to.
   
   
   This means that groups need to be defined in keystone first, but it also
   removes the requirement that a domain or project administrator assign user
   roles and project membership on a per-user basis. Instead, groups are used
   to define project membership and roles and incoming users are automatically
   mapped to keystone groups based on their upstream group membership. This
   strategy provides a consistent role-based access control (RBAC) model based
   on the upstream identity source. The configuration of this option is fairly
   straightforward. IdP vendors such as Ping and IBM are contributing to the
   maintenance of this function and have also produced their own integration
   documentation. HPE is using the Microsoft Active Directory Federation
   Services (AD FS) for functional testing and future documentation.
  </p><p>
   The third keystone-supported authentication source is known as multi-factor
   authentication (MFA). MFA typically requires an external source of
   authentication beyond a login name and password, and can include options
   such as SMS text, a temporal token generator, or a fingerprint scanner. Each
   of these types of MFAs are usually specific to a particular MFA vendor. The
   keystone architecture supports an MFA-based authentication system, but this
   has not yet been certified or documented for <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
  </p></div><div class="sect2" id="idg-all-operations-configuring-identity-configure-identity-xml-8"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.5.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Authorization</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-configure-identity-xml-8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-configure-identity-xml-8</li></ul></div></div></div></div><p>
   Another major function provided by the keystone service is access
   authorization that determines which resources and actions are available
   based on the UserID, the role of the user, and the projects that a user is
   provided access to. All of this information is created, managed, and stored
   by keystone. These functions are applied through the horizon web interface,
   the OpenStack command-line interface, or the direct keystone API.
  </p><p>
   keystone provides support for organizing users by using three entities:
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.5.7.7.5.4.1"><span class="term ">Domains</span></dt><dd><p>
      Domains provide the highest level of organization. Domains are intended
      to be used as high-level containers for multiple projects. A domain can
      represent different tenants, companies, or organizations for an OpenStack
      cloud deployed for public cloud deployments or it can represent major
      business units, functions, or any other type of top-level organization
      unit in an OpenStack private cloud deployment. Each domain has at least
      one Domain Admin assigned to it. This Domain Admin can then create
      multiple projects within the domain and assign the project administrator
      role to specific project owners. Each domain created in an OpenStack
      deployment is unique and the projects assigned to a domain cannot exist
      in another domain.
     </p></dd><dt id="id-1.5.7.7.5.4.2"><span class="term ">Projects</span></dt><dd><p>
      Projects are entities within a domain that represent groups of users,
      each user role within that project, and how many underlying
      infrastructure resources can be consumed by members of the project.
     </p></dd><dt id="id-1.5.7.7.5.4.3"><span class="term ">Groups</span></dt><dd><p>
      Groups are an optional function and provide the means of assigning
      project roles to multiple users at once.
     </p></dd></dl></div><p>
   keystone also makes it possible to create and assign roles to groups of
   users or individual users. Role names are created and user assignments are
   made within keystone. The actual function of a role is defined currently for
   each OpenStack service via scripts. When users request access to an
   OpenStack service, their access tokens contain information about their
   assigned project membership and role for that project. This role is then
   matched to the service-specific script and users are allowed to perform
   functions within that service defined by the role mapping.
  </p></div><div class="sect2" id="idg-all-operations-configuring-identity-configure-identity-xml-9"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.5.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Default settings</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-configure-identity-xml-9">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-configure-identity-xml-9</li></ul></div></div></div></div><p>
   <span class="bold"><strong>Identity service configuration settings</strong></span>
  </p><p>
   The identity service configuration options are described in the OpenStack
   documentation at
   <a class="link" href="https://docs.openstack.org/keystone/rocky/configuration.html" target="_blank">keystone Configuration Options</a>
   on the OpenStack site.
  </p><p>
   <span class="bold"><strong>Default domain and service accounts</strong></span>
  </p><p>
   The "default" domain is automatically created during the installation to
   contain the various required OpenStack service accounts, including the
   following:
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><p>admin</p></td><td><p>heat</p></td><td><p>monasca-agent </p></td></tr><tr><td><p>barbican</p></td><td><p>logging</p></td><td><p>neutron</p></td></tr><tr><td><p>barbican_service</p></td><td><p>logging_api</p></td><td><p>nova </p></td></tr><tr><td><p>ceilometer</p></td><td><p>logging_beaver</p></td><td><p>nova_monasca</p></td></tr><tr><td><p>cinder</p></td><td><p>logging_monitor</p></td><td><p>octavia</p></td></tr><tr><td><p>cinderinternal</p></td><td><p>magnum</p></td><td><p>placement</p></td></tr><tr><td><p>demo</p></td><td><p>manila</p></td><td><p>swift</p></td></tr><tr><td><p>designate</p></td><td><p>manilainternal</p></td><td><p>swift-demo</p></td></tr><tr><td><p>glance</p></td><td><p>monasca</p></td><td><p>swift-dispersion</p></td></tr><tr><td><p>glance-check</p></td><td><p>monasca_read_only</p></td><td><p>swift-monitor</p></td></tr><tr><td><p>glance-swift</p></td><td></td><td></td></tr></tbody></table></div><p>
   These are required accounts and are used by the underlying OpenStack
   services. These accounts should not be removed or reassigned to a different
   domain. These "default" domain should be used only for these service
   accounts.
  </p></div><div class="sect2" id="id-1.5.7.7.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.5.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Preinstalled roles</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.7.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-configure_identity.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-configure_identity.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The following are the preinstalled roles. You can create additional roles by
   UIDs with the "admin" role. Roles are defined on a per-service basis (more
   information is available at
   <a class="link" href="http://docs.openstack.org/user-guide-admin/manage_projects_users_and_roles.html" target="_blank">Manage
   projects, users, and roles</a> on the OpenStack website).
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /></colgroup><thead><tr><th>Role</th><th>Description</th></tr></thead><tbody><tr><td>admin</td><td>
       <p>
        The "superuser" role. Provides full access to all <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> services
        across all domains and projects. This role should be given only to a
        cloud administrator.
       </p>
      </td></tr><tr><td>member</td><td>
       <p>
        A general role that enables a user to access resources within an
        assigned project including creating, modifying, and deleting compute,
        storage, and network resources.
       </p>
      </td></tr></tbody></table></div><p>
   You can find additional information on these roles in each service policy
   stored in the <code class="literal">/etc/PROJECT/policy.json</code> files where
   PROJECT is a placeholder for an OpenStack service. For example, the Compute
   (nova) service roles are stored in the
   <code class="literal">/etc/nova/policy.json</code> file. Each service policy file
   defines the specific API functions available to a role label.
  </p></div></div><div class="sect1" id="admin-password"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Retrieving the Admin Password</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#admin-password">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-retrieve_adminpassword.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-retrieve_adminpassword.xml</li><li><span class="ds-label">ID: </span>admin-password</li></ul></div></div></div></div><p>
  The admin password will be used to access the dashboard and Operations Console as
  well as allow you to authenticate to use the command-line tools and API.
 </p><p>
  In a default <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 installation there is a randomly generated
  password for the Admin user created. These steps will show you how to
  retrieve this password.
 </p><div class="sect2" id="retrieve"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.6.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Retrieving the Admin Password</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#retrieve">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-retrieve_adminpassword.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-retrieve_adminpassword.xml</li><li><span class="ds-label">ID: </span>retrieve</li></ul></div></div></div></div><p>
   You can retrieve the randomly generated Admin password by using this command
   on the Cloud Lifecycle Manager:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cat ~/service.osrc</pre></div><p>
   In this example output, the value for <code class="literal">OS_PASSWORD</code> is the
   Admin password:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cat ~/service.osrc
unset OS_DOMAIN_NAME
export OS_IDENTITY_API_VERSION=3
export OS_AUTH_VERSION=3
export OS_PROJECT_NAME=admin
export OS_PROJECT_DOMAIN_NAME=Default
export OS_USERNAME=admin
export OS_USER_DOMAIN_NAME=Default
export OS_PASSWORD=SlWSfwxuJY0
export OS_AUTH_URL=https://10.13.111.145:5000/v3
export OS_ENDPOINT_TYPE=internalURL
# OpenstackClient uses OS_INTERFACE instead of OS_ENDPOINT
export OS_INTERFACE=internal
export OS_CACERT=/etc/ssl/certs/ca-certificates.crt
export OS_COMPUTE_API_VERSION=2</pre></div></div></div><div class="sect1" id="servicePasswords"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Changing Service Passwords</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#servicePasswords">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span>servicePasswords</li></ul></div></div></div></div><p>
  <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> provides a process for changing the default service
  passwords, including your admin user password, which you may want to do for
  security or other purposes.
 </p><p>
  You can easily change the inter-service passwords used for authenticating
  communications between services in your <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> deployment,
  promoting better compliance with your organization’s security policies.
  The inter-service passwords that can be changed include (but are not limited
  to) keystone, MariaDB, RabbitMQ, Cloud Lifecycle Manager cluster, monasca and barbican.
 </p><p>
  The general process for changing the passwords is to:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    Indicate to the configuration processor which password(s) you want to
    change, and optionally include the value of that password
   </p></li><li class="listitem "><p>
    Run the configuration processor to generate the new passwords (you do not
    need to run <code class="command">git add</code> before this)
   </p></li><li class="listitem "><p>
    Run ready-deployment
   </p></li><li class="listitem "><p>
    Check your password name(s) against the tables included below to see which
    high-level credentials-change playbook(s) you need to run
   </p></li><li class="listitem "><p>
    Run the appropriate high-level credentials-change playbook(s)
   </p></li></ul></div><div class="sect2" id="password-strength"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Password Strength</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#password-strength">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span>password-strength</li></ul></div></div></div></div><p>
   Encryption passwords supplied to the configuration processor for use with
   Ansible Vault and for encrypting the configuration processor’s persistent
   state must have a minimum length of 12 characters and a maximum of 128
   characters. Passwords must contain characters from each of the following
   three categories:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Uppercase characters (A-Z)
    </p></li><li class="listitem "><p>
     Lowercase characters (a-z)
    </p></li><li class="listitem "><p>
     Base 10 digits (0-9)
    </p></li></ul></div><p>
   Service Passwords that are automatically generated by the configuration
   processor are chosen from the 62 characters made up of the 26 uppercase,
   the 26 lowercase, and the 10 numeric characters, with no preference given
   to any character or set of characters, with the minimum and maximum lengths
   being determined by the specific requirements of individual services.
  </p><div id="id-1.5.7.9.6.5" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important</h6><p>
    Currently, you can not use any special characters with Ansible Vault,
    Service Passwords, or vCenter configuration.
   </p></div></div><div class="sect2" id="id-1.5.7.9.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Telling the configuration processor which password(s) you want to change</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.9.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9, the configuration processor will produce metadata about
   each of the passwords (and other variables) that it generates in the file
   <code class="literal">~/openstack/my_cloud/info/private_data_metadata_ccp.yml</code>. A
   snippet of this file follows. Expand the header to see the file:
  </p></div><div class="sect2" id="idg-all-operations-change-service-passwords-xml-7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">private_data_metadata_ccp.yml</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-change-service-passwords-xml-7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-change-service-passwords-xml-7</li></ul></div></div></div></div><div class="verbatim-wrap"><pre class="screen">metadata_proxy_shared_secret:
  metadata:
  - clusters:
    - cluster1
    component: nova-metadata
    consuming-cp: ccp
    cp: ccp
  version: '2.0'
mysql_admin_password:
  metadata:
  - clusters:
    - cluster1
    component: ceilometer
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    component: heat
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    component: keystone
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    - compute
    component: nova
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    component: cinder
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    component: glance
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    - compute
    component: neutron
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  - clusters:
    - cluster1
    component: horizon
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  version: '2.0'
mysql_barbican_password:
  metadata:
  - clusters:
    - cluster1
    component: barbican
    consumes: mysql
    consuming-cp: ccp
    cp: ccp
  version: '2.0'</pre></div><p>
   For each variable, there is a metadata entry for each pair of services that
   use the variable including a list of the clusters on which the service
   component that consumes the variable (defined as "component:" in
   <code class="literal">private_data_metadata_ccp.yml</code> above) runs.
  </p><p>
   Note above that the variable <code class="literal">mysql_admin_password</code> is used by a number of
   service components, and the service that is consumed in each case is <code class="literal">mysql</code>,
   which in this context refers to the MariaDB instance that is part of the
   product.
  </p></div><div class="sect2" id="steps-to-change-password"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Steps to change a password</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#steps-to-change-password">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span>steps-to-change-password</li></ul></div></div></div></div><p>
   First, make sure that you have a copy of
   <code class="filename">private_data_metadata_ccp.yml</code>. If you
   do not, generate one to run the configuration processor:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml</pre></div><p>
   Make a copy of the <code class="literal">private_data_metadata_ccp.yml</code> file and
   place it into the <code class="literal">~/openstack/change_credentials</code> directory:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cp ~/openstack/my_cloud/info/private_data_metadata_control-plane-1.yml \
 ~/openstack/change_credentials/</pre></div><p>
   Edit the copied file in <code class="literal">~/openstack/change_credentials</code>
   leaving only those passwords you intend to change. All entries in this
   template file should be deleted <span class="emphasis"><em>except for those
   passwords</em></span>.
  </p><div id="id-1.5.7.9.9.7" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important</h6><p>
    If you leave other passwords in that file that you do
    <span class="emphasis"><em>not</em></span> want to change, they will be regenerated and no
    longer match those in use which could disrupt operations.
   </p></div><div id="id-1.5.7.9.9.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    It is required that you change passwords in batches of each category
    listed below.
   </p></div><p>
   For example, the snippet below would result in the configuration processor
   generating new random values for keystone_backup_password,
   keystone_ceilometer_password, and keystone_cinder_password:
  </p><div class="verbatim-wrap"><pre class="screen">keystone_backup_password:
  metadata:
  - clusters:
    - cluster0
    - cluster1
    - compute
    consumes: keystone-api
    consuming-cp: ccp
    cp: ccp
  version: '2.0'
keystone_ceilometer_password:
  metadata:
  - clusters:
    - cluster1
    component: ceilometer-common
    consumes: keystone-api
    consuming-cp: ccp
    cp: ccp
  version: '2.0'
keystone_cinder_password:
  metadata:
  - clusters:
    - cluster1
    component: cinder-api
    consumes: keystone-api
    consuming-cp: ccp
    cp: ccp
  version: '2.0'</pre></div></div><div class="sect2" id="specifying-password-value"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Specifying password value</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#specifying-password-value">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span>specifying-password-value</li></ul></div></div></div></div><p>
   Optionally, you can specify a value for the password by including a "value:"
   key and value at the same level as metadata:
  </p><div class="verbatim-wrap"><pre class="screen">keystone_backup_password:
    value: 'new_password'
    metadata:
    - clusters:
        - cluster0
        - cluster1
        - compute
        consumes: keystone-api
        consuming-cp: ccp
        cp: ccp
      version: '2.0'</pre></div><p>
   Note that you can have multiple files in openstack/change_credentials. The
   configuration processor will only read files that end in .yml or .yaml.
  </p><div id="id-1.5.7.9.10.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    If you have specified a password value in your credential change file, you
    may want to encrypt it using ansible-vault. If you decide to encrypt with
    ansible-vault, make sure that you use the encryption key you have already
    used when running the configuration processor.
   </p></div><p>
   To encrypt a file using ansible-vault, execute:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/change_credentials
<code class="prompt user">ardana &gt; </code>ansible-vault encrypt <em class="replaceable ">credential change file ending in .yml or .yaml</em></pre></div><p>
   Be sure to provide the encryption key when prompted. Note that if you have
   specified the wrong ansible-vault password, the configuration-processor will
   error out with a message like the following:
  </p><div class="verbatim-wrap"><pre class="screen">################################################## Reading Persistent State ##################################################

################################################################################
# The configuration processor failed.
# PersistentStateCreds: User-supplied creds file test1.yml was not parsed properly
################################################################################</pre></div></div><div class="sect2" id="id-1.5.7.9.11"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Running the configuration processor to change passwords</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.9.11">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The directory openstack/change_credentials is not managed by git, so to rerun
   the configuration processor to generate new passwords and prepare for the
   next deployment just enter the following commands:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div><div id="id-1.5.7.9.11.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    The files that you placed in
    <code class="filename">~/openstack/change_credentials</code> should be removed
    once you have run the configuration processor because the old password
    values and new password values will be stored in the configuration
    processor's persistent state.
   </p></div><p>
   Note that if you see output like the following after running the
   configuration processor:
  </p><div class="verbatim-wrap"><pre class="screen">################################################################################
# The configuration processor completed with warnings.
# PersistentStateCreds: User-supplied password name 'blah' is not valid
################################################################################</pre></div><p>
   this tells you that the password name you have supplied, 'blah,' does not
   exist. A failure to correctly parse the credentials change file will result
   in the configuration processor erroring out with a message like the
   following:
  </p><div class="verbatim-wrap"><pre class="screen">################################################## Reading Persistent State ##################################################

################################################################################
# The configuration processor failed.
# PersistentStateCreds: User-supplied creds file test1.yml was not parsed properly
################################################################################</pre></div><p>
   Once you have run the configuration processor to change passwords, an
   information file
   <code class="literal">~/openstack/my_cloud/info/password_change.yml</code> similar to the
   <code class="literal">private_data_metadata_ccp.yml</code> is written to tell you which
   passwords have been changed, including metadata but not including the
   values.
  </p></div><div class="sect2" id="id-1.5.7.9.12"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Password change playbooks and tables</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.9.12">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Once you have completed the steps above to change password(s) value(s) and
   then prepare for the deployment that will actually switch over to the new
   passwords, you will need to run some high-level playbooks. The passwords
   that can be changed are grouped into six categories. The tables below list
   the password names that belong in each category. The categories are:
  </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.5.7.9.12.3.1"><span class="term ">keystone</span></dt><dd><p>
      Playbook: ardana-keystone-credentials-change.yml
     </p></dd><dt id="id-1.5.7.9.12.3.2"><span class="term ">RabbitMQ</span></dt><dd><p>
      Playbook: ardana-rabbitmq-credentials-change.yml
     </p></dd><dt id="id-1.5.7.9.12.3.3"><span class="term ">MariaDB</span></dt><dd><p>
      Playbook: ardana-reconfigure.yml
     </p></dd><dt id="id-1.5.7.9.12.3.4"><span class="term ">Cluster:</span></dt><dd><p>
      Playbook: ardana-cluster-credentials-change.yml
     </p></dd><dt id="id-1.5.7.9.12.3.5"><span class="term ">monasca:</span></dt><dd><p>
      Playbook: monasca-reconfigure-credentials-change.yml
     </p></dd><dt id="id-1.5.7.9.12.3.6"><span class="term ">Other:</span></dt><dd><p>
      Playbook: ardana-other-credentials-change.yml
     </p></dd></dl></div><p>
   It is recommended that you change passwords in batches; in other words, run
   through a complete password change process for each batch of passwords,
   preferably in the above order. Once you have followed the process indicated
   above to change password(s), check the names against the tables below to see
   which password change playbook(s) you should run.
  </p><p>
   <span class="bold"><strong>Changing identity service credentials</strong></span>
  </p><p>
   The following table lists identity service credentials you can change.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col width="19em" class="c1" /></colgroup><thead><tr><th>keystone credentials </th></tr></thead><tbody><tr><td>
<div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>Password name</strong></span>
barbican_admin_password
barbican_service_password
keystone_admin_pwd
keystone_ceilometer_password
keystone_cinder_password
keystone_cinderinternal_password
keystone_demo_pwd
keystone_designate_password
keystone_glance_password
keystone_glance_swift_password
keystone_heat_password
keystone_magnum_password
keystone_monasca_agent_password
keystone_monasca_password
keystone_neutron_password
keystone_nova_password
keystone_octavia_password
keystone_swift_dispersion_password
keystone_swift_monitor_password
keystone_swift_password
nova_monasca_password</pre></div>
      </td></tr></tbody></table></div><p>
   The playbook to run to change keystone credentials is
   <code class="literal">ardana-keystone-credentials-change.yml</code>. Execute the
   following commands to make the changes:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts ardana-keystone-credentials-change.yml</pre></div><p>
   <span class="bold"><strong>Changing RabbitMQ credentials</strong></span>
  </p><p>
   The following table lists the RabbitMQ credentials you can change.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col width="19em" class="c1" /></colgroup><thead><tr><th>RabbitMQ credentials </th></tr></thead><tbody><tr><td>
<div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>Password name</strong></span>
rmq_barbican_password
rmq_ceilometer_password
rmq_cinder_password
rmq_designate_password
rmq_keystone_password
rmq_magnum_password
rmq_monasca_monitor_password
rmq_nova_password
rmq_octavia_password
rmq_service_password</pre></div>
      </td></tr></tbody></table></div><p>
   The playbook to run to change RabbitMQ credentials is
   <code class="literal">ardana-rabbitmq-credentials-change.yml</code>. Execute the
   following commands to make the changes:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts ardana-rabbitmq-credentials-change.yml</pre></div><p>
   <span class="bold"><strong>Changing MariaDB credentials</strong></span>
  </p><p>
   The following table lists the MariaDB credentials you can change.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col width="19em" class="c1" /></colgroup><thead><tr><th>MariaDB credentials </th></tr></thead><tbody><tr><td>
<div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>Password name</strong></span>
mysql_admin_password
mysql_barbican_password
mysql_clustercheck_pwd
mysql_designate_password
mysql_magnum_password
mysql_monasca_api_password
mysql_monasca_notifier_password
mysql_monasca_thresh_password
mysql_octavia_password
mysql_powerdns_password
mysql_root_pwd
mysql_sst_password
ops_mon_mdb_password
mysql_monasca_transform_password
mysql_nova_api_password
password</pre></div>
      </td></tr></tbody></table></div><p>
   The playbook to run to change MariaDB credentials is
   <code class="literal">ardana-reconfigure.yml</code>. To make the changes, execute the
   following commands:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts ardana-reconfigure.yml</pre></div><p>
   <span class="bold"><strong>Changing cluster credentials</strong></span>
  </p><p>
   The following table lists the cluster credentials you can change.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col width="19em" class="c1" /></colgroup><thead><tr><th>cluster credentials </th></tr></thead><tbody><tr><td>
<div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>Password name</strong></span>
haproxy_stats_password
keepalive_vrrp_password</pre></div>
      </td></tr></tbody></table></div><p>
   The playbook to run to change cluster credentials is
   <code class="literal">ardana-cluster-credentials-change.yml</code>. To make changes,
   execute the following commands:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts ardana-cluster-credentials-change.yml</pre></div><p>
   <span class="bold"><strong>Changing monasca credentials</strong></span>
  </p><p>
   The following table lists the monasca credentials you can change.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col width="19em" class="c1" /></colgroup><thead><tr><th>monasca credentials </th></tr></thead><tbody><tr><td>
<div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>Password name</strong></span>
cassandra_monasca_api_password
cassandra_monasca_persister_password</pre></div>
      </td></tr></tbody></table></div><p>
   The playbook to run to change monasca credentials is
   <code class="literal">monasca-reconfigure-credentials-change.yml</code>. To make the
   changes, execute the following commands:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts monasca-reconfigure-credentials-change.yml</pre></div><p>
   <span class="bold"><strong>Changing other credentials</strong></span>
  </p><p>
   The following table lists the other credentials you can change.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col width="19em" class="c1" /></colgroup><thead><tr><th>Other credentials </th></tr></thead><tbody><tr><td>
<div class="verbatim-wrap"><pre class="screen"><span class="bold"><strong>Password name</strong></span>
logging_beaver_password
logging_api_password
logging_monitor_password
logging_kibana_password</pre></div>
      </td></tr></tbody></table></div><p>
   The playbook to run to change these credentials is
   <code class="literal">ardana-other-credentials-change.yml</code>. To make the changes,
   execute the following commands:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible/
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts ardana-other-credentials-change.yml</pre></div></div><div class="sect2" id="changing-keystone-credentials-for-rgw"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Changing RADOS Gateway Credential</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#changing-keystone-credentials-for-rgw">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span>changing-keystone-credentials-for-rgw</li></ul></div></div></div></div><p>
   To change the keystone credentials of RADOS Gateway, follow the preceding
   steps documented in <a class="xref" href="ops-managing-identity.html#servicePasswords" title="5.7. Changing Service Passwords">Section 5.7, “Changing Service Passwords”</a> by modifying the
   <code class="literal">keystone_rgw_password</code> section in
   <code class="literal">private_data_metadata_ccp.yml</code> file in
   <a class="xref" href="ops-managing-identity.html#steps-to-change-password" title="5.7.4. Steps to change a password">Section 5.7.4, “Steps to change a password”</a> or
   <a class="xref" href="ops-managing-identity.html#specifying-password-value" title="5.7.5. Specifying password value">Section 5.7.5, “Specifying password value”</a>.
  </p></div><div class="sect2" id="id-1.5.7.9.14"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.7.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Immutable variables</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.9.14">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-change_service_passwords.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-change_service_passwords.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The values of certain variables are immutable, which means that once they have
   been generated by the configuration processor they cannot be changed. These
   variables are:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     barbican_master_kek_db_plugin
    </p></li><li class="listitem "><p>
     swift_hash_path_suffix
    </p></li><li class="listitem "><p>
     swift_hash_path_prefix
    </p></li><li class="listitem "><p>
     mysql_cluster_name
    </p></li><li class="listitem "><p>
     heartbeat_key
    </p></li><li class="listitem "><p>
     erlang_cookie
    </p></li></ul></div><p>
   The configuration processor will not re-generate the values of the above
   passwords, nor will it allow you to specify a value for them. In addition to
   the above variables, the following are immutable in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     All ssh keys generated by the configuration processor
    </p></li><li class="listitem "><p>
     All UUIDs generated by the configuration processor
    </p></li><li class="listitem "><p>
     metadata_proxy_shared_secret
    </p></li><li class="listitem "><p>
     horizon_secret_key
    </p></li><li class="listitem "><p>
     ceilometer_metering_secret
    </p></li></ul></div></div></div><div class="sect1" id="topic-m43-2j3-bt"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.8 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Reconfiguring the Identity service</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#topic-m43-2j3-bt">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_reconfigure.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_reconfigure.xml</li><li><span class="ds-label">ID: </span>topic-m43-2j3-bt</li></ul></div></div></div></div><div class="sect2" id="id-1.5.7.10.2"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.8.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Updating the keystone Identity Service</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.10.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_reconfigure.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_reconfigure.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   This topic explains configuration options for the Identity service.
  </p><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> lets you perform updates on the following parts of the Identity
   service configuration:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Any content in the main keystone configuration file:
     <code class="filename">/etc/keystone/keystone.conf</code>. This lets you
     manipulate keystone configuration parameters. Next, continue with
     <a class="xref" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-reconfigure-xml-6" title="5.8.2. Updating the Main Identity service Configuration File">Section 5.8.2, “Updating the Main Identity service Configuration File”</a>.
    </p></li><li class="listitem "><p>
     Updating certain configuration options and enabling features, such as:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       Verbosity of logs being written to keystone log files.
      </p></li><li class="listitem "><p>
       Process counts for the Apache2 WSGI module, separately for admin and
       public keystone interfaces.
      </p></li><li class="listitem "><p>
       Enabling/disabling auditing.
      </p></li><li class="listitem "><p>
       Enabling/disabling Fernet tokens.
      </p></li></ul></div><p>
     For more information, see <a class="xref" href="ops-managing-identity.html#enable-features" title="5.8.3. Enabling Identity Service Features">Section 5.8.3, “Enabling Identity Service Features”</a>.
    </p></li><li class="listitem "><p>
     Creating and updating domain-specific configuration files:
     <span class="bold"><strong>/etc/keystone/domains/keystone.&lt;domain_name&gt;.conf</strong></span>.
     This lets you integrate keystone with one or more external authentication
     sources, such as LDAP server. See the topic on
     <a class="xref" href="ops-managing-identity.html#ldap" title="5.9. Integrating LDAP with the Identity Service">Section 5.9, “Integrating LDAP with the Identity Service”</a>.
    </p></li></ul></div></div><div class="sect2" id="idg-all-operations-configuring-identity-identity-reconfigure-xml-6"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.8.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Updating the Main Identity service Configuration File</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-reconfigure-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_reconfigure.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_reconfigure.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-identity-reconfigure-xml-6</li></ul></div></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     The main keystone Identity service configuration file
     (<span class="bold"><strong>/etc/keystone/keystone.conf</strong></span>), located on
     each control plane server, is generated from the following template file
     located on a Cloud Lifecycle Manager:
     <code class="literal">~/openstack/my_cloud/config/keystone/keystone.conf.j2</code>
    </p><p>
     Modify this template file as appropriate. See
     <a class="link" href="http://docs.openstack.org/liberty/config-reference/content/keystone-configuration-file.html" target="_blank">keystone
     Liberty documentation</a> for full descriptions of all settings. This
     is a Jinja2 template, which expects certain template variables to be set.
     Do not change values inside double curly braces: <code class="literal">{{ }}</code>.
    </p><div id="id-1.5.7.10.3.2.1.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
       <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 has the following token expiration setting, which
       differs from the upstream value <code class="literal">3600</code>:
      </p><div class="verbatim-wrap"><pre class="screen">[token]
expiration = 14400</pre></div></div></li><li class="listitem "><p>
     After you modify the template, commit the change to the local git
     repository, and rerun the configuration processor / deployment area
     preparation playbooks (as suggested in <span class="intraxref">Book “<em class="citetitle ">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/keystone.conf.j2
<code class="prompt user">ardana &gt; </code>git commit -m "Adjusting some parameters in keystone.conf"
<code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
     Run the reconfiguration playbook in the deployment area:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</pre></div></li></ol></div></div><div class="sect2" id="enable-features"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.8.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling Identity Service Features</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#enable-features">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_reconfigure.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_reconfigure.xml</li><li><span class="ds-label">ID: </span>enable-features</li></ul></div></div></div></div><p>
   To enable or disable keystone features, do the following:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Adjust respective parameters in
     <span class="bold"><strong>~/openstack/my_cloud/config/keystone/keystone_deploy_config.yml</strong></span>
    </p></li><li class="listitem "><p>
     Commit the change into local git repository, and rerun the configuration
     processor/deployment area preparation playbooks (as suggested in
     <span class="intraxref">Book “<em class="citetitle ">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/keystone_deploy_config.yml
<code class="prompt user">ardana &gt; </code>git commit -m "Adjusting some WSGI or logging parameters for keystone"
<code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
     Run the reconfiguration playbook in the deployment area:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</pre></div></li></ol></div></div><div class="sect2" id="fernet-tokens"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.8.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Fernet Tokens</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#fernet-tokens">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_reconfigure.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_reconfigure.xml</li><li><span class="ds-label">ID: </span>fernet-tokens</li></ul></div></div></div></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 supports Fernet tokens by default. The benefit of using Fernet
   tokens is that tokens are not persisted in a database, which is helpful if
   you want to deploy the keystone Identity service as one master and multiple
   slaves; only roles, projects, and other details are replicated from master
   to slaves. The token table is not replicated.
  </p><div id="id-1.5.7.10.5.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Tempest does not work with Fernet tokens in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9. If Fernet
    tokens are enabled, do not run token tests in Tempest.
   </p></div><div id="id-1.5.7.10.5.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    During reconfiguration when switching to a Fernet token provider or during
    Fernet key rotation, you may see a warning in
    <code class="literal">keystone.log</code> stating <code class="literal">[fernet_tokens]
    key_repository is world readable: /etc/keystone/fernet-keys/</code>.
    This is expected. You can safely ignore this message. For other keystone
    operations, this warning is not displayed. Directory permissions are set to
    600 (read/write by owner only), not world readable.
   </p></div><p>
   Fernet token-signing key rotation is being handled by a cron job, which is
   configured on one of the controllers. The controller with the Fernet
   token-signing key rotation cron job is also known as the Fernet Master node.
   By default, the Fernet token-signing key is rotated once every 24
   hours. The Fernet token-signing keys are distributed from the Fernet Master
   node to the rest of the controllers at each rotation. Therefore, the Fernet
    token-signing keys are consistent for all the controlers at all time.
  </p><p>
   When enabling Fernet token provider the first time, specific steps are
   needed to set up the necessary mechanisms for Fernet token-signing key
   distributions.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Set <code class="literal">keystone_configure_fernet</code> to
     <code class="literal">True</code> in
     <code class="filename">~/openstack/my_cloud/config/keystone/keystone_deploy_config.yml</code>.
    </p></li><li class="step "><p>
     Run the following commands to commit your change in Git and enable Fernet:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/keystone_deploy_config.yml
<code class="prompt user">ardana &gt; </code>git commit -m "enable Fernet token provider"
<code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml
<code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-deploy.yml</pre></div></li></ol></div></div><p>
   When the Fernet token provider is enabled, a Fernet Master alarm definition
   is also created on monasca to monitor the Fernet Master node. If the Fernet
   Master node is offline or unreachable, a <code class="literal">CRITICAL</code> alarm
   is raised for the Cloud Admin to take corrective actions. If the Fernet
   Master node is offline for a prolonged period of time, Fernet token-signing
   key rotation is not performed. This may introduce security risks to the
   cloud. The Cloud Admin must take immediate actions to resurrect the Fernet
   Master node.
  </p></div></div><div class="sect1" id="ldap"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Integrating LDAP with the Identity Service</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#ldap">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span>ldap</li></ul></div></div></div></div><div class="sect2" id="id-1.5.7.11.2"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.9.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Integrating with an external LDAP server</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.11.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The keystone identity service provides two primary functions: user
   authentication and access authorization. The user authentication function
   validates a user's identity. keystone has a very basic user management
   system that can be used to create and manage user login and password
   credentials but this system is intended only for proof of concept
   deployments due to the very limited password control functions. The internal
   identity service user management system is also commonly used to store and
   authenticate OpenStack-specific service account information.
  </p><p>
   The recommended source of authentication is external user management systems
   such as LDAP directory services. The identity service can be configured to
   connect to and use external systems as the source of user authentication.
   The identity service domain construct is used to define different
   authentication sources based on domain membership. For example, cloud
   deployment could consist of as few as two domains:
  </p><div class="itemizedlist " id="ul-msq-q3h-4v"><ul class="itemizedlist"><li class="listitem "><p>
     The default domain that is pre-configured for the service account users
     that are authenticated directly against the identity service internal user
     management system
    </p></li><li class="listitem "><p>
     A customer-defined domain that contains all user projects and membership
     definitions. This domain can then be configured to use an external LDAP
     directory such as Microsoft Active Directory as the authentication source.
    </p></li></ul></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> can support multiple domains for deployments that support multiple
   tenants. Multiple domains can be created with each domain configured to
   either the same or different external authentication sources. This
   deployment model is known as a "per-domain" model.
  </p><p>
   There are currently two ways to configure "per-domain" authentication
   sources:
  </p><div class="itemizedlist " id="ul-nsq-q3h-4v"><ul class="itemizedlist"><li class="listitem "><p>
     File store – each domain configuration is created and stored in separate
     text files. This is the older and current default method for defining
     domain configurations.
    </p></li><li class="listitem "><p>
     Database store – each domain configuration can be created using either
     the identity service manager utility (recommenced) or a
     <a class="link" href="http://developer.openstack.org/api-ref-identity-v3.html#domains-config-v3" target="_blank">Domain
     Admin API</a> (from OpenStack.org), and the results are stored in the
     identity service MariaDB database. This database store is a new method
     introduced in the OpenStack Kilo release and now available in
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span>.
    </p></li></ul></div><p>
   Instructions for initially creating per-domain configuration files and then
   migrating to the Database store method via the identity service manager
   utility are provided as follows.
  </p></div><div class="sect2" id="filestore"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.9.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Set up domain-specific driver configuration - file store</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#filestore">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span>filestore</li></ul></div></div></div></div><p>
   To update configuration to a specific LDAP domain:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Ensure that the following configuration options are in the main
     configuration file template:
     ~/openstack/my_cloud/config/keystone/keystone.conf.j2
    </p><div class="verbatim-wrap"><pre class="screen">[identity]
domain_specific_drivers_enabled = True
domain_configurations_from_database = False</pre></div></li><li class="listitem "><p>
     Create a YAML file that contains the definition of the LDAP server
     connection. The sample file below is already provided as part of the
     Cloud Lifecycle Manager in the <span class="intraxref">Book “<em class="citetitle ">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>. It is available on
     the Cloud Lifecycle Manager in the following file:
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/config/keystone/keystone_configure_ldap_sample.yml</pre></div><p>
     Save a copy of this file with a new name, for example:
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/config/keystone/keystone_configure_ldap_my.yml</pre></div><div id="id-1.5.7.11.3.3.2.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      Please refer to the LDAP section of the
      <a class="link" href="https://github.com/openstack/keystone/tree/stable/rocky/etc" target="_blank">keystone</a>
      configuration example for OpenStack for the full option list and
      description.
     </p></div><p>
     Below are samples of YAML configurations for identity service LDAP
     certificate settings, optimized for Microsoft Active Directory server.
    </p><p>
     Sample YAML configuration keystone_configure_ldap_my.yml
    </p><div class="verbatim-wrap"><pre class="screen">---
keystone_domainldap_conf:

    # CA certificates file content.
    # Certificates are stored in Base64 PEM format. This may be entire LDAP server
    # certificate (in case of self-signed certificates), certificate of authority
    # which issued LDAP server certificate, or a full certificate chain (Root CA
    # certificate, intermediate CA certificate(s), issuer certificate).
    #
    cert_settings:
      cacert: |
        -----BEGIN CERTIFICATE-----

        certificate appears here

        -----END CERTIFICATE-----

    # A domain will be created in MariaDB with this name, and associated with ldap back end.
    # Installer will also generate a config file named /etc/keystone/domains/keystone.&lt;domain_name&gt;.conf
    #
    domain_settings:
      name: ad
      description: Dedicated domain for ad users

    conf_settings:
      identity:
         driver: ldap


      # For a full list and description of ldap configuration options, please refer to
      # https://github.com/openstack/keystone/blob/master/etc/keystone.conf.sample or
      # http://docs.openstack.org/liberty/config-reference/content/keystone-configuration-file.html.
      #
      # Please note:
      #  1. LDAP configuration is read-only. Configuration which performs write operations (i.e. creates users, groups, etc)
      #     is not supported at the moment.
      #  2. LDAP is only supported for identity operations (reading users and groups from LDAP). Assignment
      #     operations with LDAP (i.e. managing roles, projects) are not supported.
      #  3. LDAP is configured as non-default domain. Configuring LDAP as a default domain is not supported.
      #
      ldap:
        url: ldap://ad.hpe.net
        suffix: DC=hpe,DC=net
        query_scope: sub
        user_tree_dn: CN=Users,DC=hpe,DC=net
        user : CN=admin,CN=Users,DC=hpe,DC=net
        password: REDACTED
        user_objectclass: user
        user_id_attribute: cn
        user_name_attribute: cn
        group_tree_dn: CN=Users,DC=hpe,DC=net
        group_objectclass: group
        group_id_attribute: cn
        group_name_attribute: cn
        use_pool: True
        user_enabled_attribute: userAccountControl
        user_enabled_mask: 2
        user_enabled_default: 512
        use_tls: True
        tls_req_cert: demand
        # if you are configuring multiple LDAP domains, and LDAP server certificates are issued
        # by different authorities, make sure that you place certs for all the LDAP backend domains in the
        # cacert parameter as seen in this sample yml file so that all the certs are combined in a single CA file
        # and every LDAP domain configuration points to the combined CA file.
        # Note:
        # 1. Please be advised that every time a new ldap domain is configured, the single CA file gets overwritten
        # and hence ensure that you place certs for all the LDAP backend domains in the cacert parameter.
        # 2. There is a known issue on one cert per CA file per domain when the system processes
        # concurrent requests to multiple LDAP domains. Using the single CA file with all certs combined
        # shall get the system working properly*.

        tls_cacertfile: /etc/keystone/ssl/certs/all_ldapdomains_ca.pem

        # The issue is in the underlying SSL library. Upstream is not investing in python-ldap package anymore.
        # It is also not python3 compliant.</pre></div><div class="verbatim-wrap"><pre class="screen">keystone_domain_MSAD_conf:

    # CA certificates file content.
    # Certificates are stored in Base64 PEM format. This may be entire LDAP server
    # certificate (in case of self-signed certificates), certificate of authority
    # which issued LDAP server certificate, or a full certificate chain (Root CA
    # certificate, intermediate CA certificate(s), issuer certificate).
    #
    cert_settings:
      cacert: |
        -----BEGIN CERTIFICATE-----

        certificate appears here

        -----END CERTIFICATE-----

    # A domain will be created in MariaDB with this name, and associated with ldap back end.
    # Installer will also generate a config file named /etc/keystone/domains/keystone.&lt;domain_name&gt;.conf
    #
        domain_settings:
          name: msad
          description: Dedicated domain for msad users

        conf_settings:
          identity:
            driver: ldap

    # For a full list and description of ldap configuration options, please refer to
    # https://github.com/openstack/keystone/blob/master/etc/keystone.conf.sample or
    # http://docs.openstack.org/liberty/config-reference/content/keystone-configuration-file.html.
    #
    # Please note:
    #  1. LDAP configuration is read-only. Configuration which performs write operations (i.e. creates users, groups, etc)
    #     is not supported at the moment.
    #  2. LDAP is only supported for identity operations (reading users and groups from LDAP). Assignment
    #     operations with LDAP (i.e. managing roles, projects) are not supported.
    #  3. LDAP is configured as non-default domain. Configuring LDAP as a default domain is not supported.
    #
    ldap:
      # If the url parameter is set to ldap then typically use_tls should be set to True. If
      # url is set to ldaps, then use_tls should be set to False
      url: ldaps://10.16.22.5
      use_tls: False
      query_scope: sub
      user_tree_dn: DC=l3,DC=local
      # this is the user and password for the account that has access to the AD server
      user: administrator@l3.local
      password: OpenStack123
      user_objectclass: user
      # For a default Active Directory schema this is where to find the user name, openldap uses a different value
      user_id_attribute: userPrincipalName
      user_name_attribute: sAMAccountName
      group_tree_dn: DC=l3,DC=local
      group_objectclass: group
      group_id_attribute: cn
      group_name_attribute: cn
      # An upstream defect requires use_pool to be set false
      use_pool: False
      user_enabled_attribute: userAccountControl
      user_enabled_mask: 2
      user_enabled_default: 512
      tls_req_cert: allow
      # Referals may contain urls that can't be resolved and will cause timeouts, ignore them
      chase_referrals: False
      # if you are configuring multiple LDAP domains, and LDAP server certificates are issued
      # by different authorities, make sure that you place certs for all the LDAP backend domains in the
      # cacert parameter as seen in this sample yml file so that all the certs are combined in a single CA file
      # and every LDAP domain configuration points to the combined CA file.
      # Note:
      # 1. Please be advised that every time a new ldap domain is configured, the single CA file gets overwritten
      # and hence ensure that you place certs for all the LDAP backend domains in the cacert parameter.
      # 2. There is a known issue on one cert per CA file per domain when the system processes
      # concurrent requests to multiple LDAP domains. Using the single CA file with all certs combined
      # shall get the system working properly.

      tls_cacertfile: /etc/keystone/ssl/certs/all_ldapdomains_ca.pem</pre></div></li><li class="listitem "><p>
     As suggested in <span class="intraxref">Book “<em class="citetitle ">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>, commit the new file to the
     local git repository, and rerun the configuration processor and ready
     deployment playbooks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/keystone_configure_ldap_my.yml
<code class="prompt user">ardana &gt; </code>git commit -m "Adding LDAP server integration config"
<code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
     Run the reconfiguration playbook in a deployment area, passing the YAML
     file created in the previous step as a command-line option:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@~/openstack/my_cloud/config/keystone/keystone_configure_ldap_my.yml</pre></div></li><li class="listitem "><p>
     Follow these same steps for each LDAP domain with which you are
     integrating the identity service, creating a YAML file for each and
     running the reconfigure playbook once for each additional domain.
    </p></li><li class="listitem "><p>
     Ensure that a new domain was created for LDAP (Microsoft AD in this
     example) and set environment variables for admin level access
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source keystone.osrc</pre></div><p>
     Get a list of domains
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack domain list</pre></div><p>
     As output here:
    </p><div class="verbatim-wrap"><pre class="screen">+----------------------------------+---------+---------+----------------------------------------------------------------------+
| ID                               | Name    | Enabled | Description                                                          |
+----------------------------------+---------+---------+----------------------------------------------------------------------+
| 6740dbf7465a4108a36d6476fc967dbd | heat    | True    | Owns users and projects created by heat                              |
| default                          | Default | True    | Owns users and tenants (i.e. projects) available on Identity API v2. |
| b2aac984a52e49259a2bbf74b7c4108b | ad      | True    | Dedicated domain for users managed by Microsoft AD server            |
+----------------------------------+---------+---------+----------------------------------------------------------------------+</pre></div><div id="id-1.5.7.11.3.3.6.7" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      LDAP domain is read-only. This means that you cannot create new user or
      group records in it.
     </p></div></li><li class="listitem "><p>
     Once the LDAP user is granted the appropriate role, you can authenticate
     within the specified domain. Set environment variables for admin-level
     access
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source keystone.osrc</pre></div><p>
     Get user record within the ad (Active Directory) domain
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack user show testuser1 --domain ad</pre></div><p>
     Note the output:
    </p><div class="verbatim-wrap"><pre class="screen">+-----------+------------------------------------------------------------------+
| Field     | Value                                                            |
+-----------+------------------------------------------------------------------+
| domain_id | 143af847018c4dc7bd35390402395886                                 |
| id        | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |
| name      | testuser1                                                        |
+-----------+------------------------------------------------------------------+</pre></div><p>
     Now, get list of LDAP groups:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack group list --domain ad</pre></div><p>
     Here you see testgroup1 and testgroup2:
    </p><div class="verbatim-wrap"><pre class="screen">+------------------------------------------------------------------+------------+
|  ID                                                              | Name       |
+------------------------------------------------------------------+------------+
|  03976b0ea6f54a8e4c0032e8f756ad581f26915c7e77500c8d4aaf0e83afcdc6| testgroup1 |
7ba52ee1c5829d9837d740c08dffa07ad118ea1db2d70e0dc7fa7853e0b79fcf   | testgroup2 |
+------------------------------------------------------------------+------------+</pre></div><p>
     Create a new role. Note that the role is not bound to the domain.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack role create testrole1</pre></div><p>
     Testrole1 has been created:
    </p><div class="verbatim-wrap"><pre class="screen">+-------+----------------------------------+
| Field | Value                            |
+-------+----------------------------------+
| id    | 02251585319d459ab847409dea527dee |
| name  | testrole1                        |
+-------+----------------------------------+</pre></div><p>
     Grant the user a role within the domain by executing the code below. Note
     that due to a current OpenStack CLI limitation, you must use the user ID
     rather than the user name when working with a non-default domain.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack role add testrole1 --user e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 --domain ad</pre></div><p>
     Verify that the role was successfully granted, as shown here:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack role assignment list --user e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 --domain ad
+----------------------------------+------------------------------------------------------------------+-------+---------+----------------------------------+
| Role                             | User                                                             | Group | Project | Domain                           |
+----------------------------------+------------------------------------------------------------------+-------+---------+----------------------------------+
| 02251585319d459ab847409dea527dee | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |       |         | 143af847018c4dc7bd35390402395886 |
+----------------------------------+------------------------------------------------------------------+-------+---------+----------------------------------+</pre></div><p>
     Authenticate (get a domain-scoped token) as a new user with a new role.
     The --os-* command-line parameters specified below override the respective
     OS_* environment variables set by the keystone.osrc script to provide
     admin access. To ensure that the command below is executed in a clean
     environment, you may want log out from the node and log in again.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack --os-identity-api-version 3 \
            --os-username testuser1 \
            --os-password testuser1_password \
            --os-auth-url http://10.0.0.6:35357/v3 \
            --os-domain-name ad \
            --os-user-domain-name ad \
            token issue</pre></div><p>
     Here is the result:
    </p><div class="verbatim-wrap"><pre class="screen">+-----------+------------------------------------------------------------------+
| Field     | Value                                                            |
+-----------+------------------------------------------------------------------+
| domain_id | 143af847018c4dc7bd35390402395886                                 |
| expires   | 2015-09-09T21:36:15.306561Z                                      |
| id        | 6f8f9f1a932a4d01b7ad9ab061eb0917                                 |
| user_id   | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |
+-----------+------------------------------------------------------------------+</pre></div></li><li class="listitem "><p>
     Users can also have a project within the domain and get a project-scoped
     token. To accomplish this, set environment variables for admin level
     access:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source keystone.osrc</pre></div><p>
     Then create a new project within the domain:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack project create testproject1 --domain ad</pre></div><p>
     The result shows that they have been created:
    </p><div class="verbatim-wrap"><pre class="screen">+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description |                                  |
| domain_id   | 143af847018c4dc7bd35390402395886 |
| enabled     | True                             |
| id          | d065394842d34abd87167ab12759f107 |
| name        | testproject1                     |
+-------------+----------------------------------+</pre></div><p>
     Grant the user a role with a project, re-using the role created in the
     previous example. Note that due to a current OpenStack CLI limitation, you
     must use user ID rather than user name when working with a non-default
     domain.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack role add testrole1 --user e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 --project testproject1</pre></div><p>
     Verify that the role was successfully granted by generating a list:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack role assignment list --user e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 --project testproject1</pre></div><p>
     The output shows the result:
    </p><div class="verbatim-wrap"><pre class="screen">+----------------------------------+------------------------------------------------------------------+-------+----------------------------------+--------+
| Role                             | User                                                             | Group | Project                          | Domain |
+----------------------------------+------------------------------------------------------------------+-------+----------------------------------+--------+
| 02251585319d459ab847409dea527dee | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |       | d065394842d34abd87167ab12759f107 |        |
+----------------------------------+------------------------------------------------------------------+-------+----------------------------------+--------+</pre></div><p>
     Authenticate (get a project-scoped token) as the new user with a new role.
     The --os-* command line parameters specified below override their
     respective OS_* environment variables set by keystone.osrc to provide
     admin access. To ensure that the command below is executed in a clean
     environment, you may want log out from the node and log in again. Note
     that both the --os-project-domain-name and --os-project-user-name
     parameters are needed to verify that both user and project are not in the
     default domain.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack --os-identity-api-version 3 \
            --os-username testuser1 \
            --os-password testuser1_password \
            --os-auth-url http://10.0.0.6:35357/v3 \
            --os-project-name testproject1 \
            --os-project-domain-name ad \
            --os-user-domain-name ad \
            token issue</pre></div><p>
     Below is the result:
    </p><div class="verbatim-wrap"><pre class="screen">+------------+------------------------------------------------------------------+
| Field      | Value                                                            |
+------------+------------------------------------------------------------------+
| expires    | 2015-09-09T21:50:49.945893Z                                      |
| id         | 328e18486f69441fb13f4842423f52d1                                 |
| project_id | d065394842d34abd87167ab12759f107                                 |
| user_id    | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |
+------------+------------------------------------------------------------------+</pre></div></li></ol></div></div><div class="sect2" id="id-1.5.7.11.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.9.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Set up or switch to domain-specific driver configuration using a database store</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.11.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To make the switch, execute the steps below. Remember, you must have already
   set up the configuration for a file store as explained in
   <a class="xref" href="ops-managing-identity.html#filestore" title="5.9.2. Set up domain-specific driver configuration - file store">Section 5.9.2, “Set up domain-specific driver configuration - file store”</a>, and it must be working properly.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Ensure that the following configuration options are set in the main
     configuration file,
     ~/openstack/my_cloud/config/keystone/keystone.conf.j2:
    </p><div class="verbatim-wrap"><pre class="screen">[identity]
domain_specific_drivers_enabled = True
domain_configurations_from_database = True

[domain_config]
driver = sql</pre></div></li><li class="listitem "><p>
     Once the template is modified, commit the change to the local git
     repository, and rerun the configuration processor / deployment area
     preparation playbooks (as suggested at Using Git for Configuration
     Management):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add -A</pre></div><p>
     Verify that the files have been added using git status:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git status</pre></div><p>
     Then commit the changes:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git commit -m "Use Domain-Specific Driver Configuration - Database Store: more description here..."</pre></div><p>
     Next, run the configuration processor and ready deployment playbooks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
     Run the reconfiguration playbook in a deployment area:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</pre></div></li><li class="listitem "><p>
     Upload the domain-specific config files to the database if they have not
     been loaded. If they have already been loaded and you want to switch back
     to database store mode, then skip this upload step and move on to step 5.
    </p><div class="orderedlist " id="ol-tff-px4-mv"><ol class="orderedlist" type="a"><li class="listitem "><p>
       Go to one of the controller nodes where keystone is deployed.
      </p></li><li class="listitem "><p>
       Verify that domain-specific driver configuration files are located under
       the directory (default /etc/keystone/domains) with the format:
       keystone.&lt;domain name&gt;.conf Use the keystone manager utility to
       load domain-specific config files to the database. There are two options
       for uploading the files:
      </p><div class="orderedlist " id="ol-uff-px4-mv"><ol class="orderedlist" type="i"><li class="listitem "><p>
         Option 1: Upload all configuration files to the SQL database:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>keystone-manage domain_config_upload --all</pre></div></li><li class="listitem "><p>
         Option 2: Upload individual domain-specific configuration files by
         specifying the domain name one by one:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>keystone-manage domain_config_upload --domain-name <em class="replaceable ">domain name</em></pre></div><p>
         Here is an example:
        </p><div class="verbatim-wrap"><pre class="screen">keystone-manage domain_config_upload --domain-name ad</pre></div><p>
         Note that the keystone manager utility does not upload the
         domain-specific driver configuration file the second time for the same
         domain. For the management of the domain-specific driver configuration
         in the database store, you may refer to
         <a class="link" href="http://developer.openstack.org/api-ref-identity-v3.html#domains-config-v3" target="_blank">OpenStack
         Identity API - Domain Configuration</a>.
        </p></li></ol></div></li></ol></div></li><li class="listitem "><p>
     Verify that the switched domain driver configuration for LDAP (Microsoft
     AD in this example) in the database store works properly. Then set the
     environment variables for admin level access:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source ~/keystone.osrc</pre></div><p>
     Get a list of domain users:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack user list --domain ad</pre></div><p>
     Note the three users returned:
    </p><div class="verbatim-wrap"><pre class="screen">+------------------------------------------------------------------+------------+
| ID                                                               | Name       |
+------------------------------------------------------------------+------------+
| e7dbec51ecaf07906bd743debcb49157a0e8af557b860a7c1dadd454bdab03fe | testuser1  |
| 8a09630fde3180c685e0cd663427e8638151b534a8a7ccebfcf244751d6f09bd | testuser2  |
| ea463d778dadcefdcfd5b532ee122a70dce7e790786678961420ae007560f35e | testuser3  |
+------------------------------------------------------------------+------------+</pre></div><p>
     Get user records within the ad domain:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack user show testuser1 --domain ad</pre></div><p>
     Here testuser1 is returned:
    </p><div class="verbatim-wrap"><pre class="screen">+-----------+------------------------------------------------------------------+
| Field     | Value                                                            |
+-----------+------------------------------------------------------------------+
| domain_id | 143af847018c4dc7bd35390402395886                                 |
| id        | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |
| name      | testuser1                                                        |
+-----------+------------------------------------------------------------------+</pre></div><p>
     Get a list of LDAP groups:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack group list --domain ad</pre></div><p>
     Note that testgroup1 and testgroup2 are returned:
    </p><div class="verbatim-wrap"><pre class="screen">+------------------------------------------------------------------+------------+
| ID                                                               | Name       |
+------------------------------------------------------------------+------------+
| 03976b0ea6f54a8e4c0032e8f756ad581f26915c7e77500c8d4aaf0e83afcdc6 | testgroup1 |
| 7ba52ee1c5829d9837d740c08dffa07ad118ea1db2d70e0dc7fa7853e0b79fcf | testgroup2 |
+------------------------------------------------------------------+------------+</pre></div><div id="id-1.5.7.11.4.3.5.15" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      LDAP domain is read-only. This means that you cannot create new user or
      group records in it.
     </p></div></li></ol></div></div><div class="sect2" id="id-1.5.7.11.5"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.9.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Domain-specific driver configuration. Switching from a database to a file store</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.11.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Following is the procedure to switch a domain-specific driver configuration
   from a database store to a file store. It is assumed that:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The domain-specific driver configuration with a database store has been
     set up and is working properly.
    </p></li><li class="listitem "><p>
     Domain-specific driver configuration files with the format:
     keystone.&lt;domain name&gt;.conf have already been located and verified
     in the specific directory (by default, /etc/keystone/domains/) on all of
     the controller nodes.
    </p></li></ul></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Ensure that the following configuration options are set in the main
     configuration file template in
     ~/openstack/my_cloud/config/keystone/keystone.conf.j2:
    </p><div class="verbatim-wrap"><pre class="screen">[identity]
 domain_specific_drivers_enabled = True
 domain_configurations_from_database = False

[domain_config]
# driver = sql</pre></div></li><li class="listitem "><p>
     Once the template is modified, commit the change to the local git
     repository, and rerun the configuration processor / deployment area
     preparation playbooks (as suggested at Using Git for Configuration
     Management):
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add -A</pre></div><p>
     Verify that the files have been added using git status, then commit the
     changes:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git status
<code class="prompt user">ardana &gt; </code>git commit -m "Domain-Specific Driver Configuration - Switch From Database Store to File Store: more description here..."</pre></div><p>
     Then run the configuration processor and ready deployment playbooks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
     Run reconfiguration playbook in a deployment area:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</pre></div></li><li class="listitem "><p>
     Verify that the switched domain driver configuration for LDAP (Microsoft
     AD in this example) using file store works properly: Set environment
     variables for admin level access
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>source ~/keystone.osrc</pre></div><p>
     Get list of domain users:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack user list --domain ad</pre></div><p>
     Here you see the three users:
    </p><div class="verbatim-wrap"><pre class="screen">+------------------------------------------------------------------+------------+
| ID                                                               | Name       |
+------------------------------------------------------------------+------------+
| e7dbec51ecaf07906bd743debcb49157a0e8af557b860a7c1dadd454bdab03fe | testuser1  |
| 8a09630fde3180c685e0cd663427e8638151b534a8a7ccebfcf244751d6f09bd | testuser2  |
| ea463d778dadcefdcfd5b532ee122a70dce7e790786678961420ae007560f35e | testuser3  |
+------------------------------------------------------------------+------------+</pre></div><p>
     Get user records within the ad domain:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack user show testuser1 --domain ad</pre></div><p>
     Here is the result:
    </p><div class="verbatim-wrap"><pre class="screen">+-----------+------------------------------------------------------------------+
| Field     | Value                                                            |
+-----------+------------------------------------------------------------------+
| domain_id | 143af847018c4dc7bd35390402395886                                 |
| id        | e6d8c90abdc4510621271b73cc4dda8bc6009f263e421d8735d5f850f002f607 |
| name      | testuser1                                                        |
+-----------+------------------------------------------------------------------+</pre></div><p>
     Get a list of LDAP groups:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openstack group list --domain ad</pre></div><p>
     Here are the groups returned:
    </p><div class="verbatim-wrap"><pre class="screen">+------------------------------------------------------------------+------------+
| ID                                                               | Name       |
+------------------------------------------------------------------+------------+
| 03976b0ea6f54a8e4c0032e8f756ad581f26915c7e77500c8d4aaf0e83afcdc6 | testgroup1 |
| 7ba52ee1c5829d9837d740c08dffa07ad118ea1db2d70e0dc7fa7853e0b79fcf | testgroup2 |
+------------------------------------------------------------------+------------+</pre></div><p>
     Note: Note: LDAP domain is read-only. This means that you can not create
     new user or group record in it.
    </p></li></ol></div></div><div class="sect2" id="id-1.5.7.11.6"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.9.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Update LDAP CA certificates</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.11.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   There is a chance that LDAP CA certificates may expire or for some reason
   not work anymore. Below are steps to update the LDAP CA certificates on the
   identity service side. Follow the steps below to make the updates.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Locate the file keystone_configure_ldap_certs_sample.yml
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/config/keystone/keystone_configure_ldap_certs_sample.yml</pre></div></li><li class="listitem "><p>
     Save a copy of this file with a new name, for example:
    </p><div class="verbatim-wrap"><pre class="screen">~/openstack/my_cloud/config/keystone/keystone_configure_ldap_certs_all.yml</pre></div></li><li class="listitem "><p>
     Edit the file and specify the correct single file path name for the ldap
     certificates. This file path name has to be consistent with the one
     defined in tls_cacertfile of the domain-specific configuration. Edit the
     file and populate or update it with LDAP CA certificates for all LDAP
     domains.
    </p></li><li class="listitem "><p>
     As suggested in <span class="intraxref">Book “<em class="citetitle ">Deployment Guide using Cloud Lifecycle Manager</em>”, Chapter 22 “Using Git for Configuration Management”</span>, add the new file to the local
     git repository:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add -A</pre></div><p>
     Verify that the files have been added using git status and commit the
     file:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>git status
<code class="prompt user">ardana &gt; </code>git commit -m "Update LDAP CA certificates: more description here..."</pre></div><p>
     Then run the configuration processor and ready deployment playbooks:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost config-processor-run.yml
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/localhost ready-deployment.yml</pre></div></li><li class="listitem "><p>
     Run the reconfiguration playbook in the deployment area:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/scratch/ansible/next/ardana/ansible
<code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@~/openstack/my_cloud/config/keystone/keystone_configure_ldap_certs_all.yml</pre></div></li></ol></div></div><div class="sect2" id="id-1.5.7.11.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.9.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Limitations</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.11.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_ldap.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_ldap.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 domain-specific configuration:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     No Global User Listing: Once domain-specific driver configuration is
     enabled, listing all users and listing all groups are not supported
     operations. Those calls require a specific domain filter and a
     domain-scoped token for the target domain.
    </p></li><li class="listitem "><p>
     You cannot have both a file store and a database store for domain-specific
     driver configuration in a single identity service instance. Once a
     database store is enabled within the identity service instance, any file
     store will be ignored, and vice versa.
    </p></li><li class="listitem "><p>
     The identity service allows a list limit configuration to globally set the
     maximum number of entities that will be returned in an identity collection
     per request but it does not support per-domain list limit setting at this
     time.
    </p></li><li class="listitem "><p>
     Each time a new domain is configured with LDAP integration the single CA
     file gets overwritten. Ensure that you place certs for all the LDAP
     back-end domains in the cacert parameter. Detailed CA file inclusion
     instructions are provided in the comments of the sample YAML configuration
     file <code class="filename">keystone_configure_ldap_my.yml</code>
     (<a class="xref" href="ops-managing-identity.html#filestore" title="5.9.2. Set up domain-specific driver configuration - file store">Section 5.9.2, “Set up domain-specific driver configuration - file store”</a>).
    </p></li><li class="listitem "><p>
     LDAP is only supported for identity operations (reading users and groups
     from LDAP).
    </p></li><li class="listitem "><p>
     keystone assignment operations from LDAP records such as managing or
     assigning roles and projects, are not currently supported.
    </p></li><li class="listitem "><p>
     The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 'default' domain is pre-configured to store service account
     users and is authenticated locally against the identity service. Domains
     configured for external LDAP integration are non-default domains.
    </p></li><li class="listitem "><p>
     When using the current OpenStackClient CLI you must use the user ID rather
     than the user name when working with a non-default domain.
    </p></li><li class="listitem "><p>
     Each LDAP connection with the identity service is for read-only
     operations. Configurations that require identity service write operations
     (to create users, groups, etc.) are not currently supported.
    </p></li><li class="listitem "><p>
     LDAP is only supported for identity operations (reading users and groups
     from LDAP). keystone assignment operations from LDAP records such as
     managing or assigning roles and projects, are not currently supported.
    </p></li><li class="listitem "><p>
     When using the current OpenStackClient CLI you must use the user ID rather
     than the user name when working with a non-default domain.
    </p></li></ul></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 API-based domain-specific configuration management
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     No GUI dashboard for domain-specific driver configuration management
    </p></li><li class="listitem "><p>
     API-based Domain specific config does not check for type of option.
    </p></li><li class="listitem "><p>
     API-based Domain specific config does not check for option values
     supported.
    </p></li><li class="listitem "><p>
     API-based Domain config method does not provide retrieval of default
     values of domain-specific configuration options.
    </p></li><li class="listitem "><p>
     Status: Domain-specific driver configuration database store is a non-core
     feature for <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9.
    </p></li></ul></div><div id="id-1.5.7.11.7.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    When integrating with an external identity provider, cloud security is
    dependent upon the security of that identify provider. You should examine
    the security of the identity provider, and in particular the SAML 2.0 token
    generation process and decide what security properties you need to ensure
    adequate security of your cloud deployment. More information about SAML can
    be found at
    <a class="link" href="https://www.owasp.org/index.php/SAML_Security_Cheat_Sheet" target="_blank">https://www.owasp.org/index.php/SAML_Security_Cheat_Sheet</a>.
   </p></div></div></div><div class="sect1" id="k2kfed"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.10 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">keystone-to-keystone Federation</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#k2kfed">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span>k2kfed</li></ul></div></div></div></div><p>
  This topic explains how you can use one instance of keystone as an identity
  provider and one as a service provider.
 </p><div class="sect2" id="id-1.5.7.12.3"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">What Is Keystone-to-Keystone Federation?</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.12.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Identity federation lets you configure <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> using existing identity
   management systems such as an LDAP directory as the source of user access
   authentication. The keystone-to-keystone federation (K2K) function extends
   this concept for accessing resources in multiple, separate <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> clouds.
   You can configure each cloud to trust the authentication credentials of
   other clouds to provide the ability for users to authenticate with their
   home cloud and to access authorized resources in another cloud without
   having to reauthenticate with the remote cloud. This function is sometimes
   referred to as "single sign-on" or SSO.
  </p><p>
   The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> cloud that provides the initial user authentication is called
   the identity provider (IdP). The identity provider cloud can support
   domain-based authentication against external authentication sources
   including LDAP-based directories such as Microsoft Active Directory. The
   identity provider creates the user attributes, known as assertions, which
   are used to automatically authenticate users with other <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> clouds.
  </p><p>
   An <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> cloud that provides resources is called a service provider (SP).
   A service provider cloud accepts user authentication assertions from the
   identity provider and provides access to project resources based on the
   mapping file settings developed for each service provider cloud. The
   following are characteristics of a service provider:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Each service provider cloud has a unique set of projects, groups, and
     group role assignments that are created and managed locally.
    </p></li><li class="listitem "><p>
     The mapping file consists a set of rules that define user group
     membership.
    </p></li><li class="listitem "><p>
     The mapping file enables the ability to auto-assign incoming users to a
     specific group. Project membership and access are defined by group
     membership.
    </p></li><li class="listitem "><p>
     Project quotas are defined locally by each service provider cloud.
    </p></li></ul></div><p>
   keystone-to-keystone federation is supported and enabled in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9
   using configuration parameters in specific Ansible files. Instructions are
   provided to define and enable the required configurations.
  </p><p>
   Support for keystone-to-keystone federation happens on the API level, and
   you must implement it using your own client code by calling the supported
   APIs. Python-keystoneclient has supported APIs to access the K2K APIs.
  </p><div class="complex-example"><div class="example" id="ex-k2kclient"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 5.1: </span><span class="name">k2kclient.py </span><a title="Permalink" class="permalink" href="ops-managing-identity.html#ex-k2kclient">#</a></h6></div><div class="example-contents"><p>
    The following k2kclient.py file is an example, and the request diagram
    <a class="xref" href="ops-managing-identity.html#fig-keystone-authentication-flow" title="Keystone Authentication Flow">Figure 5.1, “Keystone Authentication Flow”</a> explains the flow of
    client requests.
   </p><div class="verbatim-wrap highlight python"><pre class="screen">import json
import os
import requests

import xml.dom.minidom

from keystoneclient.auth.identity import v3
from keystoneclient import session

class K2KClient(object):

    def __init__(self):
        # IdP auth URL
        self.auth_url = "http://192.168.245.9:35357/v3/"
        self.project_name = "admin"
        self.project_domain_name = "Default"
        self.username = "admin"
        self.password = "vvaQIZ1S"
        self.user_domain_name = "Default"
        self.session = requests.Session()
        self.verify = False
        # identity provider Id
        self.idp_id = "z420_idp"
        # service provider Id
        self.sp_id = "z620_sp"
        #self.sp_ecp_url = "https://16.103.149.44:8443/Shibboleth.sso/SAML2/ECP"
        #self.sp_auth_url = "https://16.103.149.44:8443/v3"

    def v3_authenticate(self):
        auth = v3.Password(auth_url=self.auth_url,
                           username=self.username,
                           password=self.password,
                           user_domain_name=self.user_domain_name,
                           project_name=self.project_name,
                           project_domain_name=self.project_domain_name)

        self.auth_session = session.Session(session=requests.session(),
                                       auth=auth, verify=self.verify)
        auth_ref = self.auth_session.auth.get_auth_ref(self.auth_session)
        self.token = self.auth_session.auth.get_token(self.auth_session)

    def _generate_token_json(self):
        return {
            "auth": {
                "identity": {
                    "methods": [
                        "token"
                    ],
                    "token": {
                        "id": self.token
                    }
                },
                "scope": {
                    "service_provider": {
                        "id": self.sp_id
                    }
                }
            }
        }

    def get_saml2_ecp_assertion(self):
        token = json.dumps(self._generate_token_json())
        url = self.auth_url + 'auth/OS-FEDERATION/saml2/ecp'
        r = self.session.post(url=url,
                              data=token,
                              verify=self.verify)
        if not r.ok:
            raise Exception("Something went wrong, %s" % r.__dict__)
        self.ecp_assertion = r.text

    def _get_sp_url(self):
        url = self.auth_url + 'OS-FEDERATION/service_providers/' + self.sp_id
        r = self.auth_session.get(
           url=url,
           verify=self.verify)
        if not r.ok:
            raise Exception("Something went wrong, %s" % r.__dict__)

        sp = json.loads(r.text)[u'service_provider']
        self.sp_ecp_url = sp[u'sp_url']
        self.sp_auth_url = sp[u'auth_url']

    def _handle_http_302_ecp_redirect(self, response, method, **kwargs):
        location = self.sp_auth_url + '/OS-FEDERATION/identity_providers/' + self.idp_id + '/protocols/saml2/auth'
        return self.auth_session.request(location, method, authenticated=False, **kwargs)

    def exchange_assertion(self):
        """Send assertion to a keystone SP and get token."""
        self._get_sp_url()
        print("SP ECP Url:%s" % self.sp_ecp_url)
        print("SP Auth Url:%s" % self.sp_auth_url)
        #self.sp_ecp_url = 'https://16.103.149.44:8443/Shibboleth.sso/SAML2/ECP'
        r = self.auth_session.post(
            self.sp_ecp_url,
            headers={'Content-Type': 'application/vnd.paos+xml'},
            data=self.ecp_assertion,
            authenticated=False, redirect=False)
        r = self._handle_http_302_ecp_redirect(r, 'GET',
            headers={'Content-Type': 'application/vnd.paos+xml'})
        self.fed_token_id = r.headers['X-Subject-Token']
        self.fed_token = r.text

if __name__ == "__main__":
    client = K2KClient()
    client.v3_authenticate()
    client.get_saml2_ecp_assertion()
    client.exchange_assertion()
    print('Unscoped token_id: %s' % client.fed_token_id)
    print('Unscoped token body:
%s' % client.fed_token)</pre></div></div></div></div></div><div class="sect2" id="id-1.5.7.12.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Setting Up a keystone Provider</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.12.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   To set up keystone as a service provider, follow these steps.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Create a config file called <code class="literal">k2k.yml</code> with the following
     parameters and place it in any directory on your Cloud Lifecycle Manager, such
     as /tmp.
    </p><div class="verbatim-wrap"><pre class="screen">keystone_trusted_idp: k2k
keystone_sp_conf:
  shib_sso_idp_entity_id: &lt;protocol&gt;://&lt;idp_host&gt;:&lt;port&gt;/v3/OS-FEDERATION/saml2/idp
  shib_sso_application_entity_id: http://service_provider_uri_entityId
  target_domain:
    name: domain1
    description: my domain
  target_project:
    name: project1
    description: my project
  target_group:
    name: group1
    description: my group
  role:
    name: service
  idp_metadata_file: /tmp/idp_metadata.xml
  identity_provider:
    id: my_idp_id
    description: This is the identity service provider.
  mapping:
    id: mapping1
    <span class="bold"><strong>rules_file: /tmp/k2k_sp_mapping.json</strong></span>
  protocol:
    id: saml2
  attribute_map:
    -
      name: name1
      id: id1</pre></div><p>
     The following are descriptions of each of the attributes.
    </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /></colgroup><thead><tr><th> Attribute</th><th>Definition</th></tr></thead><tbody><tr><td>keystone_trusted_idp</td><td>
         <p>
          A flag to indicate if this configuration is used for
          keystone-to-keystone or WebSSO. The value can be either k2k or adfs.
         </p>
        </td></tr><tr><td><span class="bold"><strong>keystone_sp_conf</strong></span>
        </td><td> </td></tr><tr><td>shib_sso_idp_entity_id</td><td>
         <p>
          The identity provider URI used as an entity Id to identity the IdP.
          You shoud use the following value:
          &lt;protocol&gt;://&lt;idp_host&gt;:&lt;port&gt;/v3/OS-FEDERATION/saml2/idp.
         </p>
        </td></tr><tr><td>shib_sso_application_entity_id</td><td>
         <p>
          The service provider URI used as an entity Id. It can be any URI here
          for keystone-to-keystone.
         </p>
        </td></tr><tr><td>target_domain</td><td>
         <p>
          A domain where the group will be created.
         </p>
        </td></tr><tr><td>name</td><td>
         <p>
          Any domain name. If it does not exist, it will be created or updated.
         </p>
        </td></tr><tr><td>description</td><td>
         <p>
          Any description.
         </p>
        </td></tr><tr><td>target_project</td><td>
         <p>
          A project scope of the group.
         </p>
        </td></tr><tr><td>name</td><td>
         <p>
          Any project name. If it does not exist, it will be created or
          updated.
         </p>
        </td></tr><tr><td>description</td><td>Any description. </td></tr><tr><td>target_group</td><td>
         <p>
          A group will be created from target_domain.
         </p>
        </td></tr><tr><td>name</td><td>
         <p>
          Any group name. If it does not exist, it will be created or updated.
         </p>
        </td></tr><tr><td>description</td><td>Any description. </td></tr><tr><td>role</td><td>
         <p>
          A role will be assigned on target_project. This role impacts the IdP
          user scoped token permission on the service provider side.
         </p>
        </td></tr><tr><td>name</td><td>Must be an existing role. </td></tr><tr><td>idp_metadata_file</td><td>
         <p>
          A reference to the IdP metadata file that validates the SAML2
          assertion.
         </p>
        </td></tr><tr><td>identity_provider</td><td>A supported IdP.</td></tr><tr><td>id</td><td>
         <p>
          Any Id. If it does not exist, it will be created or updated. This Id
          needs to be shared with the client so that the right mapping will be
          selected.
         </p>
        </td></tr><tr><td>description</td><td>Any description.</td></tr><tr><td>mapping</td><td>
         <p>
          A mapping in JSON format that maps a federated user to a
          corresponding group.
         </p>
        </td></tr><tr><td>id</td><td>
         <p>
          Any Id. If it does not exist, it will be created or updated.
         </p>
        </td></tr><tr><td>rules_file</td><td>
         <p>
          A reference to the file that has the mapping in JSON.
         </p>
        </td></tr><tr><td>protocol</td><td>
         <p>
          The supported federation protocol.
         </p>
        </td></tr><tr><td>id</td><td>
         <p>
          Security Assertion Markup Language 2.0 (SAML2) is the only supported
          protocol for K2K.
         </p>
        </td></tr><tr><td>attribute_map</td><td>
         <p>
          A shibboleth mapping that defines additional attributes to map the
          attributes from the SAML2 assertion to the K2K mapping that the
          service provider understands. K2K does not require any additional
          attribute mapping.
         </p>
        </td></tr><tr><td>name</td><td>An attribute name from the SAML2 assertion.</td></tr><tr><td>id</td><td>An Id that the preceding name will be mapped to.</td></tr></tbody></table></div></li><li class="listitem "><p>
     Create a metadata file that is referenced from <code class="literal">k2k.yml</code>,
     such as <code class="literal">/tmp/idp_metadata.xml</code>. The content of the
     metadata file comes from the identity provider and can be found in
     <code class="literal"> /etc/keystone/idp_metadata.xml</code>.
    </p><div class="orderedlist "><ol class="orderedlist" type="a"><li class="listitem "><p>
       Create a mapping file that is referenced in k2k.yml, shown previously.
       An example is <code class="literal">/tmp/k2k_sp_mapping.json</code>. You can see
       the reference in bold in the preceding k2k.yml example. The following is
       an example of the mapping file.
      </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://idp_host:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div><p>
       You can find more information on how the K2K mapping works at
       <a class="link" href="http://docs.openstack.org" target="_blank">http://docs.openstack.org</a>.
      </p></li></ol></div></li><li class="listitem "><p>
     Go to <code class="literal">~/stack/scratch/ansible/next/ardana/ansible</code> and
     run the following playbook to enable the service provider:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@/tmp/k2k.yml</pre></div></li></ol></div><p>
   <span class="bold"><strong><span class="bold"><strong>Setting Up an Identity
   Provider</strong></span></strong></span>
  </p><p>
   To set up keystone as an identity provider, follow these steps:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Create a config file <code class="literal">k2k.yml</code> with the following
     parameters and place it in any directory on your Cloud Lifecycle Manager, such
     as <code class="literal">/tmp</code>. Note that the certificate and key here are
     excerpted for space.
    </p><div class="verbatim-wrap"><pre class="screen">keystone_k2k_idp_conf:
    service_provider:
          -
            id: my_sp_id
            description: This is service provider.
            sp_url: https://sp_host:5000
            auth_url: https://sp_host:5000/v3
    signer_cert: -----BEGIN CERTIFICATE-----
MIIDmDCCAoACCQDS+ZDoUfr
    cIzANBgkqhkiG9w0BAQsFADCBjDELMAkGA1UEBhMC\ nVVMxEzARBgNVB
    AgMCkNhbGlmb3JuaWExEjAQBgNVBAcMCVN1bm55dmFsZTEMMAoG\
   
            ...
    nOpKEvhlMsl5I/tle
-----END CERTIFICATE-----
    signer_key: -----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA1gRiHiwSO6L5PrtroHi/f17DQBOpJ1KMnS9FOHS
            
            ...</pre></div><p>
     The following are descriptions of each of the attributes under
     keystone_k2k_idp_conf
    </p><div class="variablelist "><dl class="variablelist"><dt id="id-1.5.7.12.4.6.1.4.1"><span class="term ">service_provider</span></dt><dd><p>
        One or more service providers can be defined. If it does not exist, it
        will be created or updated.
       </p></dd><dt id="id-1.5.7.12.4.6.1.4.2"><span class="term ">id</span></dt><dd><p>
        Any Id. If it does not exist, it will be created or updated. This Id
        needs to be shared with the client so that it knows where the service
        provider is.
       </p></dd><dt id="id-1.5.7.12.4.6.1.4.3"><span class="term ">description</span></dt><dd><p>
        Any description.
       </p></dd><dt id="id-1.5.7.12.4.6.1.4.4"><span class="term ">sp_url</span></dt><dd><p>
        Service provider base URL.
       </p></dd><dt id="id-1.5.7.12.4.6.1.4.5"><span class="term ">auth_url</span></dt><dd><p>
        Service provider auth URL.
       </p></dd><dt id="id-1.5.7.12.4.6.1.4.6"><span class="term ">signer_cert</span></dt><dd><p>
        Content of self-signed certificate that is embedded in the metadata
        file. We recommend setting the validity for a longer period of time,
        such as 3650 days (10 years).
       </p></dd><dt id="id-1.5.7.12.4.6.1.4.7"><span class="term ">signer_key</span></dt><dd><p>
        A private key that has a key size of 2048 bits.
       </p></dd></dl></div></li><li class="listitem "><p>
     Create a private key and a self-signed certificate. The command-line tool,
     openssl, is required to generate the keys and certificates. If the system
     does not have it, you must install it.
    </p><div class="orderedlist "><ol class="orderedlist" type="a"><li class="listitem "><p>
       Create a private key of size 2048.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openssl genrsa -out myidp.key 2048</pre></div></li><li class="listitem "><p>
       Generate a certificate request named myidp.csr. When prompted, choose
       CommonName for the server's hostname.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openssl req -new -key myidp.key -out myidp.csr</pre></div></li><li class="listitem "><p>
       Generate a self-signed certificate named myidp.cer.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>openssl x509 -req -days 3650 -in myidp.csr -signkey myidp.key -out myidp.cer</pre></div></li></ol></div></li><li class="listitem "><p>
     Go to <code class="literal">~/scratch/ansible/next/ardana/ansible</code> and
     run the following playbook to enable the service provider in keystone:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@/tmp/k2k.yml</pre></div></li></ol></div></div><div class="sect2" id="id-1.5.7.12.5"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Test It Out</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.12.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   You can use the script listed earlier, <code class="literal">k2kclient.py</code>
   (<a class="xref" href="ops-managing-identity.html#ex-k2kclient" title="k2kclient.py">Example 5.1, “k2kclient.py”</a>), as an example for the end-to-end flows. To run
   <code class="literal">k2kclient.py</code>, follow these steps:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     A few parameters must be changed in the beginning of
     <code class="literal">k2kclient.py</code>. For example, enter your specific URL,
     project name, and user name, as follows:
    </p><div class="verbatim-wrap"><pre class="screen"># IdP auth URL
self.auth_url = "http://idp_host:5000/v3/"
self.project_name = "my_project_name"
self.project_domain_name = "my_project_domain_name"
self.username = "test"
self.password = "mypass"
self.user_domain_name = "my_domain"
# identity provider Id that is defined in the SP config
self.idp_id = "my_idp_id"
# service provider Id that is defined in the IdP config
self.sp_id = "my_sp_id"</pre></div></li><li class="listitem "><p>
     Install python-keystoneclient along with its dependencies.
    </p></li><li class="listitem "><p>
     Run the <code class="literal">k2kclient.py</code> script. An unscoped token will be
     returned from the service provider.
    </p></li></ol></div><p>
   At this point, the domain or project scope of the unscoped taken can be
   discovered by sending the following URLs:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>curl -k -X GET -H "X-Auth-Token: <em class="replaceable ">unscoped token</em>" \
 https://&lt;sp_public_endpoint&gt;:5000/v3/OS-FEDERATION/domains
<code class="prompt user">ardana &gt; </code>curl -k -X GET -H "X-Auth-Token: <em class="replaceable ">unscoped token</em>" \
 https://&lt;sp_public_endpoint:5000/v3/OS-FEDERATION/projects</pre></div></div><div class="sect2" id="id-1.5.7.12.6"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Inside keystone-to-keystone Federation</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.12.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   K2K federation places a lot of responsibility with the user. The complexity
   is apparent from the following diagram.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Users must first authenticate to their home or local cloud, or local
     identity provider keystone instance to obtain a scoped token.
    </p></li><li class="listitem "><p>
     Users must discover which service providers (or remote clouds) are
     available to them by querying their local cloud.
    </p></li><li class="listitem "><p>
     For a given remote cloud, users must discover which resources are
     available to them by querying the remote cloud for the projects they can
     scope to.
    </p></li><li class="listitem "><p>
     To talk to the remote cloud, users must first exchange, with the local
     cloud, their locally scoped token for a SAML2 assertion to present to the
     remote cloud.
    </p></li><li class="listitem "><p>
     Users then present the SAML2 assertion to the remote cloud. The remote
     cloud applies its mapping for the incoming SAML2 assertion to map each
     user to a local ephemeral persona (such as groups) and issues an unscoped
     token.
    </p></li><li class="listitem "><p>
     Users query the remote cloud for the list of projects they have access to.
    </p></li><li class="listitem "><p>
     Users then rescope their token to a given project.
    </p></li><li class="listitem "><p>
     Users now have access to the resources owned by the project.
    </p></li></ol></div><p>
   The following diagram illustrates the flow of authentication requests.
  </p><div class="figure" id="fig-keystone-authentication-flow"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/media-keystone-Keystone-2-Keystone-Sequence-Generic.png" target="_blank"><img src="images/media-keystone-Keystone-2-Keystone-Sequence-Generic.png" width="" alt="Keystone Authentication Flow" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 5.1: </span><span class="name">Keystone Authentication Flow </span><a title="Permalink" class="permalink" href="ops-managing-identity.html#fig-keystone-authentication-flow">#</a></h6></div></div></div><div class="sect2" id="id-1.5.7.12.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Additional Testing Scenarios</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.12.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   The following tests assume one identity provider and one service provider.
  </p><p>
   <span class="bold"><strong>Test Case 1: Any federated user in the identity
   provider maps to a single designated group in the service
   provider</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com
username=user1</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group1
group_domain_name=domain1
'group1' scopes to 'project1'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_1.json</pre></div><p>
     testcase1_1.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to project1.
    </p></li></ol></div><p>
   <span class="bold"><strong>Test Case 2: A federated user in a specific domain in
   the identity provider maps to two different groups in the service
   provider</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com
username=user1
user_domain_name=Default</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group1
group_domain_name=domain1
'group1' scopes to 'project1' group=group2
group_domain_name=domain2
'group2' scopes to 'project2'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_2.json</pre></div><p>
     testcase1_2.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group2",
           "domain":{
             "name": "domain2"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "openstack_user_domain",
      "any_one_of": [
          "Default"
      ]
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to both project1 and
     project2.
    </p></li></ol></div><p>
   <span class="bold"><strong>Test Case 3: A federated user with a specific project
   in the identity provider maps to a specific group in the service
   provider</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com
username=user4
user_project_name=test1</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group4
group_domain_name=domain4
'group4' scopes to 'project4'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_3.json</pre></div><p>
     testcase1_3.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group4",
           "domain":{
             "name": "domain4"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "openstack_project",
      "any_one_of": [
          "test1"
      ]
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   },
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group5",
           "domain":{
             "name": "domain5"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "openstack_roles",
      "not_any_of": [
          "member"
      ]
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to project4.
    </p></li></ol></div><p>
   <span class="bold"><strong>Test Case 4: A federated user with a specific role in
   the identity provider maps to a specific group in the service
   provider</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com, username=user5, role_name=member</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group5, group_domain_name=domain5, 'group5' scopes to 'project5'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_3.json</pre></div><p>
     testcase1_3.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group4",
           "domain":{
             "name": "domain4"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "openstack_project",
      "any_one_of": [
          "test1"
      ]
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   },
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group5",
           "domain":{
             "name": "domain5"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "openstack_roles",
      "not_any_of": [
          "member"
      ]
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to project5.
    </p></li></ol></div><p>
   <span class="bold"><strong>Test Case 5: Retain the previous scope for a federated
   user</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com, username=user1, user_domain_name=Default</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group1, group_domain_name=domain1, 'group1' scopes to 'project1'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_1.json</pre></div><p>
     testcase1_1.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to project1. Later, we
     would like to scope federated users who have the default domain in the
     identity provider to project2 in addition to project1.
    </p></li><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com, username=user1, user_domain_name=Default</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group1
group_domain_name=domain1
'group1' scopes to 'project1' group=group2
group_domain_name=domain2
'group2' scopes to 'project2'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_2.json</pre></div><p>
     testcase1_2.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group2",
           "domain":{
             "name": "domain2"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "openstack_user_domain",
      "any_one_of": [
          "Default"
      ]
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to project1 and project2.
    </p></li></ol></div><p>
   <span class="bold"><strong>Test Case 6: Scope a federated user to a domain
   </strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the identity provider side:
    </p><div class="verbatim-wrap"><pre class="screen">hostname=myidp.com, username=user1</pre></div></li><li class="listitem "><p>
     On the service provider side:
    </p><div class="verbatim-wrap"><pre class="screen">group=group1, group_domain_name=domain1, 'group1' scopes to 'project1'</pre></div></li><li class="listitem "><p>
     Mapping used:
    </p><div class="verbatim-wrap"><pre class="screen">testcase1_1.json</pre></div><p>
     testcase1_1.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       The federated user will scope to project1.
      </p></li><li class="listitem "><p>
       User uses CLI/Curl to assign any existing role to group1 on domain1.
      </p></li><li class="listitem "><p>
       User uses CLI/Curl to remove project1 scope from group1.
      </p></li></ul></div></li><li class="listitem "><p>
     Final result: The federated user will scope to domain1.
    </p></li></ol></div><p>
   <span class="bold"><strong>Test Case 7: Test five remote attributes for mapping
   </strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Test all five different remote attributes, as follows, with similar test
     cases as noted previously.
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       openstack_user
      </p></li><li class="listitem "><p>
       openstack_user_domain
      </p></li><li class="listitem "><p>
       openstack_roles
      </p></li><li class="listitem "><p>
       openstack_project
      </p></li><li class="listitem "><p>
       openstack_project_domain
      </p></li></ul></div><p>
     The attribute openstack_user does not make much sense for testing because
     it is mapped only to a specific username. The preceding test cases have
     already covered the attributes openstack_user_domain, openstack_roles, and
     openstack_project.
    </p></li></ol></div><p>
    Note that similar tests have also been run for two identity providers with
    one service provider, and for one identity provider with two service
    providers.
  </p></div><div class="sect2" id="id-1.5.7.12.8"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.6 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Known Issues and Limitations</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.12.8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Keep the following points in mind:
  </p><div class="itemizedlist " id="idg-all-operations-configuring-identity-keystone-federation-xml-14"><ul class="itemizedlist"><li class="listitem "><p>
     When a user is disabled in the identity provider, the issued federated
     token from the service provider still remains valid until the token is
     expired based on the keystone expiration setting.
    </p></li><li class="listitem "><p>
     An already issued federated token will retain its scope until its
     expiration. Any changes in the mapping on the service provider will not
     impact the scope of an already issued federated token. For example, if an
     already issued federated token was mapped to group1 that has scope on
     project1, and mapping is changed to group2 that has scope on project2, the
     prevously issued federated token still has scope on project1.
    </p></li><li class="listitem "><p>
     Access to service provider resources is provided only through the
     python-keystone CLI client or the keystone API. No horizon web interface
     support is currently available.
    </p></li><li class="listitem "><p>
     Domains, projects, groups, roles, and quotas are created per the service
     provider cloud. Support for federated projects, groups, roles, and quotas
     is currently not available.
    </p></li><li class="listitem "><p>
     keystone-to-keystone federation and WebSSO cannot be configured by putting
     both sets of configuration attributes in the same config file; they will
     overwrite each other. Consequently, they need to be configured
     individually.
    </p></li><li class="listitem "><p>
     Scoping the federated user to a domain is not supported by default in the
     playbook. Please follow the steps at <a class="xref" href="ops-managing-identity.html#scopeToDomain" title="5.10.7. Scope Federated User to Domain">Section 5.10.7, “Scope Federated User to Domain”</a>.
    </p></li></ul></div></div><div class="sect2" id="scopeToDomain"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.10.7 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Scope Federated User to Domain</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#scopeToDomain">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-keystone_federation.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-keystone_federation.xml</li><li><span class="ds-label">ID: </span>scopeToDomain</li></ul></div></div></div></div><p>
Use the following steps to scope a federated user to a domain:
</p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the IdP side, set <code class="literal">hostname=myidp.com</code> and
     <code class="literal">username=user1</code>.
    </p></li><li class="listitem "><p>
     On the service provider side, set: <code class="literal">group=group1</code>,
     <code class="literal">group_domain_name=domain1</code>, group1 scopes to project1.
    </p></li><li class="listitem "><p>
     Mapping used: testcase1_1.json.
    </p><p>
     testcase1_1.json
    </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "openstack_user"
    },
    {
      "type": "Shib-Identity-Provider",
      "any_one_of":[
         "https://myidp.com:5000/v3/OS-FEDERATION/saml2/idp"
      ]
     }
    ]
   }
]</pre></div></li><li class="listitem "><p>
     Expected result: The federated user will scope to project1. Use CLI/Curl
     to assign any existing role to group1 on domain1. Use CLI/Curl to remove
     project1 scope from group1.
    </p></li><li class="listitem "><p>
     Result: The federated user will scope to domain1.
    </p></li></ol></div></div></div><div class="sect1" id="websso"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.11 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring Web Single Sign-On</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#websso">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span>websso</li></ul></div></div></div></div><div id="id-1.5.7.13.2" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important</h6><p>
   The external-name in ~/openstack/my_cloud/definition/data/network_groups.yml must be set to a valid DNS-resolvable FQDN. 
   </p></div><p>
  This topic explains how to implement web single sign-on.
 </p><div class="sect2" id="id-1.5.7.13.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.11.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">What is WebSSO?</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   WebSSO, or web single sign-on, is a method for web browsers to receive
   current authentication information from an identity provider system without
   requiring a user to log in again to the application displayed by the
   browser. Users initially access the identity provider web page and supply
   their credentials. If the user successfully authenticates with the identity
   provider, the authentication credentials are then stored in the user’s web
   browser and automatically provided to all web-based applications, such as
   the horizon dashboard in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9. If users have not yet
   authenticated with an identity provider or their credentials have timed out,
   they are automatically redirected to the identity provider to renew their
   credentials.
  </p></div><div class="sect2" id="id-1.5.7.13.5"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.11.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Limitations</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="itemizedlist " id="idg-all-operations-configuring-identity-websso-xml-6"><ul class="itemizedlist"><li class="listitem "><p>
     The WebSSO function supports only horizon web authentication. It is not
     supported for direct API or CLI access.
    </p></li><li class="listitem "><p>
     WebSSO works only with Fernet token provider. See <a class="xref" href="ops-managing-identity.html#fernet-tokens" title="5.8.4. Fernet Tokens">Section 5.8.4, “Fernet Tokens”</a>.
    </p></li><li class="listitem "><p>
     The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> WebSSO function was tested with Microsoft Active Directory
     Federation Services (AD FS). The instructions provided are pertinent to
     ADFS and are intended to provide a sample configuration for deploying
     WebSSO with an external identity provider. If you have a different
     identity provider such as Ping Identity or IBM Tivoli, consult with those
     vendors for specific instructions for those products.
    </p></li><li class="listitem "><p>
     The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> WebSSO function with OpenID method was tested with
     Google OAuth 2.0 APIs, which conform to the OpenID Connect specification.
     The interaction between Keystone and the external Identity Provider (IdP) is
     handled by the Apache2 <a class="link" href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">auth_openidc</a> module. Please consult with the specific OpenID Connect vendor
     on whether they support <code class="literal">auth_openidc</code>.
    </p></li><li class="listitem "><p>
     Both SAML and OpenID methods are supported for WebSSO federation in
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 .
    </p></li><li class="listitem "><p>
     <span class="bold"><strong>WebSSO has a change password option in User
     Settings, but note that this function is not accessible for users
     authenticating with external systems such as LDAP or SAML Identity
     Providers.</strong></span>
    </p></li></ul></div></div><div class="sect2" id="id-1.5.7.13.6"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.11.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Enabling WebSSO</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 provides WebSSO support for the horizon web interface.
   This support requires several configuration steps including editing the
   horizon configuration file as well as ensuring that the correct keystone
   authentication configuration is enabled to receive the authentication
   assertions provided by the identity provider.
  </p><p>
   WebSSO support both SAML and OpenID methods.
   The following workflow depicts how horizon and keystone support
   WebSSO via SAML method if no current authentication assertion is available.
  </p><div class="orderedlist " id="ul-fcj-z4g-4v"><ol class="orderedlist" type="1"><li class="listitem "><p>
     horizon redirects the web browser to the keystone endpoint.
    </p></li><li class="listitem "><p>
     keystone automatically redirects the web browser to the correct identity
     provider authentication web page based on the keystone configuration file.
    </p></li><li class="listitem "><p>
     The user authenticates with the identity provider.
    </p></li><li class="listitem "><p>
     The identity provider automatically redirects the web browser back to the
     keystone endpoint.
    </p></li><li class="listitem "><p>
     keystone generates the required Javascript code to POST a token back to
     horizon.
    </p></li><li class="listitem "><p>
     keystone automatically redirects the web browser back to horizon and the
     user can then access projects and resources assigned to the user.
    </p></li></ol></div><p>
   The following diagram provides more details on the WebSSO authentication
   workflow.
  </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/Keystone-ADFS-WebSSO-Authentication-Sequence.png" target="_blank"><img src="images/Keystone-ADFS-WebSSO-Authentication-Sequence.png" width="" /></a></div></div><p>
   Note that the horizon dashboard service never talks directly to the keystone
   identity service until the end of the sequence, after the federated unscoped
   token negotiation has completed. The browser interacts with the horizon
   dashboard service, the keystone identity service, and ADFS on their
   respective public endpoints.
  </p><p>
   The following sequence of events is depicted in the diagram.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     The user's browser reaches the horizon dashboard service's login page. The
     user selects ADFS login from the drop-down menu.
    </p></li><li class="listitem "><p>
     The horizon dashboard service issues an HTTP Redirect (301) to redirect
     the browser to the keystone identity service's (public) SAML2 Web SSO
     endpoint (/auth/OS-FEDERATION/websso/saml2). The endpoint is protected by
     Apache mod_shib (shibboleth).
    </p></li><li class="listitem "><p>
     The browser talks to the keystone identity service. Because the user's
     browser does not have an active session with AD FS, the keystone identity
     service issues an HTTP Redirect (301) to the browser, along with the
     required SAML2 request, to the ADFS endpoint.
    </p></li><li class="listitem "><p>
     The browser talks to AD FS. ADFS returns a login form. The browser presents
     it to the user.
    </p></li><li class="listitem "><p>
     The user enters credentials (such as username and password) and submits
     the form to AD FS.
    </p></li><li class="listitem "><p>
     Upon successful validation of the user's credentials, ADFS issues an HTTP
     Redirect (301) to the browser, along with the SAML2 assertion, to the
     keystone identity service's (public) SAML2 endpoint
     (/auth/OS-FEDERATION/websso/saml2).
    </p></li><li class="listitem "><p>
     The browser talks to the keystone identity service. the keystone identity
     service validates the SAML2 assertion and issues a federated unscoped
     token. the keystone identity service returns JavaScript code to be
     executed by the browser, along with the federated unscoped token in the
     headers.
    </p></li><li class="listitem "><p>
     Upon execution of the JavaScript code, the browser is redirected to the
     horizon dashboard service with the federated unscoped token in the header.
    </p></li><li class="listitem "><p>
     The browser talks to the horizon dashboard service with the federated
     unscoped token.
    </p></li><li class="listitem "><p>
     With the unscoped token, the horizon dashboard service talks to the
     keystone identity service's (internal) endpoint to get a list of projects
     the user has access to.
    </p></li><li class="listitem "><p>
     The horizon dashboard service rescopes the token to the first project in
     the list. At this point, the user is successfully logged in.
    </p></li></ol></div><p>
   The sequence of events for WebSSO using OpenID method is similar to SAML method.
  </p></div><div class="sect2" id="id-1.5.7.13.7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.11.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Prerequisites</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="sect3" id="id-1.5.7.13.7.2"><div class="titlepage"><div><div><h4 class="title"><span class="number">5.11.4.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">WebSSO Using SAML Method</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.7.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="sect4" id="id-1.5.7.13.7.2.2"><div class="titlepage"><div><div><h5 class="title"><span class="number">5.11.4.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Creating ADFS metadata</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.7.2.2">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h5><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   For information about creating Active Directory Federation Services
   metadata, see the section <em class="citetitle ">To create edited ADFS 2.0 metadata
   with an added scope element</em> of
   <a class="link" href="https://technet.microsoft.com/en-us/library/gg317734" target="_blank">https://technet.microsoft.com/en-us/library/gg317734</a>.
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     On the ADFS computer, use a browser such as Internet Explorer to view
     <code class="literal">https://&lt;adfs_server_hostname&gt;/FederationMetadata/2007-06/FederationMetadata.xml</code>.
    </p></li><li class="listitem "><p>
     On the File menu, click Save as, and then navigate to the Windows desktop
     and save the file with the name adfs_metadata.xml. Make sure to change the
     Save as type drop-down box to All Files (*.*).
    </p></li><li class="listitem "><p>
     Use Windows Explorer to navigate to the Windows desktop, right-click
     adfs_metadata.xml, and then click Edit.
    </p></li><li class="listitem "><p>
     In Notepad, insert the following XML in the first element. Before editing,
     the EntityDescriptor appears as follows:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;EntityDescriptor ID="abc123" entityID=http://WIN-CAICP35LF2I.vlan44.domain/adfs/services/trust xmlns="urn:oasis:names:tc:SAML:2.0:metadata" &gt;</pre></div><p>
     After editing, it should look like this:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;EntityDescriptor ID="abc123" entityID="http://WIN-CAICP35LF2I.vlan44.domain/adfs/services/trust" xmlns="urn:oasis:names:tc:SAML:2.0:metadata" xmlns:shibmd="urn:mace:shibboleth:metadata:1.0"&gt;</pre></div></li><li class="listitem "><p>
     In Notepad, on the Edit menu, click Find. In Find what, type IDPSSO, and
     then click Find Next.
    </p></li><li class="listitem "><p>
     Insert the following XML in this section: Before editing, the
     IDPSSODescriptor appears as follows:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;&lt;KeyDescriptor use="encryption"&gt;</pre></div><p>
     After editing, it should look like this:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;IDPSSODescriptor protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;&lt;Extensions&gt;&lt;shibmd:Scope regexp="false"&gt;vlan44.domain&lt;/shibmd:Scope&gt;&lt;/Extensions&gt;&lt;KeyDescriptor use="encryption"&gt;</pre></div></li><li class="listitem "><p>
     Delete the metadata document signature section of the file (the bold text
     shown in the following code). Because you have edited the document, the
     signature will now be invalid. Before editing the signature appears as
     follows:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;EntityDescriptor ID="abc123" entityID="http://FSWEB.contoso.com/adfs/services/trust" xmlns="urn:oasis:names:tc:SAML:2.0:metadata" xmlns:shibmd="urn:mace:shibboleth:metadata:1.0"&gt;
<span class="bold"><strong>&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    SIGNATURE DATA
&lt;/ds:Signature&gt;</strong></span>
&lt;RoleDescriptor xsi:type=…&gt;</pre></div><p>
     After editing it should look like this:
    </p><div class="verbatim-wrap"><pre class="screen">&lt;EntityDescriptor ID="abc123" entityID="http://FSWEB.contoso.com/adfs/services/trust" xmlns="urn:oasis:names:tc:SAML:2.0:metadata" xmlns:shibmd="urn:mace:shibboleth:metadata:1.0"&gt;
&lt;RoleDescriptor xsi:type=…&gt;</pre></div></li><li class="listitem "><p>
     Save and close adfs_metadata.xml.
    </p></li><li class="listitem "><p>
     Copy adfs_metadata.xml to the Cloud Lifecycle Manager node and place it into
     <code class="filename">/var/lib/ardana/openstack/my_cloud/config/keystone/</code>
     directory and put it under revision control.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/adfs_metadata.xml
<code class="prompt user">ardana &gt; </code>git commit -m "Add ADFS metadata file for WebSSO authentication"</pre></div></li></ol></div></div><div class="sect4" id="id-1.5.7.13.7.2.3"><div class="titlepage"><div><div><h5 class="title"><span class="number">5.11.4.1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Setting Up WebSSO</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.7.2.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h5><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Start by creating a config file <code class="filename">adfs_config.yml</code> with the
   following parameters and place it in the
   <code class="filename">/var/lib/ardana/openstack/my_cloud/config/keystone/</code>
   directory on your Cloud Lifecycle Manager node.
  </p><div class="verbatim-wrap"><pre class="screen">keystone_trusted_idp: adfs
keystone_sp_conf:
    idp_metadata_file: /var/lib/ardana/openstack/my_cloud/config/keystone/adfs_metadata.xml
    shib_sso_application_entity_id: http://sp_uri_entityId
    shib_sso_idp_entity_id: http://default_idp_uri_entityId
    target_domain:
        name: domain1
        description: my domain
    target_project:
        name: project1
        description: my project
    target_group:
        name: group1
        description: my group
    role:
        name: service
    identity_provider:
        id: adfs_idp1
        description: This is the ADFS identity provider.
    mapping:
        id: mapping1
        rules_file: /var/lib/ardana/openstack/my_cloud/config/keystone/adfs_mapping.json
    protocol:
        id: saml2
    attribute_map:
        -
          name: http://schemas.xmlsoap.org/claims/Group
          id: ADFS_GROUP
        -
          name: urn:oid:1.3.6.1.4.1.5923.1.1.1.6
          id: ADFS_LOGIN</pre></div><p>
   A sample config file like this exists in
   roles/KEY-API/files/samples/websso/keystone_configure_adfs_sample.yml. Here
   are some detailed descriptions for each of the config options:
  </p><div class="verbatim-wrap"><pre class="screen">keystone_trusted_idp: A flag to indicate if this configuration is used for WebSSO or K2K. The value can be either 'adfs' or 'k2k'.
keystone_sp_conf:
    shib_sso_idp_entity_id: The ADFS URI used as an entity Id to identity the IdP.
    shib_sso_application_entity_id: The Service Provider URI used as a entity Id. It can be any URI here for Websso as long as it is unique to the SP.
    target_domain: A domain where the group will be created from.
        name: Any domain name. If it does not exist, it will be created or be updated.
        description: Any description.
    target_project: A project scope that the group has.
        name: Any project name. If it does not exist, it will be created or be updated.
        description: Any description.
    target_group: A group will be created from 'target_domain'.
        name: Any group name. If it does not exist, it will be created or be updated.
        description: Any description.
    role: A role will be assigned on 'target_project'. This role impacts the idp user scoped token permission at sp side.
        name: It has to be an existing role.
    idp_metadata_file: A reference to the ADFS metadata file that validates the SAML2 assertion.
    identity_provider: An ADFS IdP
        id: Any Id. If it does not exist, it will be created or be updated. This Id needs to be shared with the client so that the right mapping will be selected.
        description: Any description.
    mapping: A mapping in json format that maps a federated user to a corresponding group.
        id: Any Id. If it does not exist, it will be created or be updated.
        rules_file: A reference to the file that has the mapping in json.
    protocol: The supported federation protocol.
        id: 'saml2' is the only supported protocol for Websso.
    attribute_map: A shibboleth mapping defined additional attributes to map the attributes from the SAML2 assertion to the Websso mapping that SP understands.
        -
          name: An attribute name from the SAML2 assertion.
          id: An Id that the above name will be mapped to.</pre></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Create a mapping file, <code class="filename">adfs_mapping.json</code>, that is
     referenced from the preceding config file in
     <code class="filename">/var/lib/ardana/openstack/my_cloud/config/keystone/</code>.
    </p><div class="verbatim-wrap"><pre class="screen">     rules_file: /var/lib/ardana/openstack/my_cloud/config/keystone/adfs_mapping.json.</pre></div><p>
     The following is an example of the mapping file, existing in
     roles/KEY-API/files/samples/websso/adfs_sp_mapping.json:
    </p><div class="verbatim-wrap"><pre class="screen">[
             {
               "local": [{
                     "user": {
                         "name": "{0}"
                     }
                 }],
                 "remote": [{
                     "type": "ADFS_LOGIN"
                 }]
              },
              {
                "local": [{
                    "group": {
                        "id": "GROUP_ID"
                    }
                }],
                "remote": [{
                    "type": "ADFS_GROUP",
                "any_one_of": [
                    "Domain Users"
                    ]
                }]
              }
 ]</pre></div><p>
     You can find more details about how the WebSSO mapping works at
     <a class="link" href="http://docs.openstack.org" target="_blank">http://docs.openstack.org</a>.
     Also see <a class="xref" href="ops-managing-identity.html#maprules" title="5.11.4.1.3. Mapping rules">Section 5.11.4.1.3, “Mapping rules”</a> for more information.
    </p></li><li class="listitem "><p>
     Add <code class="filename">adfs_config.yml</code> and
     <code class="filename">adfs_mapping.json</code> to revision control.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>cd ~/openstack
<code class="prompt user">ardana &gt; </code>git checkout site
<code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/adfs_config.yml
<code class="prompt user">ardana &gt; </code>git add my_cloud/config/keystone/adfs_mapping.json
<code class="prompt user">ardana &gt; </code>git commit -m "Add ADFS config and mapping."</pre></div></li><li class="listitem "><p>
     Go to ~/scratch/ansible/next/ardana/ansible and run the following
     playbook to enable WebSSO in the keystone identity service:
    </p><div class="verbatim-wrap"><pre class="screen">ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@/var/lib/ardana/openstack/my_cloud/config/keystone/adfs_config.yml</pre></div></li><li class="listitem "><p>
     Enable WebSSO in the horizon dashboard service by setting
     horizon_websso_enabled flag to True in roles/HZN-WEB/defaults/main.yml and
     then run the horizon-reconfigure playbook:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">ardana &gt; </code>ansible-playbook -i hosts/verb_hosts horizon-reconfigure.yml</pre></div></li></ol></div></div><div class="sect4" id="maprules"><div class="titlepage"><div><div><h5 class="title"><span class="number">5.11.4.1.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Mapping rules</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#maprules">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h5><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span>maprules</li></ul></div></div></div></div><p>
   One IdP-SP has only one mapping. The last mapping that the customer
   configures will be the one used and will overwrite the old mapping setting.
   Therefore, if the example mapping adfs_sp_mapping.json is used, the
   following behavior is expected because it maps the federated user only to
   the one group configured in
   <code class="literal">keystone_configure_adfs_sample.yml</code>.
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Configure domain1/project1/group1, mapping1; websso login horizon, see
     project1;
    </p></li><li class="listitem "><p>
     Then reconfigure: domain1/project2/group1. mapping1, websso login horizon,
     see project1 and project2;
    </p></li><li class="listitem "><p>
     Reconfigure: domain3/project3/group3; mapping1, websso login horizon, only
     see project3; because now the IDP mapping maps the federated user to
     group3, which only has priviliges on project3.
    </p></li></ul></div><p>
   If you need a more complex mapping, you can use a custom mapping file, which
   needs to be specified in keystone_configure_adfs_sample.yml -&gt;
   rules_file.
  </p><p>
   You can use different attributes of the ADFS user in order to map to
   different or multiple groups.
  </p><p>
   An example of a more complex mapping file is
   adfs_sp_mapping_multiple_groups.json, as follows.
  </p><p>
   adfs_sp_mapping_multiple_groups.json
  </p><div class="verbatim-wrap"><pre class="screen">[
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group1",
           "domain":{
             "name": "domain1"
           }
        }
      }
    ],
    "remote":[{
      "type": "ADFS_LOGIN"
    },
    {
      "type": "ADFS_GROUP",
      "any_one_of":[
         "Domain Users"
      ]
     }
    ]
   },
  {
    "local": [
      {
        "user": {
          "name": "{0}"
        }
      },
      {
        "group": {
           "name": "group2",
           "domain":{
             "name": "domain2"
           }
        }
      }
    ],
    "remote":[{
      "type": "ADFS_LOGIN"
    },
    {
      "type": "ADFS_SCOPED_AFFILIATION",
      "any_one_of": [
          "member@contoso.com"
      ]
    },
    ]
   }
]</pre></div><p>
   The adfs_sp_mapping_multiple_groups.json must be run together with
   keystone_configure_mutiple_groups_sample.yml, which adds a new attribute for
   the shibboleth mapping. That file is as follows:
  </p><p>
   keystone_configure_mutiple_groups_sample.yml
  </p><div class="verbatim-wrap"><pre class="screen">#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
---

keystone_trusted_idp: adfs
keystone_sp_conf:
    identity_provider:
        id: adfs_idp1
        description: This is the ADFS identity provider.
    idp_metadata_file: /var/lib/ardana/openstack/my_cloud/config/keystone/adfs_metadata.xml

    shib_sso_application_entity_id: http://blabla
    shib_sso_idp_entity_id: http://WIN-CAICP35LF2I.vlan44.domain/adfs/services/trust

    target_domain:
        name: domain2
        description: my domain

    target_project:
        name: project6
        description: my project

    target_group:
        name: group2
        description: my group

    role:
        name: admin

    mapping:
        id: mapping1
        rules_file: /var/lib/ardana/openstack/my_cloud/config/keystone/adfs_sp_mapping_multiple_groups.json

    protocol:
        id: saml2

    attribute_map:
        -
          name: http://schemas.xmlsoap.org/claims/Group
          id: ADFS_GROUP
        -
          name: urn:oid:1.3.6.1.4.1.5923.1.1.1.6
          id: ADFS_LOGIN
        -
          name: urn:oid:1.3.6.1.4.1.5923.1.1.1.9
          id: ADFS_SCOPED_AFFILIATION</pre></div></div></div><div class="sect3" id="id-1.5.7.13.7.3"><div class="titlepage"><div><div><h4 class="title"><span class="number">5.11.4.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Setting up the ADFS server as the identity provider</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.7.3">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   For ADFS to be able to communicate with the keystone identity service, you
   need to add the keystone identity service as a trusted relying party for
   ADFS and also specify the user attributes that you want to send to the
   keystone identity service when users authenticate via WebSSO.
  </p><p>
   For more information, see the
   <a class="link" href="https://technet.microsoft.com/en-us/library/gg317734" target="_blank">Microsoft
   ADFS wiki</a>, section "Step 2: Configure ADFS 2.0 as the identity
   provider and shibboleth as the Relying Party".
  </p><p>
   Log in to the ADFS server.
  </p><p>
   <span class="bold"><strong>Add a relying party using metadata</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     From Server Manager Dashboard, click Tools on the upper right, then ADFS
     Management.
    </p></li><li class="listitem "><p>
     Right-click ADFS, and then select Add Relying Party Trust.
    </p></li><li class="listitem "><p>
     Click Start, leave the already selected option <code class="literal">Import data about
     the relying party published online or on a local network</code>.
    </p></li><li class="listitem "><p>
     In the Federation metadata address field, type
     <code class="literal">&lt;keystone_publicEndpoint&gt;/Shibboleth.sso/Metadata</code>
     (your keystone identity service Metadata endpoint), and then click Next.
     You can also import metadata from a file. Create a file with the content
     of the result of the following curl command
    </p><div class="verbatim-wrap"><pre class="screen">curl &lt;keystone_publicEndpoint&gt;/Shibboleth.sso/Metadata</pre></div><p>
     and then choose this file for importing the metadata for the relying
     party.
    </p></li><li class="listitem "><p>
     In the Specify Display Name page, choose a proper name to identify this
     trust relationship, and then click Next.
    </p></li><li class="listitem "><p>
     On the Choose Issuance Authorization Rules page, leave the default Permit
     all users to access the relying party selected, and then click Next.
    </p></li><li class="listitem "><p>
     Click Next, and then click Close.
    </p></li></ol></div><p>
   <span class="bold"><strong>Edit claim rules for relying party trust</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     The Edit Claim Rules dialog box should already be open. If not, In the
     ADFS center pane, under Relying Party Trusts, right-click your newly
     created trust, and then click Edit Claim Rules.
    </p></li><li class="listitem "><p>
     On the Issuance Transform Rules tab, click Add Rule.
    </p></li><li class="listitem "><p>
     On the Select Rule Template page, select Send LDAP Attributes as Claims,
     and then click Next.
    </p></li><li class="listitem "><p>
     On the Configure Rule page, in the Claim rule name box, type Get Data.
    </p></li><li class="listitem "><p>
     In the Attribute Store list, select Active Directory.
    </p></li><li class="listitem "><p>
     In the Mapping of LDAP attributes section, create the following mappings.
    </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /></colgroup><thead><tr><th> LDAP Attribute</th><th>Outgoing Claim Type</th></tr></thead><tbody><tr><td>Token-Groups – Unqualified Names</td><td>Group</td></tr><tr><td>User-Principal-Name</td><td>UPN</td></tr></tbody></table></div></li><li class="listitem "><p>
     Click Finish.
    </p></li><li class="listitem "><p>
     On the Issuance Transform Rules tab, click Add Rule.
    </p></li><li class="listitem "><p>
     On the Select Rule Template page, select Send Claims Using a Custom Rule,
     and then click Next.
    </p></li><li class="listitem "><p>
     In the Configure Rule page, in the Claim rule name box, type Transform UPN
     to epPN.
    </p></li><li class="listitem "><p>
     In the Custom Rule window, type or copy and paste the following:
    </p><div class="verbatim-wrap"><pre class="screen">c:[Type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"]
=&gt; issue(Type = "urn:oid:1.3.6.1.4.1.5923.1.1.1.6", Value = c.Value, Properties["http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/attributename"] = "urn:oasis:names:tc:SAML:2.0:attrname-format:uri");</pre></div></li><li class="listitem "><p>
     Click Finish.
    </p></li><li class="listitem "><p>
     On the Issuance Transform Rules tab, click Add Rule.
    </p></li><li class="listitem "><p>
     On the Select Rule Template page, select Send Claims Using a Custom Rule,
     and then click Next.
    </p></li><li class="listitem "><p>
     On the Configure Rule page, in the Claim rule name box, type Transform
     Group to epSA.
    </p></li><li class="listitem "><p>
     In the Custom Rule window, type or copy and paste the following:
    </p><div class="verbatim-wrap"><pre class="screen">c:[Type == "http://schemas.xmlsoap.org/claims/Group", Value == "Domain Users"]
=&gt; issue(Type = "urn:oid:1.3.6.1.4.1.5923.1.1.1.9", Value = "member@contoso.com", Properties["http://schemas.xmlsoap.org/ws/2005/05/identity/claimproperties/attributename"] = "urn:oasis:names:tc:SAML:2.0:attrname-format:uri");</pre></div></li><li class="listitem "><p>
     Click Finish, and then click OK.
    </p></li></ol></div><p>
   This list of Claim Rules is just an example and can be modified or enhanced
   based on the customer's necessities and ADFS setup specifics.
  </p><p>
   <span class="bold"><strong>Create a sample user on the ADFS server</strong></span>
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     From the Server Manager Dashboard, click Tools on the upper right, then
     Active Directory Users and Computer.
    </p></li><li class="listitem "><p>
     Right click User, then New, and then User.
    </p></li><li class="listitem "><p>
     Follow the on-screen instructions.
    </p></li></ol></div><p>
   You can test the horizon dashboard service "Login with ADFS" by opening a
   browser at the horizon dashboard service URL and choose
   <code class="literal">Authenticate using: ADFS Credentials</code>. You should be
   redirected to the ADFS login page and be able to log into the horizon
   dashboard service with your ADFS credentials.
  </p></div></div><div class="sect2" id="id-1.5.7.13.8"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.11.5 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">WebSSO Using OpenID Method</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.8">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
    The interaction between Keystone and the external Identity Provider (IdP) is
    handled by the Apache2 <a class="link" href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">auth_openidc</a> module.
   </p><p>
     There are two steps to enable the feature.
   </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
      Configure Keystone with the required OpenID Connect provider information.
     </p></li><li class="listitem "><p>
      Create the Identity Provider, protocol, and mapping in Keystone, using
      <span class="bold"><strong> OpenStack Command Line Tool</strong></span>.
     </p></li></ol></div><div class="sect3" id="id-1.5.7.13.8.5"><div class="titlepage"><div><div><h4 class="title"><span class="number">5.11.5.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configuring Keystone</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.8.5">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
      Log in to the Cloud Lifecycle Manager node and edit the <code class="filename">~/openstack/my_cloud/config/keystone/keystone_deploy_config.yml</code> file with the <code class="literal">"keystone_openid_connect_conf"</code> variable. For example:
     </p><div class="verbatim-wrap"><pre class="screen">keystone_openid_connect_conf:
    identity_provider: google
    response_type: id_token
    scope: "openid email profile"
    metadata_url: https://accounts.google.com/.well-known/openid-configuration
    client_id: [Replace with your client ID]
    client_secret: [Replace with your client secret]
    redirect_uri: https://www.myenterprise.com:5000/v3/OS-FEDERATION/identity_providers/google/protocols/openid/auth
    crypto_passphrase: ""</pre></div><p>Where:</p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        <code class="literal">identity_provider</code>: name of the OpenID Connect identity provider. This must be the same as the identity provider to be created in Keystone using <span class="bold"><strong> OpenStack Command Line Tool</strong></span>. For example, if the identity provider is <code class="literal">foo</code>, we must create the identity provider with the name. For example:
       </p><div class="verbatim-wrap"><pre class="screen">openstack identity provider create foo</pre></div></li><li class="listitem "><p>
        <code class="literal">response_type</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCResponseType</a>. In most cases, it should be <code class="literal">"id_token"</code>.
       </p></li><li class="listitem "><p>
        <code class="literal">scope</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCScope</a>.
       </p></li><li class="listitem "><p>
        <code class="literal">metadata_url</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCProviderMetadataURL</a>.
       </p></li><li class="listitem "><p>
        <code class="literal">client_id</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCClientID</a>.
       </p></li><li class="listitem "><p>
        <code class="literal">client_secret</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCClientSecret</a>.
       </p></li><li class="listitem "><p>
        <code class="literal">redirect_uri</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCRedirectURI</a>. This must be the Keystone public endpoint for given OpenID Connect identity provider. i.e. <code class="literal">"https://keystone-public-endpoint.foo.com/v3/OS-FEDERATION/identity_providers/foo/protocols/openid/auth"</code>.
       </p><div id="id-1.5.7.13.8.5.2.1.4.7.2" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning</h6><p>
         Some OpenID Connect IdPs such as Google require the hostname in the "redirect_uri" to be a public FQDN. In that case, the hostname in Keystone public endpoint must also be a public FQDN and must match the one specified in the "redirect_uri".
        </p></div></li><li class="listitem "><p>
        <code class="literal">crypto_passphrase</code>: corresponding to <a class="link" href="https://github.com/zmartzone/mod_auth_openidc/blob/master/auth_openidc.conf" target="_blank">auth_openidc OIDCCryptoPassphrase</a>. If left blank, a random cryto passphrase will be generated.
       </p></li></ul></div></li><li class="listitem "><p>
      Commit the changes to your local git repository.
     </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack/ardana/ansible
git add -A
git commit -m "add OpenID Connect configuration"</pre></div></li><li class="listitem "><p>
      Run <code class="literal">keystone-reconfigure</code> Ansible playbook.
     </p><div class="verbatim-wrap"><pre class="screen">cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</pre></div></li></ol></div></div><div class="sect3" id="id-1.5.7.13.8.6"><div class="titlepage"><div><div><h4 class="title"><span class="number">5.11.5.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Configure Horizon</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.8.6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
   Complete the following steps to configure horizon to support WebSSO with OpenID method.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Edit the
     <code class="filename">~/openstack/ardana/ansible/roles/HZN-WEB/defaults/main.yml</code>
     file and set the following parameter to <code class="literal">True</code>.
    </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_enabled: True</pre></div></li><li class="step "><p>
     Locate the last line in the
     <code class="filename">~/openstack/ardana/ansible/roles/HZN-WEB/defaults/main.yml</code>
     file. The default configuration for this line should look like the
     following:
    </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_choices:
  - {protocol: saml2, description: "ADFS Credentials"}</pre></div><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       If your cloud <span class="bold"><strong>does not</strong></span> have AD FS
       enabled, then replace the preceding
       <code class="literal">horizon_websso_choices:</code> parameter with the following.
      </p><div class="verbatim-wrap"><pre class="screen">- {protocol: openid, description: "OpenID Connect"}</pre></div><p>
       The resulting block should look like the following.
      </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_choices:
    - {protocol: openid, description: "OpenID Connect"}</pre></div></li><li class="listitem "><p>
       If your cloud <span class="bold"><strong>does</strong></span> have ADFS enabled,
       then simply add the following parameter to the
       <code class="literal">horizon_websso_choices:</code> section. Do not replace the
       default parameter, add the following line to the existing block.
      </p><div class="verbatim-wrap"><pre class="screen">- {protocol: saml2, description: "ADFS Credentials"}</pre></div><p>
       If your cloud has ADFS enabled, the final block of your
       <code class="literal">~/openstack/ardana/ansible/roles/HZN-WEB/defaults/main.yml</code>
       should have the following entries.
      </p><div class="verbatim-wrap"><pre class="screen">horizon_websso_choices:
    - {protocol: openid, description: "OpenID Connect"}
    - {protocol: saml2, description: "ADFS Credentials"}</pre></div></li></ul></div></li><li class="step "><p>
     Run the following commands to add your changes to the local git
     repository, and reconfigure the horizon service, enabling the changes made
     in <span class="bold"><strong>Step 1</strong></span>:
    </p><div class="verbatim-wrap"><pre class="screen">cd ~/openstack
git add -A
git commit -m "Configured WebSSO using OpenID Connect"
cd ~/openstack/ardana/ansible/
ansible-playbook -i hosts/localhost config-processor-run.yml
ansible-playbook -i hosts/localhost ready-deployment.yml
cd ~/scratch/ansible/next/ardana/ansible
ansible-playbook -i hosts/verb_hosts horizon-reconfigure.yml</pre></div></li></ol></div></div></div><div class="sect3" id="id-1.5.7.13.8.7"><div class="titlepage"><div><div><h4 class="title"><span class="number">5.11.5.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Create Identity Provider, Protocol, and Mapping</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.13.8.7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-websso.xml" title="Edit the source file for this section">Edit source</a></h4><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-websso.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
    To fully enable OpenID Connect, Identity Provider, Protocol, and Mapping for the given IdP must be created in Keystone. This is done by using the <span class="bold"><strong>OpenStack Command Line Tool</strong></span> using the Keystone <span class="bold"><strong>admin</strong></span> credential.
   </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
      Log in to the Cloud Lifecycle Manager node and source <code class="literal">keystone.osrc</code> file.
     </p><div class="verbatim-wrap"><pre class="screen">source ~/keystone.osrc</pre></div></li><li class="listitem "><p>
      Create the <span class="bold"><strong>Identity Provider</strong></span>. For example:
     </p><div class="verbatim-wrap"><pre class="screen">openstack identity provider create foo</pre></div><div id="id-1.5.7.13.8.7.3.2.3" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning</h6><p>
       The name of the Identity Provider must be exactly the same as the "identity_provider" attribute given when configuring Keystone in the previous section.
      </p></div></li><li class="listitem "><p>
      Next, create the Mapping for the Identity Provider. Prior to creating the
      Mapping, one must fully grasp the intricacies
      of <a class="link" href="https://docs.openstack.org/keystone/latest/admin/federation/mapping_combinations.html" target="_blank">Mapping Combinations</a>
      as it may have profound security implications if done incorrectly.
      Here's an example of a mapping file.
     </p><div class="verbatim-wrap"><pre class="screen">[
    {
        "local": [
            {
                "user": {
                    "name": "{0}",
                    "email": "{1}",
                    "type": "ephemeral"
                 },
                 "group": {
                    "domain": {
                        "name": "Default"
                    },
                    "name": "openidc_demo"
                }
             }
         ],
         "remote": [
             {
                 "type": "REMOTE_USER"
             },
             {
                 "type": "HTTP_OIDC_EMAIL"
             }

        ]
    }
]</pre></div><p>
      Once the mapping file is created, now create the Mapping resource in Keystone. For example:
     </p><div class="verbatim-wrap"><pre class="screen">openstack mapping create --rule oidc_mapping.json oidc_mapping</pre></div></li><li class="listitem "><p>
      Lastly, create the Protocol for the Identity Provider and its mapping. For OpenID Connect, the protocol name must be <span class="bold"><strong>openid</strong></span>. For example:
     </p><div class="verbatim-wrap"><pre class="screen">openstack federation protocol create --identity-provider google --mapping oidc_mapping openid</pre></div></li></ol></div></div></div></div><div class="sect1" id="topic-qtp-cn3-bt"><div class="titlepage"><div><div><h2 class="title"><span class="number">5.12 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Identity Service Notes and Limitations</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#topic-qtp-cn3-bt">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_limitations.xml" title="Edit the source file for this section">Edit source</a></h2><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_limitations.xml</li><li><span class="ds-label">ID: </span>topic-qtp-cn3-bt</li></ul></div></div></div></div><div class="sect2" id="idg-all-operations-configuring-identity-identity-limitations-xml-6"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.12.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Notes</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-limitations-xml-6">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_limitations.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_limitations.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-identity-limitations-xml-6</li></ul></div></div></div></div><p>
   This topic describes limitations of and important notes pertaining to the
   identity service. <span class="bold"><strong>Domains</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Domains can be created and managed by the horizon web interface, keystone
     API and OpenStackClient CLI.
    </p></li><li class="listitem "><p>
     The configuration of external authentication systems requires the creation
     and usage of Domains.
    </p></li><li class="listitem "><p>
     All configurations are managed by creating and editing specific
     configuration files.
    </p></li><li class="listitem "><p>
     End users can authenticate to a particular project and domain via the
     horizon web interface, keystone API and OpenStackClient CLI.
    </p></li><li class="listitem "><p>
     A new horizon login page that requires a Domain entry is now installed by
     default.
    </p></li></ul></div><p>
   <span class="bold"><strong>keystone-to-keystone Federation</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     keystone-to-keystone (K2K) Federation provides the ability to authenticate
     once with one cloud and then use these credentials to access resources on
     other federated clouds.
    </p></li><li class="listitem "><p>
     All configurations are managed by creating and editing specific
     configuration files.
    </p></li></ul></div><p>
   <span class="bold"><strong>Multi-Factor Authentication (MFA)</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The keystone architecture provides support for MFA deployments.
    </p></li><li class="listitem "><p>
     MFA provides the ability to deploy non-password based authentication; for
     example: token providing hardware and text messages.
    </p></li></ul></div><p>
   <span class="bold"><strong>Hierarchical Multitenancy</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Provides the ability to create sub-projects within a Domain-Project
     hierarchy.
    </p></li></ul></div></div><div class="sect2" id="idg-all-operations-configuring-identity-identity-limitations-xml-7"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.12.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Limitations</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#idg-all-operations-configuring-identity-identity-limitations-xml-7">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_limitations.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_limitations.xml</li><li><span class="ds-label">ID: </span>idg-all-operations-configuring-identity-identity-limitations-xml-7</li></ul></div></div></div></div><p>
   <span class="bold"><strong>Authentication with external authentication systems
   (LDAP, Active Directory (AD) or Identity Providers)</strong></span>
  </p><div class="itemizedlist " id="ul-u52-jpd-bt"><ul class="itemizedlist"><li class="listitem "><p>
     No horizon web portal support currently exists for the creation and
     management of external authentication system configurations.
    </p></li></ul></div><p>
   <span class="bold"><strong>Integration with LDAP services</strong></span>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 domain-specific configuration:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     No Global User Listing: Once domain-specific driver configuration is
     enabled, listing all users and listing all groups are not supported
     operations. Those calls require a specific domain filter and a
     domain-scoped token for the target domain.
    </p></li><li class="listitem "><p>
     You cannot have both a file store and a database store for domain-specific
     driver configuration in a single identity service instance. Once a
     database store is enabled within the identity service instance, any file
     store will be ignored, and vice versa.
    </p></li><li class="listitem "><p>
     The identity service allows a list limit configuration to globally set the
     maximum number of entities that will be returned in an identity collection
     per request but it does not support per-domain list limit setting at this
     time.
    </p></li><li class="listitem "><p>
     Each time a new domain is configured with LDAP integration the single CA
     file gets overwritten. Ensure that you place certs for all the LDAP
     back-end domains in the cacert parameter. Detailed CA file inclusion
     instructions are provided in the comments of the sample YAML configuration
     file <code class="filename">keystone_configure_ldap_my.yml</code>
     (see <a class="xref" href="ops-managing-identity.html#filestore" title="5.9.2. Set up domain-specific driver configuration - file store">Section 5.9.2, “Set up domain-specific driver configuration - file store”</a>).
    </p></li><li class="listitem "><p>
     LDAP is only supported for identity operations (reading users and groups
     from LDAP).
    </p></li><li class="listitem "><p>
     keystone assignment operations from LDAP records such as managing or
     assigning roles and projects, are not currently supported.
    </p></li><li class="listitem "><p>
     The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 'default' domain is pre-configured to store service account
     users and is authenticated locally against the identity service. Domains
     configured for external LDAP integration are non-default domains.
    </p></li><li class="listitem "><p>
     When using the current OpenStackClient CLI you must use the user ID rather
     than the user name when working with a non-default domain.
    </p></li><li class="listitem "><p>
     Each LDAP connection with the identity service is for read-only
     operations. Configurations that require identity service write operations
     (to create users, groups, etc.) are not currently supported.
    </p></li><li class="listitem "><p>
     LDAP is only supported for identity operations (reading users and groups
     from LDAP). keystone assignment operations from LDAP records such as
     managing or assigning roles and projects, are not currently supported.
    </p></li><li class="listitem "><p>
     When using the current OpenStackClient CLI you must use the user ID rather
     than the user name when working with a non-default domain.
    </p></li></ul></div><p>
   <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 API-based domain-specific configuration management
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     No GUI dashboard for domain-specific driver configuration management
    </p></li><li class="listitem "><p>
     API-based Domain specific config does not check for type of option.
    </p></li><li class="listitem "><p>
     API-based Domain specific config does not check for option values
     supported.
    </p></li><li class="listitem "><p>
     API-based Domain config method does not provide retrieval of default
     values of domain-specific configuration options.
    </p></li><li class="listitem "><p>
     Status: Domain-specific driver configuration database store is a non-core
     feature for <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9.
    </p></li></ul></div></div><div class="sect2" id="id-1.5.7.14.4"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.12.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">keystone-to-keystone federation</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#id-1.5.7.14.4">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_limitations.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_limitations.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     When a user is disabled in the identity provider, the issued federated
     token from the service provider still remains valid until the token is
     expired based on the keystone expiration setting.
    </p></li><li class="listitem "><p>
     An already issued federated token will retain its scope until its
     expiration. Any changes in the mapping on the service provider will not
     impact the scope of an already issued federated token. For example, if an
     already issued federated token was mapped to group1 that has scope on
     project1, and mapping is changed to group2 that has scope on project2, the
     prevously issued federated token still has scope on project1.
    </p></li><li class="listitem "><p>
     Access to service provider resources is provided only through the
     python-keystone CLI client or the keystone API. No horizon web interface
     support is currently available.
    </p></li><li class="listitem "><p>
     Domains, projects, groups, roles, and quotas are created per the service
     provider cloud. Support for federated projects, groups, roles, and quotas
     is currently not available.
    </p></li><li class="listitem "><p>
     keystone-to-keystone federation and WebSSO cannot be configured by putting
     both sets of configuration attributes in the same config file; they will
     overwrite each other. Consequently, they need to be configured
     individually.
    </p></li><li class="listitem "><p>
     Scoping the federated user to a domain is not supported by default in the
     playbook. To enable it, see the steps in <a class="xref" href="ops-managing-identity.html#scopeToDomain" title="5.10.7. Scope Federated User to Domain">Section 5.10.7, “Scope Federated User to Domain”</a>.
    </p></li><li class="listitem "><p>
     No horizon web portal support currently exists for the creation and
     management of federation configurations.
    </p></li><li class="listitem "><p>
     All end user authentication is available only via the keystone API and
     OpenStackClient CLI.
    </p></li><li class="listitem "><p>
     Additional information can be found at
     <a class="link" href="http://docs.openstack.org" target="_blank">http://docs.openstack.org</a>.
    </p></li></ul></div><p>
   <span class="bold"><strong>WebSSO</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The WebSSO function supports only horizon web authentication. It is not
     supported for direct API or CLI access.
    </p></li><li class="listitem "><p>
     WebSSO works only with Fernet token provider. See <a class="xref" href="ops-managing-identity.html#fernet-tokens" title="5.8.4. Fernet Tokens">Section 5.8.4, “Fernet Tokens”</a>.
    </p></li><li class="listitem "><p>
     The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> WebSSO function with SAML method was tested with Microsoft Active Directory
     Federation Services (ADFS). The instructions provided are pertinent to
     ADFS and are intended to provide a sample configuration for deploying
     WebSSO with an external identity provider. If you have a different
     identity provider such as Ping Identity or IBM Tivoli, consult with those
     vendors for specific instructions for those products.
    </p></li><li class="listitem "><p>
     The <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> WebSSO function with OpenID method was tested with
     Google OAuth 2.0 APIs, which conform to the OpenID Connect specification.
     The interaction between keystone and the external Identity Provider (IdP) is
     handled by the Apache2 <a class="link" href="https://github.com/zmartzone/mod_auth_openidc" target="_blank">auth_openidc</a> module. Please consult with the specific OpenID Connect vendor
     on whether they support <code class="literal">auth_openidc</code>
    </p></li><li class="listitem "><p>
     Both SAML and OpenID methods are supported for WebSSO federation in
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 .
    </p></li><li class="listitem "><p>
     <span class="bold"><strong>WebSSO has a change password option in User
     Settings, but note that this function is not accessible for users
     authenticating with external systems such as LDAP or SAML Identity
     Providers.</strong></span>
    </p></li></ul></div><p>
   <span class="bold"><strong>Multi-factor authentication (MFA)</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> MFA support is a custom configuration requiring Sales Engineering support.
    </p></li><li class="listitem "><p>
     MFA drivers are not included with <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> and need to be provided by a
     specific MFA vendor.
    </p></li><li class="listitem "><p>
     Additional information can be found at
     <a class="link" href="http://docs.openstack.org/security-guide/content/identity-authentication-methods.html#identity-authentication-methods-external-authentication-methods" target="_blank">http://docs.openstack.org/security-guide/content/identity-authentication-methods.html#identity-authentication-methods-external-authentication-methods</a>.
    </p></li></ul></div><p>
   <span class="bold"><strong>Hierarchical multitenancy</strong></span>
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     This function requires additional support from various OpenStack services
     to be functional. It is a non-core function in <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> and is not ready
     for either proof of concept or production deployments.
    </p></li><li class="listitem "><p>
     Additional information can be found at
     <a class="link" href="http://specs.openstack.org/openstack/keystone-specs/specs/juno/hierarchical_multitenancy.html" target="_blank">http://specs.openstack.org/openstack/keystone-specs/specs/juno/hierarchical_multitenancy.html</a>.
    </p></li></ul></div><p>
   <span class="bold"><strong>Missing quota information for compute
   resources</strong></span>
  </p><div id="id-1.5.7.14.4.10" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    An error message that will appear in the default horizon page if you are
    running a swift-only deployment (no Compute service). In this
    configuration, you will not see any quota information for Compute
    resources and will see the following error message:
   </p></div><p>
   <span class="emphasis"><em>The Compute service is not installed or is not configured
   properly. No information is available for Compute resources.</em></span> This
   error message is expected as no Compute service is configured for this
   deployment. Please ignore the error message.
  </p><p>
   The following is the benchmark of the performance that is based on 150
   concurrent requests and run for 10 minute periods of stable load time.
  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="newCol3" /></colgroup><thead><tr><th>Operation </th><th>In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 (secs/request)</th><th>In <span class="phrase"><span class="phrase">SUSE <span class="productname">OpenStack</span> Cloud</span></span> 9 3.0 (secs/request)</th></tr></thead><tbody><tr><td>Token Creation </td><td>0.86</td><td>0.42</td></tr><tr><td>Token Validation</td><td>0.47</td><td>0.41</td></tr></tbody></table></div><p>
   Considering that token creation operations do not happen as frequently as
   token validation operations, you are likely to experience less of a
   performance problem regardless of the extended time for token creation.
  </p></div><div class="sect2" id="sec-keystone-cron"><div class="titlepage"><div><div><h3 class="title"><span class="number">5.12.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">System cron jobs need setup</span> <a title="Permalink" class="permalink" href="ops-managing-identity.html#sec-keystone-cron">#</a><a class="report-bug" target="_blank" href="https://github.com/SUSE-Cloud/doc-cloud/blob/maintenance/cloud_9/xml/operations-configuring-identity-identity_limitations.xml" title="Edit the source file for this section">Edit source</a></h3><div class="doc-status"><ul><li><span class="ds-label">File Name: </span>operations-configuring-identity-identity_limitations.xml</li><li><span class="ds-label">ID: </span>sec-keystone-cron</li></ul></div></div></div></div><p>
   keystone relies on two cron jobs to periodically clean up expired tokens and
   for token revocation. The following is how the cron jobs appear on the
   system:
  </p><div class="verbatim-wrap"><pre class="screen">1 1 * * * /opt/stack/service/keystone/venv/bin/keystone-manage token_flush
1 1,5,10,15,20 * * * /opt/stack/service/keystone/venv/bin/revocation_cleanup.sh</pre></div><p>
   By default, the two cron jobs are enabled on controller node 1 only, not on
   the other two nodes. When controller node 1 is down or has failed for any
   reason, these two cron jobs must be manually set up on one of the other two
   nodes.
  </p></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="ops-managing-compute.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 6 </span>Managing Compute</span></a><a class="nav-link" href="third-party-integrations.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 4 </span>Third-Party Integrations</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2021 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>